(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7],{4035:function(e,t,r){"use strict";let i,n,a,o,s,l,c,u,h,A,d,f,m,p,g,y,v,E,x,C,B,w,I,b,_,M,S,D,T,R,F,P,Q,z,L,O,U,k,G,N,H,V;function j(){return(j=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)({}).hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e}).apply(null,arguments)}r.r(t),r.d(t,{AccumulativeShadows:function(){return gk},AdaptiveDpr:function(){return vi},AdaptiveEvents:function(){return vn},ArcballControls:function(){return c6},AsciiRenderer:function(){return cr},BBAnchor:function(){return mf},Backdrop:function(){return gY},BakeShadows:function(){return y8},Billboard:function(){return oe},Bounds:function(){return pZ},Box:function(){return pw},Bvh:function(){return mi},CameraControls:function(){return uH},CameraShake:function(){return p4},Capsule:function(){return pG},CatmullRomLine:function(){return oL},Caustics:function(){return g1},Center:function(){return mv},Circle:function(){return pI},Clone:function(){return s3},Cloud:function(){return yE},CloudInstance:function(){return yv},Clouds:function(){return yy},ComputedAttribute:function(){return sZ},Cone:function(){return pb},ContactShadows:function(){return gL},CubeCamera:function(){return cg},CubeTexture:function(){return hp},CubicBezierLine:function(){return oz},CurveModifier:function(){return m0},CycleRaycast:function(){return eH},Cylinder:function(){return p_},Decal:function(){return ln},Detailed:function(){return y5},DetectGPU:function(){return dm},DeviceOrientationControls:function(){return cb},Dodecahedron:function(){return pO},DragControls:function(){return t9},Edges:function(){return sT},Effects:function(){return sy},Environment:function(){return gP},EnvironmentCube:function(){return gT},EnvironmentMap:function(){return gD},EnvironmentPortal:function(){return gR},Example:function(){return mE},Extrude:function(){return pU},FaceControls:function(){return EH},FaceLandmarker:function(){return EO},FaceLandmarkerDefaults:function(){return EL},Facemesh:function(){return ER},FacemeshDatas:function(){return EQ},FacemeshEye:function(){return EP},FacemeshEyeDefaults:function(){return EF},Fbo:function(){return ch},Fbx:function(){return Ap},FirstPersonControls:function(){return uE},Fisheye:function(){return vf},Float:function(){return p5},FlyControls:function(){return cR},GizmoHelper:function(){return u9},GizmoViewcube:function(){return hc},GizmoViewport:function(){return hA},Gltf:function(){return ce},GradientTexture:function(){return sE},GradientType:function(){return sv},Grid:function(){return hf},Helper:function(){return A2},Html:function(){return eN},Hud:function(){return uq},Icosahedron:function(){return pz},Image:function(){return sD},Instance:function(){return mO},InstancedAttribute:function(){return mN},Instances:function(){return mU},IsObject:function(){return sC},KeyboardControls:function(){return aU},Ktx2:function(){return AV},Lathe:function(){return pk},Lightformer:function(){return ye},Line:function(){return oF},Loader:function(){return e1},MapControls:function(){return cN},MarchingCube:function(){return s7},MarchingCubes:function(){return s9},MarchingPlane:function(){return le},Mask:function(){return vA},MatcapTexture:function(){return yS},Merged:function(){return mk},MeshDiscardMaterial:function(){return pm},MeshDistortMaterial:function(){return m3},MeshPortalMaterial:function(){return vg},MeshReflectorMaterial:function(){return m7},MeshRefractionMaterial:function(){return ph},MeshTransmissionMaterial:function(){return pf},MeshWobbleMaterial:function(){return m5},MotionPathControls:function(){return uW},MultiMaterial:function(){return pp},NormalTexture:function(){return yT},Octahedron:function(){return pL},OrbitControls:function(){return cH},OrthographicCamera:function(){return cd},Outlines:function(){return sF},PerformanceMonitor:function(){return vo},PerspectiveCamera:function(){return cm},PivotControls:function(){return E_},Plane:function(){return pS},Point:function(){return yX},PointMaterial:function(){return pv},PointMaterialImpl:function(){return py},PointerLockControls:function(){return uf},Points:function(){return y$},PointsBuffer:function(){return yZ},Polyhedron:function(){return pQ},PositionMesh:function(){return mS},PositionPoint:function(){return yJ},PositionalAudio:function(){return oO},Preload:function(){return y6},PresentationControls:function(){return az},Progress:function(){return eZ},QuadraticBezierLine:function(){return oQ},RandomizedLight:function(){return gG},Reflector:function(){return g0},RenderCubeTexture:function(){return vu},RenderTexture:function(){return vl},Resize:function(){return pJ},Ring:function(){return pP},RoundedBox:function(){return pH},Sampler:function(){return sX},ScreenQuad:function(){return pj},ScreenSizer:function(){return oc},ScreenSpace:function(){return ot},ScreenVideoTexture:function(){return EM},Scroll:function(){return r1},ScrollControls:function(){return rX},Segment:function(){return y4},SegmentObject:function(){return y2},Segments:function(){return y0},Select:function(){return a9},Shadow:function(){return gW},ShadowAlpha:function(){return yG},Shape:function(){return pN},Sky:function(){return yo},SoftShadows:function(){return pC},Sparkles:function(){return y_},Sphere:function(){return pM},Splat:function(){return cc},SpotLight:function(){return g7},SpotLightShadow:function(){return g9},SpriteAnimator:function(){return mJ},Stage:function(){return gj},Stars:function(){return yc},Stats:function(){return A6},StatsGl:function(){return A7},Svg:function(){return lo},Tetrahedron:function(){return pF},Text:function(){return oG},Text3D:function(){return o2},Texture:function(){return sw},Torus:function(){return pT},TorusKnot:function(){return pR},TrackballControls:function(){return cW},Trail:function(){return sJ},TrailTexture:function(){return my},TransformControls:function(){return ui},Tube:function(){return pD},VideoTexture:function(){return Aq},View:function(){return vk},WebcamVideoTexture:function(){return ES},Wireframe:function(){return yk},accumulativeContext:function(){return gO},calcPosFromAngles:function(){return ya},calculateScaleFactor:function(){return os},checkIfFrameIsEmpty:function(){return A$},createInstances:function(){return mG},getFirstFrame:function(){return AZ},isWebGL2Available:function(){return sg},meshBounds:function(){return vr},shaderMaterial:function(){return sx},useAnimations:function(){return ma},useAspect:function(){return dt},useBVH:function(){return mr},useBounds:function(){return p$},useBoxProjectedEnv:function(){return mh},useCamera:function(){return dr},useContextBridge:function(){return mn},useCubeCamera:function(){return cp},useCubeTexture:function(){return hm},useCursor:function(){return eV},useDepthBuffer:function(){return de},useDetectGPU:function(){return df},useEnvironment:function(){return gx},useFBO:function(){return cu},useFBX:function(){return Am},useFaceControls:function(){return EV},useFaceLandmarker:function(){return EU},useFont:function(){return o$},useGLTF:function(){return l7},useGizmoContext:function(){return uZ},useHelper:function(){return A0},useIntersect:function(){return mo},useKTX2:function(){return AH},useKeyboardControls:function(){return ak},useMask:function(){return vd},useMatcapTexture:function(){return yM},useMotion:function(){return uJ},useNormalTexture:function(){return yD},usePerformanceMonitor:function(){return vs},useProgress:function(){return eX},useScroll:function(){return rq},useSelect:function(){return a7},useSpriteAnimator:function(){return mV},useSpriteLoader:function(){return A1},useSurfaceSampler:function(){return sq},useTexture:function(){return sB},useTrail:function(){return sj},useTrailTexture:function(){return mg},useVideoTexture:function(){return AK}});var J,Y,W,K,q,X,Z,$,ee,et,er,ei,en,ea,eo,es,el,ec,eu,eh,eA,ed,ef,em,ep,eg,ey,ev,eE,ex,eC,eB,ew,eI,eb,e_,eM,eS=r(2265),eD=r(4040),eT=r(6375),eR=r(2860);let eF=new eT.Vector3,eP=new eT.Vector3,eQ=new eT.Vector3,ez=new eT.Vector2;function eL(e,t,r){let i=eF.setFromMatrixPosition(e.matrixWorld);i.project(t);let n=r.width/2,a=r.height/2;return[i.x*n+n,-(i.y*a)+a]}let eO=e=>1e-10>Math.abs(e)?0:e;function eU(e,t,r=""){let i="matrix3d(";for(let r=0;16!==r;r++)i+=eO(t[r]*e.elements[r])+(15!==r?",":")");return r+i}let ek=(J=[1,-1,1,1,1,-1,1,1,1,-1,1,1,1,-1,1,1],e=>eU(e,J)),eG=(Y=e=>[1/e,1/e,1/e,1,-1/e,-1/e,-1/e,-1,1/e,1/e,1/e,1,1,1,1,1],(e,t)=>eU(e,Y(t),"translate(-50%,-50%)")),eN=eS.forwardRef(({children:e,eps:t=.001,style:r,className:i,prepend:n,center:a,fullscreen:o,portal:s,distanceFactor:l,sprite:c=!1,transform:u=!1,occlude:h,onOcclude:A,castShadow:d,receiveShadow:f,material:m,geometry:p,zIndexRange:g=[16777271,0],calculatePosition:y=eL,as:v="div",wrapperClass:E,pointerEvents:x="auto",...C},B)=>{let{gl:w,camera:I,scene:b,size:_,raycaster:M,events:S,viewport:D}=(0,eR.D)(),[T]=eS.useState(()=>document.createElement(v)),R=eS.useRef(),F=eS.useRef(null),P=eS.useRef(0),Q=eS.useRef([0,0]),z=eS.useRef(null),L=eS.useRef(null),O=(null==s?void 0:s.current)||S.connected||w.domElement.parentNode,U=eS.useRef(null),k=eS.useRef(!1),G=eS.useMemo(()=>{var e;return h&&"blending"!==h||Array.isArray(h)&&h.length&&(e=h[0])&&"object"==typeof e&&"current"in e},[h]);eS.useLayoutEffect(()=>{let e=w.domElement;h&&"blending"===h?(e.style.zIndex=`${Math.floor(g[0]/2)}`,e.style.position="absolute",e.style.pointerEvents="none"):(e.style.zIndex=null,e.style.position=null,e.style.pointerEvents=null)},[h]),eS.useLayoutEffect(()=>{if(F.current){let e=R.current=eD.createRoot(T);if(b.updateMatrixWorld(),u)T.style.cssText="position:absolute;top:0;left:0;pointer-events:none;overflow:hidden;";else{let e=y(F.current,I,_);T.style.cssText=`position:absolute;top:0;left:0;transform:translate3d(${e[0]}px,${e[1]}px,0);transform-origin:0 0;`}return O&&(n?O.prepend(T):O.appendChild(T)),()=>{O&&O.removeChild(T),e.unmount()}}},[O,u]),eS.useLayoutEffect(()=>{E&&(T.className=E)},[E]);let N=eS.useMemo(()=>u?{position:"absolute",top:0,left:0,width:_.width,height:_.height,transformStyle:"preserve-3d",pointerEvents:"none"}:{position:"absolute",transform:a?"translate3d(-50%,-50%,0)":"none",...o&&{top:-_.height/2,left:-_.width/2,width:_.width,height:_.height},...r},[r,a,o,_,u]),H=eS.useMemo(()=>({position:"absolute",pointerEvents:x}),[x]);eS.useLayoutEffect(()=>{var t,n;k.current=!1,u?null==(t=R.current)||t.render(eS.createElement("div",{ref:z,style:N},eS.createElement("div",{ref:L,style:H},eS.createElement("div",{ref:B,className:i,style:r,children:e})))):null==(n=R.current)||n.render(eS.createElement("div",{ref:B,style:N,className:i,children:e}))});let V=eS.useRef(!0);(0,eR.F)(e=>{if(F.current){I.updateMatrixWorld(),F.current.updateWorldMatrix(!0,!1);let e=u?Q.current:y(F.current,I,_);if(u||Math.abs(P.current-I.zoom)>t||Math.abs(Q.current[0]-e[0])>t||Math.abs(Q.current[1]-e[1])>t){let t=function(e,t){let r=eF.setFromMatrixPosition(e.matrixWorld),i=eP.setFromMatrixPosition(t.matrixWorld),n=r.sub(i),a=t.getWorldDirection(eQ);return n.angleTo(a)>Math.PI/2}(F.current,I),r=!1;G&&(Array.isArray(h)?r=h.map(e=>e.current):"blending"!==h&&(r=[b]));let i=V.current;if(r){let e=function(e,t,r,i){let n=eF.setFromMatrixPosition(e.matrixWorld),a=n.clone();a.project(t),ez.set(a.x,a.y),r.setFromCamera(ez,t);let o=r.intersectObjects(i,!0);if(o.length){let e=o[0].distance;return n.distanceTo(r.ray.origin)<e}return!0}(F.current,I,M,r);V.current=e&&!t}else V.current=!t;i!==V.current&&(A?A(!V.current):T.style.display=V.current?"block":"none");let n=Math.floor(g[0]/2),a=h?G?[g[0],n]:[n-1,0]:g;if(T.style.zIndex=`${function(e,t,r){if(t instanceof eT.PerspectiveCamera||t instanceof eT.OrthographicCamera){let i=eF.setFromMatrixPosition(e.matrixWorld),n=eP.setFromMatrixPosition(t.matrixWorld),a=i.distanceTo(n),o=(r[1]-r[0])/(t.far-t.near),s=r[1]-o*t.far;return Math.round(o*a+s)}}(F.current,I,a)}`,u){let[e,t]=[_.width/2,_.height/2],r=I.projectionMatrix.elements[5]*t,{isOrthographicCamera:i,top:n,left:a,bottom:o,right:s}=I,u=ek(I.matrixWorldInverse),h=i?`scale(${r})translate(${eO(-(s+a)/2)}px,${eO((n+o)/2)}px)`:`translateZ(${r}px)`,A=F.current.matrixWorld;c&&((A=I.matrixWorldInverse.clone().transpose().copyPosition(A).scale(F.current.scale)).elements[3]=A.elements[7]=A.elements[11]=0,A.elements[15]=1),T.style.width=_.width+"px",T.style.height=_.height+"px",T.style.perspective=i?"":`${r}px`,z.current&&L.current&&(z.current.style.transform=`${h}${u}translate(${e}px,${t}px)`,L.current.style.transform=eG(A,1/((l||10)/400)))}else{let t=void 0===l?1:function(e,t){if(t instanceof eT.OrthographicCamera)return t.zoom;if(!(t instanceof eT.PerspectiveCamera))return 1;{let r=eF.setFromMatrixPosition(e.matrixWorld),i=eP.setFromMatrixPosition(t.matrixWorld);return 1/(2*Math.tan(t.fov*Math.PI/180/2)*r.distanceTo(i))}}(F.current,I)*l;T.style.transform=`translate3d(${e[0]}px,${e[1]}px,0) scale(${t})`}Q.current=e,P.current=I.zoom}}if(!G&&U.current&&!k.current){if(u){if(z.current){let e=z.current.children[0];if(null!=e&&e.clientWidth&&null!=e&&e.clientHeight){let{isOrthographicCamera:t}=I;if(t||p)C.scale&&(Array.isArray(C.scale)?C.scale instanceof eT.Vector3?U.current.scale.copy(C.scale.clone().divideScalar(1)):U.current.scale.set(1/C.scale[0],1/C.scale[1],1/C.scale[2]):U.current.scale.setScalar(1/C.scale));else{let t=(l||10)/400,r=e.clientWidth*t,i=e.clientHeight*t;U.current.scale.set(r,i,1)}k.current=!0}}}else{let t=T.children[0];if(null!=t&&t.clientWidth&&null!=t&&t.clientHeight){let e=1/D.factor,r=t.clientWidth*e,i=t.clientHeight*e;U.current.scale.set(r,i,1),k.current=!0}U.current.lookAt(e.camera.position)}}});let J=eS.useMemo(()=>({vertexShader:u?void 0:`
          /*
            This shader is from the THREE's SpriteMaterial.
            We need to turn the backing plane into a Sprite
            (make it always face the camera) if "transfrom"
            is false.
          */
          #include <common>

          void main() {
            vec2 center = vec2(0., 1.);
            float rotation = 0.0;

            // This is somewhat arbitrary, but it seems to work well
            // Need to figure out how to derive this dynamically if it even matters
            float size = 0.03;

            vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
            vec2 scale;
            scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
            scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );

            bool isPerspective = isPerspectiveMatrix( projectionMatrix );
            if ( isPerspective ) scale *= - mvPosition.z;

            vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale * size;
            vec2 rotatedPosition;
            rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
            rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
            mvPosition.xy += rotatedPosition;

            gl_Position = projectionMatrix * mvPosition;
          }
      `,fragmentShader:`
        void main() {
          gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);
        }
      `}),[u]);return eS.createElement("group",j({},C,{ref:F}),h&&!G&&eS.createElement("mesh",{castShadow:d,receiveShadow:f,ref:U},p||eS.createElement("planeGeometry",null),m||eS.createElement("shaderMaterial",{side:eT.DoubleSide,vertexShader:J.vertexShader,fragmentShader:J.fragmentShader})))});function eH({onChanged:e,portal:t,preventDefault:r=!0,scroll:i=!0,keyCode:n=9}){let a=eS.useRef(0),o=(0,eR.D)(e=>e.setEvents),s=(0,eR.D)(e=>e.get),l=(0,eR.D)(e=>e.gl);return eS.useEffect(()=>{var c;let u;let h=[],A=s().events.filter,d=null!==(c=null==t?void 0:t.current)&&void 0!==c?c:l.domElement.parentNode,f=()=>d&&e&&e(h,Math.round(a.current)%h.length);o({filter:(e,t)=>{let r=[...e];r.length===h.length&&h.every(e=>r.map(e=>e.object.uuid).includes(e.object.uuid))||(a.current=0,h=r,f()),A&&(r=A(r,t));for(let e=0;e<Math.round(a.current)%r.length;e++){let e=r.shift();r=[...r,e]}return r}});let m=e=>{var t,r;a.current=e(a.current),null==(t=s().events.handlers)||t.onPointerCancel(void 0),null==(r=s().events.handlers)||r.onPointerMove(u),f()},p=e=>{(e.keyCode||e.which)===n&&(r&&e.preventDefault(),h.length>1&&m(e=>e+1))},g=e=>{r&&e.preventDefault();let t=0;e||(e=window.event),e.wheelDelta?t=e.wheelDelta/120:e.detail&&(t=-e.detail/3),h.length>1&&m(e=>Math.abs(e-t))},y=e=>u=e;return document.addEventListener("pointermove",y,{passive:!0}),i&&document.addEventListener("wheel",g),void 0!==n&&document.addEventListener("keydown",p),()=>{o({filter:A}),void 0!==n&&document.removeEventListener("keydown",p),i&&document.removeEventListener("wheel",g),document.removeEventListener("pointermove",y)}},[l,s,o,r,i,n]),null}function eV(e,t="pointer",r="auto",i=document.body){eS.useEffect(()=>{if(e)return i.style.cursor=t,()=>void(i.style.cursor=r)},[e])}let ej=e=>{let t;let r=new Set,i=(e,i)=>{let n="function"==typeof e?e(t):e;if(!Object.is(n,t)){let e=t;t=(null!=i?i:"object"!=typeof n||null===n)?n:Object.assign({},t,n),r.forEach(r=>r(t,e))}},n=()=>t,a={setState:i,getState:n,getInitialState:()=>o,subscribe:e=>(r.add(e),()=>r.delete(e))},o=t=e(i,n,a);return a},eJ=e=>e?ej(e):ej,eY=e=>e,eW=e=>{let t=eJ(e),r=e=>(function(e,t=eY){let r=eS.useSyncExternalStore(e.subscribe,()=>t(e.getState()),()=>t(e.getInitialState()));return eS.useDebugValue(r),r})(t,e);return Object.assign(r,t),r},eK=e=>e?eW(e):eW,eq=0,eX=eK(e=>(eT.DefaultLoadingManager.onStart=(t,r,i)=>{e({active:!0,item:t,loaded:r,total:i,progress:(r-eq)/(i-eq)*100})},eT.DefaultLoadingManager.onLoad=()=>{e({active:!1})},eT.DefaultLoadingManager.onError=t=>e(e=>({errors:[...e.errors,t]})),eT.DefaultLoadingManager.onProgress=(t,r,i)=>{r===i&&(eq=i),e({active:!0,item:t,loaded:r,total:i,progress:(r-eq)/(i-eq)*100||100})},{errors:[],active:!1,progress:0,item:"",loaded:0,total:0}));function eZ({children:e}){let t=eX();return eS.createElement(eS.Fragment,null,null==e?void 0:e(t))}let e$=e=>`Loading ${e.toFixed(2)}%`;function e1({containerStyles:e,innerStyles:t,barStyles:r,dataStyles:i,dataInterpolation:n=e$,initialState:a=e=>e}){let{active:o,progress:s}=eX(),l=eS.useRef(0),c=eS.useRef(0),u=eS.useRef(null),[h,A]=eS.useState(a(o));eS.useEffect(()=>{let e;return o!==h&&(e=setTimeout(()=>A(o),300)),()=>clearTimeout(e)},[h,o]);let d=eS.useCallback(()=>{u.current&&(l.current+=(s-l.current)/2,(l.current>.95*s||100===s)&&(l.current=s),u.current.innerText=n(l.current),l.current<s&&(c.current=requestAnimationFrame(d)))},[n,s]);return eS.useEffect(()=>(d(),()=>cancelAnimationFrame(c.current)),[d]),h?eS.createElement("div",{style:{...e0.container,opacity:o?1:0,...e}},eS.createElement("div",null,eS.createElement("div",{style:{...e0.inner,...t}},eS.createElement("div",{style:{...e0.bar,transform:`scaleX(${s/100})`,...r}}),eS.createElement("span",{ref:u,style:{...e0.data,...i}})))):null}let e0={container:{position:"absolute",top:0,left:0,width:"100%",height:"100%",background:"#171717",display:"flex",alignItems:"center",justifyContent:"center",transition:"opacity 300ms ease",zIndex:1e3},inner:{width:100,height:3,background:"#272727",textAlign:"center"},bar:{height:3,width:"100%",background:"white",transition:"transform 200ms",transformOrigin:"left center"},data:{display:"inline-block",position:"relative",fontVariantNumeric:"tabular-nums",marginTop:"0.8em",color:"#f0f0f0",fontSize:"0.6em",fontFamily:'-apple-system, BlinkMacSystemFont, "Inter", "Segoe UI", "Helvetica Neue", Helvetica, Arial, Roboto, Ubuntu, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol"',whiteSpace:"nowrap"}},e2={toVector:(e,t)=>(void 0===e&&(e=t),Array.isArray(e)?e:[e,e]),add:(e,t)=>[e[0]+t[0],e[1]+t[1]],sub:(e,t)=>[e[0]-t[0],e[1]-t[1]],addTo(e,t){e[0]+=t[0],e[1]+=t[1]},subTo(e,t){e[0]-=t[0],e[1]-=t[1]}};function e3(e,t,r){return 0===t||Math.abs(t)===1/0?Math.pow(e,5*r):e*t*r/(t+r*e)}function e4(e,t,r,i=.15){return 0===i?Math.max(t,Math.min(e,r)):e<t?-e3(t-e,r-t,i)+t:e>r?+e3(e-r,r-t,i)+r:e}function e5(e,t,r){var i;return(t="symbol"==typeof(i=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,t||"default");if("object"!=typeof i)return i;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(t,"string"))?i:String(i))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function e6(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,i)}return r}function e8(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?e6(Object(r),!0).forEach(function(t){e5(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):e6(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}let e9={pointer:{start:"down",change:"move",end:"up"},mouse:{start:"down",change:"move",end:"up"},touch:{start:"start",change:"move",end:"end"},gesture:{start:"start",change:"change",end:"end"}};function e7(e){return e?e[0].toUpperCase()+e.slice(1):""}let te=["enter","leave"],tt=["gotpointercapture","lostpointercapture"];function tr(e){return"touches"in e}function ti(e){return tr(e)?"touch":"pointerType"in e?e.pointerType:"mouse"}function tn(e){return tr(e)?("touchend"===e.type||"touchcancel"===e.type?e.changedTouches:e.targetTouches)[0]:e}function ta(e,t){try{let r=t.clientX-e.clientX,i=t.clientY-e.clientY,n=(t.clientX+e.clientX)/2,a=(t.clientY+e.clientY)/2;return{angle:-(180*Math.atan2(r,i))/Math.PI,distance:Math.hypot(r,i),origin:[n,a]}}catch(e){}return null}function to(e,t){let[r,i]=Array.from(e.touches).filter(e=>t.includes(e.identifier));return ta(r,i)}function ts(e){let t=tn(e);return tr(e)?t.identifier:t.pointerId}function tl(e){let t=tn(e);return[t.clientX,t.clientY]}function tc(e){let{deltaX:t,deltaY:r,deltaMode:i}=e;return 1===i?(t*=40,r*=40):2===i&&(t*=800,r*=800),[t,r]}function tu(e,...t){return"function"==typeof e?e(...t):e}function th(){}function tA(e,t){return Object.assign({},t,e||{})}class td{constructor(e,t,r){this.ctrl=e,this.args=t,this.key=r,this.state||(this.state={},this.computeValues([0,0]),this.computeInitial(),this.init&&this.init(),this.reset())}get state(){return this.ctrl.state[this.key]}set state(e){this.ctrl.state[this.key]=e}get shared(){return this.ctrl.state.shared}get eventStore(){return this.ctrl.gestureEventStores[this.key]}get timeoutStore(){return this.ctrl.gestureTimeoutStores[this.key]}get config(){return this.ctrl.config[this.key]}get sharedConfig(){return this.ctrl.config.shared}get handler(){return this.ctrl.handlers[this.key]}reset(){let{state:e,shared:t,ingKey:r,args:i}=this;t[r]=e._active=e.active=e._blocked=e._force=!1,e._step=[!1,!1],e.intentional=!1,e._movement=[0,0],e._distance=[0,0],e._direction=[0,0],e._delta=[0,0],e._bounds=[[-1/0,1/0],[-1/0,1/0]],e.args=i,e.axis=void 0,e.memo=void 0,e.elapsedTime=e.timeDelta=0,e.direction=[0,0],e.distance=[0,0],e.overflow=[0,0],e._movementBound=[!1,!1],e.velocity=[0,0],e.movement=[0,0],e.delta=[0,0],e.timeStamp=0}start(e){let t=this.state,r=this.config;t._active||(this.reset(),this.computeInitial(),t._active=!0,t.target=e.target,t.currentTarget=e.currentTarget,t.lastOffset=r.from?tu(r.from,t):t.offset,t.offset=t.lastOffset,t.startTime=t.timeStamp=e.timeStamp)}computeValues(e){let t=this.state;t._values=e,t.values=this.config.transform(e)}computeInitial(){let e=this.state;e._initial=e._values,e.initial=e.values}compute(e){let{state:t,config:r,shared:i}=this;t.args=this.args;let n=0;if(e&&(t.event=e,r.preventDefault&&e.cancelable&&t.event.preventDefault(),t.type=e.type,i.touches=this.ctrl.pointerIds.size||this.ctrl.touchIds.size,i.locked=!!document.pointerLockElement,Object.assign(i,function(e){let t={};if("buttons"in e&&(t.buttons=e.buttons),"shiftKey"in e){let{shiftKey:r,altKey:i,metaKey:n,ctrlKey:a}=e;Object.assign(t,{shiftKey:r,altKey:i,metaKey:n,ctrlKey:a})}return t}(e)),i.down=i.pressed=i.buttons%2==1||i.touches>0,n=e.timeStamp-t.timeStamp,t.timeStamp=e.timeStamp,t.elapsedTime=t.timeStamp-t.startTime),t._active){let e=t._delta.map(Math.abs);e2.addTo(t._distance,e)}this.axisIntent&&this.axisIntent(e);let[a,o]=t._movement,[s,l]=r.threshold,{_step:c,values:u}=t;if(r.hasCustomTransform?(!1===c[0]&&(c[0]=Math.abs(a)>=s&&u[0]),!1===c[1]&&(c[1]=Math.abs(o)>=l&&u[1])):(!1===c[0]&&(c[0]=Math.abs(a)>=s&&Math.sign(a)*s),!1===c[1]&&(c[1]=Math.abs(o)>=l&&Math.sign(o)*l)),t.intentional=!1!==c[0]||!1!==c[1],!t.intentional)return;let h=[0,0];if(r.hasCustomTransform){let[e,t]=u;h[0]=!1!==c[0]?e-c[0]:0,h[1]=!1!==c[1]?t-c[1]:0}else h[0]=!1!==c[0]?a-c[0]:0,h[1]=!1!==c[1]?o-c[1]:0;this.restrictToAxis&&!t._blocked&&this.restrictToAxis(h);let A=t.offset,d=t._active&&!t._blocked||t.active;d&&(t.first=t._active&&!t.active,t.last=!t._active&&t.active,t.active=i[this.ingKey]=t._active,e&&(t.first&&("bounds"in r&&(t._bounds=tu(r.bounds,t)),this.setup&&this.setup()),t.movement=h,this.computeOffset()));let[f,m]=t.offset,[[p,g],[y,v]]=t._bounds;t.overflow=[f<p?-1:f>g?1:0,m<y?-1:m>v?1:0],t._movementBound[0]=!!t.overflow[0]&&(!1===t._movementBound[0]?t._movement[0]:t._movementBound[0]),t._movementBound[1]=!!t.overflow[1]&&(!1===t._movementBound[1]?t._movement[1]:t._movementBound[1]);let E=t._active&&r.rubberband||[0,0];if(t.offset=function(e,[t,r],[i,n]){let[[a,o],[s,l]]=e;return[e4(t,a,o,i),e4(r,s,l,n)]}(t._bounds,t.offset,E),t.delta=e2.sub(t.offset,A),this.computeMovement(),d&&(!t.last||n>32)){t.delta=e2.sub(t.offset,A);let e=t.delta.map(Math.abs);e2.addTo(t.distance,e),t.direction=t.delta.map(Math.sign),t._direction=t._delta.map(Math.sign),!t.first&&n>0&&(t.velocity=[e[0]/n,e[1]/n],t.timeDelta=n)}}emit(){let e=this.state,t=this.shared,r=this.config;if(e._active||this.clean(),(e._blocked||!e.intentional)&&!e._force&&!r.triggerAllEvents)return;let i=this.handler(e8(e8(e8({},t),e),{},{[this.aliasKey]:e.values}));void 0!==i&&(e.memo=i)}clean(){this.eventStore.clean(),this.timeoutStore.clean()}}class tf extends td{constructor(...e){super(...e),e5(this,"aliasKey","xy")}reset(){super.reset(),this.state.axis=void 0}init(){this.state.offset=[0,0],this.state.lastOffset=[0,0]}computeOffset(){this.state.offset=e2.add(this.state.lastOffset,this.state.movement)}computeMovement(){this.state.movement=e2.sub(this.state.offset,this.state.lastOffset)}axisIntent(e){let t=this.state,r=this.config;if(!t.axis&&e){let i="object"==typeof r.axisThreshold?r.axisThreshold[ti(e)]:r.axisThreshold;t.axis=function([e,t],r){let i=Math.abs(e),n=Math.abs(t);return i>n&&i>r?"x":n>i&&n>r?"y":void 0}(t._movement,i)}t._blocked=(r.lockDirection||!!r.axis)&&!t.axis||!!r.axis&&r.axis!==t.axis}restrictToAxis(e){if(this.config.axis||this.config.lockDirection)switch(this.state.axis){case"x":e[1]=0;break;case"y":e[0]=0}}}let tm=e=>e,tp={enabled:(e=!0)=>e,eventOptions:(e,t,r)=>e8(e8({},r.shared.eventOptions),e),preventDefault:(e=!1)=>e,triggerAllEvents:(e=!1)=>e,rubberband(e=0){switch(e){case!0:return[.15,.15];case!1:return[0,0];default:return e2.toVector(e)}},from:e=>"function"==typeof e?e:null!=e?e2.toVector(e):void 0,transform(e,t,r){let i=e||r.shared.transform;return this.hasCustomTransform=!!i,i||tm},threshold:e=>e2.toVector(e,0)},tg=0,ty=e8(e8({},tp),{},{axis(e,t,{axis:r}){if(this.lockDirection="lock"===r,!this.lockDirection)return r},axisThreshold:(e=tg)=>e,bounds(e={}){if("function"==typeof e)return t=>ty.bounds(e(t));if("current"in e)return()=>e.current;if("function"==typeof HTMLElement&&e instanceof HTMLElement)return e;let{left:t=-1/0,right:r=1/0,top:i=-1/0,bottom:n=1/0}=e;return[[t,r],[i,n]]}}),tv={ArrowRight:(e,t=1)=>[e*t,0],ArrowLeft:(e,t=1)=>[-1*e*t,0],ArrowUp:(e,t=1)=>[0,-1*e*t],ArrowDown:(e,t=1)=>[0,e*t]};class tE extends tf{constructor(...e){super(...e),e5(this,"ingKey","dragging")}reset(){super.reset();let e=this.state;e._pointerId=void 0,e._pointerActive=!1,e._keyboardActive=!1,e._preventScroll=!1,e._delayed=!1,e.swipe=[0,0],e.tap=!1,e.canceled=!1,e.cancel=this.cancel.bind(this)}setup(){let e=this.state;if(e._bounds instanceof HTMLElement){let t=e._bounds.getBoundingClientRect(),r=e.currentTarget.getBoundingClientRect(),i={left:t.left-r.left+e.offset[0],right:t.right-r.right+e.offset[0],top:t.top-r.top+e.offset[1],bottom:t.bottom-r.bottom+e.offset[1]};e._bounds=ty.bounds(i)}}cancel(){let e=this.state;e.canceled||(e.canceled=!0,e._active=!1,setTimeout(()=>{this.compute(),this.emit()},0))}setActive(){this.state._active=this.state._pointerActive||this.state._keyboardActive}clean(){this.pointerClean(),this.state._pointerActive=!1,this.state._keyboardActive=!1,super.clean()}pointerDown(e){let t=this.config,r=this.state;if(null!=e.buttons&&(Array.isArray(t.pointerButtons)?!t.pointerButtons.includes(e.buttons):-1!==t.pointerButtons&&t.pointerButtons!==e.buttons))return;let i=this.ctrl.setEventIds(e);t.pointerCapture&&e.target.setPointerCapture(e.pointerId),i&&i.size>1&&r._pointerActive||(this.start(e),this.setupPointer(e),r._pointerId=ts(e),r._pointerActive=!0,this.computeValues(tl(e)),this.computeInitial(),t.preventScrollAxis&&"mouse"!==ti(e)?(r._active=!1,this.setupScrollPrevention(e)):t.delay>0?(this.setupDelayTrigger(e),t.triggerAllEvents&&(this.compute(e),this.emit())):this.startPointerDrag(e))}startPointerDrag(e){let t=this.state;t._active=!0,t._preventScroll=!0,t._delayed=!1,this.compute(e),this.emit()}pointerMove(e){let t=this.state,r=this.config;if(!t._pointerActive)return;let i=ts(e);if(void 0!==t._pointerId&&i!==t._pointerId)return;let n=tl(e);if(document.pointerLockElement===e.target?t._delta=[e.movementX,e.movementY]:(t._delta=e2.sub(n,t._values),this.computeValues(n)),e2.addTo(t._movement,t._delta),this.compute(e),t._delayed&&t.intentional){this.timeoutStore.remove("dragDelay"),t.active=!1,this.startPointerDrag(e);return}if(r.preventScrollAxis&&!t._preventScroll){if(!t.axis)return;if(t.axis===r.preventScrollAxis||"xy"===r.preventScrollAxis){t._active=!1,this.clean();return}this.timeoutStore.remove("startPointerDrag"),this.startPointerDrag(e);return}this.emit()}pointerUp(e){this.ctrl.setEventIds(e);try{this.config.pointerCapture&&e.target.hasPointerCapture(e.pointerId)&&e.target.releasePointerCapture(e.pointerId)}catch(e){}let t=this.state,r=this.config;if(!t._active||!t._pointerActive)return;let i=ts(e);if(void 0!==t._pointerId&&i!==t._pointerId)return;this.state._pointerActive=!1,this.setActive(),this.compute(e);let[n,a]=t._distance;if(t.tap=n<=r.tapsThreshold&&a<=r.tapsThreshold,t.tap&&r.filterTaps)t._force=!0;else{let[e,i]=t._delta,[n,a]=t._movement,[o,s]=r.swipe.velocity,[l,c]=r.swipe.distance,u=r.swipe.duration;if(t.elapsedTime<u){let r=Math.abs(e/t.timeDelta),u=Math.abs(i/t.timeDelta);r>o&&Math.abs(n)>l&&(t.swipe[0]=Math.sign(e)),u>s&&Math.abs(a)>c&&(t.swipe[1]=Math.sign(i))}}this.emit()}pointerClick(e){!this.state.tap&&e.detail>0&&(e.preventDefault(),e.stopPropagation())}setupPointer(e){let t=this.config,r=t.device;t.pointerLock&&e.currentTarget.requestPointerLock(),t.pointerCapture||(this.eventStore.add(this.sharedConfig.window,r,"change",this.pointerMove.bind(this)),this.eventStore.add(this.sharedConfig.window,r,"end",this.pointerUp.bind(this)),this.eventStore.add(this.sharedConfig.window,r,"cancel",this.pointerUp.bind(this)))}pointerClean(){this.config.pointerLock&&document.pointerLockElement===this.state.currentTarget&&document.exitPointerLock()}preventScroll(e){this.state._preventScroll&&e.cancelable&&e.preventDefault()}setupScrollPrevention(e){this.state._preventScroll=!1,"persist"in e&&"function"==typeof e.persist&&e.persist();let t=this.eventStore.add(this.sharedConfig.window,"touch","change",this.preventScroll.bind(this),{passive:!1});this.eventStore.add(this.sharedConfig.window,"touch","end",t),this.eventStore.add(this.sharedConfig.window,"touch","cancel",t),this.timeoutStore.add("startPointerDrag",this.startPointerDrag.bind(this),this.config.preventScrollDelay,e)}setupDelayTrigger(e){this.state._delayed=!0,this.timeoutStore.add("dragDelay",()=>{this.state._step=[0,0],this.startPointerDrag(e)},this.config.delay)}keyDown(e){let t=tv[e.key];if(t){let r=this.state,i=e.shiftKey?10:e.altKey?.1:1;this.start(e),r._delta=t(this.config.keyboardDisplacement,i),r._keyboardActive=!0,e2.addTo(r._movement,r._delta),this.compute(e),this.emit()}}keyUp(e){e.key in tv&&(this.state._keyboardActive=!1,this.setActive(),this.compute(e),this.emit())}bind(e){let t=this.config.device;e(t,"start",this.pointerDown.bind(this)),this.config.pointerCapture&&(e(t,"change",this.pointerMove.bind(this)),e(t,"end",this.pointerUp.bind(this)),e(t,"cancel",this.pointerUp.bind(this)),e("lostPointerCapture","",this.pointerUp.bind(this))),this.config.keys&&(e("key","down",this.keyDown.bind(this)),e("key","up",this.keyUp.bind(this))),this.config.filterTaps&&e("click","",this.pointerClick.bind(this),{capture:!0,passive:!1})}}let tx="undefined"!=typeof window&&window.document&&window.document.createElement;function tC(){return tx&&"ontouchstart"in window}let tB={isBrowser:tx,gesture:function(){try{return"constructor"in GestureEvent}catch(e){return!1}}(),touch:tC(),touchscreen:tC()||tx&&window.navigator.maxTouchPoints>1,pointer:tx&&"onpointerdown"in window,pointerLock:tx&&"exitPointerLock"in window.document},tw=10,tI={mouse:0,touch:0,pen:8},tb=e8(e8({},ty),{},{device(e,t,{pointer:{touch:r=!1,lock:i=!1,mouse:n=!1}={}}){return(this.pointerLock=i&&tB.pointerLock,tB.touch&&r)?"touch":this.pointerLock?"mouse":tB.pointer&&!n?"pointer":tB.touch?"touch":"mouse"},preventScrollAxis(e,t,{preventScroll:r}){if(this.preventScrollDelay="number"==typeof r?r:r||void 0===r&&e?250:void 0,tB.touchscreen&&!1!==r)return e||(void 0!==r?"y":void 0)},pointerCapture(e,t,{pointer:{capture:r=!0,buttons:i=1,keys:n=!0}={}}){return this.pointerButtons=i,this.keys=n,!this.pointerLock&&"pointer"===this.device&&r},threshold(e,t,{filterTaps:r=!1,tapsThreshold:i=3,axis:n}){let a=e2.toVector(e,r?i:n?1:0);return this.filterTaps=r,this.tapsThreshold=i,a},swipe({velocity:e=.5,distance:t=50,duration:r=250}={}){return{velocity:this.transform(e2.toVector(e)),distance:this.transform(e2.toVector(t)),duration:r}},delay(e=0){switch(e){case!0:return 180;case!1:return 0;default:return e}},axisThreshold:e=>e?e8(e8({},tI),e):tI,keyboardDisplacement:(e=tw)=>e});function t_(e){let[t,r]=e.overflow,[i,n]=e._delta,[a,o]=e._direction;(t<0&&i>0&&a<0||t>0&&i<0&&a>0)&&(e._movement[0]=e._movementBound[0]),(r<0&&n>0&&o<0||r>0&&n<0&&o>0)&&(e._movement[1]=e._movementBound[1])}class tM extends td{constructor(...e){super(...e),e5(this,"ingKey","pinching"),e5(this,"aliasKey","da")}init(){this.state.offset=[1,0],this.state.lastOffset=[1,0],this.state._pointerEvents=new Map}reset(){super.reset();let e=this.state;e._touchIds=[],e.canceled=!1,e.cancel=this.cancel.bind(this),e.turns=0}computeOffset(){let{type:e,movement:t,lastOffset:r}=this.state;"wheel"===e?this.state.offset=e2.add(t,r):this.state.offset=[(1+t[0])*r[0],t[1]+r[1]]}computeMovement(){let{offset:e,lastOffset:t}=this.state;this.state.movement=[e[0]/t[0],e[1]-t[1]]}axisIntent(){let e=this.state,[t,r]=e._movement;if(!e.axis){let i=30*Math.abs(t)-Math.abs(r);i<0?e.axis="angle":i>0&&(e.axis="scale")}}restrictToAxis(e){this.config.lockDirection&&("scale"===this.state.axis?e[1]=0:"angle"===this.state.axis&&(e[0]=0))}cancel(){let e=this.state;e.canceled||setTimeout(()=>{e.canceled=!0,e._active=!1,this.compute(),this.emit()},0)}touchStart(e){this.ctrl.setEventIds(e);let t=this.state,r=this.ctrl.touchIds;if(t._active&&t._touchIds.every(e=>r.has(e))||r.size<2)return;this.start(e),t._touchIds=Array.from(r).slice(0,2);let i=to(e,t._touchIds);i&&this.pinchStart(e,i)}pointerStart(e){if(null!=e.buttons&&e.buttons%2!=1)return;this.ctrl.setEventIds(e),e.target.setPointerCapture(e.pointerId);let t=this.state,r=t._pointerEvents,i=this.ctrl.pointerIds;if(t._active&&Array.from(r.keys()).every(e=>i.has(e))||(r.size<2&&r.set(e.pointerId,e),t._pointerEvents.size<2))return;this.start(e);let n=ta(...Array.from(r.values()));n&&this.pinchStart(e,n)}pinchStart(e,t){this.state.origin=t.origin,this.computeValues([t.distance,t.angle]),this.computeInitial(),this.compute(e),this.emit()}touchMove(e){if(!this.state._active)return;let t=to(e,this.state._touchIds);t&&this.pinchMove(e,t)}pointerMove(e){let t=this.state._pointerEvents;if(t.has(e.pointerId)&&t.set(e.pointerId,e),!this.state._active)return;let r=ta(...Array.from(t.values()));r&&this.pinchMove(e,r)}pinchMove(e,t){let r=this.state,i=r._values[1],n=t.angle-i,a=0;Math.abs(n)>270&&(a+=Math.sign(n)),this.computeValues([t.distance,t.angle-360*a]),r.origin=t.origin,r.turns=a,r._movement=[r._values[0]/r._initial[0]-1,r._values[1]-r._initial[1]],this.compute(e),this.emit()}touchEnd(e){this.ctrl.setEventIds(e),this.state._active&&this.state._touchIds.some(e=>!this.ctrl.touchIds.has(e))&&(this.state._active=!1,this.compute(e),this.emit())}pointerEnd(e){let t=this.state;this.ctrl.setEventIds(e);try{e.target.releasePointerCapture(e.pointerId)}catch(e){}t._pointerEvents.has(e.pointerId)&&t._pointerEvents.delete(e.pointerId),t._active&&t._pointerEvents.size<2&&(t._active=!1,this.compute(e),this.emit())}gestureStart(e){e.cancelable&&e.preventDefault();let t=this.state;t._active||(this.start(e),this.computeValues([e.scale,e.rotation]),t.origin=[e.clientX,e.clientY],this.compute(e),this.emit())}gestureMove(e){if(e.cancelable&&e.preventDefault(),!this.state._active)return;let t=this.state;this.computeValues([e.scale,e.rotation]),t.origin=[e.clientX,e.clientY];let r=t._movement;t._movement=[e.scale-1,e.rotation],t._delta=e2.sub(t._movement,r),this.compute(e),this.emit()}gestureEnd(e){this.state._active&&(this.state._active=!1,this.compute(e),this.emit())}wheel(e){let t=this.config.modifierKey;(!t||(Array.isArray(t)?t.find(t=>e[t]):e[t]))&&(this.state._active?this.wheelChange(e):this.wheelStart(e),this.timeoutStore.add("wheelEnd",this.wheelEnd.bind(this)))}wheelStart(e){this.start(e),this.wheelChange(e)}wheelChange(e){"uv"in e||!e.cancelable||e.preventDefault();let t=this.state;t._delta=[-tc(e)[1]/100*t.offset[0],0],e2.addTo(t._movement,t._delta),t_(t),this.state.origin=[e.clientX,e.clientY],this.compute(e),this.emit()}wheelEnd(){this.state._active&&(this.state._active=!1,this.compute(),this.emit())}bind(e){let t=this.config.device;t&&(e(t,"start",this[t+"Start"].bind(this)),e(t,"change",this[t+"Move"].bind(this)),e(t,"end",this[t+"End"].bind(this)),e(t,"cancel",this[t+"End"].bind(this)),e("lostPointerCapture","",this[t+"End"].bind(this))),this.config.pinchOnWheel&&e("wheel","",this.wheel.bind(this),{passive:!1})}}let tS=e8(e8({},tp),{},{device(e,t,{shared:r,pointer:{touch:i=!1}={}}){if(r.target&&!tB.touch&&tB.gesture)return"gesture";if(tB.touch&&i)return"touch";if(tB.touchscreen){if(tB.pointer)return"pointer";if(tB.touch)return"touch"}},bounds(e,t,{scaleBounds:r={},angleBounds:i={}}){let n=e=>{let t=tA(tu(r,e),{min:-1/0,max:1/0});return[t.min,t.max]},a=e=>{let t=tA(tu(i,e),{min:-1/0,max:1/0});return[t.min,t.max]};return"function"!=typeof r&&"function"!=typeof i?[n(),a()]:e=>[n(e),a(e)]},threshold(e,t,r){return this.lockDirection="lock"===r.axis,e2.toVector(e,this.lockDirection?[.1,3]:0)},modifierKey:e=>void 0===e?"ctrlKey":e,pinchOnWheel:(e=!0)=>e});class tD extends tf{constructor(...e){super(...e),e5(this,"ingKey","moving")}move(e){this.config.mouseOnly&&"mouse"!==e.pointerType||(this.state._active?this.moveChange(e):this.moveStart(e),this.timeoutStore.add("moveEnd",this.moveEnd.bind(this)))}moveStart(e){this.start(e),this.computeValues(tl(e)),this.compute(e),this.computeInitial(),this.emit()}moveChange(e){if(!this.state._active)return;let t=tl(e),r=this.state;r._delta=e2.sub(t,r._values),e2.addTo(r._movement,r._delta),this.computeValues(t),this.compute(e),this.emit()}moveEnd(e){this.state._active&&(this.state._active=!1,this.compute(e),this.emit())}bind(e){e("pointer","change",this.move.bind(this)),e("pointer","leave",this.moveEnd.bind(this))}}let tT=e8(e8({},ty),{},{mouseOnly:(e=!0)=>e});class tR extends tf{constructor(...e){super(...e),e5(this,"ingKey","scrolling")}scroll(e){this.state._active||this.start(e),this.scrollChange(e),this.timeoutStore.add("scrollEnd",this.scrollEnd.bind(this))}scrollChange(e){e.cancelable&&e.preventDefault();let t=this.state,r=function(e){var t,r;let{scrollX:i,scrollY:n,scrollLeft:a,scrollTop:o}=e.currentTarget;return[null!==(t=null!=i?i:a)&&void 0!==t?t:0,null!==(r=null!=n?n:o)&&void 0!==r?r:0]}(e);t._delta=e2.sub(r,t._values),e2.addTo(t._movement,t._delta),this.computeValues(r),this.compute(e),this.emit()}scrollEnd(){this.state._active&&(this.state._active=!1,this.compute(),this.emit())}bind(e){e("scroll","",this.scroll.bind(this))}}class tF extends tf{constructor(...e){super(...e),e5(this,"ingKey","wheeling")}wheel(e){this.state._active||this.start(e),this.wheelChange(e),this.timeoutStore.add("wheelEnd",this.wheelEnd.bind(this))}wheelChange(e){let t=this.state;t._delta=tc(e),e2.addTo(t._movement,t._delta),t_(t),this.compute(e),this.emit()}wheelEnd(){this.state._active&&(this.state._active=!1,this.compute(),this.emit())}bind(e){e("wheel","",this.wheel.bind(this))}}class tP extends tf{constructor(...e){super(...e),e5(this,"ingKey","hovering")}enter(e){this.config.mouseOnly&&"mouse"!==e.pointerType||(this.start(e),this.computeValues(tl(e)),this.compute(e),this.emit())}leave(e){if(this.config.mouseOnly&&"mouse"!==e.pointerType)return;let t=this.state;if(!t._active)return;t._active=!1;let r=tl(e);t._movement=t._delta=e2.sub(r,t._values),this.computeValues(r),this.compute(e),t.delta=t.movement,this.emit()}bind(e){e("pointer","enter",this.enter.bind(this)),e("pointer","leave",this.leave.bind(this))}}let tQ=e8(e8({},ty),{},{mouseOnly:(e=!0)=>e}),tz=new Map,tL=new Map;function tO(e){tz.set(e.key,e.engine),tL.set(e.key,e.resolver)}let tU={key:"drag",engine:tE,resolver:tb},tk={key:"hover",engine:tP,resolver:tQ},tG={key:"move",engine:tD,resolver:tT},tN={key:"pinch",engine:tM,resolver:tS},tH={key:"scroll",engine:tR,resolver:ty},tV={key:"wheel",engine:tF,resolver:ty},tj={target(e){if(e)return()=>"current"in e?e.current:e},enabled:(e=!0)=>e,window:(e=tB.isBrowser?window:void 0)=>e,eventOptions:({passive:e=!0,capture:t=!1}={})=>({passive:e,capture:t}),transform:e=>e},tJ=["target","eventOptions","window","enabled","transform"];function tY(e={},t){let r={};for(let[i,n]of Object.entries(t))switch(typeof n){case"function":r[i]=n.call(r,e[i],i,e);break;case"object":r[i]=tY(e[i],n);break;case"boolean":n&&(r[i]=e[i])}return r}class tW{constructor(e,t){e5(this,"_listeners",new Set),this._ctrl=e,this._gestureKey=t}add(e,t,r,i,n){let a=this._listeners,o=function(e,t=""){let r=e9[e];return e+(r&&r[t]||t)}(t,r),s=e8(e8({},this._gestureKey?this._ctrl.config[this._gestureKey].eventOptions:{}),n);e.addEventListener(o,i,s);let l=()=>{e.removeEventListener(o,i,s),a.delete(l)};return a.add(l),l}clean(){this._listeners.forEach(e=>e()),this._listeners.clear()}}class tK{constructor(){e5(this,"_timeouts",new Map)}add(e,t,r=140,...i){this.remove(e),this._timeouts.set(e,window.setTimeout(t,r,...i))}remove(e){let t=this._timeouts.get(e);t&&window.clearTimeout(t)}clean(){this._timeouts.forEach(e=>void window.clearTimeout(e)),this._timeouts.clear()}}class tq{constructor(e){e5(this,"gestures",new Set),e5(this,"_targetEventStore",new tW(this)),e5(this,"gestureEventStores",{}),e5(this,"gestureTimeoutStores",{}),e5(this,"handlers",{}),e5(this,"config",{}),e5(this,"pointerIds",new Set),e5(this,"touchIds",new Set),e5(this,"state",{shared:{shiftKey:!1,metaKey:!1,ctrlKey:!1,altKey:!1}}),e.drag&&tX(this,"drag"),e.wheel&&tX(this,"wheel"),e.scroll&&tX(this,"scroll"),e.move&&tX(this,"move"),e.pinch&&tX(this,"pinch"),e.hover&&tX(this,"hover")}setEventIds(e){return tr(e)?(this.touchIds=new Set(Array.from(e.touches).filter(t=>{var r,i;return t.target===e.currentTarget||(null===(r=e.currentTarget)||void 0===r||null===(i=r.contains)||void 0===i?void 0:i.call(r,t.target))}).map(e=>e.identifier)),this.touchIds):"pointerId"in e?("pointerup"===e.type||"pointercancel"===e.type?this.pointerIds.delete(e.pointerId):"pointerdown"===e.type&&this.pointerIds.add(e.pointerId),this.pointerIds):void 0}applyHandlers(e,t){this.handlers=e,this.nativeHandlers=t}applyConfig(e,t){this.config=function(e,t,r={}){let{target:i,eventOptions:n,window:a,enabled:o,transform:s}=e,l=function(e,t){if(null==e)return{};var r,i,n=function(e,t){if(null==e)return{};var r,i,n={},a=Object.keys(e);for(i=0;i<a.length;i++)r=a[i],t.indexOf(r)>=0||(n[r]=e[r]);return n}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(i=0;i<a.length;i++)r=a[i],!(t.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}(e,tJ);if(r.shared=tY({target:i,eventOptions:n,window:a,enabled:o,transform:s},tj),t){let e=tL.get(t);r[t]=tY(e8({shared:r.shared},l),e)}else for(let e in l){let t=tL.get(e);t&&(r[e]=tY(e8({shared:r.shared},l[e]),t))}return r}(e,t,this.config)}clean(){for(let e of(this._targetEventStore.clean(),this.gestures))this.gestureEventStores[e].clean(),this.gestureTimeoutStores[e].clean()}effect(){return this.config.shared.target&&this.bind(),()=>this._targetEventStore.clean()}bind(...e){let t;let r=this.config.shared,i={};if(!r.target||(t=r.target())){if(r.enabled){for(let r of this.gestures){let n=this.config[r],a=tZ(i,n.eventOptions,!!t);n.enabled&&new(tz.get(r))(this,e,r).bind(a)}let n=tZ(i,r.eventOptions,!!t);for(let t in this.nativeHandlers)n(t,"",r=>this.nativeHandlers[t](e8(e8({},this.state.shared),{},{event:r,args:e})),void 0,!0)}for(let e in i)i[e]=function(...e){return 0===e.length?th:1===e.length?e[0]:function(){let t;for(let r of e)t=r.apply(this,arguments)||t;return t}}(...i[e]);if(!t)return i;for(let e in i){let{device:r,capture:n,passive:a}=function(e){let t=e.substring(2).toLowerCase(),r=!!~t.indexOf("passive");r&&(t=t.replace("passive",""));let i=tt.includes(t)?"capturecapture":"capture",n=!!~t.indexOf(i);return n&&(t=t.replace("capture","")),{device:t,capture:n,passive:r}}(e);this._targetEventStore.add(t,r,"",i[e],{capture:n,passive:a})}}}}function tX(e,t){e.gestures.add(t),e.gestureEventStores[t]=new tW(e,t),e.gestureTimeoutStores[t]=new tK}let tZ=(e,t,r)=>(i,n,a,o={},s=!1)=>{var l,c;let u=null!==(l=o.capture)&&void 0!==l?l:t.capture,h=null!==(c=o.passive)&&void 0!==c?c:t.passive,A=s?i:function(e,t="",r=!1){let i=e9[e],n=i&&i[t]||t;return"on"+e7(e)+e7(n)+(!function(e=!1,t){return e&&!te.includes(t)}(r,n)?"":"Capture")}(i,n,u);r&&h&&(A+="Passive"),e[A]=e[A]||[],e[A].push(a)},t$=/^on(Drag|Wheel|Scroll|Move|Pinch|Hover)/;function t1(e,t,r,i,n,a){if(!e.has(r)||!tz.has(i))return;let o=r+"Start",s=r+"End";n[i]=e=>{let i;return e.first&&o in t&&t[o](e),r in t&&(i=t[r](e)),e.last&&s in t&&t[s](e),i},a[i]=a[i]||{}}function t0(e,t){return([tU,tN,tH,tV,tG,tk].forEach(tO),function(e,t){let{handlers:r,nativeHandlers:i,config:n}=function(e,t){let[r,i,n]=function(e){let t={},r={},i=new Set;for(let n in e)t$.test(n)?(i.add(RegExp.lastMatch),r[n]=e[n]):t[n]=e[n];return[r,t,i]}(e),a={};return t1(n,r,"onDrag","drag",a,t),t1(n,r,"onWheel","wheel",a,t),t1(n,r,"onScroll","scroll",a,t),t1(n,r,"onPinch","pinch",a,t),t1(n,r,"onMove","move",a,t),t1(n,r,"onHover","hover",a,t),{handlers:a,config:t,nativeHandlers:i}}(e,t||{});return function(e,t={},r,i){let n=eS.useMemo(()=>new tq(e),[]);if(n.applyHandlers(e,i),n.applyConfig(t,r),eS.useEffect(n.effect.bind(n)),eS.useEffect(()=>n.clean.bind(n),[]),void 0===t.target)return n.bind.bind(n)}(r,n,void 0,i)})(e,t||{})}let t2=new eT.Vector3,t3=new eT.Vector2,t4=new eT.Vector3,t5=new eT.Vector3,t6=new eT.Vector3,t8=new eT.Plane,t9=eS.forwardRef(({autoTransform:e=!0,matrix:t,axisLock:r,dragLimits:i,onHover:n,onDragStart:a,onDrag:o,onDragEnd:s,children:l,dragConfig:c,...u},h)=>{let A=(0,eR.D)(e=>e.controls),{camera:d,size:f,raycaster:m,invalidate:p}=(0,eR.D)(),g=eS.useRef(null),y=t0({onHover:({hovering:e})=>n&&n(null!=e&&e),onDragStart:({event:e})=>{A&&(A.enabled=!1);let{point:t}=e;g.current.matrix.decompose(t2,new eT.Quaternion,new eT.Vector3),t4.copy(t),t5.copy(t4).sub(t2),a&&a(t2),p()},onDrag:({xy:[t,n],intentional:a})=>{if(!a)return;let s=(t-f.left)/f.width*2-1,l=-((n-f.top)/f.height*2)+1;if(t3.set(s,l),m.setFromCamera(t3,d),r)switch(r){case"x":t6.set(1,0,0);break;case"y":t6.set(0,1,0);break;case"z":t6.set(0,0,1)}else d.getWorldDirection(t6).negate();t8.setFromNormalAndCoplanarPoint(t6,t4),m.ray.intersectPlane(t8,t4);let c=g.current.matrix.clone(),u=g.current.matrixWorld.clone(),h=new eT.Vector3(t4.x-t5.x,t4.y-t5.y,t4.z-t5.z);if(i&&(h.x=i[0]?Math.max(Math.min(h.x,i[0][1]),i[0][0]):h.x,h.y=i[1]?Math.max(Math.min(h.y,i[1][1]),i[1][0]):h.y,h.z=i[2]?Math.max(Math.min(h.z,i[2][1]),i[2][0]):h.z),e){g.current.matrix.setPosition(h);let e=g.current.matrix.clone().multiply(c.invert()),t=g.current.matrix.clone().multiply(u.invert());o&&o(g.current.matrix,e,g.current.matrixWorld,t)}else{let e=new eT.Matrix4().copy(g.current.matrix);e.setPosition(h);let t=e.clone().multiply(c.invert()),r=e.clone().multiply(u.invert());o&&o(e,t,g.current.matrixWorld,r)}p()},onDragEnd:()=>{A&&(A.enabled=!0),s&&s(),p()}},{drag:{filterTaps:!0,threshold:1,..."object"==typeof c?c:{}}});return eS.useImperativeHandle(h,()=>g.current,[]),eS.useLayoutEffect(()=>{t&&(g.current.matrix=t)},[t]),eS.createElement("group",j({ref:g},y(),{matrix:t,matrixAutoUpdate:!1},u),l)});function t7(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function re(e,t){return(re=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function rt(e,t){for(var r=[],i=e.toArray(),n=t.toArray(),a=0;a<i.length;a++)r[a]=i[a]+n[a];return new eT.Matrix3().fromArray(r)}function rr(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,i=Array(t);r<t;r++)i[r]=e[r];return i}function ri(e,t){if(e){if("string"==typeof e)return rr(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if("Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return rr(e,t)}}function rn(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r,i,n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var a=[],o=!0,s=!1;try{for(n=n.call(e);!(o=(r=n.next()).done)&&(a.push(r.value),!t||a.length!==t);o=!0);}catch(e){s=!0,i=e}finally{try{o||null==n.return||n.return()}finally{if(s)throw i}}return a}}(e,t)||ri(e,t)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ra(e){return function(e){if(Array.isArray(e))return rr(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||ri(e)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ro(e,t,r){return(ro=!function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}()?function(e,t,r){var i=[null];i.push.apply(i,t);var n=new(Function.bind.apply(e,i));return r&&re(n,r.prototype),n}:Reflect.construct).apply(null,arguments)}var rs=new eT.Vector2,rl=new eT.Vector2;function rc(e){var t,r,i,n,a,o,s,l,c=rn(e.map(function(e){return Array.isArray(e)?ro(eT.Vector2,ra(e)):e}),3),u=c[0],h=c[1],A=c[2];if(0===(i=(r=rn((t=e)[0],2))[0],n=r[1],o=(a=rn(t[1],2))[0],s=a[1],function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];var i=t[0],n=t[1],a=t[2],o=t[3],s=t[4],l=t[5],c=t[6],u=t[7],h=t[8];return i*s*h+n*l*c+a*o*u-a*s*c-n*o*h-i*l*u}(i,n,1,o,s,1,(l=rn(t[2],2))[0],l[1],1)))return!1;var d=rs.subVectors(h,u);return rl.subVectors(A,u).cross(d)>0}function ru(e,t,r){return Math.max(t,Math.min(r,e))}function rh(e,t){return ru(e-Math.floor(e/t)*t,0,t)}function rA(e,t){var r=rh(t-e,2*Math.PI);return r>Math.PI&&(r-=2*Math.PI),r}function rd(e,t){return e.x===t.x?void 0!==e.z&&e.y===t.y?e.z-t.z:e.y-t.y:e.x-t.x}function rf(e,t,r){return(r-e)/(t-e)}function rm(e,t){var r=new eT.Vector3().crossVectors(e,t),i=e.dot(t),n=new eT.Matrix3().identity(),a=new eT.Matrix3().set(0,-r.z,r.y,r.z,0,-r.x,-r.y,r.x,0),o=new eT.Matrix3().multiplyMatrices(a,a).multiplyScalar(1/(1+i));return rt(rt(n,a),o)}var rp=Object.freeze({__proto__:null,clamp:ru,repeat:rh,deltaAngle:rA,degToRad:function(e){return e/180*Math.PI},radToDeg:function(e){return 180*e/Math.PI},fibonacciOnSphere:function(e,t){for(var r=t.radius,i=void 0===r?1:r,n=e.length/3,a=2/n,o=Math.PI*(3-2.2360679775),s=0;s<e.length;s+=3){var l=s*a-1+a/2,c=Math.sqrt(1-Math.pow(l,2)),u=s%n*o,h=Math.cos(u)*c,A=Math.sin(u)*c;e[s]=h*i,e[s+1]=l*i,e[s+2]=A*i}},vectorEquals:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Number.EPSILON;return Math.abs(e.x-t.x)<r&&Math.abs(e.y-t.y)<r&&Math.abs(e.z-t.z)<r},lexicographic:rd,convexHull:function(e){for(var t=e.sort(rd),r=[t[0],t[1]],i=2;i<t.length;i++)for(r.push(t[i]);r.length>2&&rc(ra(r.slice(-3)));)r.splice(r.length-2,1);for(var n=[t[t.length-1],t[t.length-2]],a=t.length-3;a>=0;a--)for(n.push(t[a]);n.length>2&&rc(ra(n.slice(-3)));)n.splice(n.length-2,1);return n.splice(0,1),n.splice(n.length-1,1),[].concat(r,n)},remap:function(e,t,r){var i=rn(t,2),n=i[0],a=i[1],o=rn(r,2),s=o[0];return s+(e-n)*(o[1]-s)/(a-n)},fade:function(e){return e*e*e*(e*(6*e-15)+10)},lerp:function(e,t,r){return e*(1-r)+t*r},inverseLerp:rf,normalize:function(e,t,r){var i=Math.sqrt(e*e+t*t+r*r);return[e/i,t/i,r/i]},pointOnCubeToPointOnSphere:function(e,t,r){var i=e*e,n=t*t,a=r*r;return[e*Math.sqrt(1-(n+a)/2+n*a/3),t*Math.sqrt(1-(a+i)/2+a*i/3),r*Math.sqrt(1-(i+n)/2+i*n/3)]},rotateVectorOnVector:rm,pointToCoordinate:function(e,t,r){return[Math.asin(t),Math.atan2(e,-r)]},coordinateToPoint:function(e,t){var r=Math.cos(e);return[Math.sin(t)*r,Math.sin(e),-Math.cos(t)*r]},planeSegmentIntersection:function(e,t){var r=rn(t,2),i=r[0],n=r[1],a=rm(e.normal,new eT.Vector3(0,1,0)),o=rf(i.clone().applyMatrix3(a).y,n.clone().applyMatrix3(a).y,0);return new eT.Vector3().lerpVectors(i,n,o)},pointToPlaneDistance:function(e,t){return t.normal.dot(e)},getIndexFrom3D:function(e,t){var r=rn(e,3),i=r[0],n=r[1],a=r[2],o=rn(t,2),s=o[0];return a*s*o[1]+n*s+i},get3DFromIndex:function(e,t){var r=rn(t,2),i=r[0],n=i*r[1],a=e/n,o=e-n*a;return[o%i,o/i,a]},getIndexFrom2D:function(e,t){return e[0]+t[0]*e[1]},get2DFromIndex:function(e,t){return[e%t,Math.floor(e/t)]}});function rg(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}var ry=function e(t,r,i){var n=this;rg(this,e),t7(this,"dot2",function(e,t){return n.x*e+n.y*t}),t7(this,"dot3",function(e,t,r){return n.x*e+n.y*t+n.z*r}),this.x=t,this.y=r,this.z=i},rv=[new ry(1,1,0),new ry(-1,1,0),new ry(1,-1,0),new ry(-1,-1,0),new ry(1,0,1),new ry(-1,0,1),new ry(1,0,-1),new ry(-1,0,-1),new ry(0,1,1),new ry(0,-1,1),new ry(0,1,-1),new ry(0,-1,-1)],rE=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180],rx=Array(512),rC=Array(512);function rB(e){var t=function(e){if("number"==typeof e)e=Math.abs(e);else if("string"==typeof e){var t=e;e=0;for(var r=0;r<t.length;r++)e=(e+t.charCodeAt(r)%96*(r+1))%2147483647}return 0===e&&(e=311),e}(e);return function(){var e=48271*t%2147483647;return t=e,e/2147483647}}!function(e){e>0&&e<1&&(e*=65536),(e=Math.floor(e))<256&&(e|=e<<8);for(var t,r=0;r<256;r++)t=1&r?rE[r]^255&e:rE[r]^e>>8&255,rx[r]=rx[r+256]=t,rC[r]=rC[r+256]=rv[t%12]}(0),new function e(t){var r=this;rg(this,e),t7(this,"seed",0),t7(this,"init",function(e){r.seed=e,r.value=rB(e)}),t7(this,"value",rB(this.seed)),this.init(t)}(Math.random());var rw=function(e){return 1/(1+e+.48*e*e+.235*e*e*e)};function rI(e,t,r){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.25,n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.01,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1/0,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:rw,s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:.001,l="velocity_"+t;if(void 0===e.__damp&&(e.__damp={}),void 0===e.__damp[l]&&(e.__damp[l]=0),Math.abs(e[t]-r)<=s)return e[t]=r,!1;var c=2/(i=Math.max(1e-4,i)),u=o(c*n),h=e[t]-r,A=r,d=a*i;h=Math.min(Math.max(h,-d),d),r=e[t]-h;var f=(e.__damp[l]+c*h)*n;e.__damp[l]=(e.__damp[l]-c*f)*u;var m=r+(h+f)*u;return A-e[t]>0==m>A&&(m=A,e.__damp[l]=(m-A)/n),e[t]=m,!0}var rb=new eT.Vector3,r_=new eT.Quaternion,rM=new eT.Quaternion,rS=new eT.Matrix4,rD=new eT.Vector3;function rT(e,t,r,i,n,a,o,s){return rI(e,t,e[t]+rA(e[t],r),i,n,a,o,s)}var rR=new eT.Vector2,rF=new eT.Vector3;function rP(e,t,r,i,n,a,o){return"number"==typeof t?rF.setScalar(t):Array.isArray(t)?rF.set(t[0],t[1],t[2]):rF.copy(t),ee=rI(e,"x",rF.x,r,i,n,a,o),et=rI(e,"y",rF.y,r,i,n,a,o),er=rI(e,"z",rF.z,r,i,n,a,o),ee||et||er}var rQ=new eT.Vector4,rz=new eT.Euler,rL=new eT.Color,rO=new eT.Quaternion,rU=new eT.Vector4,rk=new eT.Vector4,rG=new eT.Vector4;function rN(e,t,r,i,n,a,o){Array.isArray(t)?rO.set(t[0],t[1],t[2],t[3]):rO.copy(t);var s=e.dot(rO)>0?1:-1;return rO.x*=s,rO.y*=s,rO.z*=s,rO.w*=s,ed=rI(e,"x",rO.x,r,i,n,a,o),ef=rI(e,"y",rO.y,r,i,n,a,o),em=rI(e,"z",rO.z,r,i,n,a,o),ep=rI(e,"w",rO.w,r,i,n,a,o),rU.set(e.x,e.y,e.z,e.w).normalize(),rk.set(e.__damp.velocity_x,e.__damp.velocity_y,e.__damp.velocity_z,e.__damp.velocity_w),rG.copy(rU).multiplyScalar(rk.dot(rU)/rU.dot(rU)),e.__damp.velocity_x-=rG.x,e.__damp.velocity_y-=rG.y,e.__damp.velocity_z-=rG.z,e.__damp.velocity_w-=rG.w,e.set(rU.x,rU.y,rU.z,rU.w),ed||ef||em||ep}var rH=new eT.Spherical,rV=new eT.Matrix4,rj=new eT.Vector3,rJ=new eT.Quaternion,rY=new eT.Vector3,rW=Object.freeze({__proto__:null,rsqw:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.01,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1/(2*Math.PI);return r/Math.atan(1/t)*Math.atan(Math.sin(2*Math.PI*e*i)/t)},exp:rw,linear:function(e){return e},sine:{in:function(e){return 1-Math.cos(e*Math.PI/2)},out:function(e){return Math.sin(e*Math.PI/2)},inOut:function(e){return-(Math.cos(Math.PI*e)-1)/2}},cubic:{in:function(e){return e*e*e},out:function(e){return 1-Math.pow(1-e,3)},inOut:function(e){return e<.5?4*e*e*e:1-Math.pow(-2*e+2,3)/2}},quint:{in:function(e){return e*e*e*e*e},out:function(e){return 1-Math.pow(1-e,5)},inOut:function(e){return e<.5?16*e*e*e*e*e:1-Math.pow(-2*e+2,5)/2}},circ:{in:function(e){return 1-Math.sqrt(1-Math.pow(e,2))},out:function(e){return Math.sqrt(1-Math.pow(e-1,2))},inOut:function(e){return e<.5?(1-Math.sqrt(1-Math.pow(2*e,2)))/2:(Math.sqrt(1-Math.pow(-2*e+2,2))+1)/2}},quart:{in:function(e){return e*e*e*e},out:function(e){return 1- --e*e*e*e},inOut:function(e){return e<.5?8*e*e*e*e:1-8*--e*e*e*e}},expo:{in:function(e){return 0===e?0:Math.pow(2,10*e-10)},out:function(e){return 1===e?1:1-Math.pow(2,-10*e)},inOut:function(e){return 0===e?0:1===e?1:e<.5?Math.pow(2,20*e-10)/2:(2-Math.pow(2,-20*e+10))/2}},damp:rI,dampLookAt:function(e,t,r,i,n,a,o){"number"==typeof t?rb.setScalar(t):Array.isArray(t)?rb.set(t[0],t[1],t[2]):rb.copy(t);var s=e.parent;(e.updateWorldMatrix(!0,!1),rD.setFromMatrixPosition(e.matrixWorld),e&&e.isCamera||e&&e.isLight)?rS.lookAt(rD,rb,e.up):rS.lookAt(rb,rD,e.up),rN(e.quaternion,rM.setFromRotationMatrix(rS),r,i,n,a,o),s&&(rS.extractRotation(s.matrixWorld),r_.setFromRotationMatrix(rS),rN(e.quaternion,rM.copy(e.quaternion).premultiply(r_.invert()),r,i,n,a,o))},dampAngle:rT,damp2:function(e,t,r,i,n,a,o){return"number"==typeof t?rR.setScalar(t):Array.isArray(t)?rR.set(t[0],t[1]):rR.copy(t),Z=rI(e,"x",rR.x,r,i,n,a,o),$=rI(e,"y",rR.y,r,i,n,a,o),Z||$},damp3:rP,damp4:function(e,t,r,i,n,a,o){return"number"==typeof t?rQ.setScalar(t):Array.isArray(t)?rQ.set(t[0],t[1],t[2],t[3]):rQ.copy(t),ei=rI(e,"x",rQ.x,r,i,n,a,o),en=rI(e,"y",rQ.y,r,i,n,a,o),ea=rI(e,"z",rQ.z,r,i,n,a,o),eo=rI(e,"w",rQ.w,r,i,n,a,o),ei||en||ea||eo},dampE:function(e,t,r,i,n,a,o){return Array.isArray(t)?rz.set(t[0],t[1],t[2],t[3]):rz.copy(t),es=rT(e,"x",rz.x,r,i,n,a,o),el=rT(e,"y",rz.y,r,i,n,a,o),ec=rT(e,"z",rz.z,r,i,n,a,o),es||el||ec},dampC:function(e,t,r,i,n,a,o){return t instanceof eT.Color?rL.copy(t):Array.isArray(t)?rL.setRGB(t[0],t[1],t[2]):rL.set(t),eu=rI(e,"r",rL.r,r,i,n,a,o),eh=rI(e,"g",rL.g,r,i,n,a,o),eA=rI(e,"b",rL.b,r,i,n,a,o),eu||eh||eA},dampQ:rN,dampS:function(e,t,r,i,n,a,o){return Array.isArray(t)?rH.set(t[0],t[1],t[2]):rH.copy(t),eg=rI(e,"radius",rH.radius,r,i,n,a,o),ey=rT(e,"phi",rH.phi,r,i,n,a,o),ev=rT(e,"theta",rH.theta,r,i,n,a,o),eg||ey||ev},dampM:function(e,t,r,i,n,a,o){return void 0===e.__damp&&(e.__damp={position:new eT.Vector3,rotation:new eT.Quaternion,scale:new eT.Vector3},e.decompose(e.__damp.position,e.__damp.rotation,e.__damp.scale)),Array.isArray(t)?rV.set.apply(rV,ra(t)):rV.copy(t),rV.decompose(rj,rJ,rY),eE=rP(e.__damp.position,rj,r,i,n,a,o),ex=rN(e.__damp.rotation,rJ,r,i,n,a,o),eC=rP(e.__damp.scale,rY,r,i,n,a,o),e.compose(e.__damp.position,e.__damp.rotation,e.__damp.scale),eE||ex||eC}});eT.BufferGeometry;let rK=eS.createContext(null);function rq(){return eS.useContext(rK)}function rX({eps:e=1e-5,enabled:t=!0,infinite:r,horizontal:i,pages:n=1,distance:a=1,damping:o=.25,maxSpeed:s=1/0,prepend:l=!1,style:c={},children:u}){let{get:h,setEvents:A,gl:d,size:f,invalidate:m,events:p}=(0,eR.D)(),[g]=eS.useState(()=>document.createElement("div")),[y]=eS.useState(()=>document.createElement("div")),[v]=eS.useState(()=>document.createElement("div")),E=d.domElement.parentNode,x=eS.useRef(0),C=eS.useMemo(()=>({el:g,eps:e,fill:y,fixed:v,horizontal:i,damping:o,offset:0,delta:0,scroll:x,pages:n,range(e,t,r=0){let i=e-r,n=i+t+2*r;return this.offset<i?0:this.offset>n?1:(this.offset-i)/(n-i)},curve(e,t,r=0){return Math.sin(this.range(e,t,r)*Math.PI)},visible(e,t,r=0){let i=e-r;return this.offset>=i&&this.offset<=i+t+2*r}}),[e,o,i,n]);eS.useEffect(()=>{for(let e in g.style.position="absolute",g.style.width="100%",g.style.height="100%",g.style[i?"overflowX":"overflowY"]="auto",g.style[i?"overflowY":"overflowX"]="hidden",g.style.top="0px",g.style.left="0px",c)g.style[e]=c[e];v.style.position="sticky",v.style.top="0px",v.style.left="0px",v.style.width="100%",v.style.height="100%",v.style.overflow="hidden",g.appendChild(v),y.style.height=i?"100%":`${n*a*100}%`,y.style.width=i?`${n*a*100}%`:"100%",y.style.pointerEvents="none",g.appendChild(y),l?E.prepend(g):E.appendChild(g),g[i?"scrollLeft":"scrollTop"]=1;let e=p.connected||d.domElement;requestAnimationFrame(()=>null==p.connect?void 0:p.connect(g));let t=h().events.compute;return A({compute(e,t){let{left:r,top:i}=E.getBoundingClientRect(),n=e.clientX-r,a=e.clientY-i;t.pointer.set(n/t.size.width*2-1,-(a/t.size.height*2)+1),t.raycaster.setFromCamera(t.pointer,t.camera)}}),()=>{E.removeChild(g),A({compute:t}),null==p.connect||p.connect(e)}},[n,a,i,g,y,v,E]),eS.useEffect(()=>{if(p.connected===g){let e=f[i?"width":"height"],n=g[i?"scrollWidth":"scrollHeight"],a=n-e,o=0,s=!0,l=!0,c=()=>{if(t&&!l&&(m(),o=g[i?"scrollLeft":"scrollTop"],x.current=o/a,r)){if(!s){if(o>=a){let e=1-C.offset;g[i?"scrollLeft":"scrollTop"]=1,x.current=C.offset=-e,s=!0}else if(o<=0){let e=1+C.offset;g[i?"scrollLeft":"scrollTop"]=n,x.current=C.offset=e,s=!0}}s&&setTimeout(()=>s=!1,40)}};g.addEventListener("scroll",c,{passive:!0}),requestAnimationFrame(()=>l=!1);let u=e=>g.scrollLeft+=e.deltaY/2;return i&&g.addEventListener("wheel",u,{passive:!0}),()=>{g.removeEventListener("scroll",c),i&&g.removeEventListener("wheel",u)}}},[g,p,f,r,C,m,i,t]);let B=0;return(0,eR.F)((t,r)=>{B=C.offset,rW.damp(C,"offset",x.current,o,r,s,void 0,e),rW.damp(C,"delta",Math.abs(B-C.offset),o,r,s,void 0,e),C.delta>e&&m()}),eS.createElement(rK.Provider,{value:C},u)}let rZ=eS.forwardRef(({children:e},t)=>{let r=eS.useRef(null);eS.useImperativeHandle(t,()=>r.current,[]);let i=rq(),{width:n,height:a}=(0,eR.D)(e=>e.viewport);return(0,eR.F)(()=>{r.current.position.x=i.horizontal?-n*(i.pages-1)*i.offset:0,r.current.position.y=i.horizontal?0:a*(i.pages-1)*i.offset}),eS.createElement("group",{ref:r},e)}),r$=eS.forwardRef(({children:e,style:t,...r},i)=>{let n=rq(),a=eS.useRef(null);eS.useImperativeHandle(i,()=>a.current,[]);let{width:o,height:s}=(0,eR.D)(e=>e.size),l=eS.useContext(eR.g),c=eS.useMemo(()=>eD.createRoot(n.fixed),[n.fixed]);return(0,eR.F)(()=>{n.delta>n.eps&&(a.current.style.transform=`translate3d(${n.horizontal?-o*(n.pages-1)*n.offset:0}px,${n.horizontal?0:-(s*(n.pages-1)*n.offset)}px,0)`)}),c.render(eS.createElement("div",j({ref:a,style:{...t,position:"absolute",top:0,left:0,willChange:"transform"}},r),eS.createElement(rK.Provider,{value:n},eS.createElement(eR.g.Provider,{value:l},e)))),null}),r1=eS.forwardRef(({html:e,...t},r)=>eS.createElement(e?r$:rZ,j({ref:r},t)));var r0=il(),r2=e=>ii(e,r0),r3=il();r2.write=e=>ii(e,r3);var r4=il();r2.onStart=e=>ii(e,r4);var r5=il();r2.onFrame=e=>ii(e,r5);var r6=il();r2.onFinish=e=>ii(e,r6);var r8=[];r2.setTimeout=(e,t)=>{let r=r2.now()+t,i=()=>{let e=r8.findIndex(e=>e.cancel==i);~e&&r8.splice(e,1),it-=~e?1:0},n={time:r,handler:e,cancel:i};return r8.splice(r9(r),0,n),it+=1,ia(),n};var r9=e=>~(~r8.findIndex(t=>t.time>e)||~r8.length);r2.cancel=e=>{r4.delete(e),r5.delete(e),r6.delete(e),r0.delete(e),r3.delete(e)},r2.sync=e=>{ir=!0,r2.batchedUpdates(e),ir=!1},r2.throttle=e=>{let t;function r(){try{e(...t)}finally{t=null}}function i(...e){t=e,r2.onStart(r)}return i.handler=e,i.cancel=()=>{r4.delete(r),t=null},i};var r7="undefined"!=typeof window?window.requestAnimationFrame:()=>{};r2.use=e=>r7=e,r2.now="undefined"!=typeof performance?()=>performance.now():Date.now,r2.batchedUpdates=e=>e(),r2.catch=console.error,r2.frameLoop="always",r2.advance=()=>{"demand"!==r2.frameLoop?console.warn("Cannot call the manual advancement of rafz whilst frameLoop is not set as demand"):is()};var ie=-1,it=0,ir=!1;function ii(e,t){ir?(t.delete(e),e(0)):(t.add(e),ia())}function ia(){ie<0&&(ie=0,"demand"!==r2.frameLoop&&r7(io))}function io(){~ie&&(r7(io),r2.batchedUpdates(is))}function is(){let e=ie,t=r9(ie=r2.now());if(t&&(ic(r8.splice(0,t),e=>e.handler()),it-=t),!it){ie=-1;return}r4.flush(),r0.flush(e?Math.min(64,ie-e):16.667),r5.flush(),r3.flush(),r6.flush()}function il(){let e=new Set,t=e;return{add(r){it+=t!=e||e.has(r)?0:1,e.add(r)},delete:r=>(it-=t==e&&e.has(r)?1:0,e.delete(r)),flush(r){t.size&&(e=new Set,it-=t.size,ic(t,t=>t(r)&&e.add(t)),it+=e.size,t=e)}}}function ic(e,t){e.forEach(e=>{try{t(e)}catch(e){r2.catch(e)}})}var iu=Object.defineProperty,ih={};function iA(){}((e,t)=>{for(var r in t)iu(e,r,{get:t[r],enumerable:!0})})(ih,{assign:()=>ib,colors:()=>iB,createStringInterpolator:()=>eB,skipAnimation:()=>iw,to:()=>ew,willAdvance:()=>iI});var id=(e,t,r)=>Object.defineProperty(e,t,{value:r,writable:!0,configurable:!0}),im={arr:Array.isArray,obj:e=>!!e&&"Object"===e.constructor.name,fun:e=>"function"==typeof e,str:e=>"string"==typeof e,num:e=>"number"==typeof e,und:e=>void 0===e};function ip(e,t){if(im.arr(e)){if(!im.arr(t)||e.length!==t.length)return!1;for(let r=0;r<e.length;r++)if(e[r]!==t[r])return!1;return!0}return e===t}var ig=(e,t)=>e.forEach(t);function iy(e,t,r){if(im.arr(e)){for(let i=0;i<e.length;i++)t.call(r,e[i],`${i}`);return}for(let i in e)e.hasOwnProperty(i)&&t.call(r,e[i],i)}var iv=e=>im.und(e)?[]:im.arr(e)?e:[e];function iE(e,t){if(e.size){let r=Array.from(e);e.clear(),ig(r,t)}}var ix=(e,...t)=>iE(e,e=>e(...t)),iC=()=>"undefined"==typeof window||!window.navigator||/ServerSideRendering|^Deno\//.test(window.navigator.userAgent),iB=null,iw=!1,iI=iA,ib=e=>{e.to&&(ew=e.to),e.now&&(r2.now=e.now),void 0!==e.colors&&(iB=e.colors),null!=e.skipAnimation&&(iw=e.skipAnimation),e.createStringInterpolator&&(eB=e.createStringInterpolator),e.requestAnimationFrame&&r2.use(e.requestAnimationFrame),e.batchedUpdates&&(r2.batchedUpdates=e.batchedUpdates),e.willAdvance&&(iI=e.willAdvance),e.frameLoop&&(r2.frameLoop=e.frameLoop)},i_=new Set,iM=[],iS=[],iD=0,iT={get idle(){return!i_.size&&!iM.length},start(e){iD>e.priority?(i_.add(e),r2.onStart(iR)):(iF(e),r2(iQ))},advance:iQ,sort(e){if(iD)r2.onFrame(()=>iT.sort(e));else{let t=iM.indexOf(e);~t&&(iM.splice(t,1),iP(e))}},clear(){iM=[],i_.clear()}};function iR(){i_.forEach(iF),i_.clear(),r2(iQ)}function iF(e){iM.includes(e)||iP(e)}function iP(e){iM.splice(function(e,t){let r=e.findIndex(t);return r<0?e.length:r}(iM,t=>t.priority>e.priority),0,e)}function iQ(e){let t=iS;for(let r=0;r<iM.length;r++){let i=iM[r];iD=i.priority,i.idle||(iI(i),i.advance(e),i.idle||t.push(i))}return iD=0,(iS=iM).length=0,(iM=t).length>0}var iz="[-+]?\\d*\\.?\\d+",iL=iz+"%";function iO(...e){return"\\(\\s*("+e.join(")\\s*,\\s*(")+")\\s*\\)"}var iU=RegExp("rgb"+iO(iz,iz,iz)),ik=RegExp("rgba"+iO(iz,iz,iz,iz)),iG=RegExp("hsl"+iO(iz,iL,iL)),iN=RegExp("hsla"+iO(iz,iL,iL,iz)),iH=/^#([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,iV=/^#([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,ij=/^#([0-9a-fA-F]{6})$/,iJ=/^#([0-9a-fA-F]{8})$/;function iY(e,t,r){return(r<0&&(r+=1),r>1&&(r-=1),r<1/6)?e+(t-e)*6*r:r<.5?t:r<2/3?e+(t-e)*(2/3-r)*6:e}function iW(e,t,r){let i=r<.5?r*(1+t):r+t-r*t,n=2*r-i;return Math.round(255*iY(n,i,e+1/3))<<24|Math.round(255*iY(n,i,e))<<16|Math.round(255*iY(n,i,e-1/3))<<8}function iK(e){let t=parseInt(e,10);return t<0?0:t>255?255:t}function iq(e){return(parseFloat(e)%360+360)%360/360}function iX(e){let t=parseFloat(e);return t<0?0:t>1?255:Math.round(255*t)}function iZ(e){let t=parseFloat(e);return t<0?0:t>100?1:t/100}function i$(e){let t;let r="number"==typeof e?e>>>0===e&&e>=0&&e<=4294967295?e:null:(t=ij.exec(e))?parseInt(t[1]+"ff",16)>>>0:iB&&void 0!==iB[e]?iB[e]:(t=iU.exec(e))?(iK(t[1])<<24|iK(t[2])<<16|iK(t[3])<<8|255)>>>0:(t=ik.exec(e))?(iK(t[1])<<24|iK(t[2])<<16|iK(t[3])<<8|iX(t[4]))>>>0:(t=iH.exec(e))?parseInt(t[1]+t[1]+t[2]+t[2]+t[3]+t[3]+"ff",16)>>>0:(t=iJ.exec(e))?parseInt(t[1],16)>>>0:(t=iV.exec(e))?parseInt(t[1]+t[1]+t[2]+t[2]+t[3]+t[3]+t[4]+t[4],16)>>>0:(t=iG.exec(e))?(255|iW(iq(t[1]),iZ(t[2]),iZ(t[3])))>>>0:(t=iN.exec(e))?(iW(iq(t[1]),iZ(t[2]),iZ(t[3]))|iX(t[4]))>>>0:null;if(null===r)return e;let i=(4278190080&(r=r||0))>>>24,n=(16711680&r)>>>16,a=(65280&r)>>>8,o=(255&r)/255;return`rgba(${i}, ${n}, ${a}, ${o})`}var i1=(e,t,r)=>{if(im.fun(e))return e;if(im.arr(e))return i1({range:e,output:t,extrapolate:r});if(im.str(e.output[0]))return eB(e);let i=e.output,n=e.range||[0,1],a=e.extrapolateLeft||e.extrapolate||"extend",o=e.extrapolateRight||e.extrapolate||"extend",s=e.easing||(e=>e);return t=>{let r=function(e,t){for(var r=1;r<t.length-1&&!(t[r]>=e);++r);return r-1}(t,n);return function(e,t,r,i,n,a,o,s,l){let c=l?l(e):e;if(c<t){if("identity"===o)return c;"clamp"===o&&(c=t)}if(c>r){if("identity"===s)return c;"clamp"===s&&(c=r)}return i===n?i:t===r?e<=t?i:n:(t===-1/0?c=-c:r===1/0?c-=t:c=(c-t)/(r-t),c=a(c),i===-1/0?c=-c:n===1/0?c+=i:c=c*(n-i)+i,c)}(t,n[r],n[r+1],i[r],i[r+1],s,a,o,e.map)}},i0=Symbol.for("FluidValue.get"),i2=Symbol.for("FluidValue.observers"),i3=e=>!!(e&&e[i0]),i4=e=>e&&e[i0]?e[i0]():e,i5=e=>e[i2]||null;function i6(e,t){let r=e[i2];r&&r.forEach(e=>{e.eventObserved?e.eventObserved(t):e(t)})}var i8=class{constructor(e){if(!e&&!(e=this.get))throw Error("Unknown getter");i9(this,e)}},i9=(e,t)=>nt(e,i0,t);function i7(e,t){if(e[i0]){let r=e[i2];r||nt(e,i2,r=new Set),!r.has(t)&&(r.add(t),e.observerAdded&&e.observerAdded(r.size,t))}return t}function ne(e,t){let r=e[i2];if(r&&r.has(t)){let i=r.size-1;i?r.delete(t):e[i2]=null,e.observerRemoved&&e.observerRemoved(i,t)}}var nt=(e,t,r)=>Object.defineProperty(e,t,{value:r,writable:!0,configurable:!0}),nr=/[+\-]?(?:0|[1-9]\d*)(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,ni=/(#(?:[0-9a-f]{2}){2,4}|(#[0-9a-f]{3})|(rgb|hsl)a?\((-?\d+%?[,\s]+){2,3}\s*[\d\.]+%?\))/gi,nn=RegExp(`(${nr.source})(%|[a-z]+)`,"i"),na=/rgba\(([0-9\.-]+), ([0-9\.-]+), ([0-9\.-]+), ([0-9\.-]+)\)/gi,no=/var\((--[a-zA-Z0-9-_]+),? ?([a-zA-Z0-9 ()%#.,-]+)?\)/,ns=e=>{let[t,r]=nl(e);if(!t||iC())return e;let i=window.getComputedStyle(document.documentElement).getPropertyValue(t);if(i)return i.trim();if(r&&r.startsWith("--")){let e=window.getComputedStyle(document.documentElement).getPropertyValue(r);if(e)return e}else if(r&&no.test(r))return ns(r);else if(r)return r;return e},nl=e=>{let t=no.exec(e);if(!t)return[,];let[,r,i]=t;return[r,i]},nc=(e,t,r,i,n)=>`rgba(${Math.round(t)}, ${Math.round(r)}, ${Math.round(i)}, ${n})`,nu=e=>{eI||(eI=iB?RegExp(`(${Object.keys(iB).join("|")})(?!\\w)`,"g"):/^\b$/);let t=e.output.map(e=>i4(e).replace(no,ns).replace(ni,i$).replace(eI,i$)),r=t.map(e=>e.match(nr).map(Number)),i=r[0].map((e,t)=>r.map(e=>{if(!(t in e))throw Error('The arity of each "output" value must be equal');return e[t]})).map(t=>i1({...e,output:t}));return e=>{let r=!nn.test(t[0])&&t.find(e=>nn.test(e))?.replace(nr,""),n=0;return t[0].replace(nr,()=>`${i[n++](e)}${r||""}`).replace(na,nc)}},nh="react-spring: ",nA=e=>{let t=!1;if("function"!=typeof e)throw TypeError(`${nh}once requires a function parameter`);return(...r)=>{t||(e(...r),t=!0)}},nd=nA(console.warn),nf=nA(console.warn);function nm(e){return im.str(e)&&("#"==e[0]||/\d/.test(e)||!iC()&&no.test(e)||e in(iB||{}))}var np=iC()?eS.useEffect:eS.useLayoutEffect,ng=()=>{let e=(0,eS.useRef)(!1);return np(()=>(e.current=!0,()=>{e.current=!1}),[]),e};function ny(){let e=(0,eS.useState)()[1],t=ng();return()=>{t.current&&e(Math.random())}}var nv=e=>(0,eS.useEffect)(e,nE),nE=[];function nx(e){let t=(0,eS.useRef)();return(0,eS.useEffect)(()=>{t.current=e}),t.current}var nC=Symbol.for("Animated:node"),nB=e=>!!e&&e[nC]===e,nw=e=>e&&e[nC],nI=(e,t)=>id(e,nC,t),nb=e=>e&&e[nC]&&e[nC].getPayload(),n_=class{constructor(){nI(this,this)}getPayload(){return this.payload||[]}},nM=class extends n_{constructor(e){super(),this._value=e,this.done=!0,this.durationProgress=0,im.num(this._value)&&(this.lastPosition=this._value)}static create(e){return new nM(e)}getPayload(){return[this]}getValue(){return this._value}setValue(e,t){return im.num(e)&&(this.lastPosition=e,t&&(e=Math.round(e/t)*t,this.done&&(this.lastPosition=e))),this._value!==e&&(this._value=e,!0)}reset(){let{done:e}=this;this.done=!1,im.num(this._value)&&(this.elapsedTime=0,this.durationProgress=0,this.lastPosition=this._value,e&&(this.lastVelocity=null),this.v0=null)}},nS=class extends nM{constructor(e){super(0),this._string=null,this._toString=i1({output:[e,e]})}static create(e){return new nS(e)}getValue(){let e=this._string;return null==e?this._string=this._toString(this._value):e}setValue(e){if(im.str(e)){if(e==this._string)return!1;this._string=e,this._value=1}else{if(!super.setValue(e))return!1;this._string=null}return!0}reset(e){e&&(this._toString=i1({output:[this.getValue(),e]})),this._value=0,super.reset()}},nD={dependencies:null},nT=class extends n_{constructor(e){super(),this.source=e,this.setValue(e)}getValue(e){let t={};return iy(this.source,(r,i)=>{nB(r)?t[i]=r.getValue(e):i3(r)?t[i]=i4(r):e||(t[i]=r)}),t}setValue(e){this.source=e,this.payload=this._makePayload(e)}reset(){this.payload&&ig(this.payload,e=>e.reset())}_makePayload(e){if(e){let t=new Set;return iy(e,this._addToPayload,t),Array.from(t)}}_addToPayload(e){nD.dependencies&&i3(e)&&nD.dependencies.add(e);let t=nb(e);t&&ig(t,e=>this.add(e))}},nR=class extends nT{constructor(e){super(e)}static create(e){return new nR(e)}getValue(){return this.source.map(e=>e.getValue())}setValue(e){let t=this.getPayload();return e.length==t.length?t.map((t,r)=>t.setValue(e[r])).some(Boolean):(super.setValue(e.map(nF)),!0)}};function nF(e){return(nm(e)?nS:nM).create(e)}function nP(e){let t=nw(e);return t?t.constructor:im.arr(e)?nR:nm(e)?nS:nM}var nQ=(e,t)=>{let r=!im.fun(e)||e.prototype&&e.prototype.isReactComponent;return(0,eS.forwardRef)((i,n)=>{let a=(0,eS.useRef)(null),o=r&&(0,eS.useCallback)(e=>{a.current=(n&&(im.fun(n)?n(e):n.current=e),e)},[n]),[s,l]=function(e,t){let r=new Set;return nD.dependencies=r,e.style&&(e={...e,style:t.createAnimatedStyle(e.style)}),e=new nT(e),nD.dependencies=null,[e,r]}(i,t),c=ny(),u=()=>{let e=a.current;(!r||e)&&!1===(!!e&&t.applyAnimatedValues(e,s.getValue(!0)))&&c()},h=new nz(u,l),A=(0,eS.useRef)();np(()=>(A.current=h,ig(l,e=>i7(e,h)),()=>{A.current&&(ig(A.current.deps,e=>ne(e,A.current)),r2.cancel(A.current.update))})),(0,eS.useEffect)(u,[]),nv(()=>()=>{let e=A.current;ig(e.deps,t=>ne(t,e))});let d=t.getComponentProps(s.getValue());return eS.createElement(e,{...d,ref:o})})},nz=class{constructor(e,t){this.update=e,this.deps=t}eventObserved(e){"change"==e.type&&r2.write(this.update)}},nL=Symbol.for("AnimatedComponent"),nO=e=>im.str(e)?e:e&&im.str(e.displayName)?e.displayName:im.fun(e)&&e.name||null;function nU(e,...t){return im.fun(e)?e(...t):e}var nk=(e,t)=>!0===e||!!(t&&e&&(im.fun(e)?e(t):iv(e).includes(t))),nG=(e,t)=>im.obj(e)?t&&e[t]:e,nN=(e,t)=>!0===e.default?e[t]:e.default?e.default[t]:void 0,nH=e=>e,nV=(e,t=nH)=>{let r=nj;e.default&&!0!==e.default&&(r=Object.keys(e=e.default));let i={};for(let n of r){let r=t(e[n],n);im.und(r)||(i[n]=r)}return i},nj=["config","onProps","onStart","onChange","onPause","onResume","onRest"],nJ={config:1,from:1,to:1,ref:1,loop:1,reset:1,pause:1,cancel:1,reverse:1,immediate:1,default:1,delay:1,onProps:1,onStart:1,onChange:1,onPause:1,onResume:1,onRest:1,onResolve:1,items:1,trail:1,sort:1,expires:1,initial:1,enter:1,update:1,leave:1,children:1,onDestroyed:1,keys:1,callId:1,parentId:1};function nY(e){let t=function(e){let t={},r=0;if(iy(e,(e,i)=>{!nJ[i]&&(t[i]=e,r++)}),r)return t}(e);if(t){let r={to:t};return iy(e,(e,i)=>i in t||(r[i]=e)),r}return{...e}}function nW(e){return e=i4(e),im.arr(e)?e.map(nW):nm(e)?ih.createStringInterpolator({range:[0,1],output:[e,e]})(1):e}function nK(e){return im.fun(e)||im.arr(e)&&im.obj(e[0])}var nq={tension:170,friction:26,mass:1,damping:1,easing:e=>e,clamp:!1},nX=class{constructor(){this.velocity=0,Object.assign(this,nq)}};function nZ(e,t){if(im.und(t.decay)){let r=!im.und(t.tension)||!im.und(t.friction);!r&&im.und(t.frequency)&&im.und(t.damping)&&im.und(t.mass)||(e.duration=void 0,e.decay=void 0),r&&(e.frequency=void 0)}else e.duration=void 0}var n$=[],n1=class{constructor(){this.changed=!1,this.values=n$,this.toValues=null,this.fromValues=n$,this.config=new nX,this.immediate=!1}};function n0(e,{key:t,props:r,defaultProps:i,state:n,actions:a}){return new Promise((o,s)=>{let l,c;let u=nk(r.cancel??i?.cancel,t);if(u)d();else{im.und(r.pause)||(n.paused=nk(r.pause,t));let e=i?.pause;!0!==e&&(e=n.paused||nk(e,t)),l=nU(r.delay||0,t),e?(n.resumeQueue.add(A),a.pause()):(a.resume(),A())}function h(){n.resumeQueue.add(A),n.timeouts.delete(c),c.cancel(),l=c.time-r2.now()}function A(){l>0&&!ih.skipAnimation?(n.delayed=!0,c=r2.setTimeout(d,l),n.pauseQueue.add(h),n.timeouts.add(c)):d()}function d(){n.delayed&&(n.delayed=!1),n.pauseQueue.delete(h),n.timeouts.delete(c),e<=(n.cancelId||0)&&(u=!0);try{a.start({...r,callId:e,cancel:u},o)}catch(e){s(e)}}})}var n2=(e,t)=>1==t.length?t[0]:t.some(e=>e.cancelled)?n5(e.get()):t.every(e=>e.noop)?n3(e.get()):n4(e.get(),t.every(e=>e.finished)),n3=e=>({value:e,noop:!0,finished:!0,cancelled:!1}),n4=(e,t,r=!1)=>({value:e,finished:t,cancelled:r}),n5=e=>({value:e,cancelled:!0,finished:!1});function n6(e,t,r,i){let{callId:n,parentId:a,onRest:o}=t,{asyncTo:s,promise:l}=r;return a||e!==s||t.reset?r.promise=(async()=>{let c,u,h;r.asyncId=n,r.asyncTo=e;let A=nV(t,(e,t)=>"onRest"===t?void 0:e),d=new Promise((e,t)=>(c=e,u=t)),f=e=>{let t=n<=(r.cancelId||0)&&n5(i)||n!==r.asyncId&&n4(i,!1);if(t)throw e.result=t,u(e),e},m=(e,t)=>{let a=new n9,o=new n7;return(async()=>{if(ih.skipAnimation)throw n8(r),o.result=n4(i,!1),u(o),o;f(a);let s=im.obj(e)?{...e}:{...t,to:e};s.parentId=n,iy(A,(e,t)=>{im.und(s[t])&&(s[t]=e)});let l=await i.start(s);return f(a),r.paused&&await new Promise(e=>{r.resumeQueue.add(e)}),l})()};if(ih.skipAnimation)return n8(r),n4(i,!1);try{let t;t=im.arr(e)?(async e=>{for(let t of e)await m(t)})(e):Promise.resolve(e(m,i.stop.bind(i))),await Promise.all([t.then(c),d]),h=n4(i.get(),!0,!1)}catch(e){if(e instanceof n9)h=e.result;else if(e instanceof n7)h=e.result;else throw e}finally{n==r.asyncId&&(r.asyncId=a,r.asyncTo=a?s:void 0,r.promise=a?l:void 0)}return im.fun(o)&&r2.batchedUpdates(()=>{o(h,i,i.item)}),h})():l}function n8(e,t){iE(e.timeouts,e=>e.cancel()),e.pauseQueue.clear(),e.resumeQueue.clear(),e.asyncId=e.asyncTo=e.promise=void 0,t&&(e.cancelId=t)}var n9=class extends Error{constructor(){super("An async animation has been interrupted. You see this error because you forgot to use `await` or `.catch(...)` on its returned promise.")}},n7=class extends Error{constructor(){super("SkipAnimationSignal")}},ae=e=>e instanceof ar,at=1,ar=class extends i8{constructor(){super(...arguments),this.id=at++,this._priority=0}get priority(){return this._priority}set priority(e){this._priority!=e&&(this._priority=e,this._onPriorityChange(e))}get(){let e=nw(this);return e&&e.getValue()}to(...e){return ih.to(this,e)}interpolate(...e){return nd(`${nh}The "interpolate" function is deprecated in v9 (use "to" instead)`),ih.to(this,e)}toJSON(){return this.get()}observerAdded(e){1==e&&this._attach()}observerRemoved(e){0==e&&this._detach()}_attach(){}_detach(){}_onChange(e,t=!1){i6(this,{type:"change",parent:this,value:e,idle:t})}_onPriorityChange(e){this.idle||iT.sort(this),i6(this,{type:"priority",parent:this,priority:e})}},ai=Symbol.for("SpringPhase"),an=e=>(1&e[ai])>0,aa=e=>(2&e[ai])>0,ao=e=>(4&e[ai])>0,as=(e,t)=>t?e[ai]|=3:e[ai]&=-3,al=(e,t)=>t?e[ai]|=4:e[ai]&=-5,ac=class extends ar{constructor(e,t){if(super(),this.animation=new n1,this.defaultProps={},this._state={paused:!1,delayed:!1,pauseQueue:new Set,resumeQueue:new Set,timeouts:new Set},this._pendingCalls=new Set,this._lastCallId=0,this._lastToId=0,this._memoizedDuration=0,!im.und(e)||!im.und(t)){let r=im.obj(e)?{...e}:{...t,from:e};im.und(r.default)&&(r.default=!0),this.start(r)}}get idle(){return!(aa(this)||this._state.asyncTo)||ao(this)}get goal(){return i4(this.animation.to)}get velocity(){let e=nw(this);return e instanceof nM?e.lastVelocity||0:e.getPayload().map(e=>e.lastVelocity||0)}get hasAnimated(){return an(this)}get isAnimating(){return aa(this)}get isPaused(){return ao(this)}get isDelayed(){return this._state.delayed}advance(e){let t=!0,r=!1,i=this.animation,{toValues:n}=i,{config:a}=i,o=nb(i.to);!o&&i3(i.to)&&(n=iv(i4(i.to))),i.values.forEach((s,l)=>{if(s.done)return;let c=s.constructor==nS?1:o?o[l].lastPosition:n[l],u=i.immediate,h=c;if(!u){let t;if(h=s.lastPosition,a.tension<=0){s.done=!0;return}let r=s.elapsedTime+=e,n=i.fromValues[l],o=null!=s.v0?s.v0:s.v0=im.arr(a.velocity)?a.velocity[l]:a.velocity,A=a.precision||(n==c?.005:Math.min(1,.001*Math.abs(c-n)));if(im.und(a.duration)){if(a.decay){let e=!0===a.decay?.998:a.decay,i=Math.exp(-(1-e)*r);h=n+o/(1-e)*(1-i),u=Math.abs(s.lastPosition-h)<=A,t=o*i}else{t=null==s.lastVelocity?o:s.lastVelocity;let r=a.restVelocity||A/10,i=a.clamp?0:a.bounce,l=!im.und(i),d=n==c?s.v0>0:n<c,f=Math.ceil(e/1);for(let e=0;e<f&&!(!(Math.abs(t)>r)&&(u=Math.abs(c-h)<=A));++e){l&&(h==c||h>c==d)&&(t=-t*i,h=c);let e=(-(1e-6*a.tension)*(h-c)+-(.001*a.friction)*t)/a.mass;t+=1*e,h+=1*t}}}else{let i=1;a.duration>0&&(this._memoizedDuration!==a.duration&&(this._memoizedDuration=a.duration,s.durationProgress>0&&(s.elapsedTime=a.duration*s.durationProgress,r=s.elapsedTime+=e)),i=(i=(a.progress||0)+r/this._memoizedDuration)>1?1:i<0?0:i,s.durationProgress=i),t=((h=n+a.easing(i)*(c-n))-s.lastPosition)/e,u=1==i}s.lastVelocity=t,Number.isNaN(h)&&(console.warn("Got NaN while animating:",this),u=!0)}o&&!o[l].done&&(u=!1),u?s.done=!0:t=!1,s.setValue(h,a.round)&&(r=!0)});let s=nw(this),l=s.getValue();if(t){let e=i4(i.to);(l!==e||r)&&!a.decay?(s.setValue(e),this._onChange(e)):r&&a.decay&&this._onChange(l),this._stop()}else r&&this._onChange(l)}set(e){return r2.batchedUpdates(()=>{this._stop(),this._focus(e),this._set(e)}),this}pause(){this._update({pause:!0})}resume(){this._update({pause:!1})}finish(){if(aa(this)){let{to:e,config:t}=this.animation;r2.batchedUpdates(()=>{this._onStart(),t.decay||this._set(e,!1),this._stop()})}return this}update(e){return(this.queue||(this.queue=[])).push(e),this}start(e,t){let r;return im.und(e)?(r=this.queue||[],this.queue=[]):r=[im.obj(e)?e:{...t,to:e}],Promise.all(r.map(e=>this._update(e))).then(e=>n2(this,e))}stop(e){let{to:t}=this.animation;return this._focus(this.get()),n8(this._state,e&&this._lastCallId),r2.batchedUpdates(()=>this._stop(t,e)),this}reset(){this._update({reset:!0})}eventObserved(e){"change"==e.type?this._start():"priority"==e.type&&(this.priority=e.priority+1)}_prepareNode(e){let t=this.key||"",{to:r,from:i}=e;(null==(r=im.obj(r)?r[t]:r)||nK(r))&&(r=void 0),null==(i=im.obj(i)?i[t]:i)&&(i=void 0);let n={to:r,from:i};return an(this)||(e.reverse&&([r,i]=[i,r]),i=i4(i),im.und(i)?nw(this)||this._set(r):this._set(i)),n}_update({...e},t){let{key:r,defaultProps:i}=this;e.default&&Object.assign(i,nV(e,(e,t)=>/^on/.test(t)?nG(e,r):e)),am(this,e,"onProps"),ap(this,"onProps",e,this);let n=this._prepareNode(e);if(Object.isFrozen(this))throw Error("Cannot animate a `SpringValue` object that is frozen. Did you forget to pass your component to `animated(...)` before animating its props?");let a=this._state;return n0(++this._lastCallId,{key:r,props:e,defaultProps:i,state:a,actions:{pause:()=>{ao(this)||(al(this,!0),ix(a.pauseQueue),ap(this,"onPause",n4(this,au(this,this.animation.to)),this))},resume:()=>{ao(this)&&(al(this,!1),aa(this)&&this._resume(),ix(a.resumeQueue),ap(this,"onResume",n4(this,au(this,this.animation.to)),this))},start:this._merge.bind(this,n)}}).then(r=>{if(e.loop&&r.finished&&!(t&&r.noop)){let t=ah(e);if(t)return this._update(t,!0)}return r})}_merge(e,t,r){if(t.cancel)return this.stop(!0),r(n5(this));let i=!im.und(e.to),n=!im.und(e.from);if(i||n){if(!(t.callId>this._lastToId))return r(n5(this));this._lastToId=t.callId}let{key:a,defaultProps:o,animation:s}=this,{to:l,from:c}=s,{to:u=l,from:h=c}=e;n&&!i&&(!t.default||im.und(u))&&(u=h),t.reverse&&([u,h]=[h,u]);let A=!ip(h,c);A&&(s.from=h),h=i4(h);let d=!ip(u,l);d&&this._focus(u);let f=nK(t.to),{config:m}=s,{decay:p,velocity:g}=m;(i||n)&&(m.velocity=0),t.config&&!f&&function(e,t,r){for(let i in r&&(nZ(r={...r},t),t={...r,...t}),nZ(e,t),Object.assign(e,t),nq)null==e[i]&&(e[i]=nq[i]);let{frequency:i,damping:n}=e,{mass:a}=e;im.und(i)||(i<.01&&(i=.01),n<0&&(n=0),e.tension=Math.pow(2*Math.PI/i,2)*a,e.friction=4*Math.PI*n*a/i)}(m,nU(t.config,a),t.config!==o.config?nU(o.config,a):void 0);let y=nw(this);if(!y||im.und(u))return r(n4(this,!0));let v=im.und(t.reset)?n&&!t.default:!im.und(h)&&nk(t.reset,a),E=v?h:this.get(),x=nW(u),C=im.num(x)||im.arr(x)||nm(x),B=!f&&(!C||nk(o.immediate||t.immediate,a));if(d){let e=nP(u);if(e!==y.constructor){if(B)y=this._set(x);else throw Error(`Cannot animate between ${y.constructor.name} and ${e.name}, as the "to" prop suggests`)}}let w=y.constructor,I=i3(u),b=!1;if(!I){let e=v||!an(this)&&A;(d||e)&&(I=!(b=ip(nW(E),x))),(ip(s.immediate,B)||B)&&ip(m.decay,p)&&ip(m.velocity,g)||(I=!0)}if(b&&aa(this)&&(s.changed&&!v?I=!0:I||this._stop(l)),!f&&((I||i3(l))&&(s.values=y.getPayload(),s.toValues=i3(u)?null:w==nS?[1]:iv(x)),s.immediate==B||(s.immediate=B,B||v||this._set(l)),I)){let{onRest:e}=s;ig(af,e=>am(this,t,e));let i=n4(this,au(this,l));ix(this._pendingCalls,i),this._pendingCalls.add(r),s.changed&&r2.batchedUpdates(()=>{s.changed=!v,e?.(i,this),v?nU(o.onRest,i):s.onStart?.(i,this)})}v&&this._set(E),f?r(n6(t.to,t,this._state,this)):I?this._start():aa(this)&&!d?this._pendingCalls.add(r):r(n3(E))}_focus(e){let t=this.animation;e!==t.to&&(i5(this)&&this._detach(),t.to=e,i5(this)&&this._attach())}_attach(){let e=0,{to:t}=this.animation;i3(t)&&(i7(t,this),ae(t)&&(e=t.priority+1)),this.priority=e}_detach(){let{to:e}=this.animation;i3(e)&&ne(e,this)}_set(e,t=!0){let r=i4(e);if(!im.und(r)){let e=nw(this);if(!e||!ip(r,e.getValue())){let i=nP(r);e&&e.constructor==i?e.setValue(r):nI(this,i.create(r)),e&&r2.batchedUpdates(()=>{this._onChange(r,t)})}}return nw(this)}_onStart(){let e=this.animation;e.changed||(e.changed=!0,ap(this,"onStart",n4(this,au(this,e.to)),this))}_onChange(e,t){t||(this._onStart(),nU(this.animation.onChange,e,this)),nU(this.defaultProps.onChange,e,this),super._onChange(e,t)}_start(){let e=this.animation;nw(this).reset(i4(e.to)),e.immediate||(e.fromValues=e.values.map(e=>e.lastPosition)),aa(this)||(as(this,!0),ao(this)||this._resume())}_resume(){ih.skipAnimation?this.finish():iT.start(this)}_stop(e,t){if(aa(this)){as(this,!1);let r=this.animation;ig(r.values,e=>{e.done=!0}),r.toValues&&(r.onChange=r.onPause=r.onResume=void 0),i6(this,{type:"idle",parent:this});let i=t?n5(this.get()):n4(this.get(),au(this,e??r.to));ix(this._pendingCalls,i),r.changed&&(r.changed=!1,ap(this,"onRest",i,this))}}};function au(e,t){let r=nW(t);return ip(nW(e.get()),r)}function ah(e,t=e.loop,r=e.to){let i=nU(t);if(i){let n=!0!==i&&nY(i),a=(n||e).reverse,o=!n||n.reset;return aA({...e,loop:t,default:!1,pause:void 0,to:!a||nK(r)?r:void 0,from:o?e.from:void 0,reset:o,...n})}}function aA(e){let{to:t,from:r}=e=nY(e),i=new Set;return im.obj(t)&&ad(t,i),im.obj(r)&&ad(r,i),e.keys=i.size?Array.from(i):null,e}function ad(e,t){iy(e,(e,r)=>null!=e&&t.add(r))}var af=["onStart","onRest","onChange","onPause","onResume"];function am(e,t,r){e.animation[r]=t[r]!==nN(t,r)?nG(t[r],e.key):void 0}function ap(e,t,...r){e.animation[t]?.(...r),e.defaultProps[t]?.(...r)}var ag=["onStart","onChange","onRest"],ay=1,av=class{constructor(e,t){this.id=ay++,this.springs={},this.queue=[],this._lastAsyncId=0,this._active=new Set,this._changed=new Set,this._started=!1,this._state={paused:!1,pauseQueue:new Set,resumeQueue:new Set,timeouts:new Set},this._events={onStart:new Map,onChange:new Map,onRest:new Map},this._onFrame=this._onFrame.bind(this),t&&(this._flush=t),e&&this.start({default:!0,...e})}get idle(){return!this._state.asyncTo&&Object.values(this.springs).every(e=>e.idle&&!e.isDelayed&&!e.isPaused)}get item(){return this._item}set item(e){this._item=e}get(){let e={};return this.each((t,r)=>e[r]=t.get()),e}set(e){for(let t in e){let r=e[t];im.und(r)||this.springs[t].set(r)}}update(e){return e&&this.queue.push(aA(e)),this}start(e){let{queue:t}=this;return(e?t=iv(e).map(aA):this.queue=[],this._flush)?this._flush(this,t):(ab(this,t),aE(this,t))}stop(e,t){if(!!e!==e&&(t=e),t){let r=this.springs;ig(iv(t),t=>r[t].stop(!!e))}else n8(this._state,this._lastAsyncId),this.each(t=>t.stop(!!e));return this}pause(e){if(im.und(e))this.start({pause:!0});else{let t=this.springs;ig(iv(e),e=>t[e].pause())}return this}resume(e){if(im.und(e))this.start({pause:!1});else{let t=this.springs;ig(iv(e),e=>t[e].resume())}return this}each(e){iy(this.springs,e)}_onFrame(){let{onStart:e,onChange:t,onRest:r}=this._events,i=this._active.size>0,n=this._changed.size>0;(i&&!this._started||n&&!this._started)&&(this._started=!0,iE(e,([e,t])=>{t.value=this.get(),e(t,this,this._item)}));let a=!i&&this._started,o=n||a&&r.size?this.get():null;n&&t.size&&iE(t,([e,t])=>{t.value=o,e(t,this,this._item)}),a&&(this._started=!1,iE(r,([e,t])=>{t.value=o,e(t,this,this._item)}))}eventObserved(e){if("change"==e.type)this._changed.add(e.parent),e.idle||this._active.add(e.parent);else{if("idle"!=e.type)return;this._active.delete(e.parent)}r2.onFrame(this._onFrame)}};function aE(e,t){return Promise.all(t.map(t=>ax(e,t))).then(t=>n2(e,t))}async function ax(e,t,r){let{keys:i,to:n,from:a,loop:o,onRest:s,onResolve:l}=t,c=im.obj(t.default)&&t.default;o&&(t.loop=!1),!1===n&&(t.to=null),!1===a&&(t.from=null);let u=im.arr(n)||im.fun(n)?n:void 0;u?(t.to=void 0,t.onRest=void 0,c&&(c.onRest=void 0)):ig(ag,r=>{let i=t[r];if(im.fun(i)){let n=e._events[r];t[r]=({finished:e,cancelled:t})=>{let r=n.get(i);r?(e||(r.finished=!1),t&&(r.cancelled=!0)):n.set(i,{value:null,finished:e||!1,cancelled:t||!1})},c&&(c[r]=t[r])}});let h=e._state;!h.paused===t.pause?(h.paused=t.pause,ix(t.pause?h.pauseQueue:h.resumeQueue)):h.paused&&(t.pause=!0);let A=(i||Object.keys(e.springs)).map(r=>e.springs[r].start(t)),d=!0===t.cancel||!0===nN(t,"cancel");(u||d&&h.asyncId)&&A.push(n0(++e._lastAsyncId,{props:t,state:h,actions:{pause:iA,resume:iA,start(t,r){d?(n8(h,e._lastAsyncId),r(n5(e))):(t.onRest=s,r(n6(u,t,h,e)))}}})),h.paused&&await new Promise(e=>{h.resumeQueue.add(e)});let f=n2(e,await Promise.all(A));if(o&&f.finished&&!(r&&f.noop)){let r=ah(t,o,n);if(r)return ab(e,[r]),ax(e,r,!0)}return l&&r2.batchedUpdates(()=>l(f,e,e.item)),f}function aC(e,t){let r={...e.springs};return t&&ig(iv(t),e=>{im.und(e.keys)&&(e=aA(e)),im.obj(e.to)||(e={...e,to:void 0}),aI(r,e,e=>aw(e))}),aB(e,r),r}function aB(e,t){iy(t,(t,r)=>{e.springs[r]||(e.springs[r]=t,i7(t,e))})}function aw(e,t){let r=new ac;return r.key=e,t&&i7(r,t),r}function aI(e,t,r){t.keys&&ig(t.keys,i=>{(e[i]||(e[i]=r(i)))._prepareNode(t)})}function ab(e,t){ig(t,t=>{aI(e.springs,t,t=>aw(t,e))})}var a_=({children:e,...t})=>{let r=(0,eS.useContext)(aM),i=t.pause||!!r.pause,n=t.immediate||!!r.immediate;t=function(e,t){let[r]=(0,eS.useState)(()=>({inputs:t,result:e()})),i=(0,eS.useRef)(),n=i.current,a=n;return a?t&&a.inputs&&function(e,t){if(e.length!==t.length)return!1;for(let r=0;r<e.length;r++)if(e[r]!==t[r])return!1;return!0}(t,a.inputs)||(a={inputs:t,result:e()}):a=r,(0,eS.useEffect)(()=>{i.current=a,n==r&&(r.inputs=r.result=void 0)},[a]),a.result}(()=>({pause:i,immediate:n}),[i,n]);let{Provider:a}=aM;return eS.createElement(a,{value:t},e)},aM=(Object.assign(a_,eS.createContext({})),a_.Provider._context=a_,a_.Consumer._context=a_,a_);a_.Provider=aM.Provider,a_.Consumer=aM.Consumer;var aS=()=>{let e=[],t=function(t){nf(`${nh}Directly calling start instead of using the api object is deprecated in v9 (use ".start" instead), this will be removed in later 0.X.0 versions`);let i=[];return ig(e,(e,n)=>{if(im.und(t))i.push(e.start());else{let a=r(t,e,n);a&&i.push(e.start(a))}}),i};t.current=e,t.add=function(t){e.includes(t)||e.push(t)},t.delete=function(t){let r=e.indexOf(t);~r&&e.splice(r,1)},t.pause=function(){return ig(e,e=>e.pause(...arguments)),this},t.resume=function(){return ig(e,e=>e.resume(...arguments)),this},t.set=function(t){ig(e,(e,r)=>{let i=im.fun(t)?t(r,e):t;i&&e.set(i)})},t.start=function(t){let r=[];return ig(e,(e,i)=>{if(im.und(t))r.push(e.start());else{let n=this._getProps(t,e,i);n&&r.push(e.start(n))}}),r},t.stop=function(){return ig(e,e=>e.stop(...arguments)),this},t.update=function(t){return ig(e,(e,r)=>e.update(this._getProps(t,e,r))),this};let r=function(e,t,r){return im.fun(e)?e(r,t):e};return t._getProps=r,t},aD=class extends ar{constructor(e,t){super(),this.source=e,this.idle=!0,this._active=new Set,this.calc=i1(...t);let r=this._get();nI(this,nP(r).create(r))}advance(e){let t=this._get();ip(t,this.get())||(nw(this).setValue(t),this._onChange(t,this.idle)),!this.idle&&aR(this._active)&&aF(this)}_get(){let e=im.arr(this.source)?this.source.map(i4):iv(i4(this.source));return this.calc(...e)}_start(){this.idle&&!aR(this._active)&&(this.idle=!1,ig(nb(this),e=>{e.done=!1}),ih.skipAnimation?(r2.batchedUpdates(()=>this.advance()),aF(this)):iT.start(this))}_attach(){let e=1;ig(iv(this.source),t=>{i3(t)&&i7(t,this),ae(t)&&(t.idle||this._active.add(t),e=Math.max(e,t.priority+1))}),this.priority=e,this._start()}_detach(){ig(iv(this.source),e=>{i3(e)&&ne(e,this)}),this._active.clear(),aF(this)}eventObserved(e){"change"==e.type?e.idle?this.advance():(this._active.add(e.parent),this._start()):"idle"==e.type?this._active.delete(e.parent):"priority"==e.type&&(this.priority=iv(this.source).reduce((e,t)=>Math.max(e,(ae(t)?t.priority:0)+1),0))}};function aT(e){return!1!==e.idle}function aR(e){return!e.size||Array.from(e).every(aT)}function aF(e){e.idle||(e.idle=!0,ig(nb(e),e=>{e.done=!0}),i6(e,{type:"idle",parent:e}))}ih.assign({createStringInterpolator:nu,to:(e,t)=>new aD(e,t)}),iT.advance;var aP=["primitive"].concat(Object.keys(eT).filter(e=>/^[A-Z]/.test(e)).map(e=>e[0].toLowerCase()+e.slice(1)));ih.assign({createStringInterpolator:nu,colors:{transparent:0,aliceblue:4042850303,antiquewhite:4209760255,aqua:16777215,aquamarine:2147472639,azure:4043309055,beige:4126530815,bisque:4293182719,black:255,blanchedalmond:4293643775,blue:65535,blueviolet:2318131967,brown:2771004159,burlywood:3736635391,burntsienna:3934150143,cadetblue:1604231423,chartreuse:2147418367,chocolate:3530104575,coral:4286533887,cornflowerblue:1687547391,cornsilk:4294499583,crimson:3692313855,cyan:16777215,darkblue:35839,darkcyan:9145343,darkgoldenrod:3095792639,darkgray:2846468607,darkgreen:6553855,darkgrey:2846468607,darkkhaki:3182914559,darkmagenta:2332068863,darkolivegreen:1433087999,darkorange:4287365375,darkorchid:2570243327,darkred:2332033279,darksalmon:3918953215,darkseagreen:2411499519,darkslateblue:1211993087,darkslategray:793726975,darkslategrey:793726975,darkturquoise:13554175,darkviolet:2483082239,deeppink:4279538687,deepskyblue:12582911,dimgray:1768516095,dimgrey:1768516095,dodgerblue:512819199,firebrick:2988581631,floralwhite:4294635775,forestgreen:579543807,fuchsia:4278255615,gainsboro:3705462015,ghostwhite:4177068031,gold:4292280575,goldenrod:3668254975,gray:2155905279,green:8388863,greenyellow:2919182335,grey:2155905279,honeydew:4043305215,hotpink:4285117695,indianred:3445382399,indigo:1258324735,ivory:4294963455,khaki:4041641215,lavender:3873897215,lavenderblush:4293981695,lawngreen:2096890111,lemonchiffon:4294626815,lightblue:2916673279,lightcoral:4034953471,lightcyan:3774873599,lightgoldenrodyellow:4210742015,lightgray:3553874943,lightgreen:2431553791,lightgrey:3553874943,lightpink:4290167295,lightsalmon:4288707327,lightseagreen:548580095,lightskyblue:2278488831,lightslategray:2005441023,lightslategrey:2005441023,lightsteelblue:2965692159,lightyellow:4294959359,lime:16711935,limegreen:852308735,linen:4210091775,magenta:4278255615,maroon:2147483903,mediumaquamarine:1724754687,mediumblue:52735,mediumorchid:3126187007,mediumpurple:2473647103,mediumseagreen:1018393087,mediumslateblue:2070474495,mediumspringgreen:16423679,mediumturquoise:1221709055,mediumvioletred:3340076543,midnightblue:421097727,mintcream:4127193855,mistyrose:4293190143,moccasin:4293178879,navajowhite:4292783615,navy:33023,oldlace:4260751103,olive:2155872511,olivedrab:1804477439,orange:4289003775,orangered:4282712319,orchid:3664828159,palegoldenrod:4008225535,palegreen:2566625535,paleturquoise:2951671551,palevioletred:3681588223,papayawhip:4293907967,peachpuff:4292524543,peru:3448061951,pink:4290825215,plum:3718307327,powderblue:2967529215,purple:2147516671,rebeccapurple:1714657791,red:4278190335,rosybrown:3163525119,royalblue:1097458175,saddlebrown:2336560127,salmon:4202722047,sandybrown:4104413439,seagreen:780883967,seashell:4294307583,sienna:2689740287,silver:3233857791,skyblue:2278484991,slateblue:1784335871,slategray:1887473919,slategrey:1887473919,snow:4294638335,springgreen:16744447,steelblue:1182971135,tan:3535047935,teal:8421631,thistle:3636451583,tomato:4284696575,turquoise:1088475391,violet:4001558271,wheat:4125012991,white:4294967295,whitesmoke:4126537215,yellow:4294902015,yellowgreen:2597139199},frameLoop:"demand"}),(0,eR.o)(()=>{r2.advance()});var aQ=((e,{applyAnimatedValues:t=()=>!1,createAnimatedStyle:r=e=>new nT(e),getComponentProps:i=e=>e}={})=>{let n={applyAnimatedValues:t,createAnimatedStyle:r,getComponentProps:i},a=e=>{let t=nO(e)||"Anonymous";return(e=im.str(e)?a[e]||(a[e]=nQ(e,n)):e[nL]||(e[nL]=nQ(e,n))).displayName=`Animated(${t})`,e};return iy(e,(t,r)=>{im.arr(e)&&(r=nO(t)),a[r]=a(t)}),{animated:a}})(aP,{applyAnimatedValues:eR.k}).animated;function az({enabled:e=!0,snap:t,global:r,domElement:i,cursor:n=!0,children:a,speed:o=1,rotation:s=[0,0,0],zoom:l=1,polar:c=[0,Math.PI/2],azimuth:u=[-1/0,1/0],config:h={mass:1,tension:170,friction:26}}){let A=(0,eR.D)(e=>e.events),d=(0,eR.D)(e=>e.gl),f=i||A.connected||d.domElement,{size:m}=(0,eR.D)(),p=eS.useMemo(()=>[s[0]+c[0],s[0]+c[1]],[s[0],c[0],c[1]]),g=eS.useMemo(()=>[s[1]+u[0],s[1]+u[1]],[s[1],u[0],u[1]]),y=eS.useMemo(()=>[eT.MathUtils.clamp(s[0],...p),eT.MathUtils.clamp(s[1],...g),s[2]],[s[0],s[1],s[2],p,g]),[v,E]=function(e,t){let r=im.fun(e),[[i],n]=function(e,t,r){let i=im.fun(t)&&t;i&&!r&&(r=[]);let n=(0,eS.useMemo)(()=>i||3==arguments.length?aS():void 0,[]),a=(0,eS.useRef)(0),o=ny(),s=(0,eS.useMemo)(()=>({ctrls:[],queue:[],flush(e,t){let r=aC(e,t);return!(a.current>0)||s.queue.length||Object.keys(r).some(t=>!e.springs[t])?new Promise(i=>{aB(e,r),s.queue.push(()=>{i(aE(e,t))}),o()}):aE(e,t)}}),[]),l=(0,eS.useRef)([...s.ctrls]),c=[],u=nx(e)||0;function h(e,r){for(let n=e;n<r;n++){let e=l.current[n]||(l.current[n]=new av(null,s.flush)),r=i?i(n,e):t[n];r&&(c[n]=function(e){let t=aA(e);return im.und(t.default)&&(t.default=nV(t)),t}(r))}}(0,eS.useMemo)(()=>{ig(l.current.slice(e,u),e=>{e.ref?.delete(e),n?.delete(e),e.stop(!0)}),l.current.length=e,h(u,e)},[e]),(0,eS.useMemo)(()=>{h(0,Math.min(u,e))},r);let A=l.current.map((e,t)=>aC(e,c[t])),d=(0,eS.useContext)(a_),f=nx(d),m=d!==f&&function(e){for(let t in e)return!0;return!1}(d);np(()=>{a.current++,s.ctrls=l.current;let{queue:e}=s;e.length&&(s.queue=[],ig(e,e=>e())),ig(l.current,(e,t)=>{n?.add(e),m&&e.start({default:d});let r=c[t];if(r){var i;(i=r.ref)&&e.ref!==i&&(e.ref?.delete(e),i.add(e),e.ref=i),e.ref?e.queue.push(r):e.start(r)}})}),nv(()=>()=>{ig(s.ctrls,e=>e.stop(!0))});let p=A.map(e=>({...e}));return n?[p,n]:p}(1,r?e:[e],r?t||[]:t);return r||2==arguments.length?[i,n]:i}(()=>({scale:1,rotation:y,config:h}));eS.useEffect(()=>void E.start({scale:1,rotation:y,config:h}),[y]),eS.useEffect(()=>{if(r&&n&&e)return f.style.cursor="grab",d.domElement.style.cursor="",()=>{f.style.cursor="default",d.domElement.style.cursor="default"}},[r,n,f,e]);let x=t0({onHover:({last:t})=>{n&&!r&&e&&(f.style.cursor=t?"auto":"grab")},onDrag:({down:r,delta:[i,a],memo:[s,c]=v.rotation.animation.to||y})=>{if(!e)return[a,i];n&&(f.style.cursor=r?"grabbing":"grab"),i=eT.MathUtils.clamp(c+i/m.width*Math.PI*o,...g),a=eT.MathUtils.clamp(s+a/m.height*Math.PI*o,...p);let u=t&&!r&&"boolean"!=typeof t?t:h;return E.start({scale:r&&a>p[1]/2?l:1,rotation:t&&!r?y:[a,i,0],config:e=>"scale"===e?{...u,friction:3*u.friction}:u}),[a,i]}},{target:r?f:void 0});return eS.createElement(aQ.group,j({},null==x?void 0:x(),v),a)}let aL=e=>(t,r,i)=>{let n=i.subscribe;return i.subscribe=(e,t,r)=>{let a=e;if(t){let n=(null==r?void 0:r.equalityFn)||Object.is,o=e(i.getState());a=r=>{let i=e(r);if(!n(o,i)){let e=o;t(o=i,e)}},(null==r?void 0:r.fireImmediately)&&t(o,o)}return n(a)},e(t,r,i)},aO=eS.createContext(null);function aU({map:e,children:t,onChange:r,domElement:i}){let n=e.map(e=>e.name+e.keys).join("-"),a=eS.useMemo(()=>eK(aL(()=>e.reduce((e,t)=>({...e,[t.name]:!1}),{}))),[n]),o=eS.useMemo(()=>[a.subscribe,a.getState,a],[n]),s=a.setState;return eS.useEffect(()=>{let t=e.map(({name:e,keys:t,up:i})=>({keys:t,up:i,fn:t=>{s({[e]:t}),r&&r(e,t,o[1]())}})).reduce((e,{keys:t,fn:r,up:i=!0})=>(t.forEach(t=>e[t]={fn:r,pressed:!1,up:i}),e),{}),n=({key:e,code:r})=>{let i=t[e]||t[r];if(!i)return;let{fn:n,pressed:a,up:o}=i;i.pressed=!0,(o||!a)&&n(!0)},a=({key:e,code:r})=>{let i=t[e]||t[r];if(!i)return;let{fn:n,up:a}=i;i.pressed=!1,a&&n(!1)},l=i||window;return l.addEventListener("keydown",n,{passive:!0}),l.addEventListener("keyup",a,{passive:!0}),()=>{l.removeEventListener("keydown",n),l.removeEventListener("keyup",a)}},[i,n]),eS.createElement(aO.Provider,{value:o,children:t})}function ak(e){let[t,r,i]=eS.useContext(aO);return e?i(e):[t,r]}let aG=new eT.Frustum,aN=new eT.Vector3,aH=new eT.Vector3,aV=new eT.Vector3,aj=new eT.Vector3,aJ=new eT.Vector3,aY=new eT.Vector3,aW=new eT.Vector3,aK=new eT.Vector3,aq=new eT.Vector3,aX=new eT.Vector3,aZ=new eT.Vector3,a$=new eT.Vector3,a1=new eT.Vector3,a0=new eT.Vector3;class a2{constructor(e,t,r){this.camera=e,this.scene=t,this.startPoint=new eT.Vector3,this.endPoint=new eT.Vector3,this.collection=[],this.deep=r||Number.MAX_VALUE}select(e,t){return this.startPoint=e||this.startPoint,this.endPoint=t||this.endPoint,this.collection=[],this.updateFrustum(this.startPoint,this.endPoint),this.searchChildInFrustum(aG,this.scene),this.collection}updateFrustum(e,t){if(e=e||this.startPoint,t=t||this.endPoint,e.x===t.x&&(t.x+=Number.EPSILON),e.y===t.y&&(t.y+=Number.EPSILON),this.camera.updateProjectionMatrix(),this.camera.updateMatrixWorld(),this.camera.isPerspectiveCamera){aH.copy(e),aH.x=Math.min(e.x,t.x),aH.y=Math.max(e.y,t.y),t.x=Math.max(e.x,t.x),t.y=Math.min(e.y,t.y),aV.setFromMatrixPosition(this.camera.matrixWorld),aj.copy(aH),aJ.set(t.x,aH.y,0),aY.copy(t),aW.set(aH.x,t.y,0),aj.unproject(this.camera),aJ.unproject(this.camera),aY.unproject(this.camera),aW.unproject(this.camera),a$.copy(aj).sub(aV),a1.copy(aJ).sub(aV),a0.copy(aY).sub(aV),a$.normalize(),a1.normalize(),a0.normalize(),a$.multiplyScalar(this.deep),a1.multiplyScalar(this.deep),a0.multiplyScalar(this.deep),a$.add(aV),a1.add(aV),a0.add(aV);var r=aG.planes;r[0].setFromCoplanarPoints(aV,aj,aJ),r[1].setFromCoplanarPoints(aV,aJ,aY),r[2].setFromCoplanarPoints(aY,aW,aV),r[3].setFromCoplanarPoints(aW,aj,aV),r[4].setFromCoplanarPoints(aJ,aY,aW),r[5].setFromCoplanarPoints(a0,a1,a$),r[5].normal.multiplyScalar(-1)}else if(this.camera.isOrthographicCamera){let i=Math.min(e.x,t.x),n=Math.max(e.y,t.y),a=Math.max(e.x,t.x),o=Math.min(e.y,t.y);aj.set(i,n,-1),aJ.set(a,n,-1),aY.set(a,o,-1),aW.set(i,o,-1),aK.set(i,n,1),aq.set(a,n,1),aX.set(a,o,1),aZ.set(i,o,1),aj.unproject(this.camera),aJ.unproject(this.camera),aY.unproject(this.camera),aW.unproject(this.camera),aK.unproject(this.camera),aq.unproject(this.camera),aX.unproject(this.camera),aZ.unproject(this.camera);var r=aG.planes;r[0].setFromCoplanarPoints(aj,aK,aq),r[1].setFromCoplanarPoints(aJ,aq,aX),r[2].setFromCoplanarPoints(aX,aZ,aW),r[3].setFromCoplanarPoints(aZ,aK,aj),r[4].setFromCoplanarPoints(aJ,aY,aW),r[5].setFromCoplanarPoints(aX,aq,aK),r[5].normal.multiplyScalar(-1)}else console.error("THREE.SelectionBox: Unsupported camera type.")}searchChildInFrustum(e,t){if((t.isMesh||t.isLine||t.isPoints)&&void 0!==t.material&&(null===t.geometry.boundingSphere&&t.geometry.computeBoundingSphere(),aN.copy(t.geometry.boundingSphere.center),aN.applyMatrix4(t.matrixWorld),e.containsPoint(aN)&&this.collection.push(t)),t.children.length>0)for(let r=0;r<t.children.length;r++)this.searchChildInFrustum(e,t.children[r])}}let a3=e=>Symbol.iterator in e,a4=e=>"entries"in e,a5=(e,t)=>{let r=e instanceof Map?e:new Map(e.entries()),i=t instanceof Map?t:new Map(t.entries());if(r.size!==i.size)return!1;for(let[e,t]of r)if(!Object.is(t,i.get(e)))return!1;return!0},a6=(e,t)=>{let r=e[Symbol.iterator](),i=t[Symbol.iterator](),n=r.next(),a=i.next();for(;!n.done&&!a.done;){if(!Object.is(n.value,a.value))return!1;n=r.next(),a=i.next()}return!!n.done&&!!a.done},a8=eS.createContext([]);function a9({box:e,multiple:t,children:r,onChange:i,onChangePointerUp:n,border:a="1px solid #55aaff",backgroundColor:o="rgba(75, 160, 255, 0.1)",filter:s=e=>e,...l}){let[c,u]=eS.useState(!1),{setEvents:h,camera:A,raycaster:d,gl:f,controls:m,size:p,get:g}=(0,eR.D)(),[y,v]=eS.useState(!1),[E,x]=eS.useReducer((e,{object:t,shift:r})=>void 0===t?[]:Array.isArray(t)?t:r?e.includes(t)?e.filter(e=>e!==t):[t,...e]:e[0]===t?[]:[t],[]);eS.useEffect(()=>{c?null==i||i(E):null==n||n(E)},[E,c]);let C=eS.useCallback(e=>{e.stopPropagation(),x({object:s([e.object])[0],shift:t&&e.shiftKey})},[]),B=eS.useCallback(e=>!y&&x({}),[y]),w=eS.useRef(null);return eS.useEffect(()=>{if(!e||!t)return;let r=new a2(A,w.current),i=document.createElement("div");i.style.pointerEvents="none",i.style.border=a,i.style.backgroundColor=o,i.style.position="fixed";let n=new eT.Vector2,l=new eT.Vector2,c=new eT.Vector2,d=g().events.enabled,y=null==m?void 0:m.enabled,v=!1;function E(e,t){let{offsetX:r,offsetY:i}=e,{width:n,height:a}=p;t.set(r/n*2-1,-(i/a*2)+1)}function C(e){if(e.shiftKey){var t;m&&(m.enabled=!1),h({enabled:!1}),u(v=!0),null==(t=f.domElement.parentElement)||t.appendChild(i),i.style.left=`${e.clientX}px`,i.style.top=`${e.clientY}px`,i.style.width="0px",i.style.height="0px",n.x=e.clientX,n.y=e.clientY,E(e,r.startPoint)}}let B=[];function I(e){if(v){var t;c.x=Math.max(n.x,e.clientX),c.y=Math.max(n.y,e.clientY),l.x=Math.min(n.x,e.clientX),l.y=Math.min(n.y,e.clientY),i.style.left=`${l.x}px`,i.style.top=`${l.y}px`,i.style.width=`${c.x-l.x}px`,i.style.height=`${c.y-l.y}px`,E(e,r.endPoint);let a=r.select().sort(e=>e.uuid).filter(e=>e.isMesh);Object.is(a,t=B)||"object"==typeof a&&null!==a&&"object"==typeof t&&null!==t&&(a3(a)&&a3(t)?a4(a)&&a4(t)?a5(a,t):a6(a,t):a5({entries:()=>Object.entries(a)},{entries:()=>Object.entries(t)}))||(B=a,x({object:s(a)}))}}function b(e){v&&function(){if(v){var e;m&&(m.enabled=y),h({enabled:d}),u(v=!1),null==(e=i.parentElement)||e.removeChild(i)}}()}return document.addEventListener("pointerdown",C,{passive:!0}),document.addEventListener("pointermove",I,{passive:!0,capture:!0}),document.addEventListener("pointerup",b,{passive:!0}),()=>{document.removeEventListener("pointerdown",C),document.removeEventListener("pointermove",I,!0),document.removeEventListener("pointerup",b)}},[p.width,p.height,d,A,m,f]),eS.createElement("group",j({ref:w,onClick:C,onPointerOver:()=>v(!0),onPointerOut:()=>v(!1),onPointerMissed:B},l),eS.createElement(a8.Provider,{value:E},r))}function a7(){return eS.useContext(a8)}let oe=eS.forwardRef(function({children:e,follow:t=!0,lockX:r=!1,lockY:i=!1,lockZ:n=!1,...a},o){let s=eS.useRef(null),l=eS.useRef(null),c=new eT.Quaternion;return(0,eR.F)(({camera:e})=>{if(!t||!l.current)return;let a=s.current.rotation.clone();l.current.updateMatrix(),l.current.updateWorldMatrix(!1,!1),l.current.getWorldQuaternion(c),e.getWorldQuaternion(s.current.quaternion).premultiply(c.invert()),r&&(s.current.rotation.x=a.x),i&&(s.current.rotation.y=a.y),n&&(s.current.rotation.z=a.z)}),eS.useImperativeHandle(o,()=>l.current,[]),eS.createElement("group",j({ref:l},a),eS.createElement("group",{ref:s},e))}),ot=eS.forwardRef(({children:e,depth:t=-1,...r},i)=>{let n=eS.useRef(null);return eS.useImperativeHandle(i,()=>n.current,[]),(0,eR.F)(({camera:e})=>{n.current.quaternion.copy(e.quaternion),n.current.position.copy(e.position)}),eS.createElement("group",j({ref:n},r),eS.createElement("group",{"position-z":-t},e))}),or=new eT.Vector3,oi=new eT.Vector3,on=new eT.Vector3,oa=(e,t,r)=>{let i=r.width/2,n=r.height/2;t.updateMatrixWorld(!1);let a=e.project(t);return a.x=a.x*i+i,a.y=-(a.y*n)+n,a},oo=(e,t,r,i=1)=>{let n=or.set(e.x/r.width*2-1,-(e.y/r.height*2)+1,i);return n.unproject(t),n},os=(e,t,r,i)=>{let n=oa(on.copy(e),r,i),a=0;for(let o=0;o<2;++o){let s=oi.copy(n).setComponent(o,n.getComponent(o)+t),l=oo(s,r,i,s.z);a=Math.max(a,e.distanceTo(l))}return a},ol=new eT.Vector3,oc=(0,eS.forwardRef)(({scale:e=1,...t},r)=>{let i=(0,eS.useRef)(null);return eS.useImperativeHandle(r,()=>i.current,[]),(0,eR.F)(t=>{let r=i.current;if(!r)return;let n=os(r.getWorldPosition(ol),e,t.camera,t.size);r.scale.setScalar(n*e)}),eS.createElement("object3D",j({ref:i},t))}),ou=new eT.Box3,oh=new eT.Vector3;class oA extends eT.InstancedBufferGeometry{constructor(){super(),this.isLineSegmentsGeometry=!0,this.type="LineSegmentsGeometry",this.setIndex([0,2,1,2,3,1,2,4,3,4,5,3,4,6,5,6,7,5]),this.setAttribute("position",new eT.Float32BufferAttribute([-1,2,0,1,2,0,-1,1,0,1,1,0,-1,0,0,1,0,0,-1,-1,0,1,-1,0],3)),this.setAttribute("uv",new eT.Float32BufferAttribute([-1,2,1,2,-1,1,1,1,-1,-1,1,-1,-1,-2,1,-2],2))}applyMatrix4(e){let t=this.attributes.instanceStart,r=this.attributes.instanceEnd;return void 0!==t&&(t.applyMatrix4(e),r.applyMatrix4(e),t.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}setPositions(e){let t;e instanceof Float32Array?t=e:Array.isArray(e)&&(t=new Float32Array(e));let r=new eT.InstancedInterleavedBuffer(t,6,1);return this.setAttribute("instanceStart",new eT.InterleavedBufferAttribute(r,3,0)),this.setAttribute("instanceEnd",new eT.InterleavedBufferAttribute(r,3,3)),this.computeBoundingBox(),this.computeBoundingSphere(),this}setColors(e,t=3){let r;e instanceof Float32Array?r=e:Array.isArray(e)&&(r=new Float32Array(e));let i=new eT.InstancedInterleavedBuffer(r,2*t,1);return this.setAttribute("instanceColorStart",new eT.InterleavedBufferAttribute(i,t,0)),this.setAttribute("instanceColorEnd",new eT.InterleavedBufferAttribute(i,t,t)),this}fromWireframeGeometry(e){return this.setPositions(e.attributes.position.array),this}fromEdgesGeometry(e){return this.setPositions(e.attributes.position.array),this}fromMesh(e){return this.fromWireframeGeometry(new eT.WireframeGeometry(e.geometry)),this}fromLineSegments(e){let t=e.geometry;return this.setPositions(t.attributes.position.array),this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new eT.Box3);let e=this.attributes.instanceStart,t=this.attributes.instanceEnd;void 0!==e&&void 0!==t&&(this.boundingBox.setFromBufferAttribute(e),ou.setFromBufferAttribute(t),this.boundingBox.union(ou))}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new eT.Sphere),null===this.boundingBox&&this.computeBoundingBox();let e=this.attributes.instanceStart,t=this.attributes.instanceEnd;if(void 0!==e&&void 0!==t){let r=this.boundingSphere.center;this.boundingBox.getCenter(r);let i=0;for(let n=0,a=e.count;n<a;n++)oh.fromBufferAttribute(e,n),i=Math.max(i,r.distanceToSquared(oh)),oh.fromBufferAttribute(t,n),i=Math.max(i,r.distanceToSquared(oh));this.boundingSphere.radius=Math.sqrt(i),isNaN(this.boundingSphere.radius)&&console.error("THREE.LineSegmentsGeometry.computeBoundingSphere(): Computed radius is NaN. The instanced position data is likely to have NaN values.",this)}}toJSON(){}applyMatrix(e){return console.warn("THREE.LineSegmentsGeometry: applyMatrix() has been renamed to applyMatrix4()."),this.applyMatrix4(e)}}let od=parseInt(eT.REVISION.replace(/\D+/g,""));class of extends eT.ShaderMaterial{constructor(e){super({type:"LineMaterial",uniforms:eT.UniformsUtils.clone(eT.UniformsUtils.merge([eT.UniformsLib.common,eT.UniformsLib.fog,{worldUnits:{value:1},linewidth:{value:1},resolution:{value:new eT.Vector2(1,1)},dashOffset:{value:0},dashScale:{value:1},dashSize:{value:1},gapSize:{value:1}}])),vertexShader:`
				#include <common>
				#include <fog_pars_vertex>
				#include <logdepthbuf_pars_vertex>
				#include <clipping_planes_pars_vertex>

				uniform float linewidth;
				uniform vec2 resolution;

				attribute vec3 instanceStart;
				attribute vec3 instanceEnd;

				#ifdef USE_COLOR
					#ifdef USE_LINE_COLOR_ALPHA
						varying vec4 vLineColor;
						attribute vec4 instanceColorStart;
						attribute vec4 instanceColorEnd;
					#else
						varying vec3 vLineColor;
						attribute vec3 instanceColorStart;
						attribute vec3 instanceColorEnd;
					#endif
				#endif

				#ifdef WORLD_UNITS

					varying vec4 worldPos;
					varying vec3 worldStart;
					varying vec3 worldEnd;

					#ifdef USE_DASH

						varying vec2 vUv;

					#endif

				#else

					varying vec2 vUv;

				#endif

				#ifdef USE_DASH

					uniform float dashScale;
					attribute float instanceDistanceStart;
					attribute float instanceDistanceEnd;
					varying float vLineDistance;

				#endif

				void trimSegment( const in vec4 start, inout vec4 end ) {

					// trim end segment so it terminates between the camera plane and the near plane

					// conservative estimate of the near plane
					float a = projectionMatrix[ 2 ][ 2 ]; // 3nd entry in 3th column
					float b = projectionMatrix[ 3 ][ 2 ]; // 3nd entry in 4th column
					float nearEstimate = - 0.5 * b / a;

					float alpha = ( nearEstimate - start.z ) / ( end.z - start.z );

					end.xyz = mix( start.xyz, end.xyz, alpha );

				}

				void main() {

					#ifdef USE_COLOR

						vLineColor = ( position.y < 0.5 ) ? instanceColorStart : instanceColorEnd;

					#endif

					#ifdef USE_DASH

						vLineDistance = ( position.y < 0.5 ) ? dashScale * instanceDistanceStart : dashScale * instanceDistanceEnd;
						vUv = uv;

					#endif

					float aspect = resolution.x / resolution.y;

					// camera space
					vec4 start = modelViewMatrix * vec4( instanceStart, 1.0 );
					vec4 end = modelViewMatrix * vec4( instanceEnd, 1.0 );

					#ifdef WORLD_UNITS

						worldStart = start.xyz;
						worldEnd = end.xyz;

					#else

						vUv = uv;

					#endif

					// special case for perspective projection, and segments that terminate either in, or behind, the camera plane
					// clearly the gpu firmware has a way of addressing this issue when projecting into ndc space
					// but we need to perform ndc-space calculations in the shader, so we must address this issue directly
					// perhaps there is a more elegant solution -- WestLangley

					bool perspective = ( projectionMatrix[ 2 ][ 3 ] == - 1.0 ); // 4th entry in the 3rd column

					if ( perspective ) {

						if ( start.z < 0.0 && end.z >= 0.0 ) {

							trimSegment( start, end );

						} else if ( end.z < 0.0 && start.z >= 0.0 ) {

							trimSegment( end, start );

						}

					}

					// clip space
					vec4 clipStart = projectionMatrix * start;
					vec4 clipEnd = projectionMatrix * end;

					// ndc space
					vec3 ndcStart = clipStart.xyz / clipStart.w;
					vec3 ndcEnd = clipEnd.xyz / clipEnd.w;

					// direction
					vec2 dir = ndcEnd.xy - ndcStart.xy;

					// account for clip-space aspect ratio
					dir.x *= aspect;
					dir = normalize( dir );

					#ifdef WORLD_UNITS

						// get the offset direction as perpendicular to the view vector
						vec3 worldDir = normalize( end.xyz - start.xyz );
						vec3 offset;
						if ( position.y < 0.5 ) {

							offset = normalize( cross( start.xyz, worldDir ) );

						} else {

							offset = normalize( cross( end.xyz, worldDir ) );

						}

						// sign flip
						if ( position.x < 0.0 ) offset *= - 1.0;

						float forwardOffset = dot( worldDir, vec3( 0.0, 0.0, 1.0 ) );

						// don't extend the line if we're rendering dashes because we
						// won't be rendering the endcaps
						#ifndef USE_DASH

							// extend the line bounds to encompass  endcaps
							start.xyz += - worldDir * linewidth * 0.5;
							end.xyz += worldDir * linewidth * 0.5;

							// shift the position of the quad so it hugs the forward edge of the line
							offset.xy -= dir * forwardOffset;
							offset.z += 0.5;

						#endif

						// endcaps
						if ( position.y > 1.0 || position.y < 0.0 ) {

							offset.xy += dir * 2.0 * forwardOffset;

						}

						// adjust for linewidth
						offset *= linewidth * 0.5;

						// set the world position
						worldPos = ( position.y < 0.5 ) ? start : end;
						worldPos.xyz += offset;

						// project the worldpos
						vec4 clip = projectionMatrix * worldPos;

						// shift the depth of the projected points so the line
						// segments overlap neatly
						vec3 clipPose = ( position.y < 0.5 ) ? ndcStart : ndcEnd;
						clip.z = clipPose.z * clip.w;

					#else

						vec2 offset = vec2( dir.y, - dir.x );
						// undo aspect ratio adjustment
						dir.x /= aspect;
						offset.x /= aspect;

						// sign flip
						if ( position.x < 0.0 ) offset *= - 1.0;

						// endcaps
						if ( position.y < 0.0 ) {

							offset += - dir;

						} else if ( position.y > 1.0 ) {

							offset += dir;

						}

						// adjust for linewidth
						offset *= linewidth;

						// adjust for clip-space to screen-space conversion // maybe resolution should be based on viewport ...
						offset /= resolution.y;

						// select end
						vec4 clip = ( position.y < 0.5 ) ? clipStart : clipEnd;

						// back to clip space
						offset *= clip.w;

						clip.xy += offset;

					#endif

					gl_Position = clip;

					vec4 mvPosition = ( position.y < 0.5 ) ? start : end; // this is an approximation

					#include <logdepthbuf_vertex>
					#include <clipping_planes_vertex>
					#include <fog_vertex>

				}
			`,fragmentShader:`
				uniform vec3 diffuse;
				uniform float opacity;
				uniform float linewidth;

				#ifdef USE_DASH

					uniform float dashOffset;
					uniform float dashSize;
					uniform float gapSize;

				#endif

				varying float vLineDistance;

				#ifdef WORLD_UNITS

					varying vec4 worldPos;
					varying vec3 worldStart;
					varying vec3 worldEnd;

					#ifdef USE_DASH

						varying vec2 vUv;

					#endif

				#else

					varying vec2 vUv;

				#endif

				#include <common>
				#include <fog_pars_fragment>
				#include <logdepthbuf_pars_fragment>
				#include <clipping_planes_pars_fragment>

				#ifdef USE_COLOR
					#ifdef USE_LINE_COLOR_ALPHA
						varying vec4 vLineColor;
					#else
						varying vec3 vLineColor;
					#endif
				#endif

				vec2 closestLineToLine(vec3 p1, vec3 p2, vec3 p3, vec3 p4) {

					float mua;
					float mub;

					vec3 p13 = p1 - p3;
					vec3 p43 = p4 - p3;

					vec3 p21 = p2 - p1;

					float d1343 = dot( p13, p43 );
					float d4321 = dot( p43, p21 );
					float d1321 = dot( p13, p21 );
					float d4343 = dot( p43, p43 );
					float d2121 = dot( p21, p21 );

					float denom = d2121 * d4343 - d4321 * d4321;

					float numer = d1343 * d4321 - d1321 * d4343;

					mua = numer / denom;
					mua = clamp( mua, 0.0, 1.0 );
					mub = ( d1343 + d4321 * ( mua ) ) / d4343;
					mub = clamp( mub, 0.0, 1.0 );

					return vec2( mua, mub );

				}

				void main() {

					#include <clipping_planes_fragment>

					#ifdef USE_DASH

						if ( vUv.y < - 1.0 || vUv.y > 1.0 ) discard; // discard endcaps

						if ( mod( vLineDistance + dashOffset, dashSize + gapSize ) > dashSize ) discard; // todo - FIX

					#endif

					float alpha = opacity;

					#ifdef WORLD_UNITS

						// Find the closest points on the view ray and the line segment
						vec3 rayEnd = normalize( worldPos.xyz ) * 1e5;
						vec3 lineDir = worldEnd - worldStart;
						vec2 params = closestLineToLine( worldStart, worldEnd, vec3( 0.0, 0.0, 0.0 ), rayEnd );

						vec3 p1 = worldStart + lineDir * params.x;
						vec3 p2 = rayEnd * params.y;
						vec3 delta = p1 - p2;
						float len = length( delta );
						float norm = len / linewidth;

						#ifndef USE_DASH

							#ifdef USE_ALPHA_TO_COVERAGE

								float dnorm = fwidth( norm );
								alpha = 1.0 - smoothstep( 0.5 - dnorm, 0.5 + dnorm, norm );

							#else

								if ( norm > 0.5 ) {

									discard;

								}

							#endif

						#endif

					#else

						#ifdef USE_ALPHA_TO_COVERAGE

							// artifacts appear on some hardware if a derivative is taken within a conditional
							float a = vUv.x;
							float b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;
							float len2 = a * a + b * b;
							float dlen = fwidth( len2 );

							if ( abs( vUv.y ) > 1.0 ) {

								alpha = 1.0 - smoothstep( 1.0 - dlen, 1.0 + dlen, len2 );

							}

						#else

							if ( abs( vUv.y ) > 1.0 ) {

								float a = vUv.x;
								float b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;
								float len2 = a * a + b * b;

								if ( len2 > 1.0 ) discard;

							}

						#endif

					#endif

					vec4 diffuseColor = vec4( diffuse, alpha );
					#ifdef USE_COLOR
						#ifdef USE_LINE_COLOR_ALPHA
							diffuseColor *= vLineColor;
						#else
							diffuseColor.rgb *= vLineColor;
						#endif
					#endif

					#include <logdepthbuf_fragment>

					gl_FragColor = diffuseColor;

					#include <tonemapping_fragment>
					#include <${od>=154?"colorspace_fragment":"encodings_fragment"}>
					#include <fog_fragment>
					#include <premultiplied_alpha_fragment>

				}
			`,clipping:!0}),this.isLineMaterial=!0,this.onBeforeCompile=function(){this.transparent?this.defines.USE_LINE_COLOR_ALPHA="1":delete this.defines.USE_LINE_COLOR_ALPHA},Object.defineProperties(this,{color:{enumerable:!0,get:function(){return this.uniforms.diffuse.value},set:function(e){this.uniforms.diffuse.value=e}},worldUnits:{enumerable:!0,get:function(){return"WORLD_UNITS"in this.defines},set:function(e){!0===e?this.defines.WORLD_UNITS="":delete this.defines.WORLD_UNITS}},linewidth:{enumerable:!0,get:function(){return this.uniforms.linewidth.value},set:function(e){this.uniforms.linewidth.value=e}},dashed:{enumerable:!0,get:function(){return"USE_DASH"in this.defines},set(e){!!e!="USE_DASH"in this.defines&&(this.needsUpdate=!0),!0===e?this.defines.USE_DASH="":delete this.defines.USE_DASH}},dashScale:{enumerable:!0,get:function(){return this.uniforms.dashScale.value},set:function(e){this.uniforms.dashScale.value=e}},dashSize:{enumerable:!0,get:function(){return this.uniforms.dashSize.value},set:function(e){this.uniforms.dashSize.value=e}},dashOffset:{enumerable:!0,get:function(){return this.uniforms.dashOffset.value},set:function(e){this.uniforms.dashOffset.value=e}},gapSize:{enumerable:!0,get:function(){return this.uniforms.gapSize.value},set:function(e){this.uniforms.gapSize.value=e}},opacity:{enumerable:!0,get:function(){return this.uniforms.opacity.value},set:function(e){this.uniforms.opacity.value=e}},resolution:{enumerable:!0,get:function(){return this.uniforms.resolution.value},set:function(e){this.uniforms.resolution.value.copy(e)}},alphaToCoverage:{enumerable:!0,get:function(){return"USE_ALPHA_TO_COVERAGE"in this.defines},set:function(e){!!e!="USE_ALPHA_TO_COVERAGE"in this.defines&&(this.needsUpdate=!0),!0===e?(this.defines.USE_ALPHA_TO_COVERAGE="",this.extensions.derivatives=!0):(delete this.defines.USE_ALPHA_TO_COVERAGE,this.extensions.derivatives=!1)}}}),this.setValues(e)}}let om=od>=125?"uv1":"uv2",op=new eT.Vector4,og=new eT.Vector3,oy=new eT.Vector3,ov=new eT.Vector4,oE=new eT.Vector4,ox=new eT.Vector4,oC=new eT.Vector3,oB=new eT.Matrix4,ow=new eT.Line3,oI=new eT.Vector3,ob=new eT.Box3,o_=new eT.Sphere,oM=new eT.Vector4;function oS(e,t,r){return oM.set(0,0,-t,1).applyMatrix4(e.projectionMatrix),oM.multiplyScalar(1/oM.w),oM.x=n/r.width,oM.y=n/r.height,oM.applyMatrix4(e.projectionMatrixInverse),oM.multiplyScalar(1/oM.w),Math.abs(Math.max(oM.x,oM.y))}class oD extends eT.Mesh{constructor(e=new oA,t=new of({color:16777215*Math.random()})){super(e,t),this.isLineSegments2=!0,this.type="LineSegments2"}computeLineDistances(){let e=this.geometry,t=e.attributes.instanceStart,r=e.attributes.instanceEnd,i=new Float32Array(2*t.count);for(let e=0,n=0,a=t.count;e<a;e++,n+=2)og.fromBufferAttribute(t,e),oy.fromBufferAttribute(r,e),i[n]=0===n?0:i[n-1],i[n+1]=i[n]+og.distanceTo(oy);let n=new eT.InstancedInterleavedBuffer(i,2,1);return e.setAttribute("instanceDistanceStart",new eT.InterleavedBufferAttribute(n,1,0)),e.setAttribute("instanceDistanceEnd",new eT.InterleavedBufferAttribute(n,1,1)),this}raycast(e,t){let r,a;let o=this.material.worldUnits,s=e.camera;null!==s||o||console.error('LineSegments2: "Raycaster.camera" needs to be set in order to raycast against LineSegments2 while worldUnits is set to false.');let l=void 0!==e.params.Line2&&e.params.Line2.threshold||0;i=e.ray;let c=this.matrixWorld,u=this.geometry,h=this.material;if(n=h.linewidth+l,null===u.boundingSphere&&u.computeBoundingSphere(),o_.copy(u.boundingSphere).applyMatrix4(c),o)r=.5*n;else{let e=Math.max(s.near,o_.distanceToPoint(i.origin));r=oS(s,e,h.resolution)}if(o_.radius+=r,!1!==i.intersectsSphere(o_)){if(null===u.boundingBox&&u.computeBoundingBox(),ob.copy(u.boundingBox).applyMatrix4(c),o)a=.5*n;else{let e=Math.max(s.near,ob.distanceToPoint(i.origin));a=oS(s,e,h.resolution)}ob.expandByScalar(a),!1!==i.intersectsBox(ob)&&(o?function(e,t){let r=e.matrixWorld,a=e.geometry,o=a.attributes.instanceStart,s=a.attributes.instanceEnd,l=Math.min(a.instanceCount,o.count);for(let a=0;a<l;a++){ow.start.fromBufferAttribute(o,a),ow.end.fromBufferAttribute(s,a),ow.applyMatrix4(r);let l=new eT.Vector3,c=new eT.Vector3;i.distanceSqToSegment(ow.start,ow.end,c,l),c.distanceTo(l)<.5*n&&t.push({point:c,pointOnLine:l,distance:i.origin.distanceTo(c),object:e,face:null,faceIndex:a,uv:null,[om]:null})}}(this,t):function(e,t,r){let a=t.projectionMatrix,o=e.material.resolution,s=e.matrixWorld,l=e.geometry,c=l.attributes.instanceStart,u=l.attributes.instanceEnd,h=Math.min(l.instanceCount,c.count),A=-t.near;i.at(1,ox),ox.w=1,ox.applyMatrix4(t.matrixWorldInverse),ox.applyMatrix4(a),ox.multiplyScalar(1/ox.w),ox.x*=o.x/2,ox.y*=o.y/2,ox.z=0,oC.copy(ox),oB.multiplyMatrices(t.matrixWorldInverse,s);for(let t=0;t<h;t++){if(ov.fromBufferAttribute(c,t),oE.fromBufferAttribute(u,t),ov.w=1,oE.w=1,ov.applyMatrix4(oB),oE.applyMatrix4(oB),ov.z>A&&oE.z>A)continue;if(ov.z>A){let e=ov.z-oE.z,t=(ov.z-A)/e;ov.lerp(oE,t)}else if(oE.z>A){let e=oE.z-ov.z,t=(oE.z-A)/e;oE.lerp(ov,t)}ov.applyMatrix4(a),oE.applyMatrix4(a),ov.multiplyScalar(1/ov.w),oE.multiplyScalar(1/oE.w),ov.x*=o.x/2,ov.y*=o.y/2,oE.x*=o.x/2,oE.y*=o.y/2,ow.start.copy(ov),ow.start.z=0,ow.end.copy(oE),ow.end.z=0;let l=ow.closestPointToPointParameter(oC,!0);ow.at(l,oI);let h=eT.MathUtils.lerp(ov.z,oE.z,l),d=h>=-1&&h<=1,f=oC.distanceTo(oI)<.5*n;if(d&&f){ow.start.fromBufferAttribute(c,t),ow.end.fromBufferAttribute(u,t),ow.start.applyMatrix4(s),ow.end.applyMatrix4(s);let n=new eT.Vector3,a=new eT.Vector3;i.distanceSqToSegment(ow.start,ow.end,a,n),r.push({point:a,pointOnLine:n,distance:i.origin.distanceTo(a),object:e,face:null,faceIndex:t,uv:null,[om]:null})}}}(this,s,t))}}onBeforeRender(e){let t=this.material.uniforms;t&&t.resolution&&(e.getViewport(op),this.material.uniforms.resolution.value.set(op.z,op.w))}}class oT extends oA{constructor(){super(),this.isLineGeometry=!0,this.type="LineGeometry"}setPositions(e){let t=e.length-3,r=new Float32Array(2*t);for(let i=0;i<t;i+=3)r[2*i]=e[i],r[2*i+1]=e[i+1],r[2*i+2]=e[i+2],r[2*i+3]=e[i+3],r[2*i+4]=e[i+4],r[2*i+5]=e[i+5];return super.setPositions(r),this}setColors(e,t=3){let r=e.length-t,i=new Float32Array(2*r);if(3===t)for(let n=0;n<r;n+=t)i[2*n]=e[n],i[2*n+1]=e[n+1],i[2*n+2]=e[n+2],i[2*n+3]=e[n+3],i[2*n+4]=e[n+4],i[2*n+5]=e[n+5];else for(let n=0;n<r;n+=t)i[2*n]=e[n],i[2*n+1]=e[n+1],i[2*n+2]=e[n+2],i[2*n+3]=e[n+3],i[2*n+4]=e[n+4],i[2*n+5]=e[n+5],i[2*n+6]=e[n+6],i[2*n+7]=e[n+7];return super.setColors(i,t),this}fromLine(e){let t=e.geometry;return this.setPositions(t.attributes.position.array),this}}class oR extends oD{constructor(e=new oT,t=new of({color:16777215*Math.random()})){super(e,t),this.isLine2=!0,this.type="Line2"}}let oF=eS.forwardRef(function({points:e,color:t=16777215,vertexColors:r,linewidth:i,lineWidth:n,segments:a,dashed:o,...s},l){var c,u;let h=(0,eR.D)(e=>e.size),A=eS.useMemo(()=>a?new oD:new oR,[a]),[d]=eS.useState(()=>new of),f=(null==r||null==(c=r[0])?void 0:c.length)===4?4:3,m=eS.useMemo(()=>{let i=a?new oA:new oT,n=e.map(e=>{let t=Array.isArray(e);return e instanceof eT.Vector3||e instanceof eT.Vector4?[e.x,e.y,e.z]:e instanceof eT.Vector2?[e.x,e.y,0]:t&&3===e.length?[e[0],e[1],e[2]]:t&&2===e.length?[e[0],e[1],0]:e});if(i.setPositions(n.flat()),r){t=16777215;let e=r.map(e=>e instanceof eT.Color?e.toArray():e);i.setColors(e.flat(),f)}return i},[e,a,r,f]);return eS.useLayoutEffect(()=>{A.computeLineDistances()},[e,A]),eS.useLayoutEffect(()=>{o?d.defines.USE_DASH="":delete d.defines.USE_DASH,d.needsUpdate=!0},[o,d]),eS.useEffect(()=>()=>{m.dispose(),d.dispose()},[m]),eS.createElement("primitive",j({object:A,ref:l},s),eS.createElement("primitive",{object:m,attach:"geometry"}),eS.createElement("primitive",j({object:d,attach:"material",color:t,vertexColors:!!r,resolution:[h.width,h.height],linewidth:null!==(u=null!=i?i:n)&&void 0!==u?u:1,dashed:o,transparent:4===f},s)))}),oP=new eT.Vector3,oQ=eS.forwardRef(function({start:e=[0,0,0],end:t=[0,0,0],mid:r,segments:i=20,...n},a){let o=eS.useRef(null);eS.useImperativeHandle(a,()=>o.current);let[s]=eS.useState(()=>new eT.QuadraticBezierCurve3(void 0,void 0,void 0)),l=eS.useCallback((e,t,r,i=20)=>(e instanceof eT.Vector3?s.v0.copy(e):s.v0.set(...e),t instanceof eT.Vector3?s.v2.copy(t):s.v2.set(...t),r instanceof eT.Vector3?s.v1.copy(r):Array.isArray(r)?s.v1.set(...r):s.v1.copy(s.v0.clone().add(s.v2.clone().sub(s.v0)).add(oP.set(0,s.v0.y-s.v2.y,0))),s.getPoints(i)),[]);eS.useLayoutEffect(()=>{o.current.setPoints=(e,t,r)=>{let i=l(e,t,r);o.current.geometry&&o.current.geometry.setPositions(i.map(e=>e.toArray()).flat())}},[]);let c=eS.useMemo(()=>l(e,t,r,i),[e,t,r,i]);return eS.createElement(oF,j({ref:o,points:c},n))}),oz=eS.forwardRef(function({start:e,end:t,midA:r,midB:i,segments:n=20,...a},o){let s=eS.useMemo(()=>{let a=e instanceof eT.Vector3?e:new eT.Vector3(...e),o=t instanceof eT.Vector3?t:new eT.Vector3(...t),s=r instanceof eT.Vector3?r:new eT.Vector3(...r),l=i instanceof eT.Vector3?i:new eT.Vector3(...i);return new eT.CubicBezierCurve3(a,s,l,o).getPoints(n)},[e,t,r,i,n]);return eS.createElement(oF,j({ref:o,points:s},a))}),oL=eS.forwardRef(function({points:e,closed:t=!1,curveType:r="centripetal",tension:i=.5,segments:n=20,vertexColors:a,...o},s){let l=eS.useMemo(()=>{let n=e.map(e=>e instanceof eT.Vector3?e:new eT.Vector3(...e));return new eT.CatmullRomCurve3(n,t,r,i)},[e,t,r,i]),c=eS.useMemo(()=>l.getPoints(n),[l,n]),u=eS.useMemo(()=>{if(!a||a.length<2)return;if(a.length===n+1)return a;let e=a.map(e=>e instanceof eT.Color?e:new eT.Color(...e));t&&e.push(e[0].clone());let r=[e[0]],i=n/(e.length-1);for(let t=1;t<n;t++){let n=t%i/i,a=Math.floor(t/i);r.push(e[a].clone().lerp(e[a+1],n))}return r.push(e[e.length-1]),r},[a,n]);return eS.createElement(oF,j({ref:s,points:c,vertexColors:u},o))}),oO=eS.forwardRef(({url:e,distance:t=1,loop:r=!0,autoplay:i,...n},a)=>{let o=eS.useRef(null);eS.useImperativeHandle(a,()=>o.current,[]);let s=(0,eR.D)(({camera:e})=>e),[l]=eS.useState(()=>new eT.AudioListener),c=(0,eR.H)(eT.AudioLoader,e);return eS.useEffect(()=>{let e=o.current;e&&(e.setBuffer(c),e.setRefDistance(t),e.setLoop(r),i&&!e.isPlaying&&e.play())},[c,s,t,r]),eS.useEffect(()=>{let e=o.current;return s.add(l),()=>{s.remove(l),e&&(e.isPlaying&&e.stop(),e.source&&e.source._connected&&e.disconnect())}},[]),eS.createElement("positionalAudio",j({ref:o,args:[l]},n))});var oU=r(5494),ok=r(6187);let oG=eS.forwardRef(({sdfGlyphSize:e=64,anchorX:t="center",anchorY:r="middle",font:i,fontSize:n=1,children:a,characters:o,onSync:s,...l},c)=>{let u=(0,eR.D)(({invalidate:e})=>e),[h]=eS.useState(()=>new oU.xv),[A,d]=eS.useMemo(()=>{let e=[],t="";return eS.Children.forEach(a,r=>{"string"==typeof r||"number"==typeof r?t+=r:e.push(r)}),[e,t]},[a]);return(0,ok.Rq)(()=>new Promise(e=>(0,oU.C5)({font:i,characters:o},e)),["troika-text",i,o]),eS.useLayoutEffect(()=>void h.sync(()=>{u(),s&&s(h)})),eS.useEffect(()=>()=>h.dispose(),[h]),eS.createElement("primitive",j({object:h,ref:c,font:i,text:d,anchorX:t,anchorY:r,fontSize:n,sdfGlyphSize:e},l),A)});class oN extends eT.ExtrudeGeometry{constructor(e,t={}){let{bevelEnabled:r=!1,bevelSize:i=8,bevelThickness:n=10,font:a,height:o=50,size:s=100,lineHeight:l=1,letterSpacing:c=0,...u}=t;void 0===a?super():super(a.generateShapes(e,s,{lineHeight:l,letterSpacing:c}),{...u,bevelEnabled:r,bevelSize:i,bevelThickness:n,depth:o}),this.type="TextGeometry"}}function oH(e,t){if(t===eT.TrianglesDrawMode)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),e;if(t!==eT.TriangleFanDrawMode&&t!==eT.TriangleStripDrawMode)return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",t),e;{let r=e.getIndex();if(null===r){let t=[],i=e.getAttribute("position");if(void 0===i)return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),e;for(let e=0;e<i.count;e++)t.push(e);e.setIndex(t),r=e.getIndex()}let i=r.count-2,n=[];if(r){if(t===eT.TriangleFanDrawMode)for(let e=1;e<=i;e++)n.push(r.getX(0)),n.push(r.getX(e)),n.push(r.getX(e+1));else for(let e=0;e<i;e++)e%2==0?(n.push(r.getX(e)),n.push(r.getX(e+1)),n.push(r.getX(e+2))):(n.push(r.getX(e+2)),n.push(r.getX(e+1)),n.push(r.getX(e)))}n.length/3!==i&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");let a=e.clone();return a.setIndex(n),a.clearGroups(),a}}function oV(e,t=Math.PI/3){let r=Math.cos(t),i=(1+1e-10)*100,n=[new eT.Vector3,new eT.Vector3,new eT.Vector3],a=new eT.Vector3,o=new eT.Vector3,s=new eT.Vector3,l=new eT.Vector3;function c(e){let t=~~(e.x*i),r=~~(e.y*i),n=~~(e.z*i);return`${t},${r},${n}`}let u=e.index?e.toNonIndexed():e,h=u.attributes.position,A={};for(let e=0,t=h.count/3;e<t;e++){let t=3*e,r=n[0].fromBufferAttribute(h,t+0),i=n[1].fromBufferAttribute(h,t+1),s=n[2].fromBufferAttribute(h,t+2);a.subVectors(s,i),o.subVectors(r,i);let l=new eT.Vector3().crossVectors(a,o).normalize();for(let e=0;e<3;e++){let t=c(n[e]);t in A||(A[t]=[]),A[t].push(l)}}let d=new Float32Array(3*h.count),f=new eT.BufferAttribute(d,3,!1);for(let e=0,t=h.count/3;e<t;e++){let t=3*e,i=n[0].fromBufferAttribute(h,t+0),u=n[1].fromBufferAttribute(h,t+1),d=n[2].fromBufferAttribute(h,t+2);a.subVectors(d,u),o.subVectors(i,u),s.crossVectors(a,o).normalize();for(let e=0;e<3;e++){let i=A[c(n[e])];l.set(0,0,0);for(let e=0,t=i.length;e<t;e++){let t=i[e];s.dot(t)>r&&l.add(t)}l.normalize(),f.setXYZ(t+e,l.x,l.y,l.z)}}return u.setAttribute("normal",f),u}var oj=Object.defineProperty,oJ=(e,t,r)=>t in e?oj(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,oY=(e,t,r)=>(oJ(e,"symbol"!=typeof t?t+"":t,r),r);class oW extends eT.Loader{constructor(e){super(e)}load(e,t,r,i){let n=new eT.FileLoader(this.manager);n.setPath(this.path),n.setRequestHeader(this.requestHeader),n.setWithCredentials(this.withCredentials),n.load(e,e=>{if("string"!=typeof e)throw Error("unsupported data type");let r=JSON.parse(e),i=this.parse(r);t&&t(i)},r,i)}loadAsync(e,t){return super.loadAsync(e,t)}parse(e){return new oK(e)}}class oK{constructor(e){oY(this,"data"),oY(this,"isFont",!0),oY(this,"type","Font"),this.data=e}generateShapes(e,t=100,r){let i=[],n={letterSpacing:0,lineHeight:1,...r},a=function(e,t,r,i){let n=Array.from(e),a=t/r.resolution,o=(r.boundingBox.yMax-r.boundingBox.yMin+r.underlineThickness)*a,s=[],l=0,c=0;for(let e=0;e<n.length;e++){let t=n[e];if("\n"===t)l=0,c-=o*i.lineHeight;else{let e=function(e,t,r,i,n){let a,o,s,l,c,u,h,A;let d=n.glyphs[e]||n.glyphs["?"];if(!d){console.error('THREE.Font: character "'+e+'" does not exists in font family '+n.familyName+".");return}let f=new eT.ShapePath;if(d.o){let e=d._cachedOutline||(d._cachedOutline=d.o.split(" "));for(let n=0,d=e.length;n<d;)switch(e[n++]){case"m":a=parseInt(e[n++])*t+r,o=parseInt(e[n++])*t+i,f.moveTo(a,o);break;case"l":a=parseInt(e[n++])*t+r,o=parseInt(e[n++])*t+i,f.lineTo(a,o);break;case"q":s=parseInt(e[n++])*t+r,l=parseInt(e[n++])*t+i,c=parseInt(e[n++])*t+r,u=parseInt(e[n++])*t+i,f.quadraticCurveTo(c,u,s,l);break;case"b":s=parseInt(e[n++])*t+r,l=parseInt(e[n++])*t+i,c=parseInt(e[n++])*t+r,u=parseInt(e[n++])*t+i,h=parseInt(e[n++])*t+r,A=parseInt(e[n++])*t+i,f.bezierCurveTo(c,u,h,A,s,l)}}return{offsetX:d.ha*t,path:f}}(t,a,l,c,r);e&&(l+=e.offsetX+i.letterSpacing,s.push(e.path))}}return s}(e,t,this.data,n);for(let e=0,t=a.length;e<t;e++)Array.prototype.push.apply(i,a[e].toShapes(!1));return i}}let oq=null;async function oX(e){return"string"==typeof e?await (await fetch(e)).json():e}async function oZ(e){var t;return t=await oX(e),oq||(oq=new oW),oq.parse(t)}function o$(e){return(0,ok.Rq)(oZ,[e])}o$.preload=e=>(0,ok.MA)(oZ,[e]),o$.clear=e=>(0,ok.ZH)([e]);let o1=["string","number"],o0=e=>{let t="",r=[];return eS.Children.forEach(e,e=>{o1.includes(typeof e)?t+=e+"":r.push(e)}),[t,...r]},o2=eS.forwardRef(({font:e,letterSpacing:t=0,lineHeight:r=1,size:i=1,height:n=.2,bevelThickness:a=.1,bevelSize:o=.01,bevelEnabled:s=!1,bevelOffset:l=0,bevelSegments:c=4,curveSegments:u=8,smooth:h,children:A,...d},f)=>{eS.useMemo(()=>(0,eR.e)({RenamedTextGeometry:oN}),[]);let m=eS.useRef(null),p=o$(e),g=(0,eS.useMemo)(()=>({font:p,size:i,height:n,bevelThickness:a,bevelSize:o,bevelEnabled:s,bevelSegments:c,bevelOffset:l,curveSegments:u,letterSpacing:t,lineHeight:r}),[p,i,n,a,o,s,c,l,u,t,r]),[y,...v]=(0,eS.useMemo)(()=>o0(A),[A]),E=eS.useMemo(()=>[y,g],[y,g]);return eS.useLayoutEffect(()=>{h&&(m.current.geometry=function(e,t=1e-4){t=Math.max(t,Number.EPSILON);let r={},i=e.getIndex(),n=e.getAttribute("position"),a=i?i.count:n.count,o=0,s=Object.keys(e.attributes),l={},c={},u=[],h=["getX","getY","getZ","getW"];for(let t=0,r=s.length;t<r;t++){let r=s[t];l[r]=[];let i=e.morphAttributes[r];i&&(c[r]=Array(i.length).fill(0).map(()=>[]))}let A=Math.pow(10,Math.log10(1/t));for(let t=0;t<a;t++){let n=i?i.getX(t):t,a="";for(let t=0,r=s.length;t<r;t++){let r=s[t],i=e.getAttribute(r),o=i.itemSize;for(let e=0;e<o;e++)a+=`${~~(i[h[e]](n)*A)},`}if(a in r)u.push(r[a]);else{for(let t=0,r=s.length;t<r;t++){let r=s[t],i=e.getAttribute(r),a=e.morphAttributes[r],o=i.itemSize,u=l[r],A=c[r];for(let e=0;e<o;e++){let t=h[e];if(u.push(i[t](n)),a)for(let e=0,r=a.length;e<r;e++)A[e].push(a[e][t](n))}}r[a]=o,u.push(o),o++}}let d=e.clone();for(let t=0,r=s.length;t<r;t++){let r=s[t],i=e.getAttribute(r),n=new i.array.constructor(l[r]),a=new eT.BufferAttribute(n,i.itemSize,i.normalized);if(d.setAttribute(r,a),r in c)for(let t=0;t<c[r].length;t++){let i=e.morphAttributes[r][t],n=new i.array.constructor(c[r][t]),a=new eT.BufferAttribute(n,i.itemSize,i.normalized);d.morphAttributes[r][t]=a}}return d.setIndex(u),d}(m.current.geometry,h),m.current.geometry.computeVertexNormals())},[E,h]),eS.useImperativeHandle(f,()=>m.current,[]),eS.createElement("mesh",j({},d,{ref:m}),eS.createElement("renamedTextGeometry",{args:E}),v)}),o3={uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:`
    varying vec2 vUv;

    void main() {

    	vUv = uv;
    	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

    }
  `,fragmentShader:`
    uniform float opacity;

    uniform sampler2D tDiffuse;

    varying vec2 vUv;

    void main() {

    	vec4 texel = texture2D( tDiffuse, vUv );
    	gl_FragColor = opacity * texel;

    }
  `};var o4=Object.defineProperty,o5=(e,t,r)=>t in e?o4(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,o6=(e,t,r)=>(o5(e,"symbol"!=typeof t?t+"":t,r),r);class o8{constructor(){o6(this,"enabled",!0),o6(this,"needsSwap",!0),o6(this,"clear",!1),o6(this,"renderToScreen",!1)}setSize(e,t){}render(e,t,r,i,n){console.error("THREE.Pass: .render() must be implemented in derived pass.")}dispose(){}}class o9{constructor(e){o6(this,"camera",new eT.OrthographicCamera(-1,1,1,-1,0,1)),o6(this,"geometry",new eT.PlaneGeometry(2,2)),o6(this,"mesh"),this.mesh=new eT.Mesh(this.geometry,e)}get material(){return this.mesh.material}set material(e){this.mesh.material=e}dispose(){this.mesh.geometry.dispose()}render(e){e.render(this.mesh,this.camera)}}var o7=Object.defineProperty,se=(e,t,r)=>t in e?o7(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,st=(e,t,r)=>(se(e,"symbol"!=typeof t?t+"":t,r),r);class sr extends o8{constructor(e,t="tDiffuse"){super(),st(this,"textureID"),st(this,"uniforms"),st(this,"material"),st(this,"fsQuad"),this.textureID=t,e instanceof eT.ShaderMaterial?(this.uniforms=e.uniforms,this.material=e):(this.uniforms=eT.UniformsUtils.clone(e.uniforms),this.material=new eT.ShaderMaterial({defines:Object.assign({},e.defines),uniforms:this.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader})),this.fsQuad=new o9(this.material)}render(e,t,r){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=r.texture),this.fsQuad.material=this.material,this.renderToScreen?e.setRenderTarget(null):(e.setRenderTarget(t),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil)),this.fsQuad.render(e)}dispose(){this.fsQuad.dispose(),this.material.dispose()}}var si=Object.defineProperty,sn=(e,t,r)=>t in e?si(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,sa=(e,t,r)=>(sn(e,"symbol"!=typeof t?t+"":t,r),r);class so extends o8{constructor(e,t){super(),sa(this,"scene"),sa(this,"camera"),sa(this,"inverse"),this.scene=e,this.camera=t,this.clear=!0,this.needsSwap=!1,this.inverse=!1}render(e,t,r){let i,n;let a=e.getContext(),o=e.state;o.buffers.color.setMask(!1),o.buffers.depth.setMask(!1),o.buffers.color.setLocked(!0),o.buffers.depth.setLocked(!0),this.inverse?(i=0,n=1):(i=1,n=0),o.buffers.stencil.setTest(!0),o.buffers.stencil.setOp(a.REPLACE,a.REPLACE,a.REPLACE),o.buffers.stencil.setFunc(a.ALWAYS,i,4294967295),o.buffers.stencil.setClear(n),o.buffers.stencil.setLocked(!0),e.setRenderTarget(r),this.clear&&e.clear(),e.render(this.scene,this.camera),e.setRenderTarget(t),this.clear&&e.clear(),e.render(this.scene,this.camera),o.buffers.color.setLocked(!1),o.buffers.depth.setLocked(!1),o.buffers.stencil.setLocked(!1),o.buffers.stencil.setFunc(a.EQUAL,1,4294967295),o.buffers.stencil.setOp(a.KEEP,a.KEEP,a.KEEP),o.buffers.stencil.setLocked(!0)}}class ss extends o8{constructor(){super(),this.needsSwap=!1}render(e){e.state.buffers.stencil.setLocked(!1),e.state.buffers.stencil.setTest(!1)}}var sl=Object.defineProperty,sc=(e,t,r)=>t in e?sl(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,su=(e,t,r)=>(sc(e,"symbol"!=typeof t?t+"":t,r),r);class sh{constructor(e,t){if(su(this,"renderer"),su(this,"_pixelRatio"),su(this,"_width"),su(this,"_height"),su(this,"renderTarget1"),su(this,"renderTarget2"),su(this,"writeBuffer"),su(this,"readBuffer"),su(this,"renderToScreen"),su(this,"passes",[]),su(this,"copyPass"),su(this,"clock"),this.renderer=e,void 0===t){let r={minFilter:eT.LinearFilter,magFilter:eT.LinearFilter,format:eT.RGBAFormat},i=e.getSize(new eT.Vector2);this._pixelRatio=e.getPixelRatio(),this._width=i.width,this._height=i.height,(t=new eT.WebGLRenderTarget(this._width*this._pixelRatio,this._height*this._pixelRatio,r)).texture.name="EffectComposer.rt1"}else this._pixelRatio=1,this._width=t.width,this._height=t.height;this.renderTarget1=t,this.renderTarget2=t.clone(),this.renderTarget2.texture.name="EffectComposer.rt2",this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2,this.renderToScreen=!0,void 0===o3&&console.error("THREE.EffectComposer relies on CopyShader"),void 0===sr&&console.error("THREE.EffectComposer relies on ShaderPass"),this.copyPass=new sr(o3),this.copyPass.material.blending=eT.NoBlending,this.clock=new eT.Clock}swapBuffers(){let e=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=e}addPass(e){this.passes.push(e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}insertPass(e,t){this.passes.splice(t,0,e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}removePass(e){let t=this.passes.indexOf(e);-1!==t&&this.passes.splice(t,1)}isLastEnabledPass(e){for(let t=e+1;t<this.passes.length;t++)if(this.passes[t].enabled)return!1;return!0}render(e){void 0===e&&(e=this.clock.getDelta());let t=this.renderer.getRenderTarget(),r=!1,i=this.passes.length;for(let t=0;t<i;t++){let i=this.passes[t];if(!1!==i.enabled){if(i.renderToScreen=this.renderToScreen&&this.isLastEnabledPass(t),i.render(this.renderer,this.writeBuffer,this.readBuffer,e,r),i.needsSwap){if(r){let t=this.renderer.getContext(),r=this.renderer.state.buffers.stencil;r.setFunc(t.NOTEQUAL,1,4294967295),this.copyPass.render(this.renderer,this.writeBuffer,this.readBuffer,e),r.setFunc(t.EQUAL,1,4294967295)}this.swapBuffers()}void 0!==so&&(i instanceof so?r=!0:i instanceof ss&&(r=!1))}}this.renderer.setRenderTarget(t)}reset(e){if(void 0===e){let t=this.renderer.getSize(new eT.Vector2);this._pixelRatio=this.renderer.getPixelRatio(),this._width=t.width,this._height=t.height,(e=this.renderTarget1.clone()).setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.renderTarget1=e,this.renderTarget2=e.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2}setSize(e,t){this._width=e,this._height=t;let r=this._width*this._pixelRatio,i=this._height*this._pixelRatio;this.renderTarget1.setSize(r,i),this.renderTarget2.setSize(r,i);for(let e=0;e<this.passes.length;e++)this.passes[e].setSize(r,i)}setPixelRatio(e){this._pixelRatio=e,this.setSize(this._width,this._height)}dispose(){this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.copyPass.dispose()}}var sA=Object.defineProperty,sd=(e,t,r)=>t in e?sA(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,sf=(e,t,r)=>(sd(e,"symbol"!=typeof t?t+"":t,r),r);class sm extends o8{constructor(e,t,r,i,n=0){super(),sf(this,"scene"),sf(this,"camera"),sf(this,"overrideMaterial"),sf(this,"clearColor"),sf(this,"clearAlpha"),sf(this,"clearDepth",!1),sf(this,"_oldClearColor",new eT.Color),this.scene=e,this.camera=t,this.overrideMaterial=r,this.clearColor=i,this.clearAlpha=n,this.clear=!0,this.needsSwap=!1}render(e,t,r){let i,n=e.autoClear;e.autoClear=!1;let a=null;void 0!==this.overrideMaterial&&(a=this.scene.overrideMaterial,this.scene.overrideMaterial=this.overrideMaterial),this.clearColor&&(e.getClearColor(this._oldClearColor),i=e.getClearAlpha(),e.setClearColor(this.clearColor,this.clearAlpha)),this.clearDepth&&e.clearDepth(),e.setRenderTarget(this.renderToScreen?null:r),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),e.render(this.scene,this.camera),this.clearColor&&e.setClearColor(this._oldClearColor,i),void 0!==this.overrideMaterial&&(this.scene.overrideMaterial=a),e.autoClear=n}}let sp={uniforms:{tDiffuse:{value:null}},vertexShader:`
    varying vec2 vUv;

    void main() {

    	vUv = uv;
    	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

    }
  `,fragmentShader:`
    uniform sampler2D tDiffuse;

    varying vec2 vUv;

    void main() {

    	vec4 tex = texture2D( tDiffuse, vUv );

    	#ifdef LinearTosRGB
    		gl_FragColor = LinearTosRGB( tex );
    	#else
    		gl_FragColor = sRGBTransferOETF( tex );
    	#endif

    }
  `},sg=()=>{try{var e=document.createElement("canvas");return!!(window.WebGL2RenderingContext&&e.getContext("webgl2"))}catch(e){return!1}},sy=eS.forwardRef(({children:e,multisamping:t=8,renderIndex:r=1,disableRender:i,disableGamma:n,disableRenderPass:a,depthBuffer:o=!0,stencilBuffer:s=!1,anisotropy:l=1,encoding:c,type:u,...h},A)=>{eS.useMemo(()=>(0,eR.e)({EffectComposer:sh,RenderPass:sm,ShaderPass:sr}),[]);let d=eS.useRef(null);eS.useImperativeHandle(A,()=>d.current,[]);let{scene:f,camera:m,gl:p,size:g,viewport:y}=(0,eR.D)(),[v]=eS.useState(()=>{let e=new eT.WebGLRenderTarget(g.width,g.height,{type:u||eT.HalfFloatType,format:eT.RGBAFormat,depthBuffer:o,stencilBuffer:s,anisotropy:l});return u===eT.UnsignedByteType&&null!=c&&("colorSpace"in e?e.texture.colorSpace=c:e.texture.encoding=c),e.samples=t,e});eS.useEffect(()=>{var e,t;null==(e=d.current)||e.setSize(g.width,g.height),null==(t=d.current)||t.setPixelRatio(y.dpr)},[p,g,y.dpr]),(0,eR.F)(()=>{var e;i||null==(e=d.current)||e.render()},r);let E=[];return a||E.push(eS.createElement("renderPass",{key:"renderpass",attach:`passes-${E.length}`,args:[f,m]})),n||E.push(eS.createElement("shaderPass",{attach:`passes-${E.length}`,key:"gammapass",args:[sp]})),eS.Children.forEach(e,e=>{e&&E.push(eS.cloneElement(e,{key:E.length,attach:`passes-${E.length}`}))}),eS.createElement("effectComposer",j({ref:d,args:[p,v]},h),E)}),sv=((W={}).Linear="linear",W.Radial="radial",W);function sE({stops:e,colors:t,size:r=1024,width:i=16,type:n=sv.Linear,innerCircleRadius:a=0,outerCircleRadius:o="auto",...s}){let l=(0,eR.D)(e=>e.gl),c=eS.useMemo(()=>{let s;let l=document.createElement("canvas"),c=l.getContext("2d");if(l.width=i,l.height=r,n===sv.Linear)s=c.createLinearGradient(0,0,0,r);else{let e=l.width/2,t=l.height/2,r="auto"!==o?Math.abs(Number(o)):Math.sqrt(e**2+t**2);s=c.createRadialGradient(e,t,Math.abs(a),e,t,r)}let u=new eT.Color,h=e.length;for(;h--;)s.addColorStop(e[h],u.set(t[h]).getStyle());return c.save(),c.fillStyle=s,c.fillRect(0,0,i,r),c.restore(),l},[e]);return eS.createElement("canvasTexture",j({colorSpace:l.outputColorSpace,args:[c],attach:"map"},s))}function sx(e,t,r,i){let n=class extends eT.ShaderMaterial{constructor(n={}){let a=Object.entries(e);super({uniforms:a.reduce((e,[t,r])=>{let i=eT.UniformsUtils.clone({[t]:{value:r}});return{...e,...i}},{}),vertexShader:t,fragmentShader:r}),this.key="",a.forEach(([e])=>Object.defineProperty(this,e,{get:()=>this.uniforms[e].value,set:t=>this.uniforms[e].value=t})),Object.assign(this,n),i&&i(this)}};return n.key=eT.MathUtils.generateUUID(),n}let sC=e=>e===Object(e)&&!Array.isArray(e)&&"function"!=typeof e;function sB(e,t){let r=(0,eR.D)(e=>e.gl),i=(0,eR.H)(eT.TextureLoader,sC(e)?Object.values(e):e);return(0,eS.useLayoutEffect)(()=>{null==t||t(i)},[t]),(0,eS.useEffect)(()=>{if("initTexture"in r){let e=[];Array.isArray(i)?e=i:i instanceof eT.Texture?e=[i]:sC(i)&&(e=Object.values(i)),e.forEach(e=>{e instanceof eT.Texture&&r.initTexture(e)})}},[r,i]),(0,eS.useMemo)(()=>{if(!sC(e))return i;{let t={},r=0;for(let n in e)t[n]=i[r++];return t}},[e,i])}sB.preload=e=>eR.H.preload(eT.TextureLoader,e),sB.clear=e=>eR.H.clear(eT.TextureLoader,e);let sw=({children:e,input:t,onLoad:r})=>{let i=sB(t,r);return eS.createElement(eS.Fragment,null,null==e?void 0:e(i))},sI=parseInt(eT.REVISION.replace(/\D+/g,"")),sb=sx({color:new eT.Color("white"),scale:new eT.Vector2(1,1),imageBounds:new eT.Vector2(1,1),resolution:1024,map:null,zoom:1,radius:0,grayscale:0,opacity:1},`
  varying vec2 vUv;
  varying vec2 vPos;
  void main() {
    gl_Position = projectionMatrix * viewMatrix * modelMatrix * vec4(position, 1.);
    vUv = uv;
    vPos = position.xy;
  }
`,`
  // mostly from https://gist.github.com/statico/df64c5d167362ecf7b34fca0b1459a44
  varying vec2 vUv;
  varying vec2 vPos;
  uniform vec2 scale;
  uniform vec2 imageBounds;
  uniform float resolution;
  uniform vec3 color;
  uniform sampler2D map;
  uniform float radius;
  uniform float zoom;
  uniform float grayscale;
  uniform float opacity;
  const vec3 luma = vec3(.299, 0.587, 0.114);
  vec4 toGrayscale(vec4 color, float intensity) {
    return vec4(mix(color.rgb, vec3(dot(color.rgb, luma)), intensity), color.a);
  }
  vec2 aspect(vec2 size) {
    return size / min(size.x, size.y);
  }
  
  const float PI = 3.14159265;
    
  // from https://iquilezles.org/articles/distfunctions
  float udRoundBox( vec2 p, vec2 b, float r ) {
    return length(max(abs(p)-b+r,0.0))-r;
  }

  void main() {
    vec2 s = aspect(scale);
    vec2 i = aspect(imageBounds);
    float rs = s.x / s.y;
    float ri = i.x / i.y;
    vec2 new = rs < ri ? vec2(i.x * s.y / i.y, s.y) : vec2(s.x, i.y * s.x / i.x);
    vec2 offset = (rs < ri ? vec2((new.x - s.x) / 2.0, 0.0) : vec2(0.0, (new.y - s.y) / 2.0)) / new;
    vec2 uv = vUv * s / new + offset;
    vec2 zUv = (uv - vec2(0.5, 0.5)) / zoom + vec2(0.5, 0.5);

    vec2 res = vec2(scale * resolution);
    vec2 halfRes = 0.5 * res;
    float b = udRoundBox(vUv.xy * res - halfRes, halfRes, resolution * radius);    
	  vec3 a = mix(vec3(1.0,0.0,0.0), vec3(0.0,0.0,0.0), smoothstep(0.0, 1.0, b));
    gl_FragColor = toGrayscale(texture2D(map, zUv) * vec4(color, opacity * a), grayscale);
    
    #include <tonemapping_fragment>
    #include <${sI>=154?"colorspace_fragment":"encodings_fragment"}>
  }
`),s_=eS.forwardRef(({children:e,color:t,segments:r=1,scale:i=1,zoom:n=1,grayscale:a=0,opacity:o=1,radius:s=0,texture:l,toneMapped:c,transparent:u,side:h,...A},d)=>{(0,eR.e)({ImageMaterial:sb});let f=eS.useRef(null),m=(0,eR.D)(e=>e.size),p=Array.isArray(i)?[i[0],i[1]]:[i,i],g=[l.image.width,l.image.height],y=Math.max(m.width,m.height);return eS.useImperativeHandle(d,()=>f.current,[]),eS.useLayoutEffect(()=>{f.current.geometry.parameters&&f.current.material.scale.set(p[0]*f.current.geometry.parameters.width,p[1]*f.current.geometry.parameters.height)},[p[0],p[1]]),eS.createElement("mesh",j({ref:f,scale:Array.isArray(i)?[...i,1]:i},A),eS.createElement("planeGeometry",{args:[1,1,r,r]}),eS.createElement("imageMaterial",{color:t,map:l,zoom:n,grayscale:a,opacity:o,scale:p,imageBounds:g,resolution:y,radius:s,toneMapped:c,transparent:u,side:h,key:sb.key}),e)}),sM=eS.forwardRef(({url:e,...t},r)=>{let i=sB(e);return eS.createElement(s_,j({},t,{texture:i,ref:r}))}),sS=eS.forwardRef(({url:e,...t},r)=>eS.createElement(s_,j({},t,{ref:r}))),sD=eS.forwardRef((e,t)=>{if(e.url)return eS.createElement(sM,j({},e,{ref:t}));if(e.texture)return eS.createElement(sS,j({},e,{ref:t}));throw Error("<Image /> requires a url or texture")}),sT=eS.forwardRef(({threshold:e=15,geometry:t,...r},i)=>{let n=eS.useRef(null);eS.useImperativeHandle(i,()=>n.current,[]);let a=eS.useMemo(()=>[0,0,0,1,0,0],[]),o=eS.useRef(),s=eS.useRef();return eS.useLayoutEffect(()=>{let r=n.current.parent,i=null!=t?t:null==r?void 0:r.geometry;if(!i||o.current===i&&s.current===e)return;o.current=i,s.current=e;let a=new eT.EdgesGeometry(i,e).attributes.position.array;n.current.geometry.setPositions(a),n.current.geometry.attributes.instanceStart.needsUpdate=!0,n.current.geometry.attributes.instanceEnd.needsUpdate=!0,n.current.computeLineDistances()}),eS.createElement(oF,j({segments:!0,points:a,ref:n,raycast:()=>null},r))}),sR=sx({screenspace:!1,color:new eT.Color("black"),opacity:1,thickness:.05,size:new eT.Vector2},`#include <common>
   #include <morphtarget_pars_vertex>
   #include <skinning_pars_vertex>
   #include <clipping_planes_pars_vertex>
   uniform float thickness;
   uniform bool screenspace;
   uniform vec2 size;
   void main() {
     #if defined (USE_SKINNING)
	     #include <beginnormal_vertex>
       #include <morphnormal_vertex>
       #include <skinbase_vertex>
       #include <skinnormal_vertex>
       #include <defaultnormal_vertex>
     #endif
     #include <begin_vertex>
	   #include <morphtarget_vertex>
	   #include <skinning_vertex>
     #include <project_vertex>
     #include <clipping_planes_vertex>
     vec4 tNormal = vec4(normal, 0.0);
     vec4 tPosition = vec4(transformed, 1.0);
     #ifdef USE_INSTANCING
       tNormal = instanceMatrix * tNormal;
       tPosition = instanceMatrix * tPosition;
     #endif
     if (screenspace) {
       vec3 newPosition = tPosition.xyz + tNormal.xyz * thickness;
       gl_Position = projectionMatrix * modelViewMatrix * vec4(newPosition, 1.0); 
     } else {
       vec4 clipPosition = projectionMatrix * modelViewMatrix * tPosition;
       vec4 clipNormal = projectionMatrix * modelViewMatrix * tNormal;
       vec2 offset = normalize(clipNormal.xy) * thickness / size * clipPosition.w * 2.0;
       clipPosition.xy += offset;
       gl_Position = clipPosition;
     }
   }`,`uniform vec3 color;
   uniform float opacity;
   #include <clipping_planes_pars_fragment>
   void main(){
     #include <clipping_planes_fragment>
     gl_FragColor = vec4(color, opacity);
     #include <tonemapping_fragment>
     #include <${sI>=154?"colorspace_fragment":"encodings_fragment"}>
   }`);function sF({color:e="black",opacity:t=1,transparent:r=!1,screenspace:i=!1,toneMapped:n=!0,polygonOffset:a=!1,polygonOffsetFactor:o=0,renderOrder:s=0,thickness:l=.05,angle:c=Math.PI,clippingPlanes:u,...h}){let A=eS.useRef(),[d]=eS.useState(()=>new sR({side:eT.BackSide})),{gl:f}=(0,eR.D)(),m=f.getDrawingBufferSize(new eT.Vector2);eS.useMemo(()=>(0,eR.e)({OutlinesMaterial:sR}),[]);let p=eS.useRef(0),g=eS.useRef();return eS.useLayoutEffect(()=>{let e=A.current;if(!e)return;let t=e.parent;if(t&&t.geometry&&(p.current!==c||g.current!==t.geometry)){var r;p.current=c,g.current=t.geometry;let i=null==(r=e.children)?void 0:r[0];i&&(c&&i.geometry.dispose(),e.remove(i)),t.skeleton?((i=new eT.SkinnedMesh).material=d,i.bind(t.skeleton,t.bindMatrix)):t.isInstancedMesh?(i=new eT.InstancedMesh(t.geometry,d,t.count)).instanceMatrix=t.instanceMatrix:(i=new eT.Mesh).material=d,e.add(i),i.geometry=c?oV(t.geometry,c):t.geometry,i.morphTargetInfluences=t.morphTargetInfluences,i.morphTargetDictionary=t.morphTargetDictionary}}),eS.useLayoutEffect(()=>{let c=A.current;if(!c)return;let h=c.children[0];if(h){h.renderOrder=s;let A=c.parent;(0,eR.k)(h,{morphTargetInfluences:A.morphTargetInfluences,morphTargetDictionary:A.morphTargetDictionary}),(0,eR.k)(h.material,{transparent:r,thickness:l,color:e,opacity:t,size:m,screenspace:i,toneMapped:n,polygonOffset:a,polygonOffsetFactor:o,clippingPlanes:u,clipping:u&&u.length>0})}}),eS.useEffect(()=>()=>{let e=A.current;if(!e)return;let t=e.children[0];t&&(c&&t.geometry.dispose(),e.remove(t))},[]),eS.createElement("group",j({ref:A},h))}var sP=Object.defineProperty,sQ=(e,t,r)=>t in e?sP(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,sz=(e,t,r)=>(sQ(e,"symbol"!=typeof t?t+"":t,r),r);function sL(e,t,r,i,n){let a;if(e=e.subarray||e.slice?e:e.buffer,r=r.subarray||r.slice?r:r.buffer,e=t?e.subarray?e.subarray(t,n&&t+n):e.slice(t,n&&t+n):e,r.set)r.set(e,i);else for(a=0;a<e.length;a++)r[a+i]=e[a];return r}class sO extends eT.BufferGeometry{constructor(){super(),sz(this,"type","MeshLine"),sz(this,"isMeshLine",!0),sz(this,"positions",[]),sz(this,"previous",[]),sz(this,"next",[]),sz(this,"side",[]),sz(this,"width",[]),sz(this,"indices_array",[]),sz(this,"uvs",[]),sz(this,"counters",[]),sz(this,"widthCallback",null),sz(this,"_attributes"),sz(this,"_points",[]),sz(this,"points"),sz(this,"matrixWorld",new eT.Matrix4),Object.defineProperties(this,{points:{enumerable:!0,get(){return this._points},set(e){this.setPoints(e,this.widthCallback)}}})}setMatrixWorld(e){this.matrixWorld=e}setPoints(e,t){var r;if(e=(r=e)instanceof Float32Array?r:r instanceof eT.BufferGeometry?r.getAttribute("position").array:r.map(e=>{let t=Array.isArray(e);return e instanceof eT.Vector3?[e.x,e.y,e.z]:e instanceof eT.Vector2?[e.x,e.y,0]:t&&3===e.length?[e[0],e[1],e[2]]:t&&2===e.length?[e[0],e[1],0]:e}).flat(),this._points=e,this.widthCallback=null!=t?t:null,this.positions=[],this.counters=[],e.length&&e[0]instanceof eT.Vector3)for(let t=0;t<e.length;t++){let r=e[t],i=t/(e.length-1);this.positions.push(r.x,r.y,r.z),this.positions.push(r.x,r.y,r.z),this.counters.push(i),this.counters.push(i)}else for(let t=0;t<e.length;t+=3){let r=t/(e.length-1);this.positions.push(e[t],e[t+1],e[t+2]),this.positions.push(e[t],e[t+1],e[t+2]),this.counters.push(r),this.counters.push(r)}this.process()}compareV3(e,t){let r=6*e,i=6*t;return this.positions[r]===this.positions[i]&&this.positions[r+1]===this.positions[i+1]&&this.positions[r+2]===this.positions[i+2]}copyV3(e){let t=6*e;return[this.positions[t],this.positions[t+1],this.positions[t+2]]}process(){let e,t;let r=this.positions.length/6;this.previous=[],this.next=[],this.side=[],this.width=[],this.indices_array=[],this.uvs=[],t=this.compareV3(0,r-1)?this.copyV3(r-2):this.copyV3(0),this.previous.push(t[0],t[1],t[2]),this.previous.push(t[0],t[1],t[2]);for(let i=0;i<r;i++){if(this.side.push(1),this.side.push(-1),e=this.widthCallback?this.widthCallback(i/(r-1)):1,this.width.push(e),this.width.push(e),this.uvs.push(i/(r-1),0),this.uvs.push(i/(r-1),1),i<r-1){t=this.copyV3(i),this.previous.push(t[0],t[1],t[2]),this.previous.push(t[0],t[1],t[2]);let e=2*i;this.indices_array.push(e,e+1,e+2),this.indices_array.push(e+2,e+1,e+3)}i>0&&(t=this.copyV3(i),this.next.push(t[0],t[1],t[2]),this.next.push(t[0],t[1],t[2]))}t=this.compareV3(r-1,0)?this.copyV3(1):this.copyV3(r-1),this.next.push(t[0],t[1],t[2]),this.next.push(t[0],t[1],t[2]),this._attributes&&this._attributes.position.count===this.counters.length?(this._attributes.position.copyArray(new Float32Array(this.positions)),this._attributes.position.needsUpdate=!0,this._attributes.previous.copyArray(new Float32Array(this.previous)),this._attributes.previous.needsUpdate=!0,this._attributes.next.copyArray(new Float32Array(this.next)),this._attributes.next.needsUpdate=!0,this._attributes.side.copyArray(new Float32Array(this.side)),this._attributes.side.needsUpdate=!0,this._attributes.width.copyArray(new Float32Array(this.width)),this._attributes.width.needsUpdate=!0,this._attributes.uv.copyArray(new Float32Array(this.uvs)),this._attributes.uv.needsUpdate=!0,this._attributes.index.copyArray(new Uint16Array(this.indices_array)),this._attributes.index.needsUpdate=!0):this._attributes={position:new eT.BufferAttribute(new Float32Array(this.positions),3),previous:new eT.BufferAttribute(new Float32Array(this.previous),3),next:new eT.BufferAttribute(new Float32Array(this.next),3),side:new eT.BufferAttribute(new Float32Array(this.side),1),width:new eT.BufferAttribute(new Float32Array(this.width),1),uv:new eT.BufferAttribute(new Float32Array(this.uvs),2),index:new eT.BufferAttribute(new Uint16Array(this.indices_array),1),counters:new eT.BufferAttribute(new Float32Array(this.counters),1)},this.setAttribute("position",this._attributes.position),this.setAttribute("previous",this._attributes.previous),this.setAttribute("next",this._attributes.next),this.setAttribute("side",this._attributes.side),this.setAttribute("width",this._attributes.width),this.setAttribute("uv",this._attributes.uv),this.setAttribute("counters",this._attributes.counters),this.setAttribute("position",this._attributes.position),this.setAttribute("previous",this._attributes.previous),this.setAttribute("next",this._attributes.next),this.setAttribute("side",this._attributes.side),this.setAttribute("width",this._attributes.width),this.setAttribute("uv",this._attributes.uv),this.setAttribute("counters",this._attributes.counters),this.setIndex(this._attributes.index),this.computeBoundingSphere(),this.computeBoundingBox()}advance({x:e,y:t,z:r}){let i=this._attributes.position.array,n=this._attributes.previous.array,a=this._attributes.next.array,o=i.length;sL(i,0,n,0,o),sL(i,6,i,0,o-6),i[o-6]=e,i[o-5]=t,i[o-4]=r,i[o-3]=e,i[o-2]=t,i[o-1]=r,sL(i,6,a,0,o-6),a[o-6]=e,a[o-5]=t,a[o-4]=r,a[o-3]=e,a[o-2]=t,a[o-1]=r,this._attributes.position.needsUpdate=!0,this._attributes.previous.needsUpdate=!0,this._attributes.next.needsUpdate=!0}}let sU=`
  #include <common>
  #include <logdepthbuf_pars_vertex>
  #include <fog_pars_vertex>
  #include <clipping_planes_pars_vertex>

  attribute vec3 previous;
  attribute vec3 next;
  attribute float side;
  attribute float width;
  attribute float counters;
  
  uniform vec2 resolution;
  uniform float lineWidth;
  uniform vec3 color;
  uniform float opacity;
  uniform float sizeAttenuation;
  
  varying vec2 vUV;
  varying vec4 vColor;
  varying float vCounters;
  
  vec2 fix(vec4 i, float aspect) {
    vec2 res = i.xy / i.w;
    res.x *= aspect;
    return res;
  }
  
  void main() {
    float aspect = resolution.x / resolution.y;
    vColor = vec4(color, opacity);
    vUV = uv;
    vCounters = counters;
  
    mat4 m = projectionMatrix * modelViewMatrix;
    vec4 finalPosition = m * vec4(position, 1.0) * aspect;
    vec4 prevPos = m * vec4(previous, 1.0);
    vec4 nextPos = m * vec4(next, 1.0);
  
    vec2 currentP = fix(finalPosition, aspect);
    vec2 prevP = fix(prevPos, aspect);
    vec2 nextP = fix(nextPos, aspect);
  
    float w = lineWidth * width;
  
    vec2 dir;
    if (nextP == currentP) dir = normalize(currentP - prevP);
    else if (prevP == currentP) dir = normalize(nextP - currentP);
    else {
      vec2 dir1 = normalize(currentP - prevP);
      vec2 dir2 = normalize(nextP - currentP);
      dir = normalize(dir1 + dir2);
  
      vec2 perp = vec2(-dir1.y, dir1.x);
      vec2 miter = vec2(-dir.y, dir.x);
      //w = clamp(w / dot(miter, perp), 0., 4. * lineWidth * width);
    }
  
    //vec2 normal = (cross(vec3(dir, 0.), vec3(0., 0., 1.))).xy;
    vec4 normal = vec4(-dir.y, dir.x, 0., 1.);
    normal.xy *= .5 * w;
    //normal *= projectionMatrix;
    if (sizeAttenuation == 0.) {
      normal.xy *= finalPosition.w;
      normal.xy /= (vec4(resolution, 0., 1.) * projectionMatrix).xy * aspect;
    }
  
    finalPosition.xy += normal.xy * side;
    gl_Position = finalPosition;
    #include <logdepthbuf_vertex>
    #include <fog_vertex>
    vec4 mvPosition = modelViewMatrix * vec4(position, 1.0);
    #include <clipping_planes_vertex>
    #include <fog_vertex>
  }
`,sk=parseInt(eT.REVISION.replace(/\D+/g,"")),sG=`
  #include <fog_pars_fragment>
  #include <logdepthbuf_pars_fragment>
  #include <clipping_planes_pars_fragment>
  
  uniform sampler2D map;
  uniform sampler2D alphaMap;
  uniform float useGradient;
  uniform float useMap;
  uniform float useAlphaMap;
  uniform float useDash;
  uniform float dashArray;
  uniform float dashOffset;
  uniform float dashRatio;
  uniform float visibility;
  uniform float alphaTest;
  uniform vec2 repeat;
  uniform vec3 gradient[2];
  
  varying vec2 vUV;
  varying vec4 vColor;
  varying float vCounters;
  
  void main() {
    #include <logdepthbuf_fragment>
    vec4 diffuseColor = vColor;
    if (useGradient == 1.) diffuseColor = vec4(mix(gradient[0], gradient[1], vCounters), 1.0);
    if (useMap == 1.) diffuseColor *= texture2D(map, vUV * repeat);
    if (useAlphaMap == 1.) diffuseColor.a *= texture2D(alphaMap, vUV * repeat).a;
    if (diffuseColor.a < alphaTest) discard;
    if (useDash == 1.) diffuseColor.a *= ceil(mod(vCounters + dashOffset, dashArray) - (dashArray * dashRatio));
    diffuseColor.a *= step(vCounters, visibility);
    #include <clipping_planes_fragment>
    gl_FragColor = diffuseColor;     
    #include <fog_fragment>
    #include <tonemapping_fragment>
    #include <${sk>=154?"colorspace_fragment":"encodings_fragment"}>
  }
`;class sN extends eT.ShaderMaterial{constructor(e){super({uniforms:{...eT.UniformsLib.fog,lineWidth:{value:1},map:{value:null},useMap:{value:0},alphaMap:{value:null},useAlphaMap:{value:0},color:{value:new eT.Color(16777215)},gradient:{value:[new eT.Color(16711680),new eT.Color(65280)]},opacity:{value:1},resolution:{value:new eT.Vector2(1,1)},sizeAttenuation:{value:1},dashArray:{value:0},dashOffset:{value:0},dashRatio:{value:.5},useDash:{value:0},useGradient:{value:0},visibility:{value:1},alphaTest:{value:0},repeat:{value:new eT.Vector2(1,1)}},vertexShader:sU,fragmentShader:sG}),sz(this,"lineWidth"),sz(this,"map"),sz(this,"useMap"),sz(this,"alphaMap"),sz(this,"useAlphaMap"),sz(this,"color"),sz(this,"gradient"),sz(this,"resolution"),sz(this,"sizeAttenuation"),sz(this,"dashArray"),sz(this,"dashOffset"),sz(this,"dashRatio"),sz(this,"useDash"),sz(this,"useGradient"),sz(this,"visibility"),sz(this,"repeat"),this.type="MeshLineMaterial",Object.defineProperties(this,{lineWidth:{enumerable:!0,get(){return this.uniforms.lineWidth.value},set(e){this.uniforms.lineWidth.value=e}},map:{enumerable:!0,get(){return this.uniforms.map.value},set(e){this.uniforms.map.value=e}},useMap:{enumerable:!0,get(){return this.uniforms.useMap.value},set(e){this.uniforms.useMap.value=e}},alphaMap:{enumerable:!0,get(){return this.uniforms.alphaMap.value},set(e){this.uniforms.alphaMap.value=e}},useAlphaMap:{enumerable:!0,get(){return this.uniforms.useAlphaMap.value},set(e){this.uniforms.useAlphaMap.value=e}},color:{enumerable:!0,get(){return this.uniforms.color.value},set(e){this.uniforms.color.value=e}},gradient:{enumerable:!0,get(){return this.uniforms.gradient.value},set(e){this.uniforms.gradient.value=e}},opacity:{enumerable:!0,get(){return this.uniforms.opacity.value},set(e){this.uniforms.opacity.value=e}},resolution:{enumerable:!0,get(){return this.uniforms.resolution.value},set(e){this.uniforms.resolution.value.copy(e)}},sizeAttenuation:{enumerable:!0,get(){return this.uniforms.sizeAttenuation.value},set(e){this.uniforms.sizeAttenuation.value=e}},dashArray:{enumerable:!0,get(){return this.uniforms.dashArray.value},set(e){this.uniforms.dashArray.value=e,this.useDash=0!==e?1:0}},dashOffset:{enumerable:!0,get(){return this.uniforms.dashOffset.value},set(e){this.uniforms.dashOffset.value=e}},dashRatio:{enumerable:!0,get(){return this.uniforms.dashRatio.value},set(e){this.uniforms.dashRatio.value=e}},useDash:{enumerable:!0,get(){return this.uniforms.useDash.value},set(e){this.uniforms.useDash.value=e}},useGradient:{enumerable:!0,get(){return this.uniforms.useGradient.value},set(e){this.uniforms.useGradient.value=e}},visibility:{enumerable:!0,get(){return this.uniforms.visibility.value},set(e){this.uniforms.visibility.value=e}},alphaTest:{enumerable:!0,get(){return this.uniforms.alphaTest.value},set(e){this.uniforms.alphaTest.value=e}},repeat:{enumerable:!0,get(){return this.uniforms.repeat.value},set(e){this.uniforms.repeat.value.copy(e)}}}),this.setValues(e)}copy(e){return super.copy(e),this.lineWidth=e.lineWidth,this.map=e.map,this.useMap=e.useMap,this.alphaMap=e.alphaMap,this.useAlphaMap=e.useAlphaMap,this.color.copy(e.color),this.gradient=e.gradient,this.opacity=e.opacity,this.resolution.copy(e.resolution),this.sizeAttenuation=e.sizeAttenuation,this.dashArray=e.dashArray,this.dashOffset=e.dashOffset,this.dashRatio=e.dashRatio,this.useDash=e.useDash,this.useGradient=e.useGradient,this.visibility=e.visibility,this.alphaTest=e.alphaTest,this.repeat.copy(e.repeat),this}}let sH={width:.2,length:1,decay:1,local:!1,stride:0,interval:1},sV=(e,t=1)=>(e.set(e.subarray(t)),e.fill(-1/0,-t),e);function sj(e,t){let{length:r,local:i,decay:n,interval:a,stride:o}={...sH,...t},s=eS.useRef(),[l]=eS.useState(()=>new eT.Vector3);eS.useLayoutEffect(()=>{e&&(s.current=Float32Array.from({length:30*r},(t,r)=>e.position.getComponent(r%3)))},[r,e]);let c=eS.useRef(new eT.Vector3),u=eS.useRef(0);return(0,eR.F)(()=>{if(e&&s.current){if(0===u.current){let t;i?t=e.position:(e.getWorldPosition(l),t=l);let r=1*n;for(let e=0;e<r;e++)t.distanceTo(c.current)<o||(sV(s.current,3),s.current.set(t.toArray(),s.current.length-3));c.current.copy(t)}u.current++,u.current=u.current%a}}),s}let sJ=eS.forwardRef((e,t)=>{let{children:r}=e,{width:i,length:n,decay:a,local:o,stride:s,interval:l}={...sH,...e},{color:c="hotpink",attenuation:u,target:h}=e,A=(0,eR.D)(e=>e.size),d=(0,eR.D)(e=>e.scene),f=eS.useRef(null),[m,p]=eS.useState(null),g=sj(m,{length:n,decay:a,local:o,stride:s,interval:l});eS.useEffect(()=>{let e=(null==h?void 0:h.current)||f.current.children.find(e=>e instanceof eT.Object3D);e&&p(e)},[g,h]);let y=eS.useMemo(()=>new sO,[]),v=eS.useMemo(()=>{var e;let t;let n=new sN({lineWidth:.1*i,color:c,sizeAttenuation:1,resolution:new eT.Vector2(A.width,A.height)});return r&&(Array.isArray(r)?t=r.find(e=>"string"==typeof e.type&&"meshLineMaterial"===e.type):"string"==typeof r.type&&"meshLineMaterial"===r.type&&(t=r)),"object"==typeof(null==(e=t)?void 0:e.props)&&n.setValues(t.props),n},[i,c,A,r]);return eS.useEffect(()=>{v.uniforms.resolution.value.set(A.width,A.height)},[A]),(0,eR.F)(()=>{g.current&&y.setPoints(g.current,u)}),eS.createElement("group",null,(0,eR.h)(eS.createElement("mesh",{ref:t,geometry:y,material:v}),d),eS.createElement("group",{ref:f},r))}),sY=new eT.Triangle,sW=new eT.Vector3;class sK{constructor(e){let t=e.geometry;t.index&&(console.warn("THREE.MeshSurfaceSampler: Converting geometry to non-indexed BufferGeometry."),t=t.toNonIndexed()),this.geometry=t,this.randomFunction=Math.random,this.positionAttribute=this.geometry.getAttribute("position"),this.colorAttribute=this.geometry.getAttribute("color"),this.weightAttribute=null,this.distribution=null}setWeightAttribute(e){return this.weightAttribute=e?this.geometry.getAttribute(e):null,this}build(){let e=this.positionAttribute,t=this.weightAttribute,r=new Float32Array(e.count/3);for(let i=0;i<e.count;i+=3){let n=1;t&&(n=t.getX(i)+t.getX(i+1)+t.getX(i+2)),sY.a.fromBufferAttribute(e,i),sY.b.fromBufferAttribute(e,i+1),sY.c.fromBufferAttribute(e,i+2),n*=sY.getArea(),r[i/3]=n}this.distribution=new Float32Array(e.count/3);let i=0;for(let e=0;e<r.length;e++)i+=r[e],this.distribution[e]=i;return this}setRandomGenerator(e){return this.randomFunction=e,this}sample(e,t,r){let i=this.sampleFaceIndex();return this.sampleFace(i,e,t,r)}sampleFaceIndex(){let e=this.distribution[this.distribution.length-1];return this.binarySearch(this.randomFunction()*e)}binarySearch(e){let t=this.distribution,r=0,i=t.length-1,n=-1;for(;r<=i;){let a=Math.ceil((r+i)/2);if(0===a||t[a-1]<=e&&t[a]>e){n=a;break}e<t[a]?i=a-1:r=a+1}return n}sampleFace(e,t,r,i){let n=this.randomFunction(),a=this.randomFunction();return n+a>1&&(n=1-n,a=1-a),sY.a.fromBufferAttribute(this.positionAttribute,3*e),sY.b.fromBufferAttribute(this.positionAttribute,3*e+1),sY.c.fromBufferAttribute(this.positionAttribute,3*e+2),t.set(0,0,0).addScaledVector(sY.a,n).addScaledVector(sY.b,a).addScaledVector(sY.c,1-(n+a)),void 0!==r&&sY.getNormal(r),void 0!==i&&void 0!==this.colorAttribute&&(sY.a.fromBufferAttribute(this.colorAttribute,3*e),sY.b.fromBufferAttribute(this.colorAttribute,3*e+1),sY.c.fromBufferAttribute(this.colorAttribute,3*e+2),sW.set(0,0,0).addScaledVector(sY.a,n).addScaledVector(sY.b,a).addScaledVector(sY.c,1-(n+a)),i.r=sW.x,i.g=sW.y,i.b=sW.z),this}}function sq(e,t=16,r,i,n){let[a,o]=eS.useState(()=>{let e=Array.from({length:t},()=>[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]).flat();return new eT.InstancedBufferAttribute(Float32Array.from(e),16)});return eS.useLayoutEffect(()=>{if(void 0===e.current)return;let s=new sK(e.current);i&&s.setWeightAttribute(i),s.build();let l=new eT.Vector3,c=new eT.Vector3,u=new eT.Color,h=new eT.Object3D;e.current.updateMatrixWorld(!0);for(let i=0;i<t;i++)s.sample(l,c,u),"function"==typeof r?r({dummy:h,sampledMesh:e.current,position:l,normal:c,color:u},i):h.position.copy(l),h.updateMatrix(),null!=n&&n.current&&n.current.setMatrixAt(i,h.matrix),h.matrix.toArray(a.array,16*i);null!=n&&n.current&&(n.current.instanceMatrix.needsUpdate=!0),a.needsUpdate=!0,o(new eT.InstancedBufferAttribute(a.array,a.itemSize).copy(a))},[e,n,i,t,r]),a}function sX({children:e,weight:t,transform:r,instances:i,mesh:n,count:a=16,...o}){let s=eS.useRef(null),l=eS.useRef(null),c=eS.useRef(null);return eS.useLayoutEffect(()=>{var e,t;l.current=null!==(e=null==i?void 0:i.current)&&void 0!==e?e:s.current.children.find(e=>e.hasOwnProperty("instanceMatrix")),c.current=null!==(t=null==n?void 0:n.current)&&void 0!==t?t:s.current.children.find(e=>"Mesh"===e.type)},[e,null==n?void 0:n.current,null==i?void 0:i.current]),sq(c,a,r,t,l),eS.createElement("group",j({ref:s},o),e)}let sZ=({compute:e,name:t,...r})=>{let[i]=eS.useState(()=>new eT.BufferAttribute(new Float32Array(0),1)),n=eS.useRef(null);return eS.useLayoutEffect(()=>{if(n.current){var t;let r=e(null!==(t=n.current.parent)&&void 0!==t?t:n.current.__r3f.parent);n.current.copy(r)}},[e]),eS.createElement("primitive",j({ref:n,object:i,attach:`attributes-${t}`},r))};function s$(e,t,r={}){let i,n,a,o,s;let l=new eT.Vector3,c=new eT.Quaternion,u=new eT.Vector3,h=new eT.Matrix4,A=new eT.Matrix4,d=new eT.Matrix4;r.preserveMatrix=void 0===r.preserveMatrix||r.preserveMatrix,r.preservePosition=void 0===r.preservePosition||r.preservePosition,r.preserveHipPosition=void 0!==r.preserveHipPosition&&r.preserveHipPosition,r.useTargetMatrix=void 0!==r.useTargetMatrix&&r.useTargetMatrix,r.hip=void 0!==r.hip?r.hip:"hip",r.names=r.names||{};let f=t.isObject3D?t.skeleton.bones:s0(t),m=e.isObject3D?e.skeleton.bones:s0(e);if(e.isObject3D?e.skeleton.pose():(r.useTargetMatrix=!0,r.preserveMatrix=!1),r.preservePosition){s=[];for(let e=0;e<m.length;e++)s.push(m[e].position.clone())}if(r.preserveMatrix){e.updateMatrixWorld(),e.matrixWorld.identity();for(let t=0;t<e.children.length;++t)e.children[t].updateMatrixWorld(!0)}if(r.offsets){i=[];for(let e=0;e<m.length;++e)n=m[e],a=r.names[n.name]||n.name,r.offsets[a]&&(n.matrix.multiply(r.offsets[a]),n.matrix.decompose(n.position,n.quaternion,n.scale),n.updateMatrixWorld()),i.push(n.matrixWorld.clone())}for(let t=0;t<m.length;++t){if(n=m[t],o=s1(a=r.names[n.name]||n.name,f),d.copy(n.matrixWorld),o){if(o.updateMatrixWorld(),r.useTargetMatrix?A.copy(o.matrixWorld):(A.copy(e.matrixWorld).invert(),A.multiply(o.matrixWorld)),u.setFromMatrixScale(A),A.scale(u.set(1/u.x,1/u.y,1/u.z)),d.makeRotationFromQuaternion(c.setFromRotationMatrix(A)),e.isObject3D){let t=m.indexOf(n),r=i?i[t]:h.copy(e.skeleton.boneInverses[t]).invert();d.multiply(r)}d.copyPosition(A)}n.parent&&n.parent.isBone?(n.matrix.copy(n.parent.matrixWorld).invert(),n.matrix.multiply(d)):n.matrix.copy(d),r.preserveHipPosition&&a===r.hip&&n.matrix.setPosition(l.set(0,n.position.y,0)),n.matrix.decompose(n.position,n.quaternion,n.scale),n.updateMatrixWorld()}if(r.preservePosition)for(let e=0;e<m.length;++e)n=m[e],(a=r.names[n.name]||n.name)!==r.hip&&n.position.copy(s[e]);r.preserveMatrix&&e.updateMatrixWorld(!0)}function s1(e,t){for(let r=0,i=s0(t);r<i.length;r++)if(e===i[r].name)return i[r]}function s0(e){return Array.isArray(e)?e:e.bones}let s2={retarget:s$,retargetClip:function(e,t,r,i={}){let n,a,o,s;i.useFirstFramePosition=void 0!==i.useFirstFramePosition&&i.useFirstFramePosition,i.fps=void 0!==i.fps?i.fps:30,i.names=i.names||[],t.isObject3D||(t=function(e){let t=new eT.SkeletonHelper(e.bones[0]);return t.skeleton=e,t}(t));let l=Math.round(r.duration*(i.fps/1e3)*1e3),c=1/i.fps,u=[],h=new eT.AnimationMixer(t),A=s0(e.skeleton),d=[];h.clipAction(r).play(),h.update(0),t.updateMatrixWorld();for(let r=0;r<l;++r){let u=r*c;s$(e,t,i);for(let e=0;e<A.length;++e)s1(s=i.names[A[e].name]||A[e].name,t.skeleton)&&(a=A[e],o=d[e]=d[e]||{bone:a},i.hip===s&&(o.pos||(o.pos={times:new Float32Array(l),values:new Float32Array(3*l)}),i.useFirstFramePosition&&(0===r&&(n=a.position.clone()),a.position.sub(n)),o.pos.times[r]=u,a.position.toArray(o.pos.values,3*r)),o.quat||(o.quat={times:new Float32Array(l),values:new Float32Array(4*l)}),o.quat.times[r]=u,a.quaternion.toArray(o.quat.values,4*r));h.update(c),t.updateMatrixWorld()}for(let e=0;e<d.length;++e)(o=d[e])&&(o.pos&&u.push(new eT.VectorKeyframeTrack(".bones["+o.bone.name+"].position",o.pos.times,o.pos.values)),u.push(new eT.QuaternionKeyframeTrack(".bones["+o.bone.name+"].quaternion",o.quat.times,o.quat.values)));return h.uncacheAction(r),new eT.AnimationClip(r.name,-1,u)},clone:function(e){let t=new Map,r=new Map,i=e.clone();return function e(t,r,i){i(t,r);for(let n=0;n<t.children.length;n++)e(t.children[n],r.children[n],i)}(e,i,function(e,i){t.set(i,e),r.set(e,i)}),i.traverse(function(e){if(!e.isSkinnedMesh)return;let i=t.get(e),n=i.skeleton.bones;e.skeleton=i.skeleton.clone(),e.bindMatrix.copy(i.bindMatrix),e.skeleton.bones=n.map(function(e){return r.get(e)}),e.bind(e.skeleton,e.bindMatrix)}),i}},s3=eS.forwardRef(({isChild:e=!1,object:t,children:r,deep:i,castShadow:n,receiveShadow:a,inject:o,keys:s,...l},c)=>{let u={keys:s,deep:i,inject:o,castShadow:n,receiveShadow:a};if(Array.isArray(t=eS.useMemo(()=>{if(!1===e&&!Array.isArray(t)){let e=!1;if(t.traverse(t=>{t.isSkinnedMesh&&(e=!0)}),e)return s2.clone(t)}return t},[t,e])))return eS.createElement("group",j({},l,{ref:c}),t.map(e=>eS.createElement(s3,j({key:e.uuid,object:e},u))),r);let{children:h,...A}=function(e,{keys:t=["near","far","color","distance","decay","penumbra","angle","intensity","skeleton","visible","castShadow","receiveShadow","morphTargetDictionary","morphTargetInfluences","name","geometry","material","position","rotation","scale","up","userData","bindMode","bindMatrix","bindMatrixInverse","skeleton"],deep:r,inject:i,castShadow:n,receiveShadow:a}){let o={};for(let r of t)o[r]=e[r];return r&&(o.geometry&&"materialsOnly"!==r&&(o.geometry=o.geometry.clone()),o.material&&"geometriesOnly"!==r&&(o.material=o.material.clone())),i&&(o="function"==typeof i?{...o,children:i(e)}:eS.isValidElement(i)?{...o,children:i}:{...o,...i}),e instanceof eT.Mesh&&(n&&(o.castShadow=!0),a&&(o.receiveShadow=!0)),o}(t,u),d=t.type[0].toLowerCase()+t.type.slice(1);return eS.createElement(d,j({},A,l,{ref:c}),t.children.map(e=>"Bone"===e.type?eS.createElement("primitive",j({key:e.uuid,object:e},u)):eS.createElement(s3,j({key:e.uuid,object:e},u,{isChild:!0}))),r,h)});class s4 extends eT.Mesh{constructor(e,t,r=!1,i=!1,n=1e4){let a=new eT.BufferGeometry;super(a,t),this.isMarchingCubes=!0;let o=this,s=new Float32Array(36),l=new Float32Array(36),c=new Float32Array(36);function u(e,t,r,i,n,a,u,h,A,d){var f,m,p,g,y,v;let E=(r-u)/(h-u),x=o.normal_cache;s[t+0]=i+E*o.delta,s[t+1]=n,s[t+2]=a,l[t+0]=(f=x[e+0])+(x[e+3]-f)*E,l[t+1]=(m=x[e+1])+(x[e+4]-m)*E,l[t+2]=(p=x[e+2])+(x[e+5]-p)*E,c[t+0]=(g=o.palette[3*A+0])+(o.palette[3*d+0]-g)*E,c[t+1]=(y=o.palette[3*A+1])+(o.palette[3*d+1]-y)*E,c[t+2]=(v=o.palette[3*A+2])+(o.palette[3*d+2]-v)*E}function h(e,t,r,i,n,a,u,h,A,d){var f,m,p,g,y,v;let E=(r-u)/(h-u),x=o.normal_cache;s[t+0]=i,s[t+1]=n+E*o.delta,s[t+2]=a;let C=e+3*o.yd;l[t+0]=(f=x[e+0])+(x[C+0]-f)*E,l[t+1]=(m=x[e+1])+(x[C+1]-m)*E,l[t+2]=(p=x[e+2])+(x[C+2]-p)*E,c[t+0]=(g=o.palette[3*A+0])+(o.palette[3*d+0]-g)*E,c[t+1]=(y=o.palette[3*A+1])+(o.palette[3*d+1]-y)*E,c[t+2]=(v=o.palette[3*A+2])+(o.palette[3*d+2]-v)*E}function A(e,t,r,i,n,a,u,h,A,d){var f,m,p,g,y,v;let E=(r-u)/(h-u),x=o.normal_cache;s[t+0]=i,s[t+1]=n,s[t+2]=a+E*o.delta;let C=e+3*o.zd;l[t+0]=(f=x[e+0])+(x[C+0]-f)*E,l[t+1]=(m=x[e+1])+(x[C+1]-m)*E,l[t+2]=(p=x[e+2])+(x[C+2]-p)*E,c[t+0]=(g=o.palette[3*A+0])+(o.palette[3*d+0]-g)*E,c[t+1]=(y=o.palette[3*A+1])+(o.palette[3*d+1]-y)*E,c[t+2]=(v=o.palette[3*A+2])+(o.palette[3*d+2]-v)*E}function d(e){let t=3*e;0===o.normal_cache[t]&&(o.normal_cache[t+0]=o.field[e-1]-o.field[e+1],o.normal_cache[t+1]=o.field[e-o.yd]-o.field[e+o.yd],o.normal_cache[t+2]=o.field[e-o.zd]-o.field[e+o.zd])}this.enableUvs=r,this.enableColors=i,this.init=function(e){this.resolution=e,this.isolation=80,this.size=e,this.size2=this.size*this.size,this.size3=this.size2*this.size,this.halfsize=this.size/2,this.delta=2/this.size,this.yd=this.size,this.zd=this.size2,this.field=new Float32Array(this.size3),this.normal_cache=new Float32Array(3*this.size3),this.palette=new Float32Array(3*this.size3),this.count=0;let t=3*n;this.positionArray=new Float32Array(3*t);let r=new eT.BufferAttribute(this.positionArray,3);r.setUsage(eT.DynamicDrawUsage),a.setAttribute("position",r),this.normalArray=new Float32Array(3*t);let i=new eT.BufferAttribute(this.normalArray,3);if(i.setUsage(eT.DynamicDrawUsage),a.setAttribute("normal",i),this.enableUvs){this.uvArray=new Float32Array(2*t);let e=new eT.BufferAttribute(this.uvArray,2);e.setUsage(eT.DynamicDrawUsage),a.setAttribute("uv",e)}if(this.enableColors){this.colorArray=new Float32Array(3*t);let e=new eT.BufferAttribute(this.colorArray,3);e.setUsage(eT.DynamicDrawUsage),a.setAttribute("color",e)}a.boundingSphere=new eT.Sphere(new eT.Vector3,1)},this.addBall=function(e,t,r,i,n,a){let o,s,l,c,u,h,A,d,f,m,p;let g=Math.sign(i);i=Math.abs(i);let y=null!=a,v=new eT.Color(e,t,r);if(y)try{v=a instanceof eT.Color?a:Array.isArray(a)?new eT.Color(Math.min(Math.abs(a[0]),1),Math.min(Math.abs(a[1]),1),Math.min(Math.abs(a[2]),1)):new eT.Color(a)}catch(i){v=new eT.Color(e,t,r)}let E=this.size*Math.sqrt(i/n),x=r*this.size,C=t*this.size,B=e*this.size,w=Math.floor(x-E);w<1&&(w=1);let I=Math.floor(x+E);I>this.size-1&&(I=this.size-1);let b=Math.floor(C-E);b<1&&(b=1);let _=Math.floor(C+E);_>this.size-1&&(_=this.size-1);let M=Math.floor(B-E);M<1&&(M=1);let S=Math.floor(B+E);for(S>this.size-1&&(S=this.size-1),l=w;l<I;l++)for(u=this.size2*l,f=(d=l/this.size-r)*d,s=b;s<_;s++)for(c=u+this.size*s,m=(A=s/this.size-t)*A,o=M;o<S;o++)if((p=i/(1e-6+(h=o/this.size-e)*h+m+f)-n)>0){this.field[c+o]+=p*g;let e=Math.sqrt((o-B)*(o-B)+(s-C)*(s-C)+(l-x)*(l-x))/E,t=1-e*e*e*(e*(6*e-15)+10);this.palette[(c+o)*3+0]+=v.r*t,this.palette[(c+o)*3+1]+=v.g*t,this.palette[(c+o)*3+2]+=v.b*t}},this.addPlaneX=function(e,t){let r=this.size,i=this.yd,n=this.zd,a=this.field,o,s,l,c,u,h,A=r*Math.sqrt(e/t);for(A>r&&(A=r),o=0;o<A;o++)if((c=e/(1e-4+(u=o/r)*u)-t)>0)for(s=0;s<r;s++)for(l=0,h=o+s*i;l<r;l++)a[n*l+h]+=c},this.addPlaneY=function(e,t){let r=this.size,i=this.yd,n=this.zd,a=this.field,o,s,l,c,u,h,A,d=r*Math.sqrt(e/t);for(d>r&&(d=r),s=0;s<d;s++)if((c=e/(1e-4+(u=s/r)*u)-t)>0)for(o=0,h=s*i;o<r;o++)for(l=0,A=h+o;l<r;l++)a[n*l+A]+=c},this.addPlaneZ=function(e,t){let r=this.size,i=this.yd,n=this.zd,a=this.field,o,s,l,c,u,h,A,d=r*Math.sqrt(e/t);for(d>r&&(d=r),l=0;l<d;l++)if((c=e/(1e-4+(u=l/r)*u)-t)>0)for(s=0,h=n*l;s<r;s++)for(o=0,A=h+s*i;o<r;o++)a[A+o]+=c},this.setCell=function(e,t,r,i){let n=this.size2*r+this.size*t+e;this.field[n]=i},this.getCell=function(e,t,r){let i=this.size2*r+this.size*t+e;return this.field[i]},this.blur=function(e=1){let t=this.field,r=t.slice(),i=this.size,n=this.size2;for(let a=0;a<i;a++)for(let o=0;o<i;o++)for(let s=0;s<i;s++){let l=n*s+i*o+a,c=r[l],u=1;for(let t=-1;t<=1;t+=2){let l=t+a;if(!(l<0)&&!(l>=i))for(let t=-1;t<=1;t+=2){let a=t+o;if(!(a<0)&&!(a>=i))for(let t=-1;t<=1;t+=2){let o=t+s;if(o<0||o>=i)continue;let h=r[n*o+i*a+l];u++,c+=e*(h-c)/u}}}t[l]=c}},this.reset=function(){for(let e=0;e<this.size3;e++)this.normal_cache[3*e]=0,this.field[e]=0,this.palette[3*e]=this.palette[3*e+1]=this.palette[3*e+2]=0},this.update=function(){this.count=0;let e=this.size-2;for(let t=1;t<e;t++){let r=this.size2*t,i=(t-this.halfsize)/this.halfsize;for(let t=1;t<e;t++){let n=r+this.size*t,a=(t-this.halfsize)/this.halfsize;for(let t=1;t<e;t++)!function(e,t,r,i,n){let a=i+1,f=i+o.yd,m=i+o.zd,p=a+o.yd,g=a+o.zd,y=i+o.yd+o.zd,v=a+o.yd+o.zd,E=0,x=o.field[i],C=o.field[a],B=o.field[f],w=o.field[p],I=o.field[m],b=o.field[g],_=o.field[y],M=o.field[v];x<n&&(E|=1),C<n&&(E|=2),B<n&&(E|=8),w<n&&(E|=4),I<n&&(E|=16),b<n&&(E|=32),_<n&&(E|=128),M<n&&(E|=64);let S=s5[E];if(0===S)return;let D=o.delta,T=e+D,R=t+D,F=r+D;1&S&&(d(i),d(a),u(3*i,0,n,e,t,r,x,C,i,a)),2&S&&(d(a),d(p),h(3*a,3,n,T,t,r,C,w,a,p)),4&S&&(d(f),d(p),u(3*f,6,n,e,R,r,B,w,f,p)),8&S&&(d(i),d(f),h(3*i,9,n,e,t,r,x,B,i,f)),16&S&&(d(m),d(g),u(3*m,12,n,e,t,F,I,b,m,g)),32&S&&(d(g),d(v),h(3*g,15,n,T,t,F,b,M,g,v)),64&S&&(d(y),d(v),u(3*y,18,n,e,R,F,_,M,y,v)),128&S&&(d(m),d(y),h(3*m,21,n,e,t,F,I,_,m,y)),256&S&&(d(i),d(m),A(3*i,24,n,e,t,r,x,I,i,m)),512&S&&(d(a),d(g),A(3*a,27,n,T,t,r,C,b,a,g)),1024&S&&(d(p),d(v),A(3*p,30,n,T,R,r,w,M,p,v)),2048&S&&(d(f),d(y),A(3*f,33,n,e,R,r,B,_,f,y)),E<<=4;let P,Q,z,L=0;for(;-1!=s6[E+L];)Q=(P=E+L)+1,z=P+2,function(e,t,r,i,n,a){let s=3*o.count;if(o.positionArray[s+0]=e[i],o.positionArray[s+1]=e[i+1],o.positionArray[s+2]=e[i+2],o.positionArray[s+3]=e[n],o.positionArray[s+4]=e[n+1],o.positionArray[s+5]=e[n+2],o.positionArray[s+6]=e[a],o.positionArray[s+7]=e[a+1],o.positionArray[s+8]=e[a+2],!0===o.material.flatShading){let e=(t[i+0]+t[n+0]+t[a+0])/3,r=(t[i+1]+t[n+1]+t[a+1])/3,l=(t[i+2]+t[n+2]+t[a+2])/3;o.normalArray[s+0]=e,o.normalArray[s+1]=r,o.normalArray[s+2]=l,o.normalArray[s+3]=e,o.normalArray[s+4]=r,o.normalArray[s+5]=l,o.normalArray[s+6]=e,o.normalArray[s+7]=r,o.normalArray[s+8]=l}else o.normalArray[s+0]=t[i+0],o.normalArray[s+1]=t[i+1],o.normalArray[s+2]=t[i+2],o.normalArray[s+3]=t[n+0],o.normalArray[s+4]=t[n+1],o.normalArray[s+5]=t[n+2],o.normalArray[s+6]=t[a+0],o.normalArray[s+7]=t[a+1],o.normalArray[s+8]=t[a+2];if(o.enableUvs){let t=2*o.count;o.uvArray[t+0]=e[i+0],o.uvArray[t+1]=e[i+2],o.uvArray[t+2]=e[n+0],o.uvArray[t+3]=e[n+2],o.uvArray[t+4]=e[a+0],o.uvArray[t+5]=e[a+2]}o.enableColors&&(o.colorArray[s+0]=r[i+0],o.colorArray[s+1]=r[i+1],o.colorArray[s+2]=r[i+2],o.colorArray[s+3]=r[n+0],o.colorArray[s+4]=r[n+1],o.colorArray[s+5]=r[n+2],o.colorArray[s+6]=r[a+0],o.colorArray[s+7]=r[a+1],o.colorArray[s+8]=r[a+2]),o.count+=3}(s,l,c,3*s6[P],3*s6[Q],3*s6[z]),L+=3}((t-this.halfsize)/this.halfsize,a,i,n+t,this.isolation)}}this.geometry.setDrawRange(0,this.count),a.getAttribute("position").needsUpdate=!0,a.getAttribute("normal").needsUpdate=!0,this.enableUvs&&(a.getAttribute("uv").needsUpdate=!0),this.enableColors&&(a.getAttribute("color").needsUpdate=!0),this.count/3>n&&console.warn("THREE.MarchingCubes: Geometry buffers too small for rendering. Please create an instance with a higher poly count.")},this.init(e)}}let s5=new Int32Array([0,265,515,778,1030,1295,1541,1804,2060,2309,2575,2822,3082,3331,3593,3840,400,153,915,666,1430,1183,1941,1692,2460,2197,2975,2710,3482,3219,3993,3728,560,825,51,314,1590,1855,1077,1340,2620,2869,2111,2358,3642,3891,3129,3376,928,681,419,170,1958,1711,1445,1196,2988,2725,2479,2214,4010,3747,3497,3232,1120,1385,1635,1898,102,367,613,876,3180,3429,3695,3942,2154,2403,2665,2912,1520,1273,2035,1786,502,255,1013,764,3580,3317,4095,3830,2554,2291,3065,2800,1616,1881,1107,1370,598,863,85,348,3676,3925,3167,3414,2650,2899,2137,2384,1984,1737,1475,1226,966,719,453,204,4044,3781,3535,3270,3018,2755,2505,2240,2240,2505,2755,3018,3270,3535,3781,4044,204,453,719,966,1226,1475,1737,1984,2384,2137,2899,2650,3414,3167,3925,3676,348,85,863,598,1370,1107,1881,1616,2800,3065,2291,2554,3830,4095,3317,3580,764,1013,255,502,1786,2035,1273,1520,2912,2665,2403,2154,3942,3695,3429,3180,876,613,367,102,1898,1635,1385,1120,3232,3497,3747,4010,2214,2479,2725,2988,1196,1445,1711,1958,170,419,681,928,3376,3129,3891,3642,2358,2111,2869,2620,1340,1077,1855,1590,314,51,825,560,3728,3993,3219,3482,2710,2975,2197,2460,1692,1941,1183,1430,666,915,153,400,3840,3593,3331,3082,2822,2575,2309,2060,1804,1541,1295,1030,778,515,265,0]),s6=new Int32Array([-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,8,3,9,8,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,2,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,1,2,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,2,10,0,2,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,8,3,2,10,8,10,9,8,-1,-1,-1,-1,-1,-1,-1,3,11,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,11,2,8,11,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,9,0,2,3,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,11,2,1,9,11,9,8,11,-1,-1,-1,-1,-1,-1,-1,3,10,1,11,10,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,10,1,0,8,10,8,11,10,-1,-1,-1,-1,-1,-1,-1,3,9,0,3,11,9,11,10,9,-1,-1,-1,-1,-1,-1,-1,9,8,10,10,8,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,7,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,3,0,7,3,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,9,8,4,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,1,9,4,7,1,7,3,1,-1,-1,-1,-1,-1,-1,-1,1,2,10,8,4,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,4,7,3,0,4,1,2,10,-1,-1,-1,-1,-1,-1,-1,9,2,10,9,0,2,8,4,7,-1,-1,-1,-1,-1,-1,-1,2,10,9,2,9,7,2,7,3,7,9,4,-1,-1,-1,-1,8,4,7,3,11,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,4,7,11,2,4,2,0,4,-1,-1,-1,-1,-1,-1,-1,9,0,1,8,4,7,2,3,11,-1,-1,-1,-1,-1,-1,-1,4,7,11,9,4,11,9,11,2,9,2,1,-1,-1,-1,-1,3,10,1,3,11,10,7,8,4,-1,-1,-1,-1,-1,-1,-1,1,11,10,1,4,11,1,0,4,7,11,4,-1,-1,-1,-1,4,7,8,9,0,11,9,11,10,11,0,3,-1,-1,-1,-1,4,7,11,4,11,9,9,11,10,-1,-1,-1,-1,-1,-1,-1,9,5,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,5,4,0,8,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,5,4,1,5,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,5,4,8,3,5,3,1,5,-1,-1,-1,-1,-1,-1,-1,1,2,10,9,5,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,0,8,1,2,10,4,9,5,-1,-1,-1,-1,-1,-1,-1,5,2,10,5,4,2,4,0,2,-1,-1,-1,-1,-1,-1,-1,2,10,5,3,2,5,3,5,4,3,4,8,-1,-1,-1,-1,9,5,4,2,3,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,11,2,0,8,11,4,9,5,-1,-1,-1,-1,-1,-1,-1,0,5,4,0,1,5,2,3,11,-1,-1,-1,-1,-1,-1,-1,2,1,5,2,5,8,2,8,11,4,8,5,-1,-1,-1,-1,10,3,11,10,1,3,9,5,4,-1,-1,-1,-1,-1,-1,-1,4,9,5,0,8,1,8,10,1,8,11,10,-1,-1,-1,-1,5,4,0,5,0,11,5,11,10,11,0,3,-1,-1,-1,-1,5,4,8,5,8,10,10,8,11,-1,-1,-1,-1,-1,-1,-1,9,7,8,5,7,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,3,0,9,5,3,5,7,3,-1,-1,-1,-1,-1,-1,-1,0,7,8,0,1,7,1,5,7,-1,-1,-1,-1,-1,-1,-1,1,5,3,3,5,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,7,8,9,5,7,10,1,2,-1,-1,-1,-1,-1,-1,-1,10,1,2,9,5,0,5,3,0,5,7,3,-1,-1,-1,-1,8,0,2,8,2,5,8,5,7,10,5,2,-1,-1,-1,-1,2,10,5,2,5,3,3,5,7,-1,-1,-1,-1,-1,-1,-1,7,9,5,7,8,9,3,11,2,-1,-1,-1,-1,-1,-1,-1,9,5,7,9,7,2,9,2,0,2,7,11,-1,-1,-1,-1,2,3,11,0,1,8,1,7,8,1,5,7,-1,-1,-1,-1,11,2,1,11,1,7,7,1,5,-1,-1,-1,-1,-1,-1,-1,9,5,8,8,5,7,10,1,3,10,3,11,-1,-1,-1,-1,5,7,0,5,0,9,7,11,0,1,0,10,11,10,0,-1,11,10,0,11,0,3,10,5,0,8,0,7,5,7,0,-1,11,10,5,7,11,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,6,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,5,10,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,0,1,5,10,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,8,3,1,9,8,5,10,6,-1,-1,-1,-1,-1,-1,-1,1,6,5,2,6,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,6,5,1,2,6,3,0,8,-1,-1,-1,-1,-1,-1,-1,9,6,5,9,0,6,0,2,6,-1,-1,-1,-1,-1,-1,-1,5,9,8,5,8,2,5,2,6,3,2,8,-1,-1,-1,-1,2,3,11,10,6,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,0,8,11,2,0,10,6,5,-1,-1,-1,-1,-1,-1,-1,0,1,9,2,3,11,5,10,6,-1,-1,-1,-1,-1,-1,-1,5,10,6,1,9,2,9,11,2,9,8,11,-1,-1,-1,-1,6,3,11,6,5,3,5,1,3,-1,-1,-1,-1,-1,-1,-1,0,8,11,0,11,5,0,5,1,5,11,6,-1,-1,-1,-1,3,11,6,0,3,6,0,6,5,0,5,9,-1,-1,-1,-1,6,5,9,6,9,11,11,9,8,-1,-1,-1,-1,-1,-1,-1,5,10,6,4,7,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,3,0,4,7,3,6,5,10,-1,-1,-1,-1,-1,-1,-1,1,9,0,5,10,6,8,4,7,-1,-1,-1,-1,-1,-1,-1,10,6,5,1,9,7,1,7,3,7,9,4,-1,-1,-1,-1,6,1,2,6,5,1,4,7,8,-1,-1,-1,-1,-1,-1,-1,1,2,5,5,2,6,3,0,4,3,4,7,-1,-1,-1,-1,8,4,7,9,0,5,0,6,5,0,2,6,-1,-1,-1,-1,7,3,9,7,9,4,3,2,9,5,9,6,2,6,9,-1,3,11,2,7,8,4,10,6,5,-1,-1,-1,-1,-1,-1,-1,5,10,6,4,7,2,4,2,0,2,7,11,-1,-1,-1,-1,0,1,9,4,7,8,2,3,11,5,10,6,-1,-1,-1,-1,9,2,1,9,11,2,9,4,11,7,11,4,5,10,6,-1,8,4,7,3,11,5,3,5,1,5,11,6,-1,-1,-1,-1,5,1,11,5,11,6,1,0,11,7,11,4,0,4,11,-1,0,5,9,0,6,5,0,3,6,11,6,3,8,4,7,-1,6,5,9,6,9,11,4,7,9,7,11,9,-1,-1,-1,-1,10,4,9,6,4,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,10,6,4,9,10,0,8,3,-1,-1,-1,-1,-1,-1,-1,10,0,1,10,6,0,6,4,0,-1,-1,-1,-1,-1,-1,-1,8,3,1,8,1,6,8,6,4,6,1,10,-1,-1,-1,-1,1,4,9,1,2,4,2,6,4,-1,-1,-1,-1,-1,-1,-1,3,0,8,1,2,9,2,4,9,2,6,4,-1,-1,-1,-1,0,2,4,4,2,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,3,2,8,2,4,4,2,6,-1,-1,-1,-1,-1,-1,-1,10,4,9,10,6,4,11,2,3,-1,-1,-1,-1,-1,-1,-1,0,8,2,2,8,11,4,9,10,4,10,6,-1,-1,-1,-1,3,11,2,0,1,6,0,6,4,6,1,10,-1,-1,-1,-1,6,4,1,6,1,10,4,8,1,2,1,11,8,11,1,-1,9,6,4,9,3,6,9,1,3,11,6,3,-1,-1,-1,-1,8,11,1,8,1,0,11,6,1,9,1,4,6,4,1,-1,3,11,6,3,6,0,0,6,4,-1,-1,-1,-1,-1,-1,-1,6,4,8,11,6,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,10,6,7,8,10,8,9,10,-1,-1,-1,-1,-1,-1,-1,0,7,3,0,10,7,0,9,10,6,7,10,-1,-1,-1,-1,10,6,7,1,10,7,1,7,8,1,8,0,-1,-1,-1,-1,10,6,7,10,7,1,1,7,3,-1,-1,-1,-1,-1,-1,-1,1,2,6,1,6,8,1,8,9,8,6,7,-1,-1,-1,-1,2,6,9,2,9,1,6,7,9,0,9,3,7,3,9,-1,7,8,0,7,0,6,6,0,2,-1,-1,-1,-1,-1,-1,-1,7,3,2,6,7,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,11,10,6,8,10,8,9,8,6,7,-1,-1,-1,-1,2,0,7,2,7,11,0,9,7,6,7,10,9,10,7,-1,1,8,0,1,7,8,1,10,7,6,7,10,2,3,11,-1,11,2,1,11,1,7,10,6,1,6,7,1,-1,-1,-1,-1,8,9,6,8,6,7,9,1,6,11,6,3,1,3,6,-1,0,9,1,11,6,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,8,0,7,0,6,3,11,0,11,6,0,-1,-1,-1,-1,7,11,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,6,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,0,8,11,7,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,9,11,7,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,1,9,8,3,1,11,7,6,-1,-1,-1,-1,-1,-1,-1,10,1,2,6,11,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,2,10,3,0,8,6,11,7,-1,-1,-1,-1,-1,-1,-1,2,9,0,2,10,9,6,11,7,-1,-1,-1,-1,-1,-1,-1,6,11,7,2,10,3,10,8,3,10,9,8,-1,-1,-1,-1,7,2,3,6,2,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,0,8,7,6,0,6,2,0,-1,-1,-1,-1,-1,-1,-1,2,7,6,2,3,7,0,1,9,-1,-1,-1,-1,-1,-1,-1,1,6,2,1,8,6,1,9,8,8,7,6,-1,-1,-1,-1,10,7,6,10,1,7,1,3,7,-1,-1,-1,-1,-1,-1,-1,10,7,6,1,7,10,1,8,7,1,0,8,-1,-1,-1,-1,0,3,7,0,7,10,0,10,9,6,10,7,-1,-1,-1,-1,7,6,10,7,10,8,8,10,9,-1,-1,-1,-1,-1,-1,-1,6,8,4,11,8,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,6,11,3,0,6,0,4,6,-1,-1,-1,-1,-1,-1,-1,8,6,11,8,4,6,9,0,1,-1,-1,-1,-1,-1,-1,-1,9,4,6,9,6,3,9,3,1,11,3,6,-1,-1,-1,-1,6,8,4,6,11,8,2,10,1,-1,-1,-1,-1,-1,-1,-1,1,2,10,3,0,11,0,6,11,0,4,6,-1,-1,-1,-1,4,11,8,4,6,11,0,2,9,2,10,9,-1,-1,-1,-1,10,9,3,10,3,2,9,4,3,11,3,6,4,6,3,-1,8,2,3,8,4,2,4,6,2,-1,-1,-1,-1,-1,-1,-1,0,4,2,4,6,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,9,0,2,3,4,2,4,6,4,3,8,-1,-1,-1,-1,1,9,4,1,4,2,2,4,6,-1,-1,-1,-1,-1,-1,-1,8,1,3,8,6,1,8,4,6,6,10,1,-1,-1,-1,-1,10,1,0,10,0,6,6,0,4,-1,-1,-1,-1,-1,-1,-1,4,6,3,4,3,8,6,10,3,0,3,9,10,9,3,-1,10,9,4,6,10,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,9,5,7,6,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,4,9,5,11,7,6,-1,-1,-1,-1,-1,-1,-1,5,0,1,5,4,0,7,6,11,-1,-1,-1,-1,-1,-1,-1,11,7,6,8,3,4,3,5,4,3,1,5,-1,-1,-1,-1,9,5,4,10,1,2,7,6,11,-1,-1,-1,-1,-1,-1,-1,6,11,7,1,2,10,0,8,3,4,9,5,-1,-1,-1,-1,7,6,11,5,4,10,4,2,10,4,0,2,-1,-1,-1,-1,3,4,8,3,5,4,3,2,5,10,5,2,11,7,6,-1,7,2,3,7,6,2,5,4,9,-1,-1,-1,-1,-1,-1,-1,9,5,4,0,8,6,0,6,2,6,8,7,-1,-1,-1,-1,3,6,2,3,7,6,1,5,0,5,4,0,-1,-1,-1,-1,6,2,8,6,8,7,2,1,8,4,8,5,1,5,8,-1,9,5,4,10,1,6,1,7,6,1,3,7,-1,-1,-1,-1,1,6,10,1,7,6,1,0,7,8,7,0,9,5,4,-1,4,0,10,4,10,5,0,3,10,6,10,7,3,7,10,-1,7,6,10,7,10,8,5,4,10,4,8,10,-1,-1,-1,-1,6,9,5,6,11,9,11,8,9,-1,-1,-1,-1,-1,-1,-1,3,6,11,0,6,3,0,5,6,0,9,5,-1,-1,-1,-1,0,11,8,0,5,11,0,1,5,5,6,11,-1,-1,-1,-1,6,11,3,6,3,5,5,3,1,-1,-1,-1,-1,-1,-1,-1,1,2,10,9,5,11,9,11,8,11,5,6,-1,-1,-1,-1,0,11,3,0,6,11,0,9,6,5,6,9,1,2,10,-1,11,8,5,11,5,6,8,0,5,10,5,2,0,2,5,-1,6,11,3,6,3,5,2,10,3,10,5,3,-1,-1,-1,-1,5,8,9,5,2,8,5,6,2,3,8,2,-1,-1,-1,-1,9,5,6,9,6,0,0,6,2,-1,-1,-1,-1,-1,-1,-1,1,5,8,1,8,0,5,6,8,3,8,2,6,2,8,-1,1,5,6,2,1,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,3,6,1,6,10,3,8,6,5,6,9,8,9,6,-1,10,1,0,10,0,6,9,5,0,5,6,0,-1,-1,-1,-1,0,3,8,5,6,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,5,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,5,10,7,5,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,5,10,11,7,5,8,3,0,-1,-1,-1,-1,-1,-1,-1,5,11,7,5,10,11,1,9,0,-1,-1,-1,-1,-1,-1,-1,10,7,5,10,11,7,9,8,1,8,3,1,-1,-1,-1,-1,11,1,2,11,7,1,7,5,1,-1,-1,-1,-1,-1,-1,-1,0,8,3,1,2,7,1,7,5,7,2,11,-1,-1,-1,-1,9,7,5,9,2,7,9,0,2,2,11,7,-1,-1,-1,-1,7,5,2,7,2,11,5,9,2,3,2,8,9,8,2,-1,2,5,10,2,3,5,3,7,5,-1,-1,-1,-1,-1,-1,-1,8,2,0,8,5,2,8,7,5,10,2,5,-1,-1,-1,-1,9,0,1,5,10,3,5,3,7,3,10,2,-1,-1,-1,-1,9,8,2,9,2,1,8,7,2,10,2,5,7,5,2,-1,1,3,5,3,7,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,7,0,7,1,1,7,5,-1,-1,-1,-1,-1,-1,-1,9,0,3,9,3,5,5,3,7,-1,-1,-1,-1,-1,-1,-1,9,8,7,5,9,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,5,8,4,5,10,8,10,11,8,-1,-1,-1,-1,-1,-1,-1,5,0,4,5,11,0,5,10,11,11,3,0,-1,-1,-1,-1,0,1,9,8,4,10,8,10,11,10,4,5,-1,-1,-1,-1,10,11,4,10,4,5,11,3,4,9,4,1,3,1,4,-1,2,5,1,2,8,5,2,11,8,4,5,8,-1,-1,-1,-1,0,4,11,0,11,3,4,5,11,2,11,1,5,1,11,-1,0,2,5,0,5,9,2,11,5,4,5,8,11,8,5,-1,9,4,5,2,11,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,5,10,3,5,2,3,4,5,3,8,4,-1,-1,-1,-1,5,10,2,5,2,4,4,2,0,-1,-1,-1,-1,-1,-1,-1,3,10,2,3,5,10,3,8,5,4,5,8,0,1,9,-1,5,10,2,5,2,4,1,9,2,9,4,2,-1,-1,-1,-1,8,4,5,8,5,3,3,5,1,-1,-1,-1,-1,-1,-1,-1,0,4,5,1,0,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,4,5,8,5,3,9,0,5,0,3,5,-1,-1,-1,-1,9,4,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,11,7,4,9,11,9,10,11,-1,-1,-1,-1,-1,-1,-1,0,8,3,4,9,7,9,11,7,9,10,11,-1,-1,-1,-1,1,10,11,1,11,4,1,4,0,7,4,11,-1,-1,-1,-1,3,1,4,3,4,8,1,10,4,7,4,11,10,11,4,-1,4,11,7,9,11,4,9,2,11,9,1,2,-1,-1,-1,-1,9,7,4,9,11,7,9,1,11,2,11,1,0,8,3,-1,11,7,4,11,4,2,2,4,0,-1,-1,-1,-1,-1,-1,-1,11,7,4,11,4,2,8,3,4,3,2,4,-1,-1,-1,-1,2,9,10,2,7,9,2,3,7,7,4,9,-1,-1,-1,-1,9,10,7,9,7,4,10,2,7,8,7,0,2,0,7,-1,3,7,10,3,10,2,7,4,10,1,10,0,4,0,10,-1,1,10,2,8,7,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,9,1,4,1,7,7,1,3,-1,-1,-1,-1,-1,-1,-1,4,9,1,4,1,7,0,8,1,8,7,1,-1,-1,-1,-1,4,0,3,7,4,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,8,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,10,8,10,11,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,0,9,3,9,11,11,9,10,-1,-1,-1,-1,-1,-1,-1,0,1,10,0,10,8,8,10,11,-1,-1,-1,-1,-1,-1,-1,3,1,10,11,3,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,2,11,1,11,9,9,11,8,-1,-1,-1,-1,-1,-1,-1,3,0,9,3,9,11,1,2,9,2,11,9,-1,-1,-1,-1,0,2,11,8,0,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,2,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,8,2,8,10,10,8,9,-1,-1,-1,-1,-1,-1,-1,9,10,2,0,9,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,8,2,8,10,0,1,8,1,10,8,-1,-1,-1,-1,1,10,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,3,8,9,1,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,9,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,3,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1]),s8=eS.createContext(null),s9=eS.forwardRef(({resolution:e=28,maxPolyCount:t=1e4,enableUvs:r=!1,enableColors:i=!1,children:n,...a},o)=>{let s=eS.useRef(null);eS.useImperativeHandle(o,()=>s.current,[]);let l=eS.useMemo(()=>new s4(e,null,r,i,t),[e,t,r,i]),c=eS.useMemo(()=>({getParent:()=>s}),[]);return(0,eR.F)(()=>{l.update(),l.reset()},-1),eS.createElement(eS.Fragment,null,eS.createElement("primitive",j({object:l,ref:s},a),eS.createElement(s8.Provider,{value:c},n)))}),s7=eS.forwardRef(({strength:e=.5,subtract:t=12,color:r,...i},n)=>{let{getParent:a}=eS.useContext(s8),o=eS.useMemo(()=>a(),[a]),s=eS.useRef(null);eS.useImperativeHandle(n,()=>s.current,[]);let l=new eT.Vector3;return(0,eR.F)(i=>{o.current&&s.current&&(s.current.getWorldPosition(l),o.current.addBall(.5+.5*l.x,.5+.5*l.y,.5+.5*l.z,e,t,r))}),eS.createElement("group",j({ref:s},i))}),le=eS.forwardRef(({planeType:e="x",strength:t=.5,subtract:r=12,...i},n)=>{let{getParent:a}=eS.useContext(s8),o=eS.useMemo(()=>a(),[a]),s=eS.useRef(null);eS.useImperativeHandle(n,()=>s.current,[]);let l=eS.useMemo(()=>"x"===e?"addPlaneX":"y"===e?"addPlaneY":"addPlaneZ",[e]);return(0,eR.F)(()=>{o.current&&s.current&&o.current[l](t,r)}),eS.createElement("group",j({ref:s},i))});class lt extends eT.BufferGeometry{constructor(e,t,r,i){super();let n=[],a=[],o=[],s=new eT.Vector3,l=new eT.Matrix4;l.makeRotationFromEuler(r),l.setPosition(t);let c=new eT.Matrix4;function u(t,r,i){r.applyMatrix4(e.matrixWorld),r.applyMatrix4(c),i.transformDirection(e.matrixWorld),t.push(new lr(r.clone(),i.clone()))}function h(e,t){let r=[],n=.5*Math.abs(i.dot(t));for(let i=0;i<e.length;i+=3){let a,o,s,l,c,u,h;let d=e[i+0].position.dot(t)-n,f=e[i+1].position.dot(t)-n,m=e[i+2].position.dot(t)-n;switch(((c=d>0)?1:0)+((u=f>0)?1:0)+((h=m>0)?1:0)){case 0:r.push(e[i]),r.push(e[i+1]),r.push(e[i+2]);break;case 1:if(c&&(a=e[i+1],o=e[i+2],s=A(e[i],a,t,n),l=A(e[i],o,t,n)),u){a=e[i],o=e[i+2],s=A(e[i+1],a,t,n),l=A(e[i+1],o,t,n),r.push(s),r.push(o.clone()),r.push(a.clone()),r.push(o.clone()),r.push(s.clone()),r.push(l);break}h&&(a=e[i],o=e[i+1],s=A(e[i+2],a,t,n),l=A(e[i+2],o,t,n)),r.push(a.clone()),r.push(o.clone()),r.push(s),r.push(l),r.push(s.clone()),r.push(o.clone());break;case 2:c||(o=A(a=e[i].clone(),e[i+1],t,n),s=A(a,e[i+2],t,n),r.push(a),r.push(o),r.push(s)),u||(o=A(a=e[i+1].clone(),e[i+2],t,n),s=A(a,e[i],t,n),r.push(a),r.push(o),r.push(s)),h||(o=A(a=e[i+2].clone(),e[i],t,n),s=A(a,e[i+1],t,n),r.push(a),r.push(o),r.push(s))}}return r}function A(e,t,r,i){let n=e.position.dot(r)-i,a=n/(n-(t.position.dot(r)-i));return new lr(new eT.Vector3(e.position.x+a*(t.position.x-e.position.x),e.position.y+a*(t.position.y-e.position.y),e.position.z+a*(t.position.z-e.position.z)),new eT.Vector3(e.normal.x+a*(t.normal.x-e.normal.x),e.normal.y+a*(t.normal.y-e.normal.y),e.normal.z+a*(t.normal.z-e.normal.z)))}c.copy(l).invert(),function(){let t;let r=[],c=new eT.Vector3,A=new eT.Vector3;if(!0===e.geometry.isGeometry){console.error("THREE.DecalGeometry no longer supports THREE.Geometry. Use BufferGeometry instead.");return}let d=e.geometry,f=d.attributes.position,m=d.attributes.normal;if(null!==d.index){let e=d.index;for(t=0;t<e.count;t++)c.fromBufferAttribute(f,e.getX(t)),A.fromBufferAttribute(m,e.getX(t)),u(r,c,A)}else for(t=0;t<f.count;t++)c.fromBufferAttribute(f,t),A.fromBufferAttribute(m,t),u(r,c,A);for(t=0,r=h(r,s.set(1,0,0)),r=h(r,s.set(-1,0,0)),r=h(r,s.set(0,1,0)),r=h(r,s.set(0,-1,0)),r=h(r,s.set(0,0,1)),r=h(r,s.set(0,0,-1));t<r.length;t++){let e=r[t];o.push(.5+e.position.x/i.x,.5+e.position.y/i.y),e.position.applyMatrix4(l),n.push(e.position.x,e.position.y,e.position.z),a.push(e.normal.x,e.normal.y,e.normal.z)}}(),this.setAttribute("position",new eT.Float32BufferAttribute(n,3)),this.setAttribute("normal",new eT.Float32BufferAttribute(a,3)),this.setAttribute("uv",new eT.Float32BufferAttribute(o,2))}}class lr{constructor(e,t){this.position=e,this.normal=t}clone(){return new this.constructor(this.position.clone(),this.normal.clone())}}function li(e=[0,0,0]){return Array.isArray(e)?e:e instanceof eT.Vector3||e instanceof eT.Euler?[e.x,e.y,e.z]:[e,e,e]}let ln=eS.forwardRef(function({debug:e,depthTest:t=!1,polygonOffsetFactor:r=-10,map:i,mesh:n,children:a,position:o,rotation:s,scale:l,...c},u){let h=eS.useRef(null);eS.useImperativeHandle(u,()=>h.current);let A=eS.useRef(null),d=eS.useRef({position:new eT.Vector3,rotation:new eT.Euler,scale:new eT.Vector3(1,1,1)});return eS.useLayoutEffect(()=>{let e=(null==n?void 0:n.current)||h.current.parent,t=h.current;if(!(e instanceof eT.Mesh))throw Error('Decal must have a Mesh as parent or specify its "mesh" prop');if(e){(0,eR.k)(d.current,{position:o,scale:l});let r=e.matrixWorld.clone();if(e.matrixWorld.identity(),s&&"number"!=typeof s)(0,eR.k)(d.current,{rotation:s});else{let t=new eT.Object3D;t.position.copy(d.current.position);let r=e.geometry.attributes.position.array;void 0===e.geometry.attributes.normal&&e.geometry.computeVertexNormals();let i=e.geometry.attributes.normal.array,n=1/0;new eT.Vector3;let a=new eT.Vector3,o=t.position.x,l=t.position.y,c=t.position.z,u=r.length,h=-1;for(let e=0;e<u;e+=3){let t=r[e],i=r[e+1],a=r[e+2],s=t-o,u=i-l,A=a-c,d=s*s+u*u+A*A;d<n&&(n=d,h=e)}a.fromArray(i,h),t.lookAt(t.position.clone().add(a)),t.rotateZ(Math.PI),t.rotateY(Math.PI),"number"==typeof s&&t.rotateZ(s),(0,eR.k)(d.current,{rotation:t.rotation})}return t.geometry=new lt(e,d.current.position,d.current.rotation,d.current.scale),e.matrixWorld=r,()=>{t.geometry.dispose()}}},[n,...li(o),...li(l),...li(s)]),eS.useLayoutEffect(()=>{A.current&&((0,eR.k)(A.current,d.current),A.current.traverse(e=>e.raycast=()=>null))},[e]),eS.createElement("mesh",j({ref:h,"material-transparent":!0,"material-polygonOffset":!0,"material-polygonOffsetFactor":r,"material-depthTest":t,"material-map":i},c),a,e&&eS.createElement("mesh",{ref:A},eS.createElement("boxGeometry",null),eS.createElement("meshNormalMaterial",{wireframe:!0}),eS.createElement("axesHelper",null)))}),la=(()=>{class e extends eT.Loader{constructor(e){super(e),this.defaultDPI=90,this.defaultUnit="px"}load(e,t,r,i){let n=this,a=new eT.FileLoader(n.manager);a.setPath(n.path),a.setRequestHeader(n.requestHeader),a.setWithCredentials(n.withCredentials),a.load(e,function(r){try{t(n.parse(r))}catch(t){i?i(t):console.error(t),n.manager.itemError(e)}},r,i)}parse(e){let t=this;function r(e,t,r,n,a,o,s,l){if(0==t||0==r){e.lineTo(l.x,l.y);return}n=n*Math.PI/180,t=Math.abs(t),r=Math.abs(r);let c=(s.x-l.x)/2,u=(s.y-l.y)/2,h=Math.cos(n)*c+Math.sin(n)*u,A=-Math.sin(n)*c+Math.cos(n)*u,d=t*t,f=r*r,m=h*h,p=A*A,g=m/d+p/f;if(g>1){let e=Math.sqrt(g);t*=e,r*=e,d=t*t,f=r*r}let y=d*p+f*m,v=Math.sqrt(Math.max(0,(d*f-y)/y));a===o&&(v=-v);let E=v*t*A/r,x=-v*r*h/t,C=Math.cos(n)*E-Math.sin(n)*x+(s.x+l.x)/2,B=Math.sin(n)*E+Math.cos(n)*x+(s.y+l.y)/2,w=i(1,0,(h-E)/t,(A-x)/r),I=i((h-E)/t,(A-x)/r,(-h-E)/t,(-A-x)/r)%(2*Math.PI);e.currentPath.absellipse(C,B,t,r,w,w+I,0===o,n)}function i(e,t,r,i){let n=Math.acos(Math.max(-1,Math.min(1,(e*r+t*i)/(Math.sqrt(e*e+t*t)*Math.sqrt(r*r+i*i)))));return e*i-t*r<0&&(n=-n),n}function n(e,t){t=Object.assign({},t);let r={};if(e.hasAttribute("class")){let t=e.getAttribute("class").split(/\s/).filter(Boolean).map(e=>e.trim());for(let e=0;e<t.length;e++)r=Object.assign(r,d["."+t[e]])}function i(i,n,a){void 0===a&&(a=function(e){return e.startsWith("url")&&console.warn("SVGLoader: url access in attributes is not implemented."),e}),e.hasAttribute(i)&&(t[n]=a(e.getAttribute(i))),r[i]&&(t[n]=a(r[i])),e.style&&""!==e.style[i]&&(t[n]=a(e.style[i]))}function n(e){return Math.max(0,Math.min(1,l(e)))}function a(e){return Math.max(0,l(e))}return e.hasAttribute("id")&&(r=Object.assign(r,d["#"+e.getAttribute("id")])),i("fill","fill"),i("fill-opacity","fillOpacity",n),i("fill-rule","fillRule"),i("opacity","opacity",n),i("stroke","stroke"),i("stroke-opacity","strokeOpacity",n),i("stroke-width","strokeWidth",a),i("stroke-linejoin","strokeLineJoin"),i("stroke-linecap","strokeLineCap"),i("stroke-miterlimit","strokeMiterLimit",a),i("visibility","visibility"),t}function a(e,t,r){let i;if("string"!=typeof e)throw TypeError("Invalid input: "+typeof e);let n={WHITESPACE:/[ \t\r\n]/,DIGIT:/[\d]/,SIGN:/[-+]/,POINT:/\./,COMMA:/,/,EXP:/e/i,FLAGS:/[01]/},a=0,o=!0,s="",l="",c=[];function u(e,t,r){let i=SyntaxError('Unexpected character "'+e+'" at index '+t+".");throw i.partial=r,i}function h(){""!==s&&(""===l?c.push(Number(s)):c.push(Number(s)*Math.pow(10,Number(l)))),s="",l=""}let A=e.length;for(let d=0;d<A;d++){if(i=e[d],Array.isArray(t)&&t.includes(c.length%r)&&n.FLAGS.test(i)){a=1,s=i,h();continue}if(0===a){if(n.WHITESPACE.test(i))continue;if(n.DIGIT.test(i)||n.SIGN.test(i)){a=1,s=i;continue}if(n.POINT.test(i)){a=2,s=i;continue}n.COMMA.test(i)&&(o&&u(i,d,c),o=!0)}if(1===a){if(n.DIGIT.test(i)){s+=i;continue}if(n.POINT.test(i)){s+=i,a=2;continue}if(n.EXP.test(i)){a=3;continue}n.SIGN.test(i)&&1===s.length&&n.SIGN.test(s[0])&&u(i,d,c)}if(2===a){if(n.DIGIT.test(i)){s+=i;continue}if(n.EXP.test(i)){a=3;continue}n.POINT.test(i)&&"."===s[s.length-1]&&u(i,d,c)}if(3===a){if(n.DIGIT.test(i)){l+=i;continue}if(n.SIGN.test(i)){if(""===l){l+=i;continue}1===l.length&&n.SIGN.test(l)&&u(i,d,c)}}n.WHITESPACE.test(i)?(h(),a=0,o=!1):n.COMMA.test(i)?(h(),a=0,o=!0):n.SIGN.test(i)?(h(),a=1,s=i):n.POINT.test(i)?(h(),a=2,s=i):u(i,d,c)}return h(),c}let o=["mm","cm","in","pt","pc","px"],s={mm:{mm:1,cm:.1,in:1/25.4,pt:72/25.4,pc:6/25.4,px:-1},cm:{mm:10,cm:1,in:1/2.54,pt:72/2.54,pc:6/2.54,px:-1},in:{mm:25.4,cm:2.54,in:1,pt:72,pc:6,px:-1},pt:{mm:25.4/72,cm:2.54/72,in:1/72,pt:1,pc:6/72,px:-1},pc:{mm:25.4/6,cm:2.54/6,in:1/6,pt:12,pc:1,px:-1},px:{px:1}};function l(e){let r,i="px";if("string"==typeof e||e instanceof String)for(let t=0,r=o.length;t<r;t++){let r=o[t];if(e.endsWith(r)){i=r,e=e.substring(0,e.length-r.length);break}}return"px"===i&&"px"!==t.defaultUnit?r=s.in[t.defaultUnit]/t.defaultDPI:(r=s[i][t.defaultUnit])<0&&(r=s[i].in*t.defaultDPI),r*parseFloat(e)}function c(e){let t=e.elements;return t[0]*t[4]-t[1]*t[3]<0}function u(e){let t=e.elements;return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function h(e){let t=e.elements;return Math.sqrt(t[3]*t[3]+t[4]*t[4])}let A=[],d={},f=[],m=new eT.Matrix3,p=new eT.Matrix3,g=new eT.Matrix3,y=new eT.Matrix3,v=new eT.Vector2,E=new eT.Vector3,x=new eT.Matrix3,C=new DOMParser().parseFromString(e,"image/svg+xml");return!function e(t,i){if(1!==t.nodeType)return;let o=function(e){if(!(e.hasAttribute("transform")||"use"===e.nodeName&&(e.hasAttribute("x")||e.hasAttribute("y"))))return null;let t=function(e){let t=new eT.Matrix3;if("use"===e.nodeName&&(e.hasAttribute("x")||e.hasAttribute("y"))){let r=l(e.getAttribute("x")),i=l(e.getAttribute("y"));t.translate(r,i)}if(e.hasAttribute("transform")){let r=e.getAttribute("transform").split(")");for(let e=r.length-1;e>=0;e--){let i=r[e].trim();if(""===i)continue;let n=i.indexOf("("),o=i.length;if(n>0&&n<o){let e=i.slice(0,n),t=a(i.slice(n+1));switch(m.identity(),e){case"translate":if(t.length>=1){let e=t[0],r=0;t.length>=2&&(r=t[1]),m.translate(e,r)}break;case"rotate":if(t.length>=1){let e=0,r=0,i=0;e=t[0]*Math.PI/180,t.length>=3&&(r=t[1],i=t[2]),p.makeTranslation(-r,-i),g.makeRotation(e),y.multiplyMatrices(g,p),p.makeTranslation(r,i),m.multiplyMatrices(p,y)}break;case"scale":if(t.length>=1){let e=t[0],r=e;t.length>=2&&(r=t[1]),m.scale(e,r)}break;case"skewX":1===t.length&&m.set(1,Math.tan(t[0]*Math.PI/180),0,0,1,0,0,0,1);break;case"skewY":1===t.length&&m.set(1,0,0,Math.tan(t[0]*Math.PI/180),1,0,0,0,1);break;case"matrix":6===t.length&&m.set(t[0],t[2],t[4],t[1],t[3],t[5],0,0,1)}}t.premultiply(m)}}return t}(e);return f.length>0&&t.premultiply(f[f.length-1]),x.copy(t),f.push(t),t}(t),s=!1,C=null;switch(t.nodeName){case"svg":case"g":i=n(t,i);break;case"style":(function(e){if(e.sheet&&e.sheet.cssRules&&e.sheet.cssRules.length)for(let t=0;t<e.sheet.cssRules.length;t++){let r=e.sheet.cssRules[t];if(1!==r.type)continue;let i=r.selectorText.split(/,/gm).filter(Boolean).map(e=>e.trim());for(let e=0;e<i.length;e++){let t=Object.fromEntries(Object.entries(r.style).filter(([,e])=>""!==e));d[i[e]]=Object.assign(d[i[e]]||{},t)}}})(t);break;case"path":i=n(t,i),t.hasAttribute("d")&&(C=function(e){let t=new eT.ShapePath,i=new eT.Vector2,n=new eT.Vector2,o=new eT.Vector2,s=!0,l=!1,c=e.getAttribute("d");if(""===c||"none"===c)return null;let u=c.match(/[a-df-z][^a-df-z]*/gi);for(let e=0,c=u.length;e<c;e++){var h,A,d,f,m,p,g,y;let c;let v=u[e],E=v.charAt(0),x=v.slice(1).trim();switch(!0===s&&(l=!0,s=!1),E){case"M":c=a(x);for(let e=0,r=c.length;e<r;e+=2)i.x=c[e+0],i.y=c[e+1],n.x=i.x,n.y=i.y,0===e?t.moveTo(i.x,i.y):t.lineTo(i.x,i.y),0===e&&o.copy(i);break;case"H":c=a(x);for(let e=0,r=c.length;e<r;e++)i.x=c[e],n.x=i.x,n.y=i.y,t.lineTo(i.x,i.y),0===e&&!0===l&&o.copy(i);break;case"V":c=a(x);for(let e=0,r=c.length;e<r;e++)i.y=c[e],n.x=i.x,n.y=i.y,t.lineTo(i.x,i.y),0===e&&!0===l&&o.copy(i);break;case"L":c=a(x);for(let e=0,r=c.length;e<r;e+=2)i.x=c[e+0],i.y=c[e+1],n.x=i.x,n.y=i.y,t.lineTo(i.x,i.y),0===e&&!0===l&&o.copy(i);break;case"C":c=a(x);for(let e=0,r=c.length;e<r;e+=6)t.bezierCurveTo(c[e+0],c[e+1],c[e+2],c[e+3],c[e+4],c[e+5]),n.x=c[e+2],n.y=c[e+3],i.x=c[e+4],i.y=c[e+5],0===e&&!0===l&&o.copy(i);break;case"S":c=a(x);for(let e=0,r=c.length;e<r;e+=4)t.bezierCurveTo((h=i.x)-(n.x-h),(A=i.y)-(n.y-A),c[e+0],c[e+1],c[e+2],c[e+3]),n.x=c[e+0],n.y=c[e+1],i.x=c[e+2],i.y=c[e+3],0===e&&!0===l&&o.copy(i);break;case"Q":c=a(x);for(let e=0,r=c.length;e<r;e+=4)t.quadraticCurveTo(c[e+0],c[e+1],c[e+2],c[e+3]),n.x=c[e+0],n.y=c[e+1],i.x=c[e+2],i.y=c[e+3],0===e&&!0===l&&o.copy(i);break;case"T":c=a(x);for(let e=0,r=c.length;e<r;e+=2){let r=(d=i.x)-(n.x-d),a=(f=i.y)-(n.y-f);t.quadraticCurveTo(r,a,c[e+0],c[e+1]),n.x=r,n.y=a,i.x=c[e+0],i.y=c[e+1],0===e&&!0===l&&o.copy(i)}break;case"A":c=a(x,[3,4],7);for(let e=0,a=c.length;e<a;e+=7){if(c[e+5]==i.x&&c[e+6]==i.y)continue;let a=i.clone();i.x=c[e+5],i.y=c[e+6],n.x=i.x,n.y=i.y,r(t,c[e],c[e+1],c[e+2],c[e+3],c[e+4],a,i),0===e&&!0===l&&o.copy(i)}break;case"m":c=a(x);for(let e=0,r=c.length;e<r;e+=2)i.x+=c[e+0],i.y+=c[e+1],n.x=i.x,n.y=i.y,0===e?t.moveTo(i.x,i.y):t.lineTo(i.x,i.y),0===e&&o.copy(i);break;case"h":c=a(x);for(let e=0,r=c.length;e<r;e++)i.x+=c[e],n.x=i.x,n.y=i.y,t.lineTo(i.x,i.y),0===e&&!0===l&&o.copy(i);break;case"v":c=a(x);for(let e=0,r=c.length;e<r;e++)i.y+=c[e],n.x=i.x,n.y=i.y,t.lineTo(i.x,i.y),0===e&&!0===l&&o.copy(i);break;case"l":c=a(x);for(let e=0,r=c.length;e<r;e+=2)i.x+=c[e+0],i.y+=c[e+1],n.x=i.x,n.y=i.y,t.lineTo(i.x,i.y),0===e&&!0===l&&o.copy(i);break;case"c":c=a(x);for(let e=0,r=c.length;e<r;e+=6)t.bezierCurveTo(i.x+c[e+0],i.y+c[e+1],i.x+c[e+2],i.y+c[e+3],i.x+c[e+4],i.y+c[e+5]),n.x=i.x+c[e+2],n.y=i.y+c[e+3],i.x+=c[e+4],i.y+=c[e+5],0===e&&!0===l&&o.copy(i);break;case"s":c=a(x);for(let e=0,r=c.length;e<r;e+=4)t.bezierCurveTo((m=i.x)-(n.x-m),(p=i.y)-(n.y-p),i.x+c[e+0],i.y+c[e+1],i.x+c[e+2],i.y+c[e+3]),n.x=i.x+c[e+0],n.y=i.y+c[e+1],i.x+=c[e+2],i.y+=c[e+3],0===e&&!0===l&&o.copy(i);break;case"q":c=a(x);for(let e=0,r=c.length;e<r;e+=4)t.quadraticCurveTo(i.x+c[e+0],i.y+c[e+1],i.x+c[e+2],i.y+c[e+3]),n.x=i.x+c[e+0],n.y=i.y+c[e+1],i.x+=c[e+2],i.y+=c[e+3],0===e&&!0===l&&o.copy(i);break;case"t":c=a(x);for(let e=0,r=c.length;e<r;e+=2){let r=(g=i.x)-(n.x-g),a=(y=i.y)-(n.y-y);t.quadraticCurveTo(r,a,i.x+c[e+0],i.y+c[e+1]),n.x=r,n.y=a,i.x=i.x+c[e+0],i.y=i.y+c[e+1],0===e&&!0===l&&o.copy(i)}break;case"a":c=a(x,[3,4],7);for(let e=0,a=c.length;e<a;e+=7){if(0==c[e+5]&&0==c[e+6])continue;let a=i.clone();i.x+=c[e+5],i.y+=c[e+6],n.x=i.x,n.y=i.y,r(t,c[e],c[e+1],c[e+2],c[e+3],c[e+4],a,i),0===e&&!0===l&&o.copy(i)}break;case"Z":case"z":t.currentPath.autoClose=!0,t.currentPath.curves.length>0&&(i.copy(o),t.currentPath.currentPoint.copy(i),s=!0);break;default:console.warn(v)}l=!1}return t}(t));break;case"rect":i=n(t,i),C=function(e){let t=l(e.getAttribute("x")||0),r=l(e.getAttribute("y")||0),i=l(e.getAttribute("rx")||e.getAttribute("ry")||0),n=l(e.getAttribute("ry")||e.getAttribute("rx")||0),a=l(e.getAttribute("width")),o=l(e.getAttribute("height")),s=new eT.ShapePath;return s.moveTo(t+i,r),s.lineTo(t+a-i,r),(0!==i||0!==n)&&s.bezierCurveTo(t+a-.448084975506*i,r,t+a,r+.448084975506*n,t+a,r+n),s.lineTo(t+a,r+o-n),(0!==i||0!==n)&&s.bezierCurveTo(t+a,r+o-.448084975506*n,t+a-.448084975506*i,r+o,t+a-i,r+o),s.lineTo(t+i,r+o),(0!==i||0!==n)&&s.bezierCurveTo(t+.448084975506*i,r+o,t,r+o-.448084975506*n,t,r+o-n),s.lineTo(t,r+n),(0!==i||0!==n)&&s.bezierCurveTo(t,r+.448084975506*n,t+.448084975506*i,r,t+i,r),s}(t);break;case"polygon":i=n(t,i),C=function(e){let t=new eT.ShapePath,r=0;return e.getAttribute("points").replace(/([+-]?\d*\.?\d+(?:e[+-]?\d+)?)(?:,|\s)([+-]?\d*\.?\d+(?:e[+-]?\d+)?)/g,function(e,i,n){let a=l(i),o=l(n);0===r?t.moveTo(a,o):t.lineTo(a,o),r++}),t.currentPath.autoClose=!0,t}(t);break;case"polyline":i=n(t,i),C=function(e){let t=new eT.ShapePath,r=0;return e.getAttribute("points").replace(/([+-]?\d*\.?\d+(?:e[+-]?\d+)?)(?:,|\s)([+-]?\d*\.?\d+(?:e[+-]?\d+)?)/g,function(e,i,n){let a=l(i),o=l(n);0===r?t.moveTo(a,o):t.lineTo(a,o),r++}),t.currentPath.autoClose=!1,t}(t);break;case"circle":i=n(t,i),C=function(e){let t=l(e.getAttribute("cx")||0),r=l(e.getAttribute("cy")||0),i=l(e.getAttribute("r")||0),n=new eT.Path;n.absarc(t,r,i,0,2*Math.PI);let a=new eT.ShapePath;return a.subPaths.push(n),a}(t);break;case"ellipse":i=n(t,i),C=function(e){let t=l(e.getAttribute("cx")||0),r=l(e.getAttribute("cy")||0),i=l(e.getAttribute("rx")||0),n=l(e.getAttribute("ry")||0),a=new eT.Path;a.absellipse(t,r,i,n,0,2*Math.PI);let o=new eT.ShapePath;return o.subPaths.push(a),o}(t);break;case"line":i=n(t,i),C=function(e){let t=l(e.getAttribute("x1")||0),r=l(e.getAttribute("y1")||0),i=l(e.getAttribute("x2")||0),n=l(e.getAttribute("y2")||0),a=new eT.ShapePath;return a.moveTo(t,r),a.lineTo(i,n),a.currentPath.autoClose=!1,a}(t);break;case"defs":s=!0;break;case"use":i=n(t,i);let B=(t.getAttributeNS("http://www.w3.org/1999/xlink","href")||"").substring(1),w=t.viewportElement.getElementById(B);w?e(w,i):console.warn("SVGLoader: 'use node' references non-existent node id: "+B)}C&&(void 0!==i.fill&&"none"!==i.fill&&C.color.setStyle(i.fill,"srgb"),function(e,t){function r(e){E.set(e.x,e.y,1).applyMatrix3(t),e.set(E.x,E.y)}let i=e.subPaths;for(let e=0,n=i.length;e<n;e++){let n=i[e].curves;for(let e=0;e<n.length;e++){let i=n[e];i.isLineCurve?(r(i.v1),r(i.v2)):i.isCubicBezierCurve?(r(i.v0),r(i.v1),r(i.v2),r(i.v3)):i.isQuadraticBezierCurve?(r(i.v0),r(i.v1),r(i.v2)):i.isEllipseCurve&&(v.set(i.aX,i.aY),r(v),i.aX=v.x,i.aY=v.y,function(e){let t=e.elements,r=t[0]*t[3]+t[1]*t[4];return 0!==r&&Math.abs(r/(u(e)*h(e)))>Number.EPSILON}(t)?function(e){let r=e.xRadius,i=e.yRadius,n=Math.cos(e.aRotation),a=Math.sin(e.aRotation),o=new eT.Vector3(r*n,r*a,0),s=new eT.Vector3(-i*a,i*n,0),l=o.applyMatrix3(t),u=s.applyMatrix3(t),h=m.set(l.x,u.x,0,l.y,u.y,0,0,0,1),A=p.copy(h).invert(),d=g.copy(A).transpose().multiply(A).elements,f=function(e,t,r){let i,n,a,o,s;let l=e+r,c=e-r,u=Math.sqrt(c*c+4*t*t);return l>0?n=e*(s=1/(i=.5*(l+u)))*r-t*s*t:l<0?n=.5*(l-u):(i=.5*u,n=-.5*u),Math.abs(a=c>0?c+u:c-u)>2*Math.abs(t)?(o=1/Math.sqrt(1+(s=-2*t/a)*s),a=s*o):0===Math.abs(t)?(a=1,o=0):(a=1/Math.sqrt(1+(s=-.5*a/t)*s),o=s*a),c>0&&(s=a,a=-o,o=s),{rt1:i,rt2:n,cs:a,sn:o}}(d[0],d[1],d[4]),y=Math.sqrt(f.rt1),v=Math.sqrt(f.rt2);if(e.xRadius=1/y,e.yRadius=1/v,e.aRotation=Math.atan2(f.sn,f.cs),!((e.aEndAngle-e.aStartAngle)%(2*Math.PI)<Number.EPSILON)){let r=p.set(y,0,0,0,v,0,0,0,1),i=g.set(f.cs,f.sn,0,-f.sn,f.cs,0,0,0,1),n=r.multiply(i).multiply(h),a=e=>{let{x:t,y:r}=new eT.Vector3(Math.cos(e),Math.sin(e),0).applyMatrix3(n);return Math.atan2(r,t)};e.aStartAngle=a(e.aStartAngle),e.aEndAngle=a(e.aEndAngle),c(t)&&(e.aClockwise=!e.aClockwise)}}(i):function(e){let r=u(t),i=h(t);e.xRadius*=r,e.yRadius*=i;let n=r>Number.EPSILON?Math.atan2(t.elements[1],t.elements[0]):Math.atan2(-t.elements[3],t.elements[4]);e.aRotation+=n,c(t)&&(e.aStartAngle*=-1,e.aEndAngle*=-1,e.aClockwise=!e.aClockwise)}(i))}}}(C,x),A.push(C),C.userData={node:t,style:i});let I=t.childNodes;for(let t=0;t<I.length;t++){let r=I[t];s&&"style"!==r.nodeName&&"defs"!==r.nodeName||e(r,i)}o&&(f.pop(),f.length>0?x.copy(f[f.length-1]):x.identity())}(C.documentElement,{fill:"#000",fillOpacity:1,strokeOpacity:1,strokeWidth:1,strokeLineJoin:"miter",strokeLineCap:"butt",strokeMiterLimit:4}),{paths:A,xml:C.documentElement}}static createShapes(e){let t={ORIGIN:0,DESTINATION:1,BETWEEN:2,LEFT:3,RIGHT:4,BEHIND:5,BEYOND:6},r={loc:t.ORIGIN,t:0};function i(e,i,n){let a=n.x-i.x,o=n.y-i.y,s=e.x-i.x,l=e.y-i.y,c=a*l-s*o;if(e.x===i.x&&e.y===i.y){r.loc=t.ORIGIN,r.t=0;return}if(e.x===n.x&&e.y===n.y){r.loc=t.DESTINATION,r.t=1;return}if(c<-Number.EPSILON){r.loc=t.LEFT;return}if(c>Number.EPSILON){r.loc=t.RIGHT;return}if(a*s<0||o*l<0){r.loc=t.BEHIND;return}if(Math.sqrt(a*a+o*o)<Math.sqrt(s*s+l*l)){r.loc=t.BEYOND;return}r.loc=t.BETWEEN,r.t=0!==a?s/a:l/o}let n=999999999,a=-999999999,o=e.subPaths.map(e=>{let t=e.getPoints(),r=-999999999,i=999999999,o=-999999999,s=999999999;for(let e=0;e<t.length;e++){let n=t[e];n.y>r&&(r=n.y),n.y<i&&(i=n.y),n.x>o&&(o=n.x),n.x<s&&(s=n.x)}return a<=o&&(a=o+1),n>=s&&(n=s-1),{curves:e.curves,points:t,isCW:eT.ShapeUtils.isClockWise(t),identifier:-1,boundingBox:new eT.Box2(new eT.Vector2(s,i),new eT.Vector2(o,r))}});o=o.filter(e=>e.points.length>1);for(let e=0;e<o.length;e++)o[e].identifier=e;let s=o.map(s=>(function(e,n,a,o,s){(null==s||""===s)&&(s="nonzero");let l=new eT.Vector2;e.boundingBox.getCenter(l);let c=function(e,n,a){let o=new eT.Vector2;n.getCenter(o);let s=[];return a.forEach(n=>{n.boundingBox.containsPoint(o)&&(function(e,n){let a=[],o=[];for(let s=1;s<e.length;s++){let l=e[s-1],c=e[s];for(let e=1;e<n.length;e++){let s=function(e,n,a,o){let s=e.x,l=n.x,c=a.x,u=o.x,h=e.y,A=n.y,d=a.y,f=o.y,m=(u-c)*(h-d)-(f-d)*(s-c),p=(f-d)*(l-s)-(u-c)*(A-h),g=m/p,y=((l-s)*(h-d)-(A-h)*(s-c))/p;if(0===p&&0!==m||g<=0||g>=1||y<0||y>1)return null;if(0===m&&0===p){for(let c=0;c<2;c++){if(i(0===c?a:o,e,n),r.loc==t.ORIGIN){let e=0===c?a:o;return{x:e.x,y:e.y,t:r.t}}if(r.loc==t.BETWEEN)return{x:+(s+r.t*(l-s)).toPrecision(10),y:+(h+r.t*(A-h)).toPrecision(10),t:r.t}}return null}for(let s=0;s<2;s++)if(i(0===s?a:o,e,n),r.loc==t.ORIGIN){let e=0===s?a:o;return{x:e.x,y:e.y,t:r.t}}return{x:+(s+g*(l-s)).toPrecision(10),y:+(h+g*(A-h)).toPrecision(10),t:g}}(l,c,n[e-1],n[e]);null!==s&&void 0===a.find(e=>e.t<=s.t+Number.EPSILON&&e.t>=s.t-Number.EPSILON)&&(a.push(s),o.push(new eT.Vector2(s.x,s.y)))}}return o})(e,n.points).forEach(e=>{s.push({identifier:n.identifier,isCW:n.isCW,point:e})})}),s.sort((e,t)=>e.point.x-t.point.x),s}([new eT.Vector2(a,l.y),new eT.Vector2(o,l.y)],e.boundingBox,n);c.sort((e,t)=>e.point.x-t.point.x);let u=[],h=[];c.forEach(t=>{t.identifier===e.identifier?u.push(t):h.push(t)});let A=u[0].point.x,d=[],f=0;for(;f<h.length&&h[f].point.x<A;)d.length>0&&d[d.length-1]===h[f].identifier?d.pop():d.push(h[f].identifier),f++;if(d.push(e.identifier),"evenodd"===s){let t=d.length%2==0,r=d[d.length-2];return{identifier:e.identifier,isHole:t,for:r}}if("nonzero"===s){let t=!0,r=null,i=null;for(let e=0;e<d.length;e++){let a=d[e];t?(i=n[a].isCW,t=!1,r=a):i!==n[a].isCW&&(i=n[a].isCW,t=!0)}return{identifier:e.identifier,isHole:t,for:r}}console.warn('fill-rule: "'+s+'" is currently not implemented.')})(s,o,n,a,e.userData?e.userData.style.fillRule:void 0)),l=[];return o.forEach(e=>{if(!s[e.identifier].isHole){let t=new eT.Shape;t.curves=e.curves,s.filter(t=>t.isHole&&t.for===e.identifier).forEach(e=>{let r=o[e.identifier],i=new eT.Path;i.curves=r.curves,t.holes.push(i)}),l.push(t)}}),l}static getStrokeStyle(e,t,r,i,n){return{strokeColor:t=void 0!==t?t:"#000",strokeWidth:e=void 0!==e?e:1,strokeLineJoin:r=void 0!==r?r:"miter",strokeLineCap:i=void 0!==i?i:"butt",strokeMiterLimit:n=void 0!==n?n:4}}static pointsToStroke(t,r,i,n){let a=[],o=[],s=[];if(0===e.pointsToStrokeWithBuffers(t,r,i,n,a,o,s))return null;let l=new eT.BufferGeometry;return l.setAttribute("position",new eT.Float32BufferAttribute(a,3)),l.setAttribute("normal",new eT.Float32BufferAttribute(o,3)),l.setAttribute("uv",new eT.Float32BufferAttribute(s,2)),l}static pointsToStrokeWithBuffers(e,t,r,i,n,a,o,s){let l,c,u,h,A;let d=new eT.Vector2,f=new eT.Vector2,m=new eT.Vector2,p=new eT.Vector2,g=new eT.Vector2,y=new eT.Vector2,v=new eT.Vector2,E=new eT.Vector2,x=new eT.Vector2,C=new eT.Vector2,B=new eT.Vector2,w=new eT.Vector2,I=new eT.Vector2,b=new eT.Vector2,_=new eT.Vector2,M=new eT.Vector2,S=new eT.Vector2;r=void 0!==r?r:12,i=void 0!==i?i:.001,s=void 0!==s?s:0;let D=(e=function(e){let t=!1;for(let r=1,n=e.length-1;r<n;r++)if(e[r].distanceTo(e[r+1])<i){t=!0;break}if(!t)return e;let r=[];r.push(e[0]);for(let t=1,n=e.length-1;t<n;t++)e[t].distanceTo(e[t+1])>=i&&r.push(e[t]);return r.push(e[e.length-1]),r}(e)).length;if(D<2)return 0;let T=e[0].equals(e[D-1]),R=e[0],F=t.strokeWidth/2,P=1/(D-1),Q=0,z,L=!1,O=0,U=3*s,k=2*s;G(e[0],e[1],d).multiplyScalar(F),E.copy(e[0]).sub(d),x.copy(e[0]).add(d),C.copy(E),B.copy(x);for(let r=1;r<D;r++){if(l=e[r],c=r===D-1?T?e[1]:void 0:e[r+1],G(R,l,d),m.copy(d).multiplyScalar(F),w.copy(l).sub(m),I.copy(l).add(m),z=Q+P,u=!1,void 0!==c){G(l,c,f),m.copy(f).multiplyScalar(F),b.copy(l).sub(m),_.copy(l).add(m),h=!0,m.subVectors(c,R),0>d.dot(m)&&(h=!1),1===r&&(L=h),m.subVectors(c,l),m.normalize();let e=Math.abs(d.dot(m));if(e>Number.EPSILON){let r=F/e;m.multiplyScalar(-r),p.subVectors(l,R),g.copy(p).setLength(r).add(m),M.copy(g).negate();let i=g.length(),n=p.length();p.divideScalar(n),y.subVectors(c,l);let a=y.length();switch(y.divideScalar(a),p.dot(M)<n&&y.dot(M)<a&&(u=!0),S.copy(g).add(l),M.add(l),A=!1,u?h?(_.copy(M),I.copy(M)):(b.copy(M),w.copy(M)):V(),t.strokeLineJoin){case"bevel":j(h,u,z);break;case"round":J(h,u),h?H(l,w,b,z,0):H(l,_,I,z,1);break;default:let o=F*t.strokeMiterLimit/i;o<1?"miter-clip"!==t.strokeLineJoin?j(h,u,z):(J(h,u),h?(y.subVectors(S,w).multiplyScalar(o).add(w),v.subVectors(S,b).multiplyScalar(o).add(b),N(w,z,0),N(y,z,0),N(l,z,.5),N(l,z,.5),N(y,z,0),N(v,z,0),N(l,z,.5),N(v,z,0),N(b,z,0)):(y.subVectors(S,I).multiplyScalar(o).add(I),v.subVectors(S,_).multiplyScalar(o).add(_),N(I,z,1),N(y,z,1),N(l,z,.5),N(l,z,.5),N(y,z,1),N(v,z,1),N(l,z,.5),N(v,z,1),N(_,z,1))):(u?(h?(N(x,Q,1),N(E,Q,0),N(S,z,0),N(x,Q,1),N(S,z,0),N(M,z,1)):(N(x,Q,1),N(E,Q,0),N(S,z,1),N(E,Q,0),N(M,z,0),N(S,z,1)),h?b.copy(S):_.copy(S)):h?(N(w,z,0),N(S,z,0),N(l,z,.5),N(l,z,.5),N(S,z,0),N(b,z,0)):(N(I,z,1),N(S,z,1),N(l,z,.5),N(l,z,.5),N(S,z,1),N(_,z,1)),A=!0)}}else V()}else V();T||r!==D-1||Y(e[0],C,B,h,!0,Q),Q=z,R=l,E.copy(b),x.copy(_)}if(T){if(u&&n){let e=S,t=M;L!==h&&(e=M,t=S),h?(A||L)&&(t.toArray(n,0),t.toArray(n,9),A&&e.toArray(n,3)):(A||!L)&&(t.toArray(n,3),t.toArray(n,9),A&&e.toArray(n,0))}}else Y(l,w,I,h,!1,z);return O;function G(e,t,r){return r.subVectors(t,e),r.set(-r.y,r.x).normalize()}function N(e,t,r){n&&(n[U]=e.x,n[U+1]=e.y,n[U+2]=0,a&&(a[U]=0,a[U+1]=0,a[U+2]=1),U+=3,o&&(o[k]=t,o[k+1]=r,k+=2)),O+=3}function H(e,t,i,n,a){d.copy(t).sub(e).normalize(),f.copy(i).sub(e).normalize();let o=Math.PI,s=d.dot(f);1>Math.abs(s)&&(o=Math.abs(Math.acos(s))),o/=r,m.copy(t);for(let t=0,i=r-1;t<i;t++)p.copy(m).rotateAround(e,o),N(m,n,a),N(p,n,a),N(e,n,.5),m.copy(p);N(p,n,a),N(i,n,a),N(e,n,.5)}function V(){N(x,Q,1),N(E,Q,0),N(w,z,0),N(x,Q,1),N(w,z,0),N(I,z,1)}function j(e,t,r){t?e?(N(x,Q,1),N(E,Q,0),N(w,z,0),N(x,Q,1),N(w,z,0),N(M,z,1),N(w,r,0),N(b,r,0),N(M,r,.5)):(N(x,Q,1),N(E,Q,0),N(I,z,1),N(E,Q,0),N(M,z,0),N(I,z,1),N(I,r,1),N(M,r,0),N(_,r,1)):(e?(N(w,r,0),N(b,r,0)):(N(I,r,1),N(_,r,0)),N(l,r,.5))}function J(e,t){t&&(e?(N(x,Q,1),N(E,Q,0),N(w,z,0),N(x,Q,1),N(w,z,0),N(M,z,1),N(w,Q,0),N(l,z,.5),N(M,z,1),N(l,z,.5),N(b,Q,0),N(M,z,1)):(N(x,Q,1),N(E,Q,0),N(I,z,1),N(E,Q,0),N(M,z,0),N(I,z,1),N(I,Q,1),N(M,z,0),N(l,z,.5),N(l,z,.5),N(M,z,0),N(_,Q,1)))}function Y(e,r,i,a,s,l){switch(t.strokeLineCap){case"round":s?H(e,i,r,l,.5):H(e,r,i,l,.5);break;case"square":if(s)d.subVectors(r,e),f.set(d.y,-d.x),m.addVectors(d,f).add(e),p.subVectors(f,d).add(e),a?(m.toArray(n,3),p.toArray(n,0),p.toArray(n,9)):(m.toArray(n,3),1===o[7]?p.toArray(n,9):m.toArray(n,9),p.toArray(n,0));else{d.subVectors(i,e),f.set(d.y,-d.x),m.addVectors(d,f).add(e),p.subVectors(f,d).add(e);let t=n.length;a?(m.toArray(n,t-3),p.toArray(n,t-6)):(p.toArray(n,t-6),m.toArray(n,t-3)),p.toArray(n,t-12)}}}}}return e})(),lo=(0,eS.forwardRef)(function({src:e,skipFill:t,skipStrokes:r,fillMaterial:i,strokeMaterial:n,fillMeshProps:a,strokeMeshProps:o,...s},l){let c=(0,eR.H)(la,e.startsWith("<svg")?`data:image/svg+xml;utf8,${e}`:e),u=(0,eS.useMemo)(()=>r?[]:c.paths.map(e=>{var t;return(null==(t=e.userData)?void 0:t.style.stroke)===void 0||"none"===e.userData.style.stroke?null:e.subPaths.map(t=>la.pointsToStroke(t.getPoints(),e.userData.style))}),[c,r]);(0,eS.useEffect)(()=>()=>u.forEach(e=>e&&e.map(e=>e.dispose())),[u]);let h=0;return eS.createElement("object3D",j({ref:l},s),eS.createElement("object3D",{scale:[1,-1,1]},c.paths.map((e,s)=>{var l,c;return eS.createElement(eS.Fragment,{key:s},!t&&(null==(l=e.userData)?void 0:l.style.fill)!==void 0&&"none"!==e.userData.style.fill&&la.createShapes(e).map((t,r)=>eS.createElement("mesh",j({key:r},a,{renderOrder:h++}),eS.createElement("shapeGeometry",{args:[t]}),eS.createElement("meshBasicMaterial",j({color:e.userData.style.fill,opacity:e.userData.style.fillOpacity,transparent:!0,side:eT.DoubleSide,depthWrite:!1},i)))),!r&&(null==(c=e.userData)?void 0:c.style.stroke)!==void 0&&"none"!==e.userData.style.stroke&&e.subPaths.map((t,r)=>eS.createElement("mesh",j({key:r,geometry:u[s][r]},o,{renderOrder:h++}),eS.createElement("meshBasicMaterial",j({color:e.userData.style.stroke,opacity:e.userData.style.strokeOpacity,transparent:!0,side:eT.DoubleSide,depthWrite:!1},n)))))})))}),ls=new WeakMap;class ll extends eT.Loader{constructor(e){super(e),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}setDecoderPath(e){return this.decoderPath=e,this}setDecoderConfig(e){return this.decoderConfig=e,this}setWorkerLimit(e){return this.workerLimit=e,this}load(e,t,r,i){let n=new eT.FileLoader(this.manager);n.setPath(this.path),n.setResponseType("arraybuffer"),n.setRequestHeader(this.requestHeader),n.setWithCredentials(this.withCredentials),n.load(e,e=>{let r={attributeIDs:this.defaultAttributeIDs,attributeTypes:this.defaultAttributeTypes,useUniqueIDs:!1};this.decodeGeometry(e,r).then(t).catch(i)},r,i)}decodeDracoFile(e,t,r,i){let n={attributeIDs:r||this.defaultAttributeIDs,attributeTypes:i||this.defaultAttributeTypes,useUniqueIDs:!!r};this.decodeGeometry(e,n).then(t)}decodeGeometry(e,t){let r;for(let e in t.attributeTypes){let r=t.attributeTypes[e];void 0!==r.BYTES_PER_ELEMENT&&(t.attributeTypes[e]=r.name)}let i=JSON.stringify(t);if(ls.has(e)){let t=ls.get(e);if(t.key===i)return t.promise;if(0===e.byteLength)throw Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}let n=this.workerNextTaskID++,a=e.byteLength,o=this._getWorker(n,a).then(i=>(r=i,new Promise((i,a)=>{r._callbacks[n]={resolve:i,reject:a},r.postMessage({type:"decode",id:n,taskConfig:t,buffer:e},[e])}))).then(e=>this._createGeometry(e.geometry));return o.catch(()=>!0).then(()=>{r&&n&&this._releaseTask(r,n)}),ls.set(e,{key:i,promise:o}),o}_createGeometry(e){let t=new eT.BufferGeometry;e.index&&t.setIndex(new eT.BufferAttribute(e.index.array,1));for(let r=0;r<e.attributes.length;r++){let i=e.attributes[r],n=i.name,a=i.array,o=i.itemSize;t.setAttribute(n,new eT.BufferAttribute(a,o))}return t}_loadLibrary(e,t){let r=new eT.FileLoader(this.manager);return r.setPath(this.decoderPath),r.setResponseType(t),r.setWithCredentials(this.withCredentials),new Promise((t,i)=>{r.load(e,t,void 0,i)})}preload(){return this._initDecoder(),this}_initDecoder(){if(this.decoderPending)return this.decoderPending;let e="object"!=typeof WebAssembly||"js"===this.decoderConfig.type,t=[];return e?t.push(this._loadLibrary("draco_decoder.js","text")):(t.push(this._loadLibrary("draco_wasm_wrapper.js","text")),t.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(t).then(t=>{let r=t[0];e||(this.decoderConfig.wasmBinary=t[1]);let i=lc.toString(),n=["/* draco decoder */",r,"","/* worker */",i.substring(i.indexOf("{")+1,i.lastIndexOf("}"))].join("\n");this.workerSourceURL=URL.createObjectURL(new Blob([n]))}),this.decoderPending}_getWorker(e,t){return this._initDecoder().then(()=>{if(this.workerPool.length<this.workerLimit){let e=new Worker(this.workerSourceURL);e._callbacks={},e._taskCosts={},e._taskLoad=0,e.postMessage({type:"init",decoderConfig:this.decoderConfig}),e.onmessage=function(t){let r=t.data;switch(r.type){case"decode":e._callbacks[r.id].resolve(r);break;case"error":e._callbacks[r.id].reject(r);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+r.type+'"')}},this.workerPool.push(e)}else this.workerPool.sort(function(e,t){return e._taskLoad>t._taskLoad?-1:1});let r=this.workerPool[this.workerPool.length-1];return r._taskCosts[e]=t,r._taskLoad+=t,r})}_releaseTask(e,t){e._taskLoad-=e._taskCosts[t],delete e._callbacks[t],delete e._taskCosts[t]}debug(){console.log("Task load: ",this.workerPool.map(e=>e._taskLoad))}dispose(){for(let e=0;e<this.workerPool.length;++e)this.workerPool[e].terminate();return this.workerPool.length=0,this}}function lc(){let e,t;onmessage=function(r){let i=r.data;switch(i.type){case"init":e=i.decoderConfig,t=new Promise(function(t){e.onModuleLoaded=function(e){t({draco:e})},DracoDecoderModule(e)});break;case"decode":let n=i.buffer,a=i.taskConfig;t.then(e=>{let t=e.draco,r=new t.Decoder,o=new t.DecoderBuffer;o.Init(new Int8Array(n),n.byteLength);try{let e=function(e,t,r,i){let n,a;let o=i.attributeIDs,s=i.attributeTypes,l=t.GetEncodedGeometryType(r);if(l===e.TRIANGULAR_MESH)n=new e.Mesh,a=t.DecodeBufferToMesh(r,n);else if(l===e.POINT_CLOUD)n=new e.PointCloud,a=t.DecodeBufferToPointCloud(r,n);else throw Error("THREE.DRACOLoader: Unexpected geometry type.");if(!a.ok()||0===n.ptr)throw Error("THREE.DRACOLoader: Decoding failed: "+a.error_msg());let c={index:null,attributes:[]};for(let r in o){let a,l;let u=self[s[r]];if(i.useUniqueIDs)l=o[r],a=t.GetAttributeByUniqueId(n,l);else{if(-1===(l=t.GetAttributeId(n,e[o[r]])))continue;a=t.GetAttribute(n,l)}c.attributes.push(function(e,t,r,i,n,a){let o=a.num_components(),s=r.num_points()*o,l=s*n.BYTES_PER_ELEMENT,c=function(e,t){switch(t){case Float32Array:return e.DT_FLOAT32;case Int8Array:return e.DT_INT8;case Int16Array:return e.DT_INT16;case Int32Array:return e.DT_INT32;case Uint8Array:return e.DT_UINT8;case Uint16Array:return e.DT_UINT16;case Uint32Array:return e.DT_UINT32}}(e,n),u=e._malloc(l);t.GetAttributeDataArrayForAllPoints(r,a,c,l,u);let h=new n(e.HEAPF32.buffer,u,s).slice();return e._free(u),{name:i,array:h,itemSize:o}}(e,t,n,r,u,a))}return l===e.TRIANGULAR_MESH&&(c.index=function(e,t,r){let i=3*r.num_faces(),n=4*i,a=e._malloc(n);t.GetTrianglesUInt32Array(r,n,a);let o=new Uint32Array(e.HEAPF32.buffer,a,i).slice();return e._free(a),{array:o,itemSize:1}}(e,t,n)),e.destroy(n),c}(t,r,o,a),n=e.attributes.map(e=>e.array.buffer);e.index&&n.push(e.index.array.buffer),self.postMessage({type:"decode",id:i.id,geometry:e},n)}catch(e){console.error(e),self.postMessage({type:"error",id:i.id,error:e.message})}finally{t.destroy(o),t.destroy(r)}})}}}let lu=()=>{let e;if(a)return a;let t=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]),r=new Uint8Array([32,0,65,253,3,1,2,34,4,106,6,5,11,8,7,20,13,33,12,16,128,9,116,64,19,113,127,15,10,21,22,14,255,66,24,54,136,107,18,23,192,26,114,118,132,17,77,101,130,144,27,87,131,44,45,74,156,154,70,167]);if("object"!=typeof WebAssembly)return{supported:!1};let i="B9h9z9tFBBBF8fL9gBB9gLaaaaaFa9gEaaaB9gFaFa9gEaaaFaEMcBFFFGGGEIIILF9wFFFLEFBFKNFaFCx/IFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBF8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBGy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBEn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBIi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBKI9z9iqlBOc+x8ycGBM/qQFTa8jUUUUBCU/EBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAGTkUUUBRNCUoBAG9uC/wgBZHKCUGAKCUG9JyRVAECFJRICBRcGXEXAcAF9PQFAVAFAclAcAVJAF9JyRMGXGXAG9FQBAMCbJHKC9wZRSAKCIrCEJCGrRQANCUGJRfCBRbAIRTEXGXAOATlAQ9PQBCBRISEMATAQJRIGXAS9FQBCBRtCBREEXGXAOAIlCi9PQBCBRISLMANCU/CBJAEJRKGXGXGXGXGXATAECKrJ2BBAtCKZrCEZfIBFGEBMAKhB83EBAKCNJhB83EBSEMAKAI2BIAI2BBHmCKrHYAYCE6HYy86BBAKCFJAICIJAYJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCGJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCEJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCIJAYAmJHY2BBAI2BFHmCKrHPAPCE6HPy86BBAKCLJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCKJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCOJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCNJAYAmJHY2BBAI2BGHmCKrHPAPCE6HPy86BBAKCVJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCcJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCMJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCSJAYAmJHm2BBAI2BEHICKrHYAYCE6HYy86BBAKCQJAmAYJHm2BBAICIrCEZHYAYCE6HYy86BBAKCfJAmAYJHm2BBAICGrCEZHYAYCE6HYy86BBAKCbJAmAYJHK2BBAICEZHIAICE6HIy86BBAKAIJRISGMAKAI2BNAI2BBHmCIrHYAYCb6HYy86BBAKCFJAICNJAYJHY2BBAmCbZHmAmCb6Hmy86BBAKCGJAYAmJHm2BBAI2BFHYCIrHPAPCb6HPy86BBAKCEJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCIJAmAYJHm2BBAI2BGHYCIrHPAPCb6HPy86BBAKCLJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCKJAmAYJHm2BBAI2BEHYCIrHPAPCb6HPy86BBAKCOJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCNJAmAYJHm2BBAI2BIHYCIrHPAPCb6HPy86BBAKCVJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCcJAmAYJHm2BBAI2BLHYCIrHPAPCb6HPy86BBAKCMJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCSJAmAYJHm2BBAI2BKHYCIrHPAPCb6HPy86BBAKCQJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCfJAmAYJHm2BBAI2BOHICIrHYAYCb6HYy86BBAKCbJAmAYJHK2BBAICbZHIAICb6HIy86BBAKAIJRISFMAKAI8pBB83BBAKCNJAICNJ8pBB83BBAICTJRIMAtCGJRtAECTJHEAS9JQBMMGXAIQBCBRISEMGXAM9FQBANAbJ2BBRtCBRKAfREEXAEANCU/CBJAKJ2BBHTCFrCBATCFZl9zAtJHt86BBAEAGJREAKCFJHKAM9HQBMMAfCFJRfAIRTAbCFJHbAG9HQBMMABAcAG9sJANCUGJAMAG9sTkUUUBpANANCUGJAMCaJAG9sJAGTkUUUBpMAMCBAIyAcJRcAIQBMC9+RKSFMCBC99AOAIlAGCAAGCA9Ly6yRKMALCU/EBJ8kUUUUBAKM+OmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUFT+JUUUBpALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM+lLKFaF99GaG99FaG99GXGXAGCI9HQBAF9FQFEXGXGX9DBBB8/9DBBB+/ABCGJHG1BB+yAB1BBHE+yHI+L+TABCFJHL1BBHK+yHO+L+THN9DBBBB9gHVyAN9DBB/+hANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE86BBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG86BBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG86BBABCIJRBAFCaJHFQBSGMMAF9FQBEXGXGX9DBBB8/9DBBB+/ABCIJHG8uFB+yAB8uFBHE+yHI+L+TABCGJHL8uFBHK+yHO+L+THN9DBBBB9gHVyAN9DB/+g6ANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE87FBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG87FBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG87FBABCNJRBAFCaJHFQBMMM/SEIEaE99EaF99GXAF9FQBCBREABRIEXGXGX9D/zI818/AICKJ8uFBHLCEq+y+VHKAI8uFB+y+UHO9DB/+g6+U9DBBB8/9DBBB+/AO9DBBBB9gy+SHN+L9DBBB9P9d9FQBAN+oRVSFMCUUUU94RVMAICIJ8uFBRcAICGJ8uFBRMABALCFJCEZAEqCFWJAV87FBGXGXAKAM+y+UHN9DB/+g6+U9DBBB8/9DBBB+/AN9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRMSFMCUUUU94RMMABALCGJCEZAEqCFWJAM87FBGXGXAKAc+y+UHK9DB/+g6+U9DBBB8/9DBBB+/AK9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRcSFMCUUUU94RcMABALCaJCEZAEqCFWJAc87FBGXGX9DBBU8/AOAO+U+TANAN+U+TAKAK+U+THO9DBBBBAO9DBBBB9gy+R9DB/+g6+U9DBBB8/+SHO+L9DBBB9P9d9FQBAO+oRcSFMCUUUU94RcMABALCEZAEqCFWJAc87FBAICNJRIAECIJREAFCaJHFQBMMM9JBGXAGCGrAF9sHF9FQBEXABAB8oGBHGCNWCN91+yAGCi91CnWCUUU/8EJ+++U84GBABCIJRBAFCaJHFQBMMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEM/lFFFaGXGXAFABqCEZ9FQBABRESFMGXGXAGCT9PQBABRESFMABREEXAEAF8oGBjGBAECIJAFCIJ8oGBjGBAECNJAFCNJ8oGBjGBAECSJAFCSJ8oGBjGBAECTJREAFCTJRFAGC9wJHGCb9LQBMMAGCI9JQBEXAEAF8oGBjGBAFCIJRFAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF2BB86BBAECFJREAFCFJRFAGCaJHGQBMMABMoFFGaGXGXABCEZ9FQBABRESFMAFCgFZC+BwsN9sRIGXGXAGCT9PQBABRESFMABREEXAEAIjGBAECSJAIjGBAECNJAIjGBAECIJAIjGBAECTJREAGC9wJHGCb9LQBMMAGCI9JQBEXAEAIjGBAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF86BBAECFJREAGCaJHGQBMMABMMMFBCUNMIT9kBB";WebAssembly.validate(t)&&(i="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");let n=WebAssembly.instantiate(function(e){let t=new Uint8Array(e.length);for(let r=0;r<e.length;++r){let i=e.charCodeAt(r);t[r]=i>96?i-71:i>64?i-65:i>47?i+4:i>46?63:62}let i=0;for(let n=0;n<e.length;++n)t[i++]=t[n]<60?r[t[n]]:(t[n]-60)*64+t[++n];return t.buffer.slice(0,i)}(i),{}).then(t=>{(e=t.instance).exports.__wasm_call_ctors()});function o(t,r,i,n,a,o){let s=e.exports.sbrk,l=i+3&-4,c=s(l*n),u=s(a.length),h=new Uint8Array(e.exports.memory.buffer);h.set(a,u);let A=t(c,i,n,u,a.length);if(0===A&&o&&o(c,l,n),r.set(h.subarray(c,c+i*n)),s(c-s(0)),0!==A)throw Error(`Malformed buffer data: ${A}`)}let s={0:"",1:"meshopt_decodeFilterOct",2:"meshopt_decodeFilterQuat",3:"meshopt_decodeFilterExp",NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},l={0:"meshopt_decodeVertexBuffer",1:"meshopt_decodeIndexBuffer",2:"meshopt_decodeIndexSequence",ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return a={ready:n,supported:!0,decodeVertexBuffer(t,r,i,n,a){o(e.exports.meshopt_decodeVertexBuffer,t,r,i,n,e.exports[s[a]])},decodeIndexBuffer(t,r,i,n){o(e.exports.meshopt_decodeIndexBuffer,t,r,i,n)},decodeIndexSequence(t,r,i,n){o(e.exports.meshopt_decodeIndexSequence,t,r,i,n)},decodeGltfBuffer(t,r,i,n,a,c){o(e.exports[l[a]],t,r,i,n,e.exports[s[c]])}}};function lh(e){if("undefined"!=typeof TextDecoder)return new TextDecoder().decode(e);let t="";for(let r=0,i=e.length;r<i;r++)t+=String.fromCharCode(e[r]);try{return decodeURIComponent(escape(t))}catch(e){return t}}let lA="srgb",ld="srgb-linear";class lf extends eT.Loader{constructor(e){super(e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(e){return new lE(e)}),this.register(function(e){return new lx(e)}),this.register(function(e){return new lD(e)}),this.register(function(e){return new lT(e)}),this.register(function(e){return new lR(e)}),this.register(function(e){return new lB(e)}),this.register(function(e){return new lw(e)}),this.register(function(e){return new lI(e)}),this.register(function(e){return new lb(e)}),this.register(function(e){return new lv(e)}),this.register(function(e){return new l_(e)}),this.register(function(e){return new lC(e)}),this.register(function(e){return new lS(e)}),this.register(function(e){return new lM(e)}),this.register(function(e){return new lg(e)}),this.register(function(e){return new lF(e)}),this.register(function(e){return new lP(e)})}load(e,t,r,i){let n;let a=this;if(""!==this.resourcePath)n=this.resourcePath;else if(""!==this.path){let t=eT.LoaderUtils.extractUrlBase(e);n=eT.LoaderUtils.resolveURL(t,this.path)}else n=eT.LoaderUtils.extractUrlBase(e);this.manager.itemStart(e);let o=function(t){i?i(t):console.error(t),a.manager.itemError(e),a.manager.itemEnd(e)},s=new eT.FileLoader(this.manager);s.setPath(this.path),s.setResponseType("arraybuffer"),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials),s.load(e,function(r){try{a.parse(r,n,function(r){t(r),a.manager.itemEnd(e)},o)}catch(e){o(e)}},r,o)}setDRACOLoader(e){return this.dracoLoader=e,this}setDDSLoader(){throw Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return -1===this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.push(e),this}unregister(e){return -1!==this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,r,i){let n;let a={},o={};if("string"==typeof e)n=JSON.parse(e);else if(e instanceof ArrayBuffer){if(lh(new Uint8Array(e.slice(0,4)))===lQ){try{a[lp.KHR_BINARY_GLTF]=new lL(e)}catch(e){i&&i(e);return}n=JSON.parse(a[lp.KHR_BINARY_GLTF].content)}else n=JSON.parse(lh(new Uint8Array(e)))}else n=e;if(void 0===n.asset||n.asset.version[0]<2){i&&i(Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));return}let s=new l4(n,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});s.fileLoader.setRequestHeader(this.requestHeader);for(let e=0;e<this.pluginCallbacks.length;e++){let t=this.pluginCallbacks[e](s);t.name||console.error("THREE.GLTFLoader: Invalid plugin found: missing name"),o[t.name]=t,a[t.name]=!0}if(n.extensionsUsed)for(let e=0;e<n.extensionsUsed.length;++e){let t=n.extensionsUsed[e],r=n.extensionsRequired||[];switch(t){case lp.KHR_MATERIALS_UNLIT:a[t]=new ly;break;case lp.KHR_DRACO_MESH_COMPRESSION:a[t]=new lO(n,this.dracoLoader);break;case lp.KHR_TEXTURE_TRANSFORM:a[t]=new lU;break;case lp.KHR_MESH_QUANTIZATION:a[t]=new lk;break;default:r.indexOf(t)>=0&&void 0===o[t]&&console.warn('THREE.GLTFLoader: Unknown extension "'+t+'".')}}s.setExtensions(a),s.setPlugins(o),s.parse(r,i)}parseAsync(e,t){let r=this;return new Promise(function(i,n){r.parse(e,t,i,n)})}}function lm(){let e={};return{get:function(t){return e[t]},add:function(t,r){e[t]=r},remove:function(t){delete e[t]},removeAll:function(){e={}}}}let lp={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_DISPERSION:"KHR_materials_dispersion",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_ANISOTROPY:"KHR_materials_anisotropy",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_MATERIALS_BUMP:"EXT_materials_bump",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};class lg{constructor(e){this.parser=e,this.name=lp.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){let e=this.parser,t=this.parser.json.nodes||[];for(let r=0,i=t.length;r<i;r++){let i=t[r];i.extensions&&i.extensions[this.name]&&void 0!==i.extensions[this.name].light&&e._addNodeRef(this.cache,i.extensions[this.name].light)}}_loadLight(e){let t;let r=this.parser,i="light:"+e,n=r.cache.get(i);if(n)return n;let a=r.json,o=((a.extensions&&a.extensions[this.name]||{}).lights||[])[e],s=new eT.Color(16777215);void 0!==o.color&&s.setRGB(o.color[0],o.color[1],o.color[2],ld);let l=void 0!==o.range?o.range:0;switch(o.type){case"directional":(t=new eT.DirectionalLight(s)).target.position.set(0,0,-1),t.add(t.target);break;case"point":(t=new eT.PointLight(s)).distance=l;break;case"spot":(t=new eT.SpotLight(s)).distance=l,o.spot=o.spot||{},o.spot.innerConeAngle=void 0!==o.spot.innerConeAngle?o.spot.innerConeAngle:0,o.spot.outerConeAngle=void 0!==o.spot.outerConeAngle?o.spot.outerConeAngle:Math.PI/4,t.angle=o.spot.outerConeAngle,t.penumbra=1-o.spot.innerConeAngle/o.spot.outerConeAngle,t.target.position.set(0,0,-1),t.add(t.target);break;default:throw Error("THREE.GLTFLoader: Unexpected light type: "+o.type)}return t.position.set(0,0,0),t.decay=2,l1(t,o),void 0!==o.intensity&&(t.intensity=o.intensity),t.name=r.createUniqueName(o.name||"light_"+e),n=Promise.resolve(t),r.cache.add(i,n),n}getDependency(e,t){if("light"===e)return this._loadLight(t)}createNodeAttachment(e){let t=this,r=this.parser,i=r.json.nodes[e],n=(i.extensions&&i.extensions[this.name]||{}).light;return void 0===n?null:this._loadLight(n).then(function(e){return r._getNodeRef(t.cache,n,e)})}}class ly{constructor(){this.name=lp.KHR_MATERIALS_UNLIT}getMaterialType(){return eT.MeshBasicMaterial}extendParams(e,t,r){let i=[];e.color=new eT.Color(1,1,1),e.opacity=1;let n=t.pbrMetallicRoughness;if(n){if(Array.isArray(n.baseColorFactor)){let t=n.baseColorFactor;e.color.setRGB(t[0],t[1],t[2],ld),e.opacity=t[3]}void 0!==n.baseColorTexture&&i.push(r.assignTexture(e,"map",n.baseColorTexture,lA))}return Promise.all(i)}}class lv{constructor(e){this.parser=e,this.name=lp.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(e,t){let r=this.parser.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();let i=r.extensions[this.name].emissiveStrength;return void 0!==i&&(t.emissiveIntensity=i),Promise.resolve()}}class lE{constructor(e){this.parser=e,this.name=lp.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){let t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?eT.MeshPhysicalMaterial:null}extendMaterialParams(e,t){let r=this.parser,i=r.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();let n=[],a=i.extensions[this.name];if(void 0!==a.clearcoatFactor&&(t.clearcoat=a.clearcoatFactor),void 0!==a.clearcoatTexture&&n.push(r.assignTexture(t,"clearcoatMap",a.clearcoatTexture)),void 0!==a.clearcoatRoughnessFactor&&(t.clearcoatRoughness=a.clearcoatRoughnessFactor),void 0!==a.clearcoatRoughnessTexture&&n.push(r.assignTexture(t,"clearcoatRoughnessMap",a.clearcoatRoughnessTexture)),void 0!==a.clearcoatNormalTexture&&(n.push(r.assignTexture(t,"clearcoatNormalMap",a.clearcoatNormalTexture)),void 0!==a.clearcoatNormalTexture.scale)){let e=a.clearcoatNormalTexture.scale;t.clearcoatNormalScale=new eT.Vector2(e,e)}return Promise.all(n)}}class lx{constructor(e){this.parser=e,this.name=lp.KHR_MATERIALS_DISPERSION}getMaterialType(e){let t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?eT.MeshPhysicalMaterial:null}extendMaterialParams(e,t){let r=this.parser.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();let i=r.extensions[this.name];return t.dispersion=void 0!==i.dispersion?i.dispersion:0,Promise.resolve()}}class lC{constructor(e){this.parser=e,this.name=lp.KHR_MATERIALS_IRIDESCENCE}getMaterialType(e){let t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?eT.MeshPhysicalMaterial:null}extendMaterialParams(e,t){let r=this.parser,i=r.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();let n=[],a=i.extensions[this.name];return void 0!==a.iridescenceFactor&&(t.iridescence=a.iridescenceFactor),void 0!==a.iridescenceTexture&&n.push(r.assignTexture(t,"iridescenceMap",a.iridescenceTexture)),void 0!==a.iridescenceIor&&(t.iridescenceIOR=a.iridescenceIor),void 0===t.iridescenceThicknessRange&&(t.iridescenceThicknessRange=[100,400]),void 0!==a.iridescenceThicknessMinimum&&(t.iridescenceThicknessRange[0]=a.iridescenceThicknessMinimum),void 0!==a.iridescenceThicknessMaximum&&(t.iridescenceThicknessRange[1]=a.iridescenceThicknessMaximum),void 0!==a.iridescenceThicknessTexture&&n.push(r.assignTexture(t,"iridescenceThicknessMap",a.iridescenceThicknessTexture)),Promise.all(n)}}class lB{constructor(e){this.parser=e,this.name=lp.KHR_MATERIALS_SHEEN}getMaterialType(e){let t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?eT.MeshPhysicalMaterial:null}extendMaterialParams(e,t){let r=this.parser,i=r.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();let n=[];t.sheenColor=new eT.Color(0,0,0),t.sheenRoughness=0,t.sheen=1;let a=i.extensions[this.name];if(void 0!==a.sheenColorFactor){let e=a.sheenColorFactor;t.sheenColor.setRGB(e[0],e[1],e[2],ld)}return void 0!==a.sheenRoughnessFactor&&(t.sheenRoughness=a.sheenRoughnessFactor),void 0!==a.sheenColorTexture&&n.push(r.assignTexture(t,"sheenColorMap",a.sheenColorTexture,lA)),void 0!==a.sheenRoughnessTexture&&n.push(r.assignTexture(t,"sheenRoughnessMap",a.sheenRoughnessTexture)),Promise.all(n)}}class lw{constructor(e){this.parser=e,this.name=lp.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){let t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?eT.MeshPhysicalMaterial:null}extendMaterialParams(e,t){let r=this.parser,i=r.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();let n=[],a=i.extensions[this.name];return void 0!==a.transmissionFactor&&(t.transmission=a.transmissionFactor),void 0!==a.transmissionTexture&&n.push(r.assignTexture(t,"transmissionMap",a.transmissionTexture)),Promise.all(n)}}class lI{constructor(e){this.parser=e,this.name=lp.KHR_MATERIALS_VOLUME}getMaterialType(e){let t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?eT.MeshPhysicalMaterial:null}extendMaterialParams(e,t){let r=this.parser,i=r.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();let n=[],a=i.extensions[this.name];t.thickness=void 0!==a.thicknessFactor?a.thicknessFactor:0,void 0!==a.thicknessTexture&&n.push(r.assignTexture(t,"thicknessMap",a.thicknessTexture)),t.attenuationDistance=a.attenuationDistance||1/0;let o=a.attenuationColor||[1,1,1];return t.attenuationColor=new eT.Color().setRGB(o[0],o[1],o[2],ld),Promise.all(n)}}class lb{constructor(e){this.parser=e,this.name=lp.KHR_MATERIALS_IOR}getMaterialType(e){let t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?eT.MeshPhysicalMaterial:null}extendMaterialParams(e,t){let r=this.parser.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();let i=r.extensions[this.name];return t.ior=void 0!==i.ior?i.ior:1.5,Promise.resolve()}}class l_{constructor(e){this.parser=e,this.name=lp.KHR_MATERIALS_SPECULAR}getMaterialType(e){let t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?eT.MeshPhysicalMaterial:null}extendMaterialParams(e,t){let r=this.parser,i=r.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();let n=[],a=i.extensions[this.name];t.specularIntensity=void 0!==a.specularFactor?a.specularFactor:1,void 0!==a.specularTexture&&n.push(r.assignTexture(t,"specularIntensityMap",a.specularTexture));let o=a.specularColorFactor||[1,1,1];return t.specularColor=new eT.Color().setRGB(o[0],o[1],o[2],ld),void 0!==a.specularColorTexture&&n.push(r.assignTexture(t,"specularColorMap",a.specularColorTexture,lA)),Promise.all(n)}}class lM{constructor(e){this.parser=e,this.name=lp.EXT_MATERIALS_BUMP}getMaterialType(e){let t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?eT.MeshPhysicalMaterial:null}extendMaterialParams(e,t){let r=this.parser,i=r.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();let n=[],a=i.extensions[this.name];return t.bumpScale=void 0!==a.bumpFactor?a.bumpFactor:1,void 0!==a.bumpTexture&&n.push(r.assignTexture(t,"bumpMap",a.bumpTexture)),Promise.all(n)}}class lS{constructor(e){this.parser=e,this.name=lp.KHR_MATERIALS_ANISOTROPY}getMaterialType(e){let t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?eT.MeshPhysicalMaterial:null}extendMaterialParams(e,t){let r=this.parser,i=r.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();let n=[],a=i.extensions[this.name];return void 0!==a.anisotropyStrength&&(t.anisotropy=a.anisotropyStrength),void 0!==a.anisotropyRotation&&(t.anisotropyRotation=a.anisotropyRotation),void 0!==a.anisotropyTexture&&n.push(r.assignTexture(t,"anisotropyMap",a.anisotropyTexture)),Promise.all(n)}}class lD{constructor(e){this.parser=e,this.name=lp.KHR_TEXTURE_BASISU}loadTexture(e){let t=this.parser,r=t.json,i=r.textures[e];if(!i.extensions||!i.extensions[this.name])return null;let n=i.extensions[this.name],a=t.options.ktx2Loader;if(!a){if(!(r.extensionsRequired&&r.extensionsRequired.indexOf(this.name)>=0))return null;throw Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures")}return t.loadTextureImage(e,n.source,a)}}class lT{constructor(e){this.parser=e,this.name=lp.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(e){let t=this.name,r=this.parser,i=r.json,n=i.textures[e];if(!n.extensions||!n.extensions[t])return null;let a=n.extensions[t],o=i.images[a.source],s=r.textureLoader;if(o.uri){let e=r.options.manager.getHandler(o.uri);null!==e&&(s=e)}return this.detectSupport().then(function(n){if(n)return r.loadTextureImage(e,a.source,s);if(i.extensionsRequired&&i.extensionsRequired.indexOf(t)>=0)throw Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return r.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){let t=new Image;t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",t.onload=t.onerror=function(){e(1===t.height)}})),this.isSupported}}class lR{constructor(e){this.parser=e,this.name=lp.EXT_TEXTURE_AVIF,this.isSupported=null}loadTexture(e){let t=this.name,r=this.parser,i=r.json,n=i.textures[e];if(!n.extensions||!n.extensions[t])return null;let a=n.extensions[t],o=i.images[a.source],s=r.textureLoader;if(o.uri){let e=r.options.manager.getHandler(o.uri);null!==e&&(s=e)}return this.detectSupport().then(function(n){if(n)return r.loadTextureImage(e,a.source,s);if(i.extensionsRequired&&i.extensionsRequired.indexOf(t)>=0)throw Error("THREE.GLTFLoader: AVIF required by asset but unsupported.");return r.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){let t=new Image;t.src="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAABcAAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAEAAAABAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIABoAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAAB9tZGF0EgAKCBgABogQEDQgMgkQAAAAB8dSLfI=",t.onload=t.onerror=function(){e(1===t.height)}})),this.isSupported}}class lF{constructor(e){this.name=lp.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){let t=this.parser.json,r=t.bufferViews[e];if(!r.extensions||!r.extensions[this.name])return null;{let e=r.extensions[this.name],i=this.parser.getDependency("buffer",e.buffer),n=this.parser.options.meshoptDecoder;if(!n||!n.supported){if(!(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0))return null;throw Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files")}return i.then(function(t){let r=e.byteOffset||0,i=e.byteLength||0,a=e.count,o=e.byteStride,s=new Uint8Array(t,r,i);return n.decodeGltfBufferAsync?n.decodeGltfBufferAsync(a,o,s,e.mode,e.filter).then(function(e){return e.buffer}):n.ready.then(function(){let t=new ArrayBuffer(a*o);return n.decodeGltfBuffer(new Uint8Array(t),a,o,s,e.mode,e.filter),t})})}}}class lP{constructor(e){this.name=lp.EXT_MESH_GPU_INSTANCING,this.parser=e}createNodeMesh(e){let t=this.parser.json,r=t.nodes[e];if(!r.extensions||!r.extensions[this.name]||void 0===r.mesh)return null;for(let e of t.meshes[r.mesh].primitives)if(e.mode!==lV.TRIANGLES&&e.mode!==lV.TRIANGLE_STRIP&&e.mode!==lV.TRIANGLE_FAN&&void 0!==e.mode)return null;let i=r.extensions[this.name].attributes,n=[],a={};for(let e in i)n.push(this.parser.getDependency("accessor",i[e]).then(t=>(a[e]=t,a[e])));return n.length<1?null:(n.push(this.parser.createNodeMesh(e)),Promise.all(n).then(e=>{let t=e.pop(),r=t.isGroup?t.children:[t],i=e[0].count,n=[];for(let e of r){let t=new eT.Matrix4,r=new eT.Vector3,o=new eT.Quaternion,s=new eT.Vector3(1,1,1),l=new eT.InstancedMesh(e.geometry,e.material,i);for(let e=0;e<i;e++)a.TRANSLATION&&r.fromBufferAttribute(a.TRANSLATION,e),a.ROTATION&&o.fromBufferAttribute(a.ROTATION,e),a.SCALE&&s.fromBufferAttribute(a.SCALE,e),l.setMatrixAt(e,t.compose(r,o,s));for(let t in a)if("_COLOR_0"===t){let e=a[t];l.instanceColor=new eT.InstancedBufferAttribute(e.array,e.itemSize,e.normalized)}else"TRANSLATION"!==t&&"ROTATION"!==t&&"SCALE"!==t&&e.geometry.setAttribute(t,a[t]);eT.Object3D.prototype.copy.call(l,e),this.parser.assignFinalMaterial(l),n.push(l)}return t.isGroup?(t.clear(),t.add(...n),t):n[0]}))}}let lQ="glTF",lz={JSON:1313821514,BIN:5130562};class lL{constructor(e){this.name=lp.KHR_BINARY_GLTF,this.content=null,this.body=null;let t=new DataView(e,0,12);if(this.header={magic:lh(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==lQ)throw Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw Error("THREE.GLTFLoader: Legacy binary file detected.");let r=this.header.length-12,i=new DataView(e,12),n=0;for(;n<r;){let t=i.getUint32(n,!0);n+=4;let r=i.getUint32(n,!0);if(n+=4,r===lz.JSON){let r=new Uint8Array(e,12+n,t);this.content=lh(r)}else if(r===lz.BIN){let r=12+n;this.body=e.slice(r,r+t)}n+=t}if(null===this.content)throw Error("THREE.GLTFLoader: JSON content not found.")}}class lO{constructor(e,t){if(!t)throw Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=lp.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}decodePrimitive(e,t){let r=this.json,i=this.dracoLoader,n=e.extensions[this.name].bufferView,a=e.extensions[this.name].attributes,o={},s={},l={};for(let e in a)o[lK[e]||e.toLowerCase()]=a[e];for(let t in e.attributes){let i=lK[t]||t.toLowerCase();if(void 0!==a[t]){let n=r.accessors[e.attributes[t]],a=lj[n.componentType];l[i]=a.name,s[i]=!0===n.normalized}}return t.getDependency("bufferView",n).then(function(e){return new Promise(function(t,r){i.decodeDracoFile(e,function(e){for(let t in e.attributes){let r=e.attributes[t],i=s[t];void 0!==i&&(r.normalized=i)}t(e)},o,l,ld,r)})})}}class lU{constructor(){this.name=lp.KHR_TEXTURE_TRANSFORM}extendTexture(e,t){return(void 0===t.texCoord||t.texCoord===e.channel)&&void 0===t.offset&&void 0===t.rotation&&void 0===t.scale||(e=e.clone(),void 0!==t.texCoord&&(e.channel=t.texCoord),void 0!==t.offset&&e.offset.fromArray(t.offset),void 0!==t.rotation&&(e.rotation=t.rotation),void 0!==t.scale&&e.repeat.fromArray(t.scale),e.needsUpdate=!0),e}}class lk{constructor(){this.name=lp.KHR_MESH_QUANTIZATION}}class lG extends eT.Interpolant{constructor(e,t,r,i){super(e,t,r,i)}copySampleValue_(e){let t=this.resultBuffer,r=this.sampleValues,i=this.valueSize,n=e*i*3+i;for(let e=0;e!==i;e++)t[e]=r[n+e];return t}interpolate_(e,t,r,i){let n=this.resultBuffer,a=this.sampleValues,o=this.valueSize,s=2*o,l=3*o,c=i-t,u=(r-t)/c,h=u*u,A=h*u,d=e*l,f=d-l,m=-2*A+3*h,p=A-h,g=1-m,y=p-h+u;for(let e=0;e!==o;e++){let t=a[f+e+o],r=a[f+e+s]*c,i=a[d+e+o],l=a[d+e]*c;n[e]=g*t+y*r+m*i+p*l}return n}}let lN=new eT.Quaternion;class lH extends lG{interpolate_(e,t,r,i){let n=super.interpolate_(e,t,r,i);return lN.fromArray(n).normalize().toArray(n),n}}let lV={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6},lj={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},lJ={9728:eT.NearestFilter,9729:eT.LinearFilter,9984:eT.NearestMipmapNearestFilter,9985:eT.LinearMipmapNearestFilter,9986:eT.NearestMipmapLinearFilter,9987:eT.LinearMipmapLinearFilter},lY={33071:eT.ClampToEdgeWrapping,33648:eT.MirroredRepeatWrapping,10497:eT.RepeatWrapping},lW={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},lK={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",...od>=152?{TEXCOORD_0:"uv",TEXCOORD_1:"uv1",TEXCOORD_2:"uv2",TEXCOORD_3:"uv3"}:{TEXCOORD_0:"uv",TEXCOORD_1:"uv2"},COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},lq={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},lX={CUBICSPLINE:void 0,LINEAR:eT.InterpolateLinear,STEP:eT.InterpolateDiscrete},lZ={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function l$(e,t,r){for(let i in r.extensions)void 0===e[i]&&(t.userData.gltfExtensions=t.userData.gltfExtensions||{},t.userData.gltfExtensions[i]=r.extensions[i])}function l1(e,t){void 0!==t.extras&&("object"==typeof t.extras?Object.assign(e.userData,t.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+t.extras))}function l0(e){let t="",r=Object.keys(e).sort();for(let i=0,n=r.length;i<n;i++)t+=r[i]+":"+e[r[i]]+";";return t}function l2(e){switch(e){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}let l3=new eT.Matrix4;class l4{constructor(e={},t={}){this.json=e,this.extensions={},this.plugins={},this.options=t,this.cache=new lm,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let r=!1,i=!1,n=-1;"undefined"!=typeof navigator&&void 0!==navigator.userAgent&&(r=!0===/^((?!chrome|android).)*safari/i.test(navigator.userAgent),n=(i=navigator.userAgent.indexOf("Firefox")>-1)?navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1]:-1),"undefined"==typeof createImageBitmap||r||i&&n<98?this.textureLoader=new eT.TextureLoader(this.options.manager):this.textureLoader=new eT.ImageBitmapLoader(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new eT.FileLoader(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),"use-credentials"===this.options.crossOrigin&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,t){let r=this,i=this.json,n=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll(function(e){return e._markDefs&&e._markDefs()}),Promise.all(this._invokeAll(function(e){return e.beforeRoot&&e.beforeRoot()})).then(function(){return Promise.all([r.getDependencies("scene"),r.getDependencies("animation"),r.getDependencies("camera")])}).then(function(t){let a={scene:t[0][i.scene||0],scenes:t[0],animations:t[1],cameras:t[2],asset:i.asset,parser:r,userData:{}};return l$(n,a,i),l1(a,i),Promise.all(r._invokeAll(function(e){return e.afterRoot&&e.afterRoot(a)})).then(function(){for(let e of a.scenes)e.updateMatrixWorld();e(a)})}).catch(t)}_markDefs(){let e=this.json.nodes||[],t=this.json.skins||[],r=this.json.meshes||[];for(let r=0,i=t.length;r<i;r++){let i=t[r].joints;for(let t=0,r=i.length;t<r;t++)e[i[t]].isBone=!0}for(let t=0,i=e.length;t<i;t++){let i=e[t];void 0!==i.mesh&&(this._addNodeRef(this.meshCache,i.mesh),void 0!==i.skin&&(r[i.mesh].isSkinnedMesh=!0)),void 0!==i.camera&&this._addNodeRef(this.cameraCache,i.camera)}}_addNodeRef(e,t){void 0!==t&&(void 0===e.refs[t]&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)}_getNodeRef(e,t,r){if(e.refs[t]<=1)return r;let i=r.clone(),n=(e,t)=>{let r=this.associations.get(e);for(let[i,a]of(null!=r&&this.associations.set(t,r),e.children.entries()))n(a,t.children[i])};return n(r,i),i.name+="_instance_"+e.uses[t]++,i}_invokeOne(e){let t=Object.values(this.plugins);t.push(this);for(let r=0;r<t.length;r++){let i=e(t[r]);if(i)return i}return null}_invokeAll(e){let t=Object.values(this.plugins);t.unshift(this);let r=[];for(let i=0;i<t.length;i++){let n=e(t[i]);n&&r.push(n)}return r}getDependency(e,t){let r=e+":"+t,i=this.cache.get(r);if(!i){switch(e){case"scene":i=this.loadScene(t);break;case"node":i=this._invokeOne(function(e){return e.loadNode&&e.loadNode(t)});break;case"mesh":i=this._invokeOne(function(e){return e.loadMesh&&e.loadMesh(t)});break;case"accessor":i=this.loadAccessor(t);break;case"bufferView":i=this._invokeOne(function(e){return e.loadBufferView&&e.loadBufferView(t)});break;case"buffer":i=this.loadBuffer(t);break;case"material":i=this._invokeOne(function(e){return e.loadMaterial&&e.loadMaterial(t)});break;case"texture":i=this._invokeOne(function(e){return e.loadTexture&&e.loadTexture(t)});break;case"skin":i=this.loadSkin(t);break;case"animation":i=this._invokeOne(function(e){return e.loadAnimation&&e.loadAnimation(t)});break;case"camera":i=this.loadCamera(t);break;default:if(!(i=this._invokeOne(function(r){return r!=this&&r.getDependency&&r.getDependency(e,t)})))throw Error("Unknown type: "+e)}this.cache.add(r,i)}return i}getDependencies(e){let t=this.cache.get(e);if(!t){let r=this;t=Promise.all((this.json[e+("mesh"===e?"es":"s")]||[]).map(function(t,i){return r.getDependency(e,i)})),this.cache.add(e,t)}return t}loadBuffer(e){let t=this.json.buffers[e],r=this.fileLoader;if(t.type&&"arraybuffer"!==t.type)throw Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(void 0===t.uri&&0===e)return Promise.resolve(this.extensions[lp.KHR_BINARY_GLTF].body);let i=this.options;return new Promise(function(e,n){r.load(eT.LoaderUtils.resolveURL(t.uri,i.path),e,void 0,function(){n(Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))})})}loadBufferView(e){let t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then(function(e){let r=t.byteLength||0,i=t.byteOffset||0;return e.slice(i,i+r)})}loadAccessor(e){let t=this,r=this.json,i=this.json.accessors[e];if(void 0===i.bufferView&&void 0===i.sparse){let e=lW[i.type],t=lj[i.componentType],r=!0===i.normalized,n=new t(i.count*e);return Promise.resolve(new eT.BufferAttribute(n,e,r))}let n=[];return void 0!==i.bufferView?n.push(this.getDependency("bufferView",i.bufferView)):n.push(null),void 0!==i.sparse&&(n.push(this.getDependency("bufferView",i.sparse.indices.bufferView)),n.push(this.getDependency("bufferView",i.sparse.values.bufferView))),Promise.all(n).then(function(e){let n,a;let o=e[0],s=lW[i.type],l=lj[i.componentType],c=l.BYTES_PER_ELEMENT,u=c*s,h=i.byteOffset||0,A=void 0!==i.bufferView?r.bufferViews[i.bufferView].byteStride:void 0,d=!0===i.normalized;if(A&&A!==u){let e=Math.floor(h/A),r="InterleavedBuffer:"+i.bufferView+":"+i.componentType+":"+e+":"+i.count,u=t.cache.get(r);u||(n=new l(o,e*A,i.count*A/c),u=new eT.InterleavedBuffer(n,A/c),t.cache.add(r,u)),a=new eT.InterleavedBufferAttribute(u,s,h%A/c,d)}else n=null===o?new l(i.count*s):new l(o,h,i.count*s),a=new eT.BufferAttribute(n,s,d);if(void 0!==i.sparse){let t=lW.SCALAR,r=lj[i.sparse.indices.componentType],n=i.sparse.indices.byteOffset||0,c=i.sparse.values.byteOffset||0,u=new r(e[1],n,i.sparse.count*t),h=new l(e[2],c,i.sparse.count*s);null!==o&&(a=new eT.BufferAttribute(a.array.slice(),a.itemSize,a.normalized));for(let e=0,t=u.length;e<t;e++){let t=u[e];if(a.setX(t,h[e*s]),s>=2&&a.setY(t,h[e*s+1]),s>=3&&a.setZ(t,h[e*s+2]),s>=4&&a.setW(t,h[e*s+3]),s>=5)throw Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return a})}loadTexture(e){let t=this.json,r=this.options,i=t.textures[e].source,n=t.images[i],a=this.textureLoader;if(n.uri){let e=r.manager.getHandler(n.uri);null!==e&&(a=e)}return this.loadTextureImage(e,i,a)}loadTextureImage(e,t,r){let i=this,n=this.json,a=n.textures[e],o=n.images[t],s=(o.uri||o.bufferView)+":"+a.sampler;if(this.textureCache[s])return this.textureCache[s];let l=this.loadImageSource(t,r).then(function(t){t.flipY=!1,t.name=a.name||o.name||"",""===t.name&&"string"==typeof o.uri&&!1===o.uri.startsWith("data:image/")&&(t.name=o.uri);let r=(n.samplers||{})[a.sampler]||{};return t.magFilter=lJ[r.magFilter]||eT.LinearFilter,t.minFilter=lJ[r.minFilter]||eT.LinearMipmapLinearFilter,t.wrapS=lY[r.wrapS]||eT.RepeatWrapping,t.wrapT=lY[r.wrapT]||eT.RepeatWrapping,i.associations.set(t,{textures:e}),t}).catch(function(){return null});return this.textureCache[s]=l,l}loadImageSource(e,t){let r=this.json,i=this.options;if(void 0!==this.sourceCache[e])return this.sourceCache[e].then(e=>e.clone());let n=r.images[e],a=self.URL||self.webkitURL,o=n.uri||"",s=!1;if(void 0!==n.bufferView)o=this.getDependency("bufferView",n.bufferView).then(function(e){s=!0;let t=new Blob([e],{type:n.mimeType});return o=a.createObjectURL(t)});else if(void 0===n.uri)throw Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");let l=Promise.resolve(o).then(function(e){return new Promise(function(r,n){let a=r;!0===t.isImageBitmapLoader&&(a=function(e){let t=new eT.Texture(e);t.needsUpdate=!0,r(t)}),t.load(eT.LoaderUtils.resolveURL(e,i.path),a,void 0,n)})}).then(function(e){var t;return!0===s&&a.revokeObjectURL(o),l1(e,n),e.userData.mimeType=n.mimeType||((t=n.uri).search(/\.jpe?g($|\?)/i)>0||0===t.search(/^data\:image\/jpeg/)?"image/jpeg":t.search(/\.webp($|\?)/i)>0||0===t.search(/^data\:image\/webp/)?"image/webp":"image/png"),e}).catch(function(e){throw console.error("THREE.GLTFLoader: Couldn't load texture",o),e});return this.sourceCache[e]=l,l}assignTexture(e,t,r,i){let n=this;return this.getDependency("texture",r.index).then(function(a){if(!a)return null;if(void 0!==r.texCoord&&r.texCoord>0&&((a=a.clone()).channel=r.texCoord),n.extensions[lp.KHR_TEXTURE_TRANSFORM]){let e=void 0!==r.extensions?r.extensions[lp.KHR_TEXTURE_TRANSFORM]:void 0;if(e){let t=n.associations.get(a);a=n.extensions[lp.KHR_TEXTURE_TRANSFORM].extendTexture(a,e),n.associations.set(a,t)}}return void 0!==i&&("number"==typeof i&&(i=3001===i?lA:ld),"colorSpace"in a?a.colorSpace=i:a.encoding=i===lA?3001:3e3),e[t]=a,a})}assignFinalMaterial(e){let t=e.geometry,r=e.material,i=void 0===t.attributes.tangent,n=void 0!==t.attributes.color,a=void 0===t.attributes.normal;if(e.isPoints){let e="PointsMaterial:"+r.uuid,t=this.cache.get(e);t||(t=new eT.PointsMaterial,eT.Material.prototype.copy.call(t,r),t.color.copy(r.color),t.map=r.map,t.sizeAttenuation=!1,this.cache.add(e,t)),r=t}else if(e.isLine){let e="LineBasicMaterial:"+r.uuid,t=this.cache.get(e);t||(t=new eT.LineBasicMaterial,eT.Material.prototype.copy.call(t,r),t.color.copy(r.color),t.map=r.map,this.cache.add(e,t)),r=t}if(i||n||a){let e="ClonedMaterial:"+r.uuid+":";i&&(e+="derivative-tangents:"),n&&(e+="vertex-colors:"),a&&(e+="flat-shading:");let t=this.cache.get(e);t||(t=r.clone(),n&&(t.vertexColors=!0),a&&(t.flatShading=!0),i&&(t.normalScale&&(t.normalScale.y*=-1),t.clearcoatNormalScale&&(t.clearcoatNormalScale.y*=-1)),this.cache.add(e,t),this.associations.set(t,this.associations.get(r))),r=t}e.material=r}getMaterialType(){return eT.MeshStandardMaterial}loadMaterial(e){let t;let r=this,i=this.json,n=this.extensions,a=i.materials[e],o={},s=a.extensions||{},l=[];if(s[lp.KHR_MATERIALS_UNLIT]){let e=n[lp.KHR_MATERIALS_UNLIT];t=e.getMaterialType(),l.push(e.extendParams(o,a,r))}else{let i=a.pbrMetallicRoughness||{};if(o.color=new eT.Color(1,1,1),o.opacity=1,Array.isArray(i.baseColorFactor)){let e=i.baseColorFactor;o.color.setRGB(e[0],e[1],e[2],ld),o.opacity=e[3]}void 0!==i.baseColorTexture&&l.push(r.assignTexture(o,"map",i.baseColorTexture,lA)),o.metalness=void 0!==i.metallicFactor?i.metallicFactor:1,o.roughness=void 0!==i.roughnessFactor?i.roughnessFactor:1,void 0!==i.metallicRoughnessTexture&&(l.push(r.assignTexture(o,"metalnessMap",i.metallicRoughnessTexture)),l.push(r.assignTexture(o,"roughnessMap",i.metallicRoughnessTexture))),t=this._invokeOne(function(t){return t.getMaterialType&&t.getMaterialType(e)}),l.push(Promise.all(this._invokeAll(function(t){return t.extendMaterialParams&&t.extendMaterialParams(e,o)})))}!0===a.doubleSided&&(o.side=eT.DoubleSide);let c=a.alphaMode||lZ.OPAQUE;if(c===lZ.BLEND?(o.transparent=!0,o.depthWrite=!1):(o.transparent=!1,c===lZ.MASK&&(o.alphaTest=void 0!==a.alphaCutoff?a.alphaCutoff:.5)),void 0!==a.normalTexture&&t!==eT.MeshBasicMaterial&&(l.push(r.assignTexture(o,"normalMap",a.normalTexture)),o.normalScale=new eT.Vector2(1,1),void 0!==a.normalTexture.scale)){let e=a.normalTexture.scale;o.normalScale.set(e,e)}if(void 0!==a.occlusionTexture&&t!==eT.MeshBasicMaterial&&(l.push(r.assignTexture(o,"aoMap",a.occlusionTexture)),void 0!==a.occlusionTexture.strength&&(o.aoMapIntensity=a.occlusionTexture.strength)),void 0!==a.emissiveFactor&&t!==eT.MeshBasicMaterial){let e=a.emissiveFactor;o.emissive=new eT.Color().setRGB(e[0],e[1],e[2],ld)}return void 0!==a.emissiveTexture&&t!==eT.MeshBasicMaterial&&l.push(r.assignTexture(o,"emissiveMap",a.emissiveTexture,lA)),Promise.all(l).then(function(){let i=new t(o);return a.name&&(i.name=a.name),l1(i,a),r.associations.set(i,{materials:e}),a.extensions&&l$(n,i,a),i})}createUniqueName(e){let t=eT.PropertyBinding.sanitizeNodeName(e||"");return t in this.nodeNamesUsed?t+"_"+ ++this.nodeNamesUsed[t]:(this.nodeNamesUsed[t]=0,t)}loadGeometries(e){let t=this,r=this.extensions,i=this.primitiveCache,n=[];for(let a=0,o=e.length;a<o;a++){let o=e[a],s=function(e){let t;let r=e.extensions&&e.extensions[lp.KHR_DRACO_MESH_COMPRESSION];if(t=r?"draco:"+r.bufferView+":"+r.indices+":"+l0(r.attributes):e.indices+":"+l0(e.attributes)+":"+e.mode,void 0!==e.targets)for(let r=0,i=e.targets.length;r<i;r++)t+=":"+l0(e.targets[r]);return t}(o),l=i[s];if(l)n.push(l.promise);else{let e;e=o.extensions&&o.extensions[lp.KHR_DRACO_MESH_COMPRESSION]?function(e){return r[lp.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(e,t).then(function(r){return l5(r,e,t)})}(o):l5(new eT.BufferGeometry,o,t),i[s]={primitive:o,promise:e},n.push(e)}}return Promise.all(n)}loadMesh(e){let t=this,r=this.json,i=this.extensions,n=r.meshes[e],a=n.primitives,o=[];for(let e=0,t=a.length;e<t;e++){var s;let t=void 0===a[e].material?(void 0===(s=this.cache).DefaultMaterial&&(s.DefaultMaterial=new eT.MeshStandardMaterial({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:eT.FrontSide})),s.DefaultMaterial):this.getDependency("material",a[e].material);o.push(t)}return o.push(t.loadGeometries(a)),Promise.all(o).then(function(r){let o=r.slice(0,r.length-1),s=r[r.length-1],l=[];for(let r=0,c=s.length;r<c;r++){let c;let u=s[r],h=a[r],A=o[r];if(h.mode===lV.TRIANGLES||h.mode===lV.TRIANGLE_STRIP||h.mode===lV.TRIANGLE_FAN||void 0===h.mode)!0===(c=!0===n.isSkinnedMesh?new eT.SkinnedMesh(u,A):new eT.Mesh(u,A)).isSkinnedMesh&&c.normalizeSkinWeights(),h.mode===lV.TRIANGLE_STRIP?c.geometry=oH(c.geometry,eT.TriangleStripDrawMode):h.mode===lV.TRIANGLE_FAN&&(c.geometry=oH(c.geometry,eT.TriangleFanDrawMode));else if(h.mode===lV.LINES)c=new eT.LineSegments(u,A);else if(h.mode===lV.LINE_STRIP)c=new eT.Line(u,A);else if(h.mode===lV.LINE_LOOP)c=new eT.LineLoop(u,A);else if(h.mode===lV.POINTS)c=new eT.Points(u,A);else throw Error("THREE.GLTFLoader: Primitive mode unsupported: "+h.mode);Object.keys(c.geometry.morphAttributes).length>0&&function(e,t){if(e.updateMorphTargets(),void 0!==t.weights)for(let r=0,i=t.weights.length;r<i;r++)e.morphTargetInfluences[r]=t.weights[r];if(t.extras&&Array.isArray(t.extras.targetNames)){let r=t.extras.targetNames;if(e.morphTargetInfluences.length===r.length){e.morphTargetDictionary={};for(let t=0,i=r.length;t<i;t++)e.morphTargetDictionary[r[t]]=t}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}(c,n),c.name=t.createUniqueName(n.name||"mesh_"+e),l1(c,n),h.extensions&&l$(i,c,h),t.assignFinalMaterial(c),l.push(c)}for(let r=0,i=l.length;r<i;r++)t.associations.set(l[r],{meshes:e,primitives:r});if(1===l.length)return n.extensions&&l$(i,l[0],n),l[0];let c=new eT.Group;n.extensions&&l$(i,c,n),t.associations.set(c,{meshes:e});for(let e=0,t=l.length;e<t;e++)c.add(l[e]);return c})}loadCamera(e){let t;let r=this.json.cameras[e],i=r[r.type];if(!i){console.warn("THREE.GLTFLoader: Missing camera parameters.");return}return"perspective"===r.type?t=new eT.PerspectiveCamera(eT.MathUtils.radToDeg(i.yfov),i.aspectRatio||1,i.znear||1,i.zfar||2e6):"orthographic"===r.type&&(t=new eT.OrthographicCamera(-i.xmag,i.xmag,i.ymag,-i.ymag,i.znear,i.zfar)),r.name&&(t.name=this.createUniqueName(r.name)),l1(t,r),Promise.resolve(t)}loadSkin(e){let t=this.json.skins[e],r=[];for(let e=0,i=t.joints.length;e<i;e++)r.push(this._loadNodeShallow(t.joints[e]));return void 0!==t.inverseBindMatrices?r.push(this.getDependency("accessor",t.inverseBindMatrices)):r.push(null),Promise.all(r).then(function(e){let r=e.pop(),i=[],n=[];for(let a=0,o=e.length;a<o;a++){let o=e[a];if(o){i.push(o);let e=new eT.Matrix4;null!==r&&e.fromArray(r.array,16*a),n.push(e)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',t.joints[a])}return new eT.Skeleton(i,n)})}loadAnimation(e){let t=this.json,r=this,i=t.animations[e],n=i.name?i.name:"animation_"+e,a=[],o=[],s=[],l=[],c=[];for(let e=0,t=i.channels.length;e<t;e++){let t=i.channels[e],r=i.samplers[t.sampler],n=t.target,u=n.node,h=void 0!==i.parameters?i.parameters[r.input]:r.input,A=void 0!==i.parameters?i.parameters[r.output]:r.output;void 0!==n.node&&(a.push(this.getDependency("node",u)),o.push(this.getDependency("accessor",h)),s.push(this.getDependency("accessor",A)),l.push(r),c.push(n))}return Promise.all([Promise.all(a),Promise.all(o),Promise.all(s),Promise.all(l),Promise.all(c)]).then(function(e){let t=e[0],i=e[1],a=e[2],o=e[3],s=e[4],l=[];for(let e=0,n=t.length;e<n;e++){let n=t[e],c=i[e],u=a[e],h=o[e],A=s[e];if(void 0===n)continue;n.updateMatrix&&n.updateMatrix();let d=r._createAnimationTracks(n,c,u,h,A);if(d)for(let e=0;e<d.length;e++)l.push(d[e])}return new eT.AnimationClip(n,void 0,l)})}createNodeMesh(e){let t=this.json,r=this,i=t.nodes[e];return void 0===i.mesh?null:r.getDependency("mesh",i.mesh).then(function(e){let t=r._getNodeRef(r.meshCache,i.mesh,e);return void 0!==i.weights&&t.traverse(function(e){if(e.isMesh)for(let t=0,r=i.weights.length;t<r;t++)e.morphTargetInfluences[t]=i.weights[t]}),t})}loadNode(e){let t=this.json.nodes[e],r=this._loadNodeShallow(e),i=[],n=t.children||[];for(let e=0,t=n.length;e<t;e++)i.push(this.getDependency("node",n[e]));let a=void 0===t.skin?Promise.resolve(null):this.getDependency("skin",t.skin);return Promise.all([r,Promise.all(i),a]).then(function(e){let t=e[0],r=e[1],i=e[2];null!==i&&t.traverse(function(e){e.isSkinnedMesh&&e.bind(i,l3)});for(let e=0,i=r.length;e<i;e++)t.add(r[e]);return t})}_loadNodeShallow(e){let t=this.json,r=this.extensions,i=this;if(void 0!==this.nodeCache[e])return this.nodeCache[e];let n=t.nodes[e],a=n.name?i.createUniqueName(n.name):"",o=[],s=i._invokeOne(function(t){return t.createNodeMesh&&t.createNodeMesh(e)});return s&&o.push(s),void 0!==n.camera&&o.push(i.getDependency("camera",n.camera).then(function(e){return i._getNodeRef(i.cameraCache,n.camera,e)})),i._invokeAll(function(t){return t.createNodeAttachment&&t.createNodeAttachment(e)}).forEach(function(e){o.push(e)}),this.nodeCache[e]=Promise.all(o).then(function(t){let o;if((o=!0===n.isBone?new eT.Bone:t.length>1?new eT.Group:1===t.length?t[0]:new eT.Object3D)!==t[0])for(let e=0,r=t.length;e<r;e++)o.add(t[e]);if(n.name&&(o.userData.name=n.name,o.name=a),l1(o,n),n.extensions&&l$(r,o,n),void 0!==n.matrix){let e=new eT.Matrix4;e.fromArray(n.matrix),o.applyMatrix4(e)}else void 0!==n.translation&&o.position.fromArray(n.translation),void 0!==n.rotation&&o.quaternion.fromArray(n.rotation),void 0!==n.scale&&o.scale.fromArray(n.scale);return i.associations.has(o)||i.associations.set(o,{}),i.associations.get(o).nodes=e,o}),this.nodeCache[e]}loadScene(e){let t=this.extensions,r=this.json.scenes[e],i=this,n=new eT.Group;r.name&&(n.name=i.createUniqueName(r.name)),l1(n,r),r.extensions&&l$(t,n,r);let a=r.nodes||[],o=[];for(let e=0,t=a.length;e<t;e++)o.push(i.getDependency("node",a[e]));return Promise.all(o).then(function(e){for(let t=0,r=e.length;t<r;t++)n.add(e[t]);return i.associations=(e=>{let t=new Map;for(let[e,r]of i.associations)(e instanceof eT.Material||e instanceof eT.Texture)&&t.set(e,r);return e.traverse(e=>{let r=i.associations.get(e);null!=r&&t.set(e,r)}),t})(n),n})}_createAnimationTracks(e,t,r,i,n){let a;let o=[],s=e.name?e.name:e.uuid,l=[];switch(lq[n.path]===lq.weights?e.traverse(function(e){e.morphTargetInfluences&&l.push(e.name?e.name:e.uuid)}):l.push(s),lq[n.path]){case lq.weights:a=eT.NumberKeyframeTrack;break;case lq.rotation:a=eT.QuaternionKeyframeTrack;break;case lq.position:case lq.scale:a=eT.VectorKeyframeTrack;break;default:a=1===r.itemSize?eT.NumberKeyframeTrack:eT.VectorKeyframeTrack}let c=void 0!==i.interpolation?lX[i.interpolation]:eT.InterpolateLinear,u=this._getArrayFromAccessor(r);for(let e=0,r=l.length;e<r;e++){let r=new a(l[e]+"."+lq[n.path],t.array,u,c);"CUBICSPLINE"===i.interpolation&&this._createCubicSplineTrackInterpolant(r),o.push(r)}return o}_getArrayFromAccessor(e){let t=e.array;if(e.normalized){let e=l2(t.constructor),r=new Float32Array(t.length);for(let i=0,n=t.length;i<n;i++)r[i]=t[i]*e;t=r}return t}_createCubicSplineTrackInterpolant(e){e.createInterpolant=function(e){return new(this instanceof eT.QuaternionKeyframeTrack?lH:lG)(this.times,this.values,this.getValueSize()/3,e)},e.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0}}function l5(e,t,r){let i=t.attributes,n=[];for(let t in i){let a=lK[t]||t.toLowerCase();a in e.attributes||n.push(function(t,i){return r.getDependency("accessor",t).then(function(t){e.setAttribute(i,t)})}(i[t],a))}if(void 0!==t.indices&&!e.index){let i=r.getDependency("accessor",t.indices).then(function(t){e.setIndex(t)});n.push(i)}return l1(e,t),!function(e,t,r){let i=t.attributes,n=new eT.Box3;if(void 0===i.POSITION)return;{let e=r.json.accessors[i.POSITION],t=e.min,a=e.max;if(void 0!==t&&void 0!==a){if(n.set(new eT.Vector3(t[0],t[1],t[2]),new eT.Vector3(a[0],a[1],a[2])),e.normalized){let t=l2(lj[e.componentType]);n.min.multiplyScalar(t),n.max.multiplyScalar(t)}}else{console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");return}}let a=t.targets;if(void 0!==a){let e=new eT.Vector3,t=new eT.Vector3;for(let i=0,n=a.length;i<n;i++){let n=a[i];if(void 0!==n.POSITION){let i=r.json.accessors[n.POSITION],a=i.min,o=i.max;if(void 0!==a&&void 0!==o){if(t.setX(Math.max(Math.abs(a[0]),Math.abs(o[0]))),t.setY(Math.max(Math.abs(a[1]),Math.abs(o[1]))),t.setZ(Math.max(Math.abs(a[2]),Math.abs(o[2]))),i.normalized){let e=l2(lj[i.componentType]);t.multiplyScalar(e)}e.max(t)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}n.expandByVector(e)}e.boundingBox=n;let o=new eT.Sphere;n.getCenter(o.center),o.radius=n.min.distanceTo(n.max)/2,e.boundingSphere=o}(e,t,r),Promise.all(n).then(function(){return void 0!==t.targets?function(e,t,r){let i=!1,n=!1,a=!1;for(let e=0,r=t.length;e<r;e++){let r=t[e];if(void 0!==r.POSITION&&(i=!0),void 0!==r.NORMAL&&(n=!0),void 0!==r.COLOR_0&&(a=!0),i&&n&&a)break}if(!i&&!n&&!a)return Promise.resolve(e);let o=[],s=[],l=[];for(let c=0,u=t.length;c<u;c++){let u=t[c];if(i){let t=void 0!==u.POSITION?r.getDependency("accessor",u.POSITION):e.attributes.position;o.push(t)}if(n){let t=void 0!==u.NORMAL?r.getDependency("accessor",u.NORMAL):e.attributes.normal;s.push(t)}if(a){let t=void 0!==u.COLOR_0?r.getDependency("accessor",u.COLOR_0):e.attributes.color;l.push(t)}}return Promise.all([Promise.all(o),Promise.all(s),Promise.all(l)]).then(function(t){let r=t[0],o=t[1],s=t[2];return i&&(e.morphAttributes.position=r),n&&(e.morphAttributes.normal=o),a&&(e.morphAttributes.color=s),e.morphTargetsRelative=!0,e})}(e,t.targets,r):e})}let l6=null,l8="https://www.gstatic.com/draco/versioned/decoders/1.5.5/";function l9(e=!0,t=!0,r){return i=>{r&&r(i),e&&(l6||(l6=new ll),l6.setDecoderPath("string"==typeof e?e:l8),i.setDRACOLoader(l6)),t&&i.setMeshoptDecoder("function"==typeof lu?lu():lu)}}let l7=(e,t,r,i)=>(0,eR.H)(lf,e,l9(t,r,i));l7.preload=(e,t,r,i)=>eR.H.preload(lf,e,l9(t,r,i)),l7.clear=e=>eR.H.clear(lf,e),l7.setDecoderPath=e=>{l8=e};let ce=eS.forwardRef(({src:e,useDraco:t,useMeshOpt:r,extendLoader:i,...n},a)=>{let{scene:o}=l7(e,t,r,i);return eS.createElement(s3,j({ref:a},n,{object:o}))});class ct{constructor(e,t=" .:-=+*#%@",r={}){let i,n,a,o,s;let l=r.resolution||.15,c=r.scale||1,u=r.color||!1,h=r.alpha||!1,A=r.block||!1,d=r.invert||!1,f=r.strResolution||"low",m=document.createElement("div");m.style.cursor="default";let p=document.createElement("table");m.appendChild(p),this.setSize=function(t,r){i=t,n=r,e.setSize(t,r),function(){a=Math.floor(i*l),o=Math.floor(n*l),v.width=a,v.height=o,(s=e.domElement).style.backgroundColor&&(p.rows[0].cells[0].style.backgroundColor=s.style.backgroundColor,p.rows[0].cells[0].style.color=s.style.color),p.cellSpacing=0,p.cellPadding=0;let t=p.style;t.whiteSpace="pre",t.margin="0px",t.padding="0px",t.letterSpacing=w+"px",t.fontFamily=g,t.fontSize=C+"px",t.lineHeight=B+"px",t.textAlign="left",t.textDecoration="none"}()},this.render=function(t,r){e.render(t,r),function(e){E.clearRect(0,0,a,o),E.drawImage(y,0,0,a,o);let t=E.getImageData(0,0,a,o).data,r="";for(let e=0;e<o;e+=2){for(let i=0;i<a;i++){let n,o;let s=(e*a+i)*4,l=t[s],c=t[s+1],f=t[s+2],m=t[s+3];o=(.3*l+.59*c+.11*f)/255,0==m&&(o=1),n=Math.floor((1-o)*(x.length-1)),d&&(n=x.length-n-1);let p=x[n];(void 0===p||" "==p)&&(p="&nbsp;"),u?r+="<span style='color:rgb("+l+","+c+","+f+");"+(A?"background-color:rgb("+l+","+c+","+f+");":"")+(h?"opacity:"+m/255+";":"")+"'>"+p+"</span>":r+=p}r+="<br/>"}e.innerHTML=`<tr><td style="display:block;width:${i}px;height:${n}px;overflow:hidden">${r}</td></tr>`}(p)},this.domElement=m;let g="courier new, monospace",y=e.domElement,v=document.createElement("canvas");if(!v.getContext)return;let E=v.getContext("2d");if(!E.getImageData)return;let x=u?" CGO08@".split(""):" .,:;i1tfLCG08@".split("");t&&(x=t);let C=2/l*c,B=2/l*c,w=0;if("low"==f)switch(c){case 1:w=-1;break;case 2:case 3:w=-2.1;break;case 4:w=-3.1;break;case 5:w=-4.15}if("medium"==f)switch(c){case 1:w=0;break;case 2:w=-1;break;case 3:w=-1.04;break;case 4:case 5:w=-2.1}if("high"==f)switch(c){case 1:case 2:w=0;break;case 3:case 4:case 5:w=-1}}}function cr({renderIndex:e=1,bgColor:t="black",fgColor:r="white",characters:i=" .:-+*=%@#",invert:n=!0,color:a=!1,resolution:o=.15}){let{size:s,gl:l,scene:c,camera:u}=(0,eR.D)(),h=eS.useMemo(()=>{let e=new ct(l,i,{invert:n,color:a,resolution:o});return e.domElement.style.position="absolute",e.domElement.style.top="0px",e.domElement.style.left="0px",e.domElement.style.pointerEvents="none",e},[i,n,a,o]);return eS.useLayoutEffect(()=>{h.domElement.style.color=r,h.domElement.style.backgroundColor=t},[r,t]),eS.useEffect(()=>(l.domElement.style.opacity="0",l.domElement.parentNode.appendChild(h.domElement),()=>{l.domElement.style.opacity="1",l.domElement.parentNode.removeChild(h.domElement)}),[h]),eS.useEffect(()=>{h.setSize(s.width,s.height)},[h,s]),(0,eR.F)(e=>{h.render(c,u)},e),eS.createElement(eS.Fragment,null)}let ci=sx({alphaTest:0,viewport:new eT.Vector2(1980,1080),focal:1e3,centerAndScaleTexture:null,covAndColorTexture:null},`
    precision highp sampler2D;
    precision highp usampler2D;
    out vec4 vColor;
    out vec3 vPosition;
    uniform vec2 resolution;
    uniform vec2 viewport;
    uniform float focal;
    attribute uint splatIndex;
    uniform sampler2D centerAndScaleTexture;
    uniform usampler2D covAndColorTexture;    

    vec2 unpackInt16(in uint value) {
      int v = int(value);
      int v0 = v >> 16;
      int v1 = (v & 0xFFFF);
      if((v & 0x8000) != 0)
        v1 |= 0xFFFF0000;
      return vec2(float(v1), float(v0));
    }

    void main () {
      ivec2 texSize = textureSize(centerAndScaleTexture, 0);
      ivec2 texPos = ivec2(splatIndex%uint(texSize.x), splatIndex/uint(texSize.x));
      vec4 centerAndScaleData = texelFetch(centerAndScaleTexture, texPos, 0);
      vec4 center = vec4(centerAndScaleData.xyz, 1);
      vec4 camspace = modelViewMatrix * center;
      vec4 pos2d = projectionMatrix * camspace;

      float bounds = 1.2 * pos2d.w;
      if (pos2d.z < -pos2d.w || pos2d.x < -bounds || pos2d.x > bounds
        || pos2d.y < -bounds || pos2d.y > bounds) {
        gl_Position = vec4(0.0, 0.0, 2.0, 1.0);
        return;
      }

      uvec4 covAndColorData = texelFetch(covAndColorTexture, texPos, 0);
      vec2 cov3D_M11_M12 = unpackInt16(covAndColorData.x) * centerAndScaleData.w;
      vec2 cov3D_M13_M22 = unpackInt16(covAndColorData.y) * centerAndScaleData.w;
      vec2 cov3D_M23_M33 = unpackInt16(covAndColorData.z) * centerAndScaleData.w;
      mat3 Vrk = mat3(
        cov3D_M11_M12.x, cov3D_M11_M12.y, cov3D_M13_M22.x,
        cov3D_M11_M12.y, cov3D_M13_M22.y, cov3D_M23_M33.x,
        cov3D_M13_M22.x, cov3D_M23_M33.x, cov3D_M23_M33.y
      );

      mat3 J = mat3(
        focal / camspace.z, 0., -(focal * camspace.x) / (camspace.z * camspace.z),
        0., focal / camspace.z, -(focal * camspace.y) / (camspace.z * camspace.z),
        0., 0., 0.
      );

      mat3 W = transpose(mat3(modelViewMatrix));
      mat3 T = W * J;
      mat3 cov = transpose(T) * Vrk * T;
      vec2 vCenter = vec2(pos2d) / pos2d.w;
      float diagonal1 = cov[0][0] + 0.3;
      float offDiagonal = cov[0][1];
      float diagonal2 = cov[1][1] + 0.3;
      float mid = 0.5 * (diagonal1 + diagonal2);
      float radius = length(vec2((diagonal1 - diagonal2) / 2.0, offDiagonal));
      float lambda1 = mid + radius;
      float lambda2 = max(mid - radius, 0.1);
      vec2 diagonalVector = normalize(vec2(offDiagonal, lambda1 - diagonal1));
      vec2 v1 = min(sqrt(2.0 * lambda1), 1024.0) * diagonalVector;
      vec2 v2 = min(sqrt(2.0 * lambda2), 1024.0) * vec2(diagonalVector.y, -diagonalVector.x);
      uint colorUint = covAndColorData.w;
      vColor = vec4(
        float(colorUint & uint(0xFF)) / 255.0,
        float((colorUint >> uint(8)) & uint(0xFF)) / 255.0,
        float((colorUint >> uint(16)) & uint(0xFF)) / 255.0,
        float(colorUint >> uint(24)) / 255.0
      );
      vPosition = position;

      gl_Position = vec4(
        vCenter 
          + position.x * v2 / viewport * 2.0 
          + position.y * v1 / viewport * 2.0, pos2d.z / pos2d.w, 1.0);
    }
    `,`
    #include <alphatest_pars_fragment>
    #include <alphahash_pars_fragment>
    in vec4 vColor;
    in vec3 vPosition;
    void main () {
      float A = -dot(vPosition.xy, vPosition.xy);
      if (A < -4.0) discard;
      float B = exp(A) * vColor.a;
      vec4 diffuseColor = vec4(vColor.rgb, B);
      #include <alphatest_fragment>
      #include <alphahash_fragment>
      gl_FragColor = diffuseColor;
      #include <tonemapping_fragment>
      #include <${sI>=154?"colorspace_fragment":"encodings_fragment"}>
    }
  `);function cn(e){let t=null,r=0;e.onmessage=i=>{if("push"==i.data.method){0===r&&(t=new Float32Array(i.data.length));let e=new Float32Array(i.data.matrices);t.set(e,r),r+=e.length}else if("sort"==i.data.method&&null!==t){let r=function(e,r=!1){let i=t.length/16,n=-1/0,a=1/0,o=new Float32Array(i),s=new Int32Array(o.buffer),l=new Int32Array(i),c=0;for(let s=0;s<i;s++){let i=e[0]*t[16*s+12]+e[1]*t[16*s+13]+e[2]*t[16*s+14]+e[3];(r||i<0&&t[16*s+15]>-.0001*i)&&(o[c]=i,l[c]=s,c++,i>n&&(n=i),i<a&&(a=i))}let u=65535/(n-a),h=new Uint32Array(65536);for(let e=0;e<c;e++)s[e]=(o[e]-a)*u|0,h[s[e]]++;let A=new Uint32Array(65536);for(let e=1;e<65536;e++)A[e]=A[e-1]+h[e-1];let d=new Uint32Array(c);for(let e=0;e<c;e++)d[A[s[e]]++]=l[e];return d}(new Float32Array(i.data.view),i.data.hashed);e.postMessage({indices:r,key:i.data.key},[r.buffer])}}}class ca extends eT.Loader{constructor(...e){super(...e),this.gl=null,this.chunkSize=25e3}load(e,t,r,i){let n={gl:this.gl,url:this.manager.resolveURL(e),worker:new Worker(URL.createObjectURL(new Blob(["(",cn.toString(),")(self)"],{type:"application/javascript"}))),manager:this.manager,update:(e,t,r)=>(function(e,t,r,i){if(e.updateMatrixWorld(),t.gl.getCurrentViewport(r.viewport),r.material.viewport.x=r.viewport.z,r.material.viewport.y=r.viewport.w,r.material.focal=r.viewport.w/2*Math.abs(e.projectionMatrix.elements[5]),r.ready){if(i&&r.sorted)return;r.ready=!1;let e=new Float32Array([r.modelViewMatrix.elements[2],-r.modelViewMatrix.elements[6],r.modelViewMatrix.elements[10],r.modelViewMatrix.elements[14]]);t.worker.postMessage({method:"sort",src:t.url,key:r.uuid,view:e.buffer,hashed:i},[e.buffer]),i&&t.loaded&&(r.sorted=!0)}})(t,n,e,r),connect:e=>(function(e,t){e.loading||cs(e),t.ready=!1,t.pm=new eT.Matrix4,t.vm1=new eT.Matrix4,t.vm2=new eT.Matrix4,t.viewport=new eT.Vector4;let r=new Uint32Array(e.bufferTextureWidth*e.bufferTextureHeight),i=new eT.InstancedBufferAttribute(r,1,!1);i.setUsage(eT.DynamicDrawUsage);let n=t.geometry=new eT.InstancedBufferGeometry,a=new Float32Array(18),o=new eT.BufferAttribute(a,3);function s(e){if(t&&e.data.key===t.uuid){let r=new Uint32Array(e.data.indices);n.attributes.splatIndex.set(r),n.attributes.splatIndex.needsUpdate=!0,n.instanceCount=r.length,t.ready=!0}}return n.setAttribute("position",o),o.setXYZ(2,-2,2,0),o.setXYZ(1,2,2,0),o.setXYZ(0,-2,-2,0),o.setXYZ(5,-2,-2,0),o.setXYZ(4,2,2,0),o.setXYZ(3,2,-2,0),o.needsUpdate=!0,n.setAttribute("splatIndex",i),n.instanceCount=1,e.worker.addEventListener("message",s),async function(){for(;;){let t=e.gl.properties.get(e.centerAndScaleTexture),r=e.gl.properties.get(e.covAndColorTexture);if(null!=t&&t.__webglTexture&&null!=r&&r.__webglTexture&&e.loadedVertexCount>0)break;await new Promise(e=>setTimeout(e,10))}t.ready=!0}(),()=>e.worker.removeEventListener("message",s)})(n,e),loading:!1,loaded:!1,loadedVertexCount:0,chunkSize:this.chunkSize,totalDownloadBytes:0,numVertices:0,rowLength:32,maxVertexes:0,bufferTextureWidth:0,bufferTextureHeight:0,stream:null,centerAndScaleData:null,covAndColorData:null,covAndColorTexture:null,centerAndScaleTexture:null,onProgress:r};co(n).then(t).catch(e=>{null==i||i(e),n.manager.itemError(n.url)})}}async function co(e){e.manager.itemStart(e.url);let t=await fetch(e.url);if(null===t.body)throw"Failed to fetch file";let r=t.headers.get("Content-Length"),i=r?parseInt(r):void 0;if(void 0==i)throw"Failed to get content length";e.stream=t.body.getReader(),e.totalDownloadBytes=i,e.numVertices=Math.floor(e.totalDownloadBytes/e.rowLength);let n=e.gl.getContext(),a=n.getParameter(n.MAX_TEXTURE_SIZE);return e.maxVertexes=a*a,e.numVertices>e.maxVertexes&&(e.numVertices=e.maxVertexes),e.bufferTextureWidth=a,e.bufferTextureHeight=Math.floor((e.numVertices-1)/a)+1,e.centerAndScaleData=new Float32Array(e.bufferTextureWidth*e.bufferTextureHeight*4),e.covAndColorData=new Uint32Array(e.bufferTextureWidth*e.bufferTextureHeight*4),e.centerAndScaleTexture=new eT.DataTexture(e.centerAndScaleData,e.bufferTextureWidth,e.bufferTextureHeight,eT.RGBAFormat,eT.FloatType),e.centerAndScaleTexture.needsUpdate=!0,e.covAndColorTexture=new eT.DataTexture(e.covAndColorData,e.bufferTextureWidth,e.bufferTextureHeight,eT.RGBAIntegerFormat,eT.UnsignedIntType),e.covAndColorTexture.internalFormat="RGBA32UI",e.covAndColorTexture.needsUpdate=!0,e}async function cs(e){e.loading=!0;let t=0,r=0,i=[],n=0,a=0!==e.totalDownloadBytes;for(;;)try{let{value:o,done:s}=await e.stream.read();if(s)break;if(t+=o.length,void 0!=e.totalDownloadBytes){let r=t/e.totalDownloadBytes*100;if(e.onProgress&&r-n>1){let i=new ProgressEvent("progress",{lengthComputable:a,loaded:t,total:e.totalDownloadBytes});e.onProgress(i),n=r}}i.push(o);let l=t-r;if(void 0!=e.totalDownloadBytes&&l>e.rowLength*e.chunkSize){let t=Math.floor(l/e.rowLength),n=new Uint8Array(l),o=0;for(let e of i)n.set(e,o),o+=e.length;if(i.length=0,l>t*e.rowLength){let r=new Uint8Array(l-t*e.rowLength);r.set(n.subarray(l-r.length,l),0),i.push(r)}let s=new Uint8Array(t*e.rowLength);s.set(n.subarray(0,s.byteLength),0);let c=cl(e,s.buffer,t);if(e.worker.postMessage({method:"push",src:e.url,length:16*e.numVertices,matrices:c.buffer},[c.buffer]),r+=t*e.rowLength,e.onProgress){let t=new ProgressEvent("progress",{lengthComputable:a,loaded:e.totalDownloadBytes,total:e.totalDownloadBytes});e.onProgress(t)}}}catch(e){console.error(e);break}if(t-r>0){let t=new Uint8Array(i.reduce((e,t)=>e+t.length,0)),r=0;for(let e of i)t.set(e,r),r+=e.length;let n=Math.floor(t.byteLength/e.rowLength),a=cl(e,t.buffer,n);e.worker.postMessage({method:"push",src:e.url,length:16*n,matrices:a.buffer},[a.buffer])}e.loaded=!0,e.manager.itemEnd(e.url)}function cl(e,t,r){let i=e.gl.getContext();if(e.loadedVertexCount+r>e.maxVertexes&&(r=e.maxVertexes-e.loadedVertexCount),r<=0)throw"Failed to parse file";let n=new Uint8Array(t),a=new Float32Array(t),o=new Float32Array(16*r),s=new Uint8Array(e.covAndColorData.buffer),l=new Int16Array(e.covAndColorData.buffer);for(let t=0;t<r;t++){let r=new eT.Quaternion(-(n[32*t+28+1]-128)/128,(n[32*t+28+2]-128)/128,(n[32*t+28+3]-128)/128,-(n[32*t+28+0]-128)/128);r.invert();let i=new eT.Vector3(a[8*t+0],a[8*t+1],-a[8*t+2]),c=new eT.Vector3(a[8*t+3+0],a[8*t+3+1],a[8*t+3+2]),u=new eT.Matrix4;u.makeRotationFromQuaternion(r),u.transpose(),u.scale(c);let h=u.clone();u.transpose(),u.premultiply(h),u.setPosition(i);let A=[0,1,2,5,6,10],d=0;for(let e=0;e<A.length;e++)Math.abs(u.elements[A[e]])>d&&(d=Math.abs(u.elements[A[e]]));let f=4*e.loadedVertexCount+4*t;e.centerAndScaleData[f+0]=i.x,e.centerAndScaleData[f+1]=-i.y,e.centerAndScaleData[f+2]=i.z,e.centerAndScaleData[f+3]=d/32767,f=8*e.loadedVertexCount+8*t;for(let e=0;e<A.length;e++)l[f+e]=32767*u.elements[A[e]]/d;f=16*e.loadedVertexCount+(4*t+3)*4;let m=new eT.Color(n[32*t+24+0]/255,n[32*t+24+1]/255,n[32*t+24+2]/255);m.convertSRGBToLinear(),s[f+0]=255*m.r,s[f+1]=255*m.g,s[f+2]=255*m.b,s[f+3]=n[32*t+24+3],u.elements[15]=Math.max(c.x,c.y,c.z)*n[32*t+24+3]/255;for(let e=0;e<16;e++)o[16*t+e]=u.elements[e]}for(;r>0;){let t=0,n=0,a=e.loadedVertexCount%e.bufferTextureWidth,o=Math.floor(e.loadedVertexCount/e.bufferTextureWidth);e.loadedVertexCount%e.bufferTextureWidth!=0?(t=Math.min(e.bufferTextureWidth,a+r)-a,n=1):Math.floor(r/e.bufferTextureWidth)>0?(t=e.bufferTextureWidth,n=Math.floor(r/e.bufferTextureWidth)):(t=r%e.bufferTextureWidth,n=1);let s=e.gl.properties.get(e.centerAndScaleTexture);i.bindTexture(i.TEXTURE_2D,s.__webglTexture),i.texSubImage2D(i.TEXTURE_2D,0,a,o,t,n,i.RGBA,i.FLOAT,e.centerAndScaleData,4*e.loadedVertexCount);let l=e.gl.properties.get(e.covAndColorTexture);i.bindTexture(i.TEXTURE_2D,l.__webglTexture),i.texSubImage2D(i.TEXTURE_2D,0,a,o,t,n,i.RGBA_INTEGER,i.UNSIGNED_INT,e.covAndColorData,4*e.loadedVertexCount),e.gl.resetState(),e.loadedVertexCount+=t*n,r-=t*n}return o}function cc({src:e,toneMapped:t=!1,alphaTest:r=0,alphaHash:i=!1,chunkSize:n=25e3,...a}){(0,eR.e)({SplatMaterial:ci});let o=eS.useRef(null),s=(0,eR.D)(e=>e.gl),l=(0,eR.D)(e=>e.camera),c=(0,eR.H)(ca,e,e=>{e.gl=s,e.chunkSize=n});return eS.useLayoutEffect(()=>c.connect(o.current),[e]),(0,eR.F)(()=>c.update(o.current,l,i)),eS.createElement("mesh",j({ref:o,frustumCulled:!1},a),eS.createElement("splatMaterial",{key:`${e}/${r}/${i}${ci.key}`,transparent:!i,depthTest:!0,alphaTest:i?0:r,centerAndScaleTexture:c.centerAndScaleTexture,covAndColorTexture:c.covAndColorTexture,depthWrite:!!i||r>0,blending:i?eT.NormalBlending:eT.CustomBlending,blendSrcAlpha:eT.OneFactor,alphaHash:!!i,toneMapped:t}))}function cu(e,t,r){let i=(0,eR.D)(e=>e.size),n=(0,eR.D)(e=>e.viewport),a="number"==typeof e?e:i.width*n.dpr,o="number"==typeof t?t:i.height*n.dpr,{samples:s=0,depth:l,...c}=("number"==typeof e?r:e)||{},u=eS.useMemo(()=>{let e=new eT.WebGLRenderTarget(a,o,{minFilter:eT.LinearFilter,magFilter:eT.LinearFilter,type:eT.HalfFloatType,...c});return l&&(e.depthTexture=new eT.DepthTexture(a,o,eT.FloatType)),e.samples=s,e},[]);return eS.useLayoutEffect(()=>{u.setSize(a,o),s&&(u.samples=s)},[s,u,a,o]),eS.useEffect(()=>()=>u.dispose(),[]),u}let ch=({children:e,width:t,height:r,...i})=>{let n=cu(t,r,i);return eS.createElement(eS.Fragment,null,null==e?void 0:e(n))},cA=e=>"function"==typeof e,cd=eS.forwardRef(({envMap:e,resolution:t=256,frames:r=1/0,children:i,makeDefault:n,...a},o)=>{let s=(0,eR.D)(({set:e})=>e),l=(0,eR.D)(({camera:e})=>e),c=(0,eR.D)(({size:e})=>e),u=eS.useRef(null);eS.useImperativeHandle(o,()=>u.current,[]);let h=eS.useRef(null),A=cu(t);eS.useLayoutEffect(()=>{a.manual||u.current.updateProjectionMatrix()},[c,a]),eS.useLayoutEffect(()=>{u.current.updateProjectionMatrix()}),eS.useLayoutEffect(()=>{if(n)return s(()=>({camera:u.current})),()=>s(()=>({camera:l}))},[u,n,s]);let d=0,f=null,m=cA(i);return(0,eR.F)(t=>{m&&(r===1/0||d<r)&&(h.current.visible=!1,t.gl.setRenderTarget(A),f=t.scene.background,e&&(t.scene.background=e),t.gl.render(t.scene,u.current),t.scene.background=f,t.gl.setRenderTarget(null),h.current.visible=!0,d++)}),eS.createElement(eS.Fragment,null,eS.createElement("orthographicCamera",j({left:-(c.width/2),right:c.width/2,top:c.height/2,bottom:-(c.height/2),ref:u},a),!m&&i),eS.createElement("group",{ref:h},m&&i(A.texture)))}),cf=e=>"function"==typeof e,cm=eS.forwardRef(({envMap:e,resolution:t=256,frames:r=1/0,makeDefault:i,children:n,...a},o)=>{let s=(0,eR.D)(({set:e})=>e),l=(0,eR.D)(({camera:e})=>e),c=(0,eR.D)(({size:e})=>e),u=eS.useRef(null);eS.useImperativeHandle(o,()=>u.current,[]);let h=eS.useRef(null),A=cu(t);eS.useLayoutEffect(()=>{a.manual||(u.current.aspect=c.width/c.height)},[c,a]),eS.useLayoutEffect(()=>{u.current.updateProjectionMatrix()});let d=0,f=null,m=cf(n);return(0,eR.F)(t=>{m&&(r===1/0||d<r)&&(h.current.visible=!1,t.gl.setRenderTarget(A),f=t.scene.background,e&&(t.scene.background=e),t.gl.render(t.scene,u.current),t.scene.background=f,t.gl.setRenderTarget(null),h.current.visible=!0,d++)}),eS.useLayoutEffect(()=>{if(i)return s(()=>({camera:u.current})),()=>s(()=>({camera:l}))},[u,i,s]),eS.createElement(eS.Fragment,null,eS.createElement("perspectiveCamera",j({ref:u},a),!m&&n),eS.createElement("group",{ref:h},m&&n(A.texture)))});function cp({resolution:e=256,near:t=.1,far:r=1e3,envMap:i,fog:n}={}){let a,o;let s=(0,eR.D)(({gl:e})=>e),l=(0,eR.D)(({scene:e})=>e),c=(0,eS.useMemo)(()=>{let t=new eT.WebGLCubeRenderTarget(e);return t.texture.type=eT.HalfFloatType,t},[e]);(0,eS.useEffect)(()=>()=>{c.dispose()},[c]);let u=(0,eS.useMemo)(()=>new eT.CubeCamera(t,r,c),[t,r,c]),h=eS.useCallback(()=>{a=l.fog,o=l.background,l.background=i||o,l.fog=n||a,u.update(s,l),l.fog=a,l.background=o},[s,l,u]);return{fbo:c,camera:u,update:h}}function cg({children:e,frames:t=1/0,resolution:r,near:i,far:n,envMap:a,fog:o,...s}){let l=eS.useRef(null),{fbo:c,camera:u,update:h}=cp({resolution:r,near:i,far:n,envMap:a,fog:o}),A=0;return(0,eR.F)(()=>{l.current&&(t===1/0||A<t)&&(l.current.visible=!1,h(),l.current.visible=!0,A++)}),eS.createElement("group",s,eS.createElement("primitive",{object:u}),eS.createElement("group",{ref:l},null==e?void 0:e(c.texture)))}var cy=Object.defineProperty,cv=(e,t,r)=>t in e?cy(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,cE=(e,t,r)=>(cv(e,"symbol"!=typeof t?t+"":t,r),r);class cx{constructor(){cE(this,"_listeners")}addEventListener(e,t){void 0===this._listeners&&(this._listeners={});let r=this._listeners;void 0===r[e]&&(r[e]=[]),-1===r[e].indexOf(t)&&r[e].push(t)}hasEventListener(e,t){if(void 0===this._listeners)return!1;let r=this._listeners;return void 0!==r[e]&&-1!==r[e].indexOf(t)}removeEventListener(e,t){if(void 0===this._listeners)return;let r=this._listeners[e];if(void 0!==r){let e=r.indexOf(t);-1!==e&&r.splice(e,1)}}dispatchEvent(e){if(void 0===this._listeners)return;let t=this._listeners[e.type];if(void 0!==t){e.target=this;let r=t.slice(0);for(let t=0,i=r.length;t<i;t++)r[t].call(this,e);e.target=null}}}var cC=Object.defineProperty,cB=(e,t,r)=>t in e?cC(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,cw=(e,t,r)=>(cB(e,"symbol"!=typeof t?t+"":t,r),r);class cI extends cx{constructor(e){super(),cw(this,"object"),cw(this,"changeEvent",{type:"change"}),cw(this,"EPS",1e-6),cw(this,"enabled",!0),cw(this,"deviceOrientation",{alpha:0,beta:0,gamma:0}),cw(this,"screenOrientation",0),cw(this,"alphaOffset",0),cw(this,"onDeviceOrientationChangeEvent",e=>{this.deviceOrientation=e}),cw(this,"onScreenOrientationChangeEvent",()=>{this.screenOrientation=window.orientation||0}),cw(this,"zee",new eT.Vector3(0,0,1)),cw(this,"euler",new eT.Euler),cw(this,"q0",new eT.Quaternion),cw(this,"q1",new eT.Quaternion(-Math.sqrt(.5),0,0,Math.sqrt(.5))),cw(this,"setObjectQuaternion",(e,t,r,i,n)=>{this.euler.set(r,t,-i,"YXZ"),e.setFromEuler(this.euler),e.multiply(this.q1),e.multiply(this.q0.setFromAxisAngle(this.zee,-n))}),cw(this,"connect",()=>{this.onScreenOrientationChangeEvent(),void 0!==window.DeviceOrientationEvent&&"function"==typeof window.DeviceOrientationEvent.requestPermission?window.DeviceOrientationEvent.requestPermission().then(e=>{"granted"==e&&(window.addEventListener("orientationchange",this.onScreenOrientationChangeEvent),window.addEventListener("deviceorientation",this.onDeviceOrientationChangeEvent))}).catch(e=>{console.error("THREE.DeviceOrientationControls: Unable to use DeviceOrientation API:",e)}):(window.addEventListener("orientationchange",this.onScreenOrientationChangeEvent),window.addEventListener("deviceorientation",this.onDeviceOrientationChangeEvent)),this.enabled=!0}),cw(this,"disconnect",()=>{window.removeEventListener("orientationchange",this.onScreenOrientationChangeEvent),window.removeEventListener("deviceorientation",this.onDeviceOrientationChangeEvent),this.enabled=!1}),cw(this,"lastQuaternion",new eT.Quaternion),cw(this,"update",()=>{if(!1===this.enabled)return;let e=this.deviceOrientation;if(e){let t=e.alpha?eT.MathUtils.degToRad(e.alpha)+this.alphaOffset:0,r=e.beta?eT.MathUtils.degToRad(e.beta):0,i=e.gamma?eT.MathUtils.degToRad(e.gamma):0,n=this.screenOrientation?eT.MathUtils.degToRad(this.screenOrientation):0;this.setObjectQuaternion(this.object.quaternion,t,r,i,n),8*(1-this.lastQuaternion.dot(this.object.quaternion))>this.EPS&&(this.lastQuaternion.copy(this.object.quaternion),this.dispatchEvent(this.changeEvent))}}),cw(this,"dispose",()=>this.disconnect()),this.object=e,this.object.rotation.reorder("YXZ"),this.connect()}}let cb=eS.forwardRef((e,t)=>{let{camera:r,onChange:i,makeDefault:n,...a}=e,o=(0,eR.D)(e=>e.camera),s=(0,eR.D)(e=>e.invalidate),l=(0,eR.D)(e=>e.get),c=(0,eR.D)(e=>e.set),u=r||o,h=eS.useMemo(()=>new cI(u),[u]);return eS.useEffect(()=>{let e=e=>{s(),i&&i(e)};return null==h||null==h.addEventListener||h.addEventListener("change",e),()=>null==h||null==h.removeEventListener?void 0:h.removeEventListener("change",e)},[i,h,s]),(0,eR.F)(()=>null==h?void 0:h.update(),-1),eS.useEffect(()=>(null==h||h.connect(),()=>null==h?void 0:h.dispose()),[h]),eS.useEffect(()=>{if(n){let e=l().controls;return c({controls:h}),()=>c({controls:e})}},[n,h]),h?eS.createElement("primitive",j({ref:t,object:h},a)):null});var c_=Object.defineProperty,cM=(e,t,r)=>t in e?c_(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,cS=(e,t,r)=>(cM(e,"symbol"!=typeof t?t+"":t,r),r);function cD(e){e.preventDefault()}class cT extends cx{constructor(e,t){super(),cS(this,"object"),cS(this,"domElement",null),cS(this,"movementSpeed",1),cS(this,"rollSpeed",.005),cS(this,"dragToLook",!1),cS(this,"autoForward",!1),cS(this,"changeEvent",{type:"change"}),cS(this,"EPS",1e-6),cS(this,"tmpQuaternion",new eT.Quaternion),cS(this,"mouseStatus",0),cS(this,"movementSpeedMultiplier",1),cS(this,"moveState",{up:0,down:0,left:0,right:0,forward:0,back:0,pitchUp:0,pitchDown:0,yawLeft:0,yawRight:0,rollLeft:0,rollRight:0}),cS(this,"moveVector",new eT.Vector3(0,0,0)),cS(this,"rotationVector",new eT.Vector3(0,0,0)),cS(this,"keydown",e=>{if(!e.altKey){switch(e.code){case"ShiftLeft":case"ShiftRight":this.movementSpeedMultiplier=.1;break;case"KeyW":this.moveState.forward=1;break;case"KeyS":this.moveState.back=1;break;case"KeyA":this.moveState.left=1;break;case"KeyD":this.moveState.right=1;break;case"KeyR":this.moveState.up=1;break;case"KeyF":this.moveState.down=1;break;case"ArrowUp":this.moveState.pitchUp=1;break;case"ArrowDown":this.moveState.pitchDown=1;break;case"ArrowLeft":this.moveState.yawLeft=1;break;case"ArrowRight":this.moveState.yawRight=1;break;case"KeyQ":this.moveState.rollLeft=1;break;case"KeyE":this.moveState.rollRight=1}this.updateMovementVector(),this.updateRotationVector()}}),cS(this,"keyup",e=>{switch(e.code){case"ShiftLeft":case"ShiftRight":this.movementSpeedMultiplier=1;break;case"KeyW":this.moveState.forward=0;break;case"KeyS":this.moveState.back=0;break;case"KeyA":this.moveState.left=0;break;case"KeyD":this.moveState.right=0;break;case"KeyR":this.moveState.up=0;break;case"KeyF":this.moveState.down=0;break;case"ArrowUp":this.moveState.pitchUp=0;break;case"ArrowDown":this.moveState.pitchDown=0;break;case"ArrowLeft":this.moveState.yawLeft=0;break;case"ArrowRight":this.moveState.yawRight=0;break;case"KeyQ":this.moveState.rollLeft=0;break;case"KeyE":this.moveState.rollRight=0}this.updateMovementVector(),this.updateRotationVector()}),cS(this,"pointerdown",e=>{if(this.dragToLook)this.mouseStatus++;else{switch(e.button){case 0:this.moveState.forward=1;break;case 2:this.moveState.back=1}this.updateMovementVector()}}),cS(this,"pointermove",e=>{if(!this.dragToLook||this.mouseStatus>0){let t=this.getContainerDimensions(),r=t.size[0]/2,i=t.size[1]/2;this.moveState.yawLeft=-(e.pageX-t.offset[0]-r)/r,this.moveState.pitchDown=(e.pageY-t.offset[1]-i)/i,this.updateRotationVector()}}),cS(this,"pointerup",e=>{if(this.dragToLook)this.mouseStatus--,this.moveState.yawLeft=this.moveState.pitchDown=0;else{switch(e.button){case 0:this.moveState.forward=0;break;case 2:this.moveState.back=0}this.updateMovementVector()}this.updateRotationVector()}),cS(this,"lastQuaternion",new eT.Quaternion),cS(this,"lastPosition",new eT.Vector3),cS(this,"update",e=>{let t=e*this.movementSpeed,r=e*this.rollSpeed;this.object.translateX(this.moveVector.x*t),this.object.translateY(this.moveVector.y*t),this.object.translateZ(this.moveVector.z*t),this.tmpQuaternion.set(this.rotationVector.x*r,this.rotationVector.y*r,this.rotationVector.z*r,1).normalize(),this.object.quaternion.multiply(this.tmpQuaternion),(this.lastPosition.distanceToSquared(this.object.position)>this.EPS||8*(1-this.lastQuaternion.dot(this.object.quaternion))>this.EPS)&&(this.dispatchEvent(this.changeEvent),this.lastQuaternion.copy(this.object.quaternion),this.lastPosition.copy(this.object.position))}),cS(this,"updateMovementVector",()=>{let e=this.moveState.forward||this.autoForward&&!this.moveState.back?1:0;this.moveVector.x=-this.moveState.left+this.moveState.right,this.moveVector.y=-this.moveState.down+this.moveState.up,this.moveVector.z=-e+this.moveState.back}),cS(this,"updateRotationVector",()=>{this.rotationVector.x=-this.moveState.pitchDown+this.moveState.pitchUp,this.rotationVector.y=-this.moveState.yawRight+this.moveState.yawLeft,this.rotationVector.z=-this.moveState.rollRight+this.moveState.rollLeft}),cS(this,"getContainerDimensions",()=>this.domElement==document||this.domElement instanceof Document?{size:[window.innerWidth,window.innerHeight],offset:[0,0]}:{size:[this.domElement.offsetWidth,this.domElement.offsetHeight],offset:[this.domElement.offsetLeft,this.domElement.offsetTop]}),cS(this,"connect",e=>{this.domElement=e,e instanceof Document||e.setAttribute("tabindex",-1),this.domElement.addEventListener("contextmenu",cD),this.domElement.addEventListener("pointermove",this.pointermove),this.domElement.addEventListener("pointerdown",this.pointerdown),this.domElement.addEventListener("pointerup",this.pointerup),window.addEventListener("keydown",this.keydown),window.addEventListener("keyup",this.keyup)}),cS(this,"dispose",()=>{this.domElement.removeEventListener("contextmenu",cD),this.domElement.removeEventListener("pointermove",this.pointermove),this.domElement.removeEventListener("pointerdown",this.pointerdown),this.domElement.removeEventListener("pointerup",this.pointerup),window.removeEventListener("keydown",this.keydown),window.removeEventListener("keyup",this.keyup)}),this.object=e,void 0!==t&&this.connect(t),this.updateMovementVector(),this.updateRotationVector()}}let cR=eS.forwardRef(({domElement:e,...t},r)=>{let{onChange:i,makeDefault:n,...a}=t,o=(0,eR.D)(e=>e.invalidate),s=(0,eR.D)(e=>e.camera),l=(0,eR.D)(e=>e.gl),c=(0,eR.D)(e=>e.events),u=(0,eR.D)(e=>e.get),h=(0,eR.D)(e=>e.set),A=e||c.connected||l.domElement,d=eS.useMemo(()=>new cT(s),[s]);return eS.useEffect(()=>(d.connect(A),()=>void d.dispose()),[A,d,o]),eS.useEffect(()=>{let e=e=>{o(),i&&i(e)};return null==d.addEventListener||d.addEventListener("change",e),()=>null==d.removeEventListener?void 0:d.removeEventListener("change",e)},[i,o]),eS.useEffect(()=>{if(n){let e=u().controls;return h({controls:d}),()=>h({controls:e})}},[n,d]),(0,eR.F)((e,t)=>d.update(t)),eS.createElement("primitive",j({ref:r,object:d,args:[s,A]},a))});var cF=Object.defineProperty,cP=(e,t,r)=>t in e?cF(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,cQ=(e,t,r)=>(cP(e,"symbol"!=typeof t?t+"":t,r),r);let cz=new eT.Ray,cL=new eT.Plane,cO=Math.cos(Math.PI/180*70),cU=(e,t)=>(e%t+t)%t;class ck extends cx{constructor(e,t){super(),cQ(this,"object"),cQ(this,"domElement"),cQ(this,"enabled",!0),cQ(this,"target",new eT.Vector3),cQ(this,"minDistance",0),cQ(this,"maxDistance",1/0),cQ(this,"minZoom",0),cQ(this,"maxZoom",1/0),cQ(this,"minPolarAngle",0),cQ(this,"maxPolarAngle",Math.PI),cQ(this,"minAzimuthAngle",-1/0),cQ(this,"maxAzimuthAngle",1/0),cQ(this,"enableDamping",!1),cQ(this,"dampingFactor",.05),cQ(this,"enableZoom",!0),cQ(this,"zoomSpeed",1),cQ(this,"enableRotate",!0),cQ(this,"rotateSpeed",1),cQ(this,"enablePan",!0),cQ(this,"panSpeed",1),cQ(this,"screenSpacePanning",!0),cQ(this,"keyPanSpeed",7),cQ(this,"zoomToCursor",!1),cQ(this,"autoRotate",!1),cQ(this,"autoRotateSpeed",2),cQ(this,"reverseOrbit",!1),cQ(this,"reverseHorizontalOrbit",!1),cQ(this,"reverseVerticalOrbit",!1),cQ(this,"keys",{LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"}),cQ(this,"mouseButtons",{LEFT:eT.MOUSE.ROTATE,MIDDLE:eT.MOUSE.DOLLY,RIGHT:eT.MOUSE.PAN}),cQ(this,"touches",{ONE:eT.TOUCH.ROTATE,TWO:eT.TOUCH.DOLLY_PAN}),cQ(this,"target0"),cQ(this,"position0"),cQ(this,"zoom0"),cQ(this,"_domElementKeyEvents",null),cQ(this,"getPolarAngle"),cQ(this,"getAzimuthalAngle"),cQ(this,"setPolarAngle"),cQ(this,"setAzimuthalAngle"),cQ(this,"getDistance"),cQ(this,"getZoomScale"),cQ(this,"listenToKeyEvents"),cQ(this,"stopListenToKeyEvents"),cQ(this,"saveState"),cQ(this,"reset"),cQ(this,"update"),cQ(this,"connect"),cQ(this,"dispose"),cQ(this,"dollyIn"),cQ(this,"dollyOut"),cQ(this,"getScale"),cQ(this,"setScale"),this.object=e,this.domElement=t,this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.getPolarAngle=()=>c.phi,this.getAzimuthalAngle=()=>c.theta,this.setPolarAngle=e=>{let t=cU(e,2*Math.PI),i=c.phi;i<0&&(i+=2*Math.PI),t<0&&(t+=2*Math.PI);let n=Math.abs(t-i);2*Math.PI-n<n&&(t<i?t+=2*Math.PI:i+=2*Math.PI),u.phi=t-i,r.update()},this.setAzimuthalAngle=e=>{let t=cU(e,2*Math.PI),i=c.theta;i<0&&(i+=2*Math.PI),t<0&&(t+=2*Math.PI);let n=Math.abs(t-i);2*Math.PI-n<n&&(t<i?t+=2*Math.PI:i+=2*Math.PI),u.theta=t-i,r.update()},this.getDistance=()=>r.object.position.distanceTo(r.target),this.listenToKeyEvents=e=>{e.addEventListener("keydown",W),this._domElementKeyEvents=e},this.stopListenToKeyEvents=()=>{this._domElementKeyEvents.removeEventListener("keydown",W),this._domElementKeyEvents=null},this.saveState=()=>{r.target0.copy(r.target),r.position0.copy(r.object.position),r.zoom0=r.object.zoom},this.reset=()=>{r.target.copy(r.target0),r.object.position.copy(r.position0),r.object.zoom=r.zoom0,r.object.updateProjectionMatrix(),r.dispatchEvent(i),r.update(),s=o.NONE},this.update=(()=>{let t=new eT.Vector3,n=new eT.Vector3(0,1,0),a=new eT.Quaternion().setFromUnitVectors(e.up,n),d=a.clone().invert(),f=new eT.Vector3,m=new eT.Quaternion,p=2*Math.PI;return function(){let g=r.object.position;a.setFromUnitVectors(e.up,n),d.copy(a).invert(),t.copy(g).sub(r.target),t.applyQuaternion(a),c.setFromVector3(t),r.autoRotate&&s===o.NONE&&M(2*Math.PI/60/60*r.autoRotateSpeed),r.enableDamping?(c.theta+=u.theta*r.dampingFactor,c.phi+=u.phi*r.dampingFactor):(c.theta+=u.theta,c.phi+=u.phi);let y=r.minAzimuthAngle,v=r.maxAzimuthAngle;isFinite(y)&&isFinite(v)&&(y<-Math.PI?y+=p:y>Math.PI&&(y-=p),v<-Math.PI?v+=p:v>Math.PI&&(v-=p),y<=v?c.theta=Math.max(y,Math.min(v,c.theta)):c.theta=c.theta>(y+v)/2?Math.max(y,c.theta):Math.min(v,c.theta)),c.phi=Math.max(r.minPolarAngle,Math.min(r.maxPolarAngle,c.phi)),c.makeSafe(),!0===r.enableDamping?r.target.addScaledVector(A,r.dampingFactor):r.target.add(A),r.zoomToCursor&&w||r.object.isOrthographicCamera?c.radius=Q(c.radius):c.radius=Q(c.radius*h),t.setFromSpherical(c),t.applyQuaternion(d),g.copy(r.target).add(t),r.object.matrixAutoUpdate||r.object.updateMatrix(),r.object.lookAt(r.target),!0===r.enableDamping?(u.theta*=1-r.dampingFactor,u.phi*=1-r.dampingFactor,A.multiplyScalar(1-r.dampingFactor)):(u.set(0,0,0),A.set(0,0,0));let E=!1;if(r.zoomToCursor&&w){let i=null;if(r.object instanceof eT.PerspectiveCamera&&r.object.isPerspectiveCamera){let e=t.length();i=Q(e*h);let n=e-i;r.object.position.addScaledVector(C,n),r.object.updateMatrixWorld()}else if(r.object.isOrthographicCamera){let e=new eT.Vector3(B.x,B.y,0);e.unproject(r.object),r.object.zoom=Math.max(r.minZoom,Math.min(r.maxZoom,r.object.zoom/h)),r.object.updateProjectionMatrix(),E=!0;let n=new eT.Vector3(B.x,B.y,0);n.unproject(r.object),r.object.position.sub(n).add(e),r.object.updateMatrixWorld(),i=t.length()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),r.zoomToCursor=!1;null!==i&&(r.screenSpacePanning?r.target.set(0,0,-1).transformDirection(r.object.matrix).multiplyScalar(i).add(r.object.position):(cz.origin.copy(r.object.position),cz.direction.set(0,0,-1).transformDirection(r.object.matrix),Math.abs(r.object.up.dot(cz.direction))<cO?e.lookAt(r.target):(cL.setFromNormalAndCoplanarPoint(r.object.up,r.target),cz.intersectPlane(cL,r.target))))}else r.object instanceof eT.OrthographicCamera&&r.object.isOrthographicCamera&&(E=1!==h)&&(r.object.zoom=Math.max(r.minZoom,Math.min(r.maxZoom,r.object.zoom/h)),r.object.updateProjectionMatrix());return h=1,w=!1,!!(E||f.distanceToSquared(r.object.position)>l||8*(1-m.dot(r.object.quaternion))>l)&&(r.dispatchEvent(i),f.copy(r.object.position),m.copy(r.object.quaternion),E=!1,!0)}})(),this.connect=e=>{r.domElement=e,r.domElement.style.touchAction="none",r.domElement.addEventListener("contextmenu",K),r.domElement.addEventListener("pointerdown",V),r.domElement.addEventListener("pointercancel",J),r.domElement.addEventListener("wheel",Y)},this.dispose=()=>{var e,t,i,n,a,o;r.domElement&&(r.domElement.style.touchAction="auto"),null==(e=r.domElement)||e.removeEventListener("contextmenu",K),null==(t=r.domElement)||t.removeEventListener("pointerdown",V),null==(i=r.domElement)||i.removeEventListener("pointercancel",J),null==(n=r.domElement)||n.removeEventListener("wheel",Y),null==(a=r.domElement)||a.ownerDocument.removeEventListener("pointermove",j),null==(o=r.domElement)||o.ownerDocument.removeEventListener("pointerup",J),null!==r._domElementKeyEvents&&r._domElementKeyEvents.removeEventListener("keydown",W)};let r=this,i={type:"change"},n={type:"start"},a={type:"end"},o={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6},s=o.NONE,l=1e-6,c=new eT.Spherical,u=new eT.Spherical,h=1,A=new eT.Vector3,d=new eT.Vector2,f=new eT.Vector2,m=new eT.Vector2,p=new eT.Vector2,g=new eT.Vector2,y=new eT.Vector2,v=new eT.Vector2,E=new eT.Vector2,x=new eT.Vector2,C=new eT.Vector3,B=new eT.Vector2,w=!1,I=[],b={};function _(){return Math.pow(.95,r.zoomSpeed)}function M(e){r.reverseOrbit||r.reverseHorizontalOrbit?u.theta+=e:u.theta-=e}function S(e){r.reverseOrbit||r.reverseVerticalOrbit?u.phi+=e:u.phi-=e}let D=(()=>{let e=new eT.Vector3;return function(t,r){e.setFromMatrixColumn(r,0),e.multiplyScalar(-t),A.add(e)}})(),T=(()=>{let e=new eT.Vector3;return function(t,i){!0===r.screenSpacePanning?e.setFromMatrixColumn(i,1):(e.setFromMatrixColumn(i,0),e.crossVectors(r.object.up,e)),e.multiplyScalar(t),A.add(e)}})(),R=(()=>{let e=new eT.Vector3;return function(t,i){let n=r.domElement;if(n&&r.object instanceof eT.PerspectiveCamera&&r.object.isPerspectiveCamera){let a=r.object.position;e.copy(a).sub(r.target);let o=e.length();D(2*t*(o*=Math.tan(r.object.fov/2*Math.PI/180))/n.clientHeight,r.object.matrix),T(2*i*o/n.clientHeight,r.object.matrix)}else n&&r.object instanceof eT.OrthographicCamera&&r.object.isOrthographicCamera?(D(t*(r.object.right-r.object.left)/r.object.zoom/n.clientWidth,r.object.matrix),T(i*(r.object.top-r.object.bottom)/r.object.zoom/n.clientHeight,r.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),r.enablePan=!1)}})();function F(e){r.object instanceof eT.PerspectiveCamera&&r.object.isPerspectiveCamera||r.object instanceof eT.OrthographicCamera&&r.object.isOrthographicCamera?h=e:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),r.enableZoom=!1)}function P(e){if(!r.zoomToCursor||!r.domElement)return;w=!0;let t=r.domElement.getBoundingClientRect(),i=e.clientX-t.left,n=e.clientY-t.top,a=t.width,o=t.height;B.x=i/a*2-1,B.y=-(n/o*2)+1,C.set(B.x,B.y,1).unproject(r.object).sub(r.object.position).normalize()}function Q(e){return Math.max(r.minDistance,Math.min(r.maxDistance,e))}function z(e){d.set(e.clientX,e.clientY)}function L(e){p.set(e.clientX,e.clientY)}function O(){if(1==I.length)d.set(I[0].pageX,I[0].pageY);else{let e=.5*(I[0].pageX+I[1].pageX),t=.5*(I[0].pageY+I[1].pageY);d.set(e,t)}}function U(){if(1==I.length)p.set(I[0].pageX,I[0].pageY);else{let e=.5*(I[0].pageX+I[1].pageX),t=.5*(I[0].pageY+I[1].pageY);p.set(e,t)}}function k(){let e=I[0].pageX-I[1].pageX,t=I[0].pageY-I[1].pageY;v.set(0,Math.sqrt(e*e+t*t))}function G(e){if(1==I.length)f.set(e.pageX,e.pageY);else{let t=X(e),r=.5*(e.pageX+t.x),i=.5*(e.pageY+t.y);f.set(r,i)}m.subVectors(f,d).multiplyScalar(r.rotateSpeed);let t=r.domElement;t&&(M(2*Math.PI*m.x/t.clientHeight),S(2*Math.PI*m.y/t.clientHeight)),d.copy(f)}function N(e){if(1==I.length)g.set(e.pageX,e.pageY);else{let t=X(e),r=.5*(e.pageX+t.x),i=.5*(e.pageY+t.y);g.set(r,i)}y.subVectors(g,p).multiplyScalar(r.panSpeed),R(y.x,y.y),p.copy(g)}function H(e){var t;let i=X(e),n=e.pageX-i.x,a=e.pageY-i.y;E.set(0,Math.sqrt(n*n+a*a)),x.set(0,Math.pow(E.y/v.y,r.zoomSpeed)),t=x.y,F(h/t),v.copy(E)}function V(e){var t,i;!1!==r.enabled&&(0===I.length&&(null==(t=r.domElement)||t.ownerDocument.addEventListener("pointermove",j),null==(i=r.domElement)||i.ownerDocument.addEventListener("pointerup",J)),I.push(e),"touch"===e.pointerType?function(e){switch(q(e),I.length){case 1:switch(r.touches.ONE){case eT.TOUCH.ROTATE:if(!1===r.enableRotate)return;O(),s=o.TOUCH_ROTATE;break;case eT.TOUCH.PAN:if(!1===r.enablePan)return;U(),s=o.TOUCH_PAN;break;default:s=o.NONE}break;case 2:switch(r.touches.TWO){case eT.TOUCH.DOLLY_PAN:if(!1===r.enableZoom&&!1===r.enablePan)return;r.enableZoom&&k(),r.enablePan&&U(),s=o.TOUCH_DOLLY_PAN;break;case eT.TOUCH.DOLLY_ROTATE:if(!1===r.enableZoom&&!1===r.enableRotate)return;r.enableZoom&&k(),r.enableRotate&&O(),s=o.TOUCH_DOLLY_ROTATE;break;default:s=o.NONE}break;default:s=o.NONE}s!==o.NONE&&r.dispatchEvent(n)}(e):function(e){let t;switch(e.button){case 0:t=r.mouseButtons.LEFT;break;case 1:t=r.mouseButtons.MIDDLE;break;case 2:t=r.mouseButtons.RIGHT;break;default:t=-1}switch(t){case eT.MOUSE.DOLLY:if(!1===r.enableZoom)return;P(e),v.set(e.clientX,e.clientY),s=o.DOLLY;break;case eT.MOUSE.ROTATE:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===r.enablePan)return;L(e),s=o.PAN}else{if(!1===r.enableRotate)return;z(e),s=o.ROTATE}break;case eT.MOUSE.PAN:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===r.enableRotate)return;z(e),s=o.ROTATE}else{if(!1===r.enablePan)return;L(e),s=o.PAN}break;default:s=o.NONE}s!==o.NONE&&r.dispatchEvent(n)}(e))}function j(e){!1!==r.enabled&&("touch"===e.pointerType?function(e){switch(q(e),s){case o.TOUCH_ROTATE:if(!1===r.enableRotate)return;G(e),r.update();break;case o.TOUCH_PAN:if(!1===r.enablePan)return;N(e),r.update();break;case o.TOUCH_DOLLY_PAN:if(!1===r.enableZoom&&!1===r.enablePan)return;r.enableZoom&&H(e),r.enablePan&&N(e),r.update();break;case o.TOUCH_DOLLY_ROTATE:if(!1===r.enableZoom&&!1===r.enableRotate)return;r.enableZoom&&H(e),r.enableRotate&&G(e),r.update();break;default:s=o.NONE}}(e):function(e){if(!1!==r.enabled)switch(s){case o.ROTATE:if(!1===r.enableRotate)return;!function(e){f.set(e.clientX,e.clientY),m.subVectors(f,d).multiplyScalar(r.rotateSpeed);let t=r.domElement;t&&(M(2*Math.PI*m.x/t.clientHeight),S(2*Math.PI*m.y/t.clientHeight)),d.copy(f),r.update()}(e);break;case o.DOLLY:var t,i;if(!1===r.enableZoom)return;(E.set(e.clientX,e.clientY),x.subVectors(E,v),x.y>0)?(t=_(),F(h/t)):x.y<0&&(i=_(),F(h*i)),v.copy(E),r.update();break;case o.PAN:if(!1===r.enablePan)return;g.set(e.clientX,e.clientY),y.subVectors(g,p).multiplyScalar(r.panSpeed),R(y.x,y.y),p.copy(g),r.update()}}(e))}function J(e){var t,i,n;(function(e){delete b[e.pointerId];for(let t=0;t<I.length;t++)if(I[t].pointerId==e.pointerId){I.splice(t,1);return}})(e),0===I.length&&(null==(t=r.domElement)||t.releasePointerCapture(e.pointerId),null==(i=r.domElement)||i.ownerDocument.removeEventListener("pointermove",j),null==(n=r.domElement)||n.ownerDocument.removeEventListener("pointerup",J)),r.dispatchEvent(a),s=o.NONE}function Y(e){if(!1!==r.enabled&&!1!==r.enableZoom&&(s===o.NONE||s===o.ROTATE)){var t,i;e.preventDefault(),r.dispatchEvent(n),(P(e),e.deltaY<0)?(t=_(),F(h*t)):e.deltaY>0&&(i=_(),F(h/i)),r.update(),r.dispatchEvent(a)}}function W(e){!1!==r.enabled&&!1!==r.enablePan&&function(e){let t=!1;switch(e.code){case r.keys.UP:R(0,r.keyPanSpeed),t=!0;break;case r.keys.BOTTOM:R(0,-r.keyPanSpeed),t=!0;break;case r.keys.LEFT:R(r.keyPanSpeed,0),t=!0;break;case r.keys.RIGHT:R(-r.keyPanSpeed,0),t=!0}t&&(e.preventDefault(),r.update())}(e)}function K(e){!1!==r.enabled&&e.preventDefault()}function q(e){let t=b[e.pointerId];void 0===t&&(t=new eT.Vector2,b[e.pointerId]=t),t.set(e.pageX,e.pageY)}function X(e){return b[(e.pointerId===I[0].pointerId?I[1]:I[0]).pointerId]}this.dollyIn=(e=_())=>{F(h*e),r.update()},this.dollyOut=(e=_())=>{F(h/e),r.update()},this.getScale=()=>h,this.setScale=e=>{F(e),r.update()},this.getZoomScale=()=>_(),void 0!==t&&this.connect(t),this.update()}}class cG extends ck{constructor(e,t){super(e,t),this.screenSpacePanning=!1,this.mouseButtons.LEFT=eT.MOUSE.PAN,this.mouseButtons.RIGHT=eT.MOUSE.ROTATE,this.touches.ONE=eT.TOUCH.PAN,this.touches.TWO=eT.TOUCH.DOLLY_ROTATE}}let cN=eS.forwardRef((e={enableDamping:!0},t)=>{let{domElement:r,camera:i,makeDefault:n,onChange:a,onStart:o,onEnd:s,...l}=e,c=(0,eR.D)(e=>e.invalidate),u=(0,eR.D)(e=>e.camera),h=(0,eR.D)(e=>e.gl),A=(0,eR.D)(e=>e.events),d=(0,eR.D)(e=>e.set),f=(0,eR.D)(e=>e.get),m=r||A.connected||h.domElement,p=i||u,g=eS.useMemo(()=>new cG(p),[p]);return eS.useEffect(()=>{g.connect(m);let e=e=>{c(),a&&a(e)};return g.addEventListener("change",e),o&&g.addEventListener("start",o),s&&g.addEventListener("end",s),()=>{g.dispose(),g.removeEventListener("change",e),o&&g.removeEventListener("start",o),s&&g.removeEventListener("end",s)}},[a,o,s,g,c,m]),eS.useEffect(()=>{if(n){let e=f().controls;return d({controls:g}),()=>d({controls:e})}},[n,g]),(0,eR.F)(()=>g.update(),-1),eS.createElement("primitive",j({ref:t,object:g,enableDamping:!0},l))}),cH=eS.forwardRef(({makeDefault:e,camera:t,regress:r,domElement:i,enableDamping:n=!0,keyEvents:a=!1,onChange:o,onStart:s,onEnd:l,...c},u)=>{let h=(0,eR.D)(e=>e.invalidate),A=(0,eR.D)(e=>e.camera),d=(0,eR.D)(e=>e.gl),f=(0,eR.D)(e=>e.events),m=(0,eR.D)(e=>e.setEvents),p=(0,eR.D)(e=>e.set),g=(0,eR.D)(e=>e.get),y=(0,eR.D)(e=>e.performance),v=t||A,E=i||f.connected||d.domElement,x=eS.useMemo(()=>new ck(v),[v]);return(0,eR.F)(()=>{x.enabled&&x.update()},-1),eS.useEffect(()=>(a&&x.connect(!0===a?E:a),x.connect(E),()=>void x.dispose()),[a,E,r,x,h]),eS.useEffect(()=>{let e=e=>{h(),r&&y.regress(),o&&o(e)},t=e=>{s&&s(e)},i=e=>{l&&l(e)};return x.addEventListener("change",e),x.addEventListener("start",t),x.addEventListener("end",i),()=>{x.removeEventListener("start",t),x.removeEventListener("end",i),x.removeEventListener("change",e)}},[o,s,l,x,h,m]),eS.useEffect(()=>{if(e){let e=g().controls;return p({controls:x}),()=>p({controls:e})}},[e,x]),eS.createElement("primitive",j({ref:u,object:x,enableDamping:n},c))});var cV=Object.defineProperty,cj=(e,t,r)=>t in e?cV(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,cJ=(e,t,r)=>(cj(e,"symbol"!=typeof t?t+"":t,r),r);class cY extends cx{constructor(e,t){super(),cJ(this,"enabled",!0),cJ(this,"screen",{left:0,top:0,width:0,height:0}),cJ(this,"rotateSpeed",1),cJ(this,"zoomSpeed",1.2),cJ(this,"panSpeed",.3),cJ(this,"noRotate",!1),cJ(this,"noZoom",!1),cJ(this,"noPan",!1),cJ(this,"staticMoving",!1),cJ(this,"dynamicDampingFactor",.2),cJ(this,"minDistance",0),cJ(this,"maxDistance",1/0),cJ(this,"keys",["KeyA","KeyS","KeyD"]),cJ(this,"mouseButtons",{LEFT:eT.MOUSE.ROTATE,MIDDLE:eT.MOUSE.DOLLY,RIGHT:eT.MOUSE.PAN}),cJ(this,"object"),cJ(this,"domElement"),cJ(this,"cursorZoom",!1),cJ(this,"target",new eT.Vector3),cJ(this,"mousePosition",new eT.Vector2),cJ(this,"STATE",{NONE:-1,ROTATE:0,ZOOM:1,PAN:2,TOUCH_ROTATE:3,TOUCH_ZOOM_PAN:4}),cJ(this,"EPS",1e-6),cJ(this,"lastZoom",1),cJ(this,"lastPosition",new eT.Vector3),cJ(this,"cursorVector",new eT.Vector3),cJ(this,"targetVector",new eT.Vector3),cJ(this,"_state",this.STATE.NONE),cJ(this,"_keyState",this.STATE.NONE),cJ(this,"_eye",new eT.Vector3),cJ(this,"_movePrev",new eT.Vector2),cJ(this,"_moveCurr",new eT.Vector2),cJ(this,"_lastAxis",new eT.Vector3),cJ(this,"_lastAngle",0),cJ(this,"_zoomStart",new eT.Vector2),cJ(this,"_zoomEnd",new eT.Vector2),cJ(this,"_touchZoomDistanceStart",0),cJ(this,"_touchZoomDistanceEnd",0),cJ(this,"_panStart",new eT.Vector2),cJ(this,"_panEnd",new eT.Vector2),cJ(this,"target0"),cJ(this,"position0"),cJ(this,"up0"),cJ(this,"zoom0"),cJ(this,"changeEvent",{type:"change"}),cJ(this,"startEvent",{type:"start"}),cJ(this,"endEvent",{type:"end"}),cJ(this,"onScreenVector",new eT.Vector2),cJ(this,"getMouseOnScreen",(e,t)=>(this.onScreenVector.set((e-this.screen.left)/this.screen.width,(t-this.screen.top)/this.screen.height),this.onScreenVector)),cJ(this,"onCircleVector",new eT.Vector2),cJ(this,"getMouseOnCircle",(e,t)=>(this.onCircleVector.set((e-.5*this.screen.width-this.screen.left)/(.5*this.screen.width),(this.screen.height+2*(this.screen.top-t))/this.screen.width),this.onCircleVector)),cJ(this,"axis",new eT.Vector3),cJ(this,"quaternion",new eT.Quaternion),cJ(this,"eyeDirection",new eT.Vector3),cJ(this,"objectUpDirection",new eT.Vector3),cJ(this,"objectSidewaysDirection",new eT.Vector3),cJ(this,"moveDirection",new eT.Vector3),cJ(this,"angle",0),cJ(this,"rotateCamera",()=>{this.moveDirection.set(this._moveCurr.x-this._movePrev.x,this._moveCurr.y-this._movePrev.y,0),this.angle=this.moveDirection.length(),this.angle?(this._eye.copy(this.object.position).sub(this.target),this.eyeDirection.copy(this._eye).normalize(),this.objectUpDirection.copy(this.object.up).normalize(),this.objectSidewaysDirection.crossVectors(this.objectUpDirection,this.eyeDirection).normalize(),this.objectUpDirection.setLength(this._moveCurr.y-this._movePrev.y),this.objectSidewaysDirection.setLength(this._moveCurr.x-this._movePrev.x),this.moveDirection.copy(this.objectUpDirection.add(this.objectSidewaysDirection)),this.axis.crossVectors(this.moveDirection,this._eye).normalize(),this.angle*=this.rotateSpeed,this.quaternion.setFromAxisAngle(this.axis,this.angle),this._eye.applyQuaternion(this.quaternion),this.object.up.applyQuaternion(this.quaternion),this._lastAxis.copy(this.axis),this._lastAngle=this.angle):!this.staticMoving&&this._lastAngle&&(this._lastAngle*=Math.sqrt(1-this.dynamicDampingFactor),this._eye.copy(this.object.position).sub(this.target),this.quaternion.setFromAxisAngle(this._lastAxis,this._lastAngle),this._eye.applyQuaternion(this.quaternion),this.object.up.applyQuaternion(this.quaternion)),this._movePrev.copy(this._moveCurr)}),cJ(this,"zoomCamera",()=>{let e;if(this._state===this.STATE.TOUCH_ZOOM_PAN)e=this._touchZoomDistanceStart/this._touchZoomDistanceEnd,this._touchZoomDistanceStart=this._touchZoomDistanceEnd,this.object.isPerspectiveCamera?this._eye.multiplyScalar(e):this.object.isOrthographicCamera?(this.object.zoom/=e,this.object.updateProjectionMatrix()):console.warn("THREE.TrackballControls: Unsupported camera type");else{if(Math.abs((e=1+(this._zoomEnd.y-this._zoomStart.y)*this.zoomSpeed)-1)>this.EPS&&e>0&&(this.object.isPerspectiveCamera?(e>1&&this._eye.length()>=this.maxDistance-this.EPS&&(e=1),this._eye.multiplyScalar(e)):this.object.isOrthographicCamera?(e>1&&this.object.zoom<this.maxDistance*this.maxDistance&&(e=1),this.object.zoom/=e):console.warn("THREE.TrackballControls: Unsupported camera type")),this.staticMoving?this._zoomStart.copy(this._zoomEnd):this._zoomStart.y+=(this._zoomEnd.y-this._zoomStart.y)*this.dynamicDampingFactor,this.cursorZoom){this.targetVector.copy(this.target).project(this.object);let t=this.cursorVector.set(this.mousePosition.x,this.mousePosition.y,this.targetVector.z).unproject(this.object);this.target.lerpVectors(t,this.target,e)}this.object.isOrthographicCamera&&this.object.updateProjectionMatrix()}}),cJ(this,"mouseChange",new eT.Vector2),cJ(this,"objectUp",new eT.Vector3),cJ(this,"pan",new eT.Vector3),cJ(this,"panCamera",()=>{if(this.domElement&&(this.mouseChange.copy(this._panEnd).sub(this._panStart),this.mouseChange.lengthSq()>this.EPS)){if(this.object.isOrthographicCamera){let e=this.object,t=(e.right-e.left)/this.object.zoom,r=(e.top-e.bottom)/this.object.zoom;this.mouseChange.x*=t,this.mouseChange.y*=r}else this.mouseChange.multiplyScalar(this._eye.length()*this.panSpeed);this.pan.copy(this._eye).cross(this.object.up).setLength(this.mouseChange.x),this.pan.add(this.objectUp.copy(this.object.up).setLength(this.mouseChange.y)),this.object.position.add(this.pan),this.target.add(this.pan),this.staticMoving?this._panStart.copy(this._panEnd):this._panStart.add(this.mouseChange.subVectors(this._panEnd,this._panStart).multiplyScalar(this.dynamicDampingFactor))}}),cJ(this,"checkDistances",()=>{this.noZoom&&this.noPan||(this._eye.lengthSq()>this.maxDistance*this.maxDistance&&(this.object.position.addVectors(this.target,this._eye.setLength(this.maxDistance)),this._zoomStart.copy(this._zoomEnd)),this._eye.lengthSq()<this.minDistance*this.minDistance&&(this.object.position.addVectors(this.target,this._eye.setLength(this.minDistance)),this._zoomStart.copy(this._zoomEnd)))}),cJ(this,"handleResize",()=>{if(!this.domElement)return;let e=this.domElement.getBoundingClientRect(),t=this.domElement.ownerDocument.documentElement;this.screen.left=e.left+window.pageXOffset-t.clientLeft,this.screen.top=e.top+window.pageYOffset-t.clientTop,this.screen.width=e.width,this.screen.height=e.height}),cJ(this,"update",()=>{this._eye.subVectors(this.object.position,this.target),this.noRotate||this.rotateCamera(),this.noZoom||this.zoomCamera(),this.noPan||this.panCamera(),this.object.position.addVectors(this.target,this._eye),this.object.isPerspectiveCamera?(this.checkDistances(),this.object.lookAt(this.target),this.lastPosition.distanceToSquared(this.object.position)>this.EPS&&(this.dispatchEvent(this.changeEvent),this.lastPosition.copy(this.object.position))):this.object.isOrthographicCamera?(this.object.lookAt(this.target),(this.lastPosition.distanceToSquared(this.object.position)>this.EPS||this.lastZoom!==this.object.zoom)&&(this.dispatchEvent(this.changeEvent),this.lastPosition.copy(this.object.position),this.lastZoom=this.object.zoom)):console.warn("THREE.TrackballControls: Unsupported camera type")}),cJ(this,"reset",()=>{this._state=this.STATE.NONE,this._keyState=this.STATE.NONE,this.target.copy(this.target0),this.object.position.copy(this.position0),this.object.up.copy(this.up0),this.object.zoom=this.zoom0,this.object.updateProjectionMatrix(),this._eye.subVectors(this.object.position,this.target),this.object.lookAt(this.target),this.dispatchEvent(this.changeEvent),this.lastPosition.copy(this.object.position),this.lastZoom=this.object.zoom}),cJ(this,"keydown",e=>{!1!==this.enabled&&(window.removeEventListener("keydown",this.keydown),this._keyState===this.STATE.NONE&&(e.code!==this.keys[this.STATE.ROTATE]||this.noRotate?e.code!==this.keys[this.STATE.ZOOM]||this.noZoom?e.code!==this.keys[this.STATE.PAN]||this.noPan||(this._keyState=this.STATE.PAN):this._keyState=this.STATE.ZOOM:this._keyState=this.STATE.ROTATE))}),cJ(this,"onPointerDown",e=>{if(!1!==this.enabled)switch(e.pointerType){case"mouse":case"pen":this.onMouseDown(e)}}),cJ(this,"onPointerMove",e=>{if(!1!==this.enabled)switch(e.pointerType){case"mouse":case"pen":this.onMouseMove(e)}}),cJ(this,"onPointerUp",e=>{if(!1!==this.enabled)switch(e.pointerType){case"mouse":case"pen":this.onMouseUp()}}),cJ(this,"keyup",()=>{!1!==this.enabled&&(this._keyState=this.STATE.NONE,window.addEventListener("keydown",this.keydown))}),cJ(this,"onMouseDown",e=>{if(!this.domElement)return;if(this._state===this.STATE.NONE)switch(e.button){case this.mouseButtons.LEFT:this._state=this.STATE.ROTATE;break;case this.mouseButtons.MIDDLE:this._state=this.STATE.ZOOM;break;case this.mouseButtons.RIGHT:this._state=this.STATE.PAN}let t=this._keyState!==this.STATE.NONE?this._keyState:this._state;t!==this.STATE.ROTATE||this.noRotate?t!==this.STATE.ZOOM||this.noZoom?t!==this.STATE.PAN||this.noPan||(this._panStart.copy(this.getMouseOnScreen(e.pageX,e.pageY)),this._panEnd.copy(this._panStart)):(this._zoomStart.copy(this.getMouseOnScreen(e.pageX,e.pageY)),this._zoomEnd.copy(this._zoomStart)):(this._moveCurr.copy(this.getMouseOnCircle(e.pageX,e.pageY)),this._movePrev.copy(this._moveCurr)),this.domElement.ownerDocument.addEventListener("pointermove",this.onPointerMove),this.domElement.ownerDocument.addEventListener("pointerup",this.onPointerUp),this.dispatchEvent(this.startEvent)}),cJ(this,"onMouseMove",e=>{if(!1===this.enabled)return;let t=this._keyState!==this.STATE.NONE?this._keyState:this._state;t!==this.STATE.ROTATE||this.noRotate?t!==this.STATE.ZOOM||this.noZoom?t!==this.STATE.PAN||this.noPan||this._panEnd.copy(this.getMouseOnScreen(e.pageX,e.pageY)):this._zoomEnd.copy(this.getMouseOnScreen(e.pageX,e.pageY)):(this._movePrev.copy(this._moveCurr),this._moveCurr.copy(this.getMouseOnCircle(e.pageX,e.pageY)))}),cJ(this,"onMouseUp",()=>{this.domElement&&!1!==this.enabled&&(this._state=this.STATE.NONE,this.domElement.ownerDocument.removeEventListener("pointermove",this.onPointerMove),this.domElement.ownerDocument.removeEventListener("pointerup",this.onPointerUp),this.dispatchEvent(this.endEvent))}),cJ(this,"mousewheel",e=>{if(!1!==this.enabled&&!0!==this.noZoom){switch(e.preventDefault(),e.deltaMode){case 2:this._zoomStart.y-=.025*e.deltaY;break;case 1:this._zoomStart.y-=.01*e.deltaY;break;default:this._zoomStart.y-=25e-5*e.deltaY}this.mousePosition.x=e.offsetX/this.screen.width*2-1,this.mousePosition.y=-(e.offsetY/this.screen.height*2)+1,this.dispatchEvent(this.startEvent),this.dispatchEvent(this.endEvent)}}),cJ(this,"touchstart",e=>{if(!1!==this.enabled){if(e.preventDefault(),1===e.touches.length)this._state=this.STATE.TOUCH_ROTATE,this._moveCurr.copy(this.getMouseOnCircle(e.touches[0].pageX,e.touches[0].pageY)),this._movePrev.copy(this._moveCurr);else{this._state=this.STATE.TOUCH_ZOOM_PAN;let t=e.touches[0].pageX-e.touches[1].pageX,r=e.touches[0].pageY-e.touches[1].pageY;this._touchZoomDistanceEnd=this._touchZoomDistanceStart=Math.sqrt(t*t+r*r);let i=(e.touches[0].pageX+e.touches[1].pageX)/2,n=(e.touches[0].pageY+e.touches[1].pageY)/2;this._panStart.copy(this.getMouseOnScreen(i,n)),this._panEnd.copy(this._panStart)}this.dispatchEvent(this.startEvent)}}),cJ(this,"touchmove",e=>{if(!1!==this.enabled){if(e.preventDefault(),1===e.touches.length)this._movePrev.copy(this._moveCurr),this._moveCurr.copy(this.getMouseOnCircle(e.touches[0].pageX,e.touches[0].pageY));else{let t=e.touches[0].pageX-e.touches[1].pageX,r=e.touches[0].pageY-e.touches[1].pageY;this._touchZoomDistanceEnd=Math.sqrt(t*t+r*r);let i=(e.touches[0].pageX+e.touches[1].pageX)/2,n=(e.touches[0].pageY+e.touches[1].pageY)/2;this._panEnd.copy(this.getMouseOnScreen(i,n))}}}),cJ(this,"touchend",e=>{if(!1!==this.enabled){switch(e.touches.length){case 0:this._state=this.STATE.NONE;break;case 1:this._state=this.STATE.TOUCH_ROTATE,this._moveCurr.copy(this.getMouseOnCircle(e.touches[0].pageX,e.touches[0].pageY)),this._movePrev.copy(this._moveCurr)}this.dispatchEvent(this.endEvent)}}),cJ(this,"contextmenu",e=>{!1!==this.enabled&&e.preventDefault()}),cJ(this,"connect",e=>{e===document&&console.error('THREE.OrbitControls: "document" should not be used as the target "domElement". Please use "renderer.domElement" instead.'),this.domElement=e,this.domElement.addEventListener("contextmenu",this.contextmenu),this.domElement.addEventListener("pointerdown",this.onPointerDown),this.domElement.addEventListener("wheel",this.mousewheel),this.domElement.addEventListener("touchstart",this.touchstart),this.domElement.addEventListener("touchend",this.touchend),this.domElement.addEventListener("touchmove",this.touchmove),this.domElement.ownerDocument.addEventListener("pointermove",this.onPointerMove),this.domElement.ownerDocument.addEventListener("pointerup",this.onPointerUp),window.addEventListener("keydown",this.keydown),window.addEventListener("keyup",this.keyup),this.handleResize()}),cJ(this,"dispose",()=>{this.domElement&&(this.domElement.removeEventListener("contextmenu",this.contextmenu),this.domElement.removeEventListener("pointerdown",this.onPointerDown),this.domElement.removeEventListener("wheel",this.mousewheel),this.domElement.removeEventListener("touchstart",this.touchstart),this.domElement.removeEventListener("touchend",this.touchend),this.domElement.removeEventListener("touchmove",this.touchmove),this.domElement.ownerDocument.removeEventListener("pointermove",this.onPointerMove),this.domElement.ownerDocument.removeEventListener("pointerup",this.onPointerUp),window.removeEventListener("keydown",this.keydown),window.removeEventListener("keyup",this.keyup))}),this.object=e,this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.up0=this.object.up.clone(),this.zoom0=this.object.zoom,void 0!==t&&this.connect(t),this.update()}}let cW=eS.forwardRef(({makeDefault:e,camera:t,domElement:r,regress:i,onChange:n,onStart:a,onEnd:o,...s},l)=>{let{invalidate:c,camera:u,gl:h,events:A,set:d,get:f,performance:m,viewport:p}=(0,eR.D)(),g=t||u,y=r||A.connected||h.domElement,v=eS.useMemo(()=>new cY(g),[g]);return(0,eR.F)(()=>{v.enabled&&v.update()},-1),eS.useEffect(()=>(v.connect(y),()=>void v.dispose()),[y,i,v,c]),eS.useEffect(()=>{let e=e=>{c(),i&&m.regress(),n&&n(e)};return v.addEventListener("change",e),a&&v.addEventListener("start",a),o&&v.addEventListener("end",o),()=>{a&&v.removeEventListener("start",a),o&&v.removeEventListener("end",o),v.removeEventListener("change",e)}},[n,a,o,v,c]),eS.useEffect(()=>{v.handleResize()},[p]),eS.useEffect(()=>{if(e){let e=f().controls;return d({controls:v}),()=>d({controls:e})}},[e,v]),eS.createElement("primitive",j({ref:l,object:v},s))});var cK=Object.defineProperty,cq=(e,t,r)=>t in e?cK(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,cX=(e,t,r)=>(cq(e,"symbol"!=typeof t?t+"":t,r),r);let cZ={IDLE:Symbol(),ROTATE:Symbol(),PAN:Symbol(),SCALE:Symbol(),FOV:Symbol(),FOCUS:Symbol(),ZROTATE:Symbol(),TOUCH_MULTI:Symbol(),ANIMATION_FOCUS:Symbol(),ANIMATION_ROTATE:Symbol()},c$={NONE:Symbol(),ONE_FINGER:Symbol(),ONE_FINGER_SWITCHED:Symbol(),TWO_FINGER:Symbol(),MULT_FINGER:Symbol(),CURSOR:Symbol()},c1={x:0,y:0},c0={camera:new eT.Matrix4,gizmos:new eT.Matrix4},c2={type:"change"},c3={type:"start"},c4={type:"end"};class c5 extends cx{constructor(e,t=null,r=null){super(),cX(this,"camera"),cX(this,"domElement"),cX(this,"scene"),cX(this,"mouseActions"),cX(this,"_mouseOp"),cX(this,"_v2_1"),cX(this,"_v3_1"),cX(this,"_v3_2"),cX(this,"_m4_1"),cX(this,"_m4_2"),cX(this,"_quat"),cX(this,"_translationMatrix"),cX(this,"_rotationMatrix"),cX(this,"_scaleMatrix"),cX(this,"_rotationAxis"),cX(this,"_cameraMatrixState"),cX(this,"_cameraProjectionState"),cX(this,"_fovState"),cX(this,"_upState"),cX(this,"_zoomState"),cX(this,"_nearPos"),cX(this,"_farPos"),cX(this,"_gizmoMatrixState"),cX(this,"_up0"),cX(this,"_zoom0"),cX(this,"_fov0"),cX(this,"_initialNear"),cX(this,"_nearPos0"),cX(this,"_initialFar"),cX(this,"_farPos0"),cX(this,"_cameraMatrixState0"),cX(this,"_gizmoMatrixState0"),cX(this,"_button"),cX(this,"_touchStart"),cX(this,"_touchCurrent"),cX(this,"_input"),cX(this,"_switchSensibility"),cX(this,"_startFingerDistance"),cX(this,"_currentFingerDistance"),cX(this,"_startFingerRotation"),cX(this,"_currentFingerRotation"),cX(this,"_devPxRatio"),cX(this,"_downValid"),cX(this,"_nclicks"),cX(this,"_downEvents"),cX(this,"_clickStart"),cX(this,"_maxDownTime"),cX(this,"_maxInterval"),cX(this,"_posThreshold"),cX(this,"_movementThreshold"),cX(this,"_currentCursorPosition"),cX(this,"_startCursorPosition"),cX(this,"_grid"),cX(this,"_gridPosition"),cX(this,"_gizmos"),cX(this,"_curvePts"),cX(this,"_timeStart"),cX(this,"_animationId"),cX(this,"focusAnimationTime"),cX(this,"_timePrev"),cX(this,"_timeCurrent"),cX(this,"_anglePrev"),cX(this,"_angleCurrent"),cX(this,"_cursorPosPrev"),cX(this,"_cursorPosCurr"),cX(this,"_wPrev"),cX(this,"_wCurr"),cX(this,"adjustNearFar"),cX(this,"scaleFactor"),cX(this,"dampingFactor"),cX(this,"wMax"),cX(this,"enableAnimations"),cX(this,"enableGrid"),cX(this,"cursorZoom"),cX(this,"minFov"),cX(this,"maxFov"),cX(this,"enabled"),cX(this,"enablePan"),cX(this,"enableRotate"),cX(this,"enableZoom"),cX(this,"minDistance"),cX(this,"maxDistance"),cX(this,"minZoom"),cX(this,"maxZoom"),cX(this,"target"),cX(this,"_currentTarget"),cX(this,"_tbRadius"),cX(this,"_state"),cX(this,"onWindowResize",()=>{let e=(this._gizmos.scale.x+this._gizmos.scale.y+this._gizmos.scale.z)/3;if(this.camera){let e=this.calculateTbRadius(this.camera);void 0!==e&&(this._tbRadius=e)}let t=this._tbRadius/e,r=new eT.EllipseCurve(0,0,t,t).getPoints(this._curvePts),i=new eT.BufferGeometry().setFromPoints(r);for(let e in this._gizmos.children)this._gizmos.children[e].geometry=i;this.dispatchEvent(c2)}),cX(this,"onContextMenu",e=>{if(this.enabled){for(let t=0;t<this.mouseActions.length;t++)if(2==this.mouseActions[t].mouse){e.preventDefault();break}}}),cX(this,"onPointerCancel",()=>{this._touchStart.splice(0,this._touchStart.length),this._touchCurrent.splice(0,this._touchCurrent.length),this._input=c$.NONE}),cX(this,"onPointerDown",e=>{if(0==e.button&&e.isPrimary?(this._downValid=!0,this._downEvents.push(e)):this._downValid=!1,"touch"==e.pointerType&&this._input!=c$.CURSOR)switch(this._touchStart.push(e),this._touchCurrent.push(e),this._input){case c$.NONE:this._input=c$.ONE_FINGER,this.onSinglePanStart(e,"ROTATE"),window.addEventListener("pointermove",this.onPointerMove),window.addEventListener("pointerup",this.onPointerUp);break;case c$.ONE_FINGER:case c$.ONE_FINGER_SWITCHED:this._input=c$.TWO_FINGER,this.onRotateStart(),this.onPinchStart(),this.onDoublePanStart();break;case c$.TWO_FINGER:this._input=c$.MULT_FINGER,this.onTriplePanStart()}else if("touch"!=e.pointerType&&this._input==c$.NONE){let t=null;e.ctrlKey||e.metaKey?t="CTRL":e.shiftKey&&(t="SHIFT"),this._mouseOp=this.getOpFromAction(e.button,t),this._mouseOp&&(window.addEventListener("pointermove",this.onPointerMove),window.addEventListener("pointerup",this.onPointerUp),this._input=c$.CURSOR,this._button=e.button,this.onSinglePanStart(e,this._mouseOp))}}),cX(this,"onPointerMove",e=>{if("touch"==e.pointerType&&this._input!=c$.CURSOR)switch(this._input){case c$.ONE_FINGER:this.updateTouchEvent(e),this.onSinglePanMove(e,cZ.ROTATE);break;case c$.ONE_FINGER_SWITCHED:this.calculatePointersDistance(this._touchCurrent[0],e)*this._devPxRatio>=this._switchSensibility&&(this._input=c$.ONE_FINGER,this.updateTouchEvent(e),this.onSinglePanStart(e,"ROTATE"));break;case c$.TWO_FINGER:this.updateTouchEvent(e),this.onRotateMove(),this.onPinchMove(),this.onDoublePanMove();break;case c$.MULT_FINGER:this.updateTouchEvent(e),this.onTriplePanMove()}else if("touch"!=e.pointerType&&this._input==c$.CURSOR){let t=null;e.ctrlKey||e.metaKey?t="CTRL":e.shiftKey&&(t="SHIFT");let r=this.getOpStateFromAction(this._button,t);r&&this.onSinglePanMove(e,r)}this._downValid&&this.calculatePointersDistance(this._downEvents[this._downEvents.length-1],e)*this._devPxRatio>this._movementThreshold&&(this._downValid=!1)}),cX(this,"onPointerUp",e=>{if("touch"==e.pointerType&&this._input!=c$.CURSOR){let t=this._touchCurrent.length;for(let r=0;r<t;r++)if(this._touchCurrent[r].pointerId==e.pointerId){this._touchCurrent.splice(r,1),this._touchStart.splice(r,1);break}switch(this._input){case c$.ONE_FINGER:case c$.ONE_FINGER_SWITCHED:window.removeEventListener("pointermove",this.onPointerMove),window.removeEventListener("pointerup",this.onPointerUp),this._input=c$.NONE,this.onSinglePanEnd();break;case c$.TWO_FINGER:this.onDoublePanEnd(),this.onPinchEnd(),this.onRotateEnd(),this._input=c$.ONE_FINGER_SWITCHED;break;case c$.MULT_FINGER:0==this._touchCurrent.length&&(window.removeEventListener("pointermove",this.onPointerMove),window.removeEventListener("pointerup",this.onPointerUp),this._input=c$.NONE,this.onTriplePanEnd())}}else"touch"!=e.pointerType&&this._input==c$.CURSOR&&(window.removeEventListener("pointermove",this.onPointerMove),window.removeEventListener("pointerup",this.onPointerUp),this._input=c$.NONE,this.onSinglePanEnd(),this._button=-1);if(e.isPrimary){if(this._downValid){if(e.timeStamp-this._downEvents[this._downEvents.length-1].timeStamp<=this._maxDownTime){if(0==this._nclicks)this._nclicks=1,this._clickStart=performance.now();else{let t=e.timeStamp-this._clickStart,r=this.calculatePointersDistance(this._downEvents[1],this._downEvents[0])*this._devPxRatio;t<=this._maxInterval&&r<=this._posThreshold?(this._nclicks=0,this._downEvents.splice(0,this._downEvents.length),this.onDoubleTap(e)):(this._nclicks=1,this._downEvents.shift(),this._clickStart=performance.now())}}else this._downValid=!1,this._nclicks=0,this._downEvents.splice(0,this._downEvents.length)}else this._nclicks=0,this._downEvents.splice(0,this._downEvents.length)}}),cX(this,"onWheel",e=>{var t,r;if(this.enabled&&this.enableZoom&&this.domElement){let i=null;e.ctrlKey||e.metaKey?i="CTRL":e.shiftKey&&(i="SHIFT");let n=this.getOpFromAction("WHEEL",i);if(n){e.preventDefault(),this.dispatchEvent(c3);let i=e.deltaY/125,a=1;switch(i>0?a=1/this.scaleFactor:i<0&&(a=this.scaleFactor),n){case"ZOOM":if(this.updateTbState(cZ.SCALE,!0),i>0?a=1/Math.pow(this.scaleFactor,i):i<0&&(a=Math.pow(this.scaleFactor,-i)),this.cursorZoom&&this.enablePan){let i;this.camera instanceof eT.OrthographicCamera&&(i=null==(t=this.unprojectOnTbPlane(this.camera,e.clientX,e.clientY,this.domElement))?void 0:t.applyQuaternion(this.camera.quaternion).multiplyScalar(1/this.camera.zoom).add(this._gizmos.position)),this.camera instanceof eT.PerspectiveCamera&&(i=null==(r=this.unprojectOnTbPlane(this.camera,e.clientX,e.clientY,this.domElement))?void 0:r.applyQuaternion(this.camera.quaternion).add(this._gizmos.position)),void 0!==i&&this.applyTransformMatrix(this.applyScale(a,i))}else this.applyTransformMatrix(this.applyScale(a,this._gizmos.position));this._grid&&(this.disposeGrid(),this.drawGrid()),this.updateTbState(cZ.IDLE,!1),this.dispatchEvent(c2),this.dispatchEvent(c4);break;case"FOV":if(this.camera instanceof eT.PerspectiveCamera){this.updateTbState(cZ.FOV,!0),0!=e.deltaX&&(i=e.deltaX/125,a=1,i>0?a=1/Math.pow(this.scaleFactor,i):i<0&&(a=Math.pow(this.scaleFactor,-i))),this._v3_1.setFromMatrixPosition(this._cameraMatrixState);let t=this._v3_1.distanceTo(this._gizmos.position),r=t/a;r=eT.MathUtils.clamp(r,this.minDistance,this.maxDistance);let n=t*Math.tan(eT.MathUtils.DEG2RAD*this.camera.fov*.5),o=eT.MathUtils.RAD2DEG*(2*Math.atan(n/r));o>this.maxFov?o=this.maxFov:o<this.minFov&&(o=this.minFov),a=t/(n/Math.tan(eT.MathUtils.DEG2RAD*(o/2))),this.setFov(o),this.applyTransformMatrix(this.applyScale(a,this._gizmos.position,!1))}this._grid&&(this.disposeGrid(),this.drawGrid()),this.updateTbState(cZ.IDLE,!1),this.dispatchEvent(c2),this.dispatchEvent(c4)}}}}),cX(this,"onSinglePanStart",(e,t)=>{if(this.enabled&&this.domElement)switch(this.dispatchEvent(c3),this.setCenter(e.clientX,e.clientY),t){case"PAN":if(!this.enablePan)return;if(-1!=this._animationId&&(cancelAnimationFrame(this._animationId),this._animationId=-1,this._timeStart=-1,this.activateGizmos(!1),this.dispatchEvent(c2)),this.camera){this.updateTbState(cZ.PAN,!0);let e=this.unprojectOnTbPlane(this.camera,c1.x,c1.y,this.domElement);void 0!==e&&this._startCursorPosition.copy(e),this.enableGrid&&(this.drawGrid(),this.dispatchEvent(c2))}break;case"ROTATE":if(!this.enableRotate)return;if(-1!=this._animationId&&(cancelAnimationFrame(this._animationId),this._animationId=-1,this._timeStart=-1),this.camera){this.updateTbState(cZ.ROTATE,!0);let e=this.unprojectOnTbSurface(this.camera,c1.x,c1.y,this.domElement,this._tbRadius);void 0!==e&&this._startCursorPosition.copy(e),this.activateGizmos(!0),this.enableAnimations&&(this._timePrev=this._timeCurrent=performance.now(),this._angleCurrent=this._anglePrev=0,this._cursorPosPrev.copy(this._startCursorPosition),this._cursorPosCurr.copy(this._cursorPosPrev),this._wCurr=0,this._wPrev=this._wCurr)}this.dispatchEvent(c2);break;case"FOV":if(!this.enableZoom)return;this.camera instanceof eT.PerspectiveCamera&&(-1!=this._animationId&&(cancelAnimationFrame(this._animationId),this._animationId=-1,this._timeStart=-1,this.activateGizmos(!1),this.dispatchEvent(c2)),this.updateTbState(cZ.FOV,!0),this._startCursorPosition.setY(.5*this.getCursorNDC(c1.x,c1.y,this.domElement).y),this._currentCursorPosition.copy(this._startCursorPosition));break;case"ZOOM":if(!this.enableZoom)return;-1!=this._animationId&&(cancelAnimationFrame(this._animationId),this._animationId=-1,this._timeStart=-1,this.activateGizmos(!1),this.dispatchEvent(c2)),this.updateTbState(cZ.SCALE,!0),this._startCursorPosition.setY(.5*this.getCursorNDC(c1.x,c1.y,this.domElement).y),this._currentCursorPosition.copy(this._startCursorPosition)}}),cX(this,"onSinglePanMove",(e,t)=>{if(this.enabled&&this.domElement){let r=t!=this._state;switch(this.setCenter(e.clientX,e.clientY),t){case cZ.PAN:if(this.enablePan&&this.camera){if(r){this.dispatchEvent(c4),this.dispatchEvent(c3),this.updateTbState(t,!0);let e=this.unprojectOnTbPlane(this.camera,c1.x,c1.y,this.domElement);void 0!==e&&this._startCursorPosition.copy(e),this.enableGrid&&this.drawGrid(),this.activateGizmos(!1)}else{let e=this.unprojectOnTbPlane(this.camera,c1.x,c1.y,this.domElement);void 0!==e&&this._currentCursorPosition.copy(e),this.applyTransformMatrix(this.pan(this._startCursorPosition,this._currentCursorPosition))}}break;case cZ.ROTATE:if(this.enableRotate&&this.camera){if(r){this.dispatchEvent(c4),this.dispatchEvent(c3),this.updateTbState(t,!0);let e=this.unprojectOnTbSurface(this.camera,c1.x,c1.y,this.domElement,this._tbRadius);void 0!==e&&this._startCursorPosition.copy(e),this.enableGrid&&this.disposeGrid(),this.activateGizmos(!0)}else{let e=this.unprojectOnTbSurface(this.camera,c1.x,c1.y,this.domElement,this._tbRadius);void 0!==e&&this._currentCursorPosition.copy(e);let t=this._startCursorPosition.distanceTo(this._currentCursorPosition),r=this._startCursorPosition.angleTo(this._currentCursorPosition),i=Math.max(t/this._tbRadius,r);this.applyTransformMatrix(this.rotate(this.calculateRotationAxis(this._startCursorPosition,this._currentCursorPosition),i)),this.enableAnimations&&(this._timePrev=this._timeCurrent,this._timeCurrent=performance.now(),this._anglePrev=this._angleCurrent,this._angleCurrent=i,this._cursorPosPrev.copy(this._cursorPosCurr),this._cursorPosCurr.copy(this._currentCursorPosition),this._wPrev=this._wCurr,this._wCurr=this.calculateAngularSpeed(this._anglePrev,this._angleCurrent,this._timePrev,this._timeCurrent))}}break;case cZ.SCALE:if(this.enableZoom){if(r)this.dispatchEvent(c4),this.dispatchEvent(c3),this.updateTbState(t,!0),this._startCursorPosition.setY(.5*this.getCursorNDC(c1.x,c1.y,this.domElement).y),this._currentCursorPosition.copy(this._startCursorPosition),this.enableGrid&&this.disposeGrid(),this.activateGizmos(!1);else{this._currentCursorPosition.setY(.5*this.getCursorNDC(c1.x,c1.y,this.domElement).y);let e=this._currentCursorPosition.y-this._startCursorPosition.y,t=1;e<0?t=1/Math.pow(this.scaleFactor,-(8*e)):e>0&&(t=Math.pow(this.scaleFactor,8*e)),this.applyTransformMatrix(this.applyScale(t,this._gizmos.position))}}break;case cZ.FOV:if(this.enableZoom&&this.camera instanceof eT.PerspectiveCamera){if(r)this.dispatchEvent(c4),this.dispatchEvent(c3),this.updateTbState(t,!0),this._startCursorPosition.setY(.5*this.getCursorNDC(c1.x,c1.y,this.domElement).y),this._currentCursorPosition.copy(this._startCursorPosition),this.enableGrid&&this.disposeGrid(),this.activateGizmos(!1);else{this._currentCursorPosition.setY(.5*this.getCursorNDC(c1.x,c1.y,this.domElement).y);let e=this._currentCursorPosition.y-this._startCursorPosition.y,t=1;e<0?t=1/Math.pow(this.scaleFactor,-(8*e)):e>0&&(t=Math.pow(this.scaleFactor,8*e)),this._v3_1.setFromMatrixPosition(this._cameraMatrixState);let r=this._v3_1.distanceTo(this._gizmos.position),i=r/t;i=eT.MathUtils.clamp(i,this.minDistance,this.maxDistance);let n=r*Math.tan(eT.MathUtils.DEG2RAD*this._fovState*.5),a=eT.MathUtils.RAD2DEG*(2*Math.atan(n/i));a=eT.MathUtils.clamp(a,this.minFov,this.maxFov);let o=n/Math.tan(eT.MathUtils.DEG2RAD*(a/2));t=r/o,this._v3_2.setFromMatrixPosition(this._gizmoMatrixState),this.setFov(a),this.applyTransformMatrix(this.applyScale(t,this._v3_2,!1));let s=this._gizmos.position.clone().sub(this.camera.position).normalize().multiplyScalar(o/r);this._m4_1.makeTranslation(s.x,s.y,s.z)}}}this.dispatchEvent(c2)}}),cX(this,"onSinglePanEnd",()=>{if(this._state==cZ.ROTATE){if(!this.enableRotate)return;if(this.enableAnimations){if(performance.now()-this._timeCurrent<120){let e=Math.abs((this._wPrev+this._wCurr)/2),t=this;this._animationId=window.requestAnimationFrame(function(r){t.updateTbState(cZ.ANIMATION_ROTATE,!0);let i=t.calculateRotationAxis(t._cursorPosPrev,t._cursorPosCurr);t.onRotationAnim(r,i,Math.min(e,t.wMax))})}else this.updateTbState(cZ.IDLE,!1),this.activateGizmos(!1),this.dispatchEvent(c2)}else this.updateTbState(cZ.IDLE,!1),this.activateGizmos(!1),this.dispatchEvent(c2)}else(this._state==cZ.PAN||this._state==cZ.IDLE)&&(this.updateTbState(cZ.IDLE,!1),this.enableGrid&&this.disposeGrid(),this.activateGizmos(!1),this.dispatchEvent(c2));this.dispatchEvent(c4)}),cX(this,"onDoubleTap",e=>{if(this.enabled&&this.enablePan&&this.scene&&this.camera&&this.domElement){this.dispatchEvent(c3),this.setCenter(e.clientX,e.clientY);let t=this.unprojectOnObj(this.getCursorNDC(c1.x,c1.y,this.domElement),this.camera);if(t&&this.enableAnimations){let e=this;-1!=this._animationId&&window.cancelAnimationFrame(this._animationId),this._timeStart=-1,this._animationId=window.requestAnimationFrame(function(r){e.updateTbState(cZ.ANIMATION_FOCUS,!0),e.onFocusAnim(r,t,e._cameraMatrixState,e._gizmoMatrixState)})}else t&&!this.enableAnimations&&(this.updateTbState(cZ.FOCUS,!0),this.focus(t,this.scaleFactor),this.updateTbState(cZ.IDLE,!1),this.dispatchEvent(c2))}this.dispatchEvent(c4)}),cX(this,"onDoublePanStart",()=>{if(this.enabled&&this.enablePan&&this.camera&&this.domElement){this.dispatchEvent(c3),this.updateTbState(cZ.PAN,!0),this.setCenter((this._touchCurrent[0].clientX+this._touchCurrent[1].clientX)/2,(this._touchCurrent[0].clientY+this._touchCurrent[1].clientY)/2);let e=this.unprojectOnTbPlane(this.camera,c1.x,c1.y,this.domElement,!0);void 0!==e&&this._startCursorPosition.copy(e),this._currentCursorPosition.copy(this._startCursorPosition),this.activateGizmos(!1)}}),cX(this,"onDoublePanMove",()=>{if(this.enabled&&this.enablePan&&this.camera&&this.domElement){this.setCenter((this._touchCurrent[0].clientX+this._touchCurrent[1].clientX)/2,(this._touchCurrent[0].clientY+this._touchCurrent[1].clientY)/2),this._state!=cZ.PAN&&(this.updateTbState(cZ.PAN,!0),this._startCursorPosition.copy(this._currentCursorPosition));let e=this.unprojectOnTbPlane(this.camera,c1.x,c1.y,this.domElement,!0);void 0!==e&&this._currentCursorPosition.copy(e),this.applyTransformMatrix(this.pan(this._startCursorPosition,this._currentCursorPosition,!0)),this.dispatchEvent(c2)}}),cX(this,"onDoublePanEnd",()=>{this.updateTbState(cZ.IDLE,!1),this.dispatchEvent(c4)}),cX(this,"onRotateStart",()=>{var e;this.enabled&&this.enableRotate&&(this.dispatchEvent(c3),this.updateTbState(cZ.ZROTATE,!0),this._startFingerRotation=this.getAngle(this._touchCurrent[1],this._touchCurrent[0])+this.getAngle(this._touchStart[1],this._touchStart[0]),this._currentFingerRotation=this._startFingerRotation,null==(e=this.camera)||e.getWorldDirection(this._rotationAxis),this.enablePan||this.enableZoom||this.activateGizmos(!0))}),cX(this,"onRotateMove",()=>{var e;if(this.enabled&&this.enableRotate&&this.camera&&this.domElement){let t;this.setCenter((this._touchCurrent[0].clientX+this._touchCurrent[1].clientX)/2,(this._touchCurrent[0].clientY+this._touchCurrent[1].clientY)/2),this._state!=cZ.ZROTATE&&(this.updateTbState(cZ.ZROTATE,!0),this._startFingerRotation=this._currentFingerRotation),this._currentFingerRotation=this.getAngle(this._touchCurrent[1],this._touchCurrent[0])+this.getAngle(this._touchStart[1],this._touchStart[0]),this.enablePan?this.camera&&(this._v3_2.setFromMatrixPosition(this._gizmoMatrixState),t=null==(e=this.unprojectOnTbPlane(this.camera,c1.x,c1.y,this.domElement))?void 0:e.applyQuaternion(this.camera.quaternion).multiplyScalar(1/this.camera.zoom).add(this._v3_2)):t=new eT.Vector3().setFromMatrixPosition(this._gizmoMatrixState);let r=eT.MathUtils.DEG2RAD*(this._startFingerRotation-this._currentFingerRotation);void 0!==t&&this.applyTransformMatrix(this.zRotate(t,r)),this.dispatchEvent(c2)}}),cX(this,"onRotateEnd",()=>{this.updateTbState(cZ.IDLE,!1),this.activateGizmos(!1),this.dispatchEvent(c4)}),cX(this,"onPinchStart",()=>{this.enabled&&this.enableZoom&&(this.dispatchEvent(c3),this.updateTbState(cZ.SCALE,!0),this._startFingerDistance=this.calculatePointersDistance(this._touchCurrent[0],this._touchCurrent[1]),this._currentFingerDistance=this._startFingerDistance,this.activateGizmos(!1))}),cX(this,"onPinchMove",()=>{var e,t;if(this.enabled&&this.enableZoom&&this.domElement){let r;this.setCenter((this._touchCurrent[0].clientX+this._touchCurrent[1].clientX)/2,(this._touchCurrent[0].clientY+this._touchCurrent[1].clientY)/2),this._state!=cZ.SCALE&&(this._startFingerDistance=this._currentFingerDistance,this.updateTbState(cZ.SCALE,!0)),this._currentFingerDistance=Math.max(this.calculatePointersDistance(this._touchCurrent[0],this._touchCurrent[1]),12*this._devPxRatio);let i=this._currentFingerDistance/this._startFingerDistance;this.enablePan?this.camera instanceof eT.OrthographicCamera?r=null==(e=this.unprojectOnTbPlane(this.camera,c1.x,c1.y,this.domElement))?void 0:e.applyQuaternion(this.camera.quaternion).multiplyScalar(1/this.camera.zoom).add(this._gizmos.position):this.camera instanceof eT.PerspectiveCamera&&(r=null==(t=this.unprojectOnTbPlane(this.camera,c1.x,c1.y,this.domElement))?void 0:t.applyQuaternion(this.camera.quaternion).add(this._gizmos.position)):r=this._gizmos.position,void 0!==r&&this.applyTransformMatrix(this.applyScale(i,r)),this.dispatchEvent(c2)}}),cX(this,"onPinchEnd",()=>{this.updateTbState(cZ.IDLE,!1),this.dispatchEvent(c4)}),cX(this,"onTriplePanStart",()=>{if(this.enabled&&this.enableZoom&&this.domElement){this.dispatchEvent(c3),this.updateTbState(cZ.SCALE,!0);let e=0,t=0,r=this._touchCurrent.length;for(let i=0;i<r;i++)e+=this._touchCurrent[i].clientX,t+=this._touchCurrent[i].clientY;this.setCenter(e/r,t/r),this._startCursorPosition.setY(.5*this.getCursorNDC(c1.x,c1.y,this.domElement).y),this._currentCursorPosition.copy(this._startCursorPosition)}}),cX(this,"onTriplePanMove",()=>{if(this.enabled&&this.enableZoom&&this.camera&&this.domElement){let e=0,t=0,r=this._touchCurrent.length;for(let i=0;i<r;i++)e+=this._touchCurrent[i].clientX,t+=this._touchCurrent[i].clientY;this.setCenter(e/r,t/r),this._currentCursorPosition.setY(.5*this.getCursorNDC(c1.x,c1.y,this.domElement).y);let i=this._currentCursorPosition.y-this._startCursorPosition.y,n=1;i<0?n=1/Math.pow(this.scaleFactor,-(8*i)):i>0&&(n=Math.pow(this.scaleFactor,8*i)),this._v3_1.setFromMatrixPosition(this._cameraMatrixState);let a=this._v3_1.distanceTo(this._gizmos.position),o=a/n;o=eT.MathUtils.clamp(o,this.minDistance,this.maxDistance);let s=a*Math.tan(eT.MathUtils.DEG2RAD*this._fovState*.5),l=eT.MathUtils.RAD2DEG*(2*Math.atan(s/o));l=eT.MathUtils.clamp(l,this.minFov,this.maxFov);let c=s/Math.tan(eT.MathUtils.DEG2RAD*(l/2));n=a/c,this._v3_2.setFromMatrixPosition(this._gizmoMatrixState),this.setFov(l),this.applyTransformMatrix(this.applyScale(n,this._v3_2,!1));let u=this._gizmos.position.clone().sub(this.camera.position).normalize().multiplyScalar(c/a);this._m4_1.makeTranslation(u.x,u.y,u.z),this.dispatchEvent(c2)}}),cX(this,"onTriplePanEnd",()=>{this.updateTbState(cZ.IDLE,!1),this.dispatchEvent(c4)}),cX(this,"setCenter",(e,t)=>{c1.x=e,c1.y=t}),cX(this,"initializeMouseActions",()=>{this.setMouseAction("PAN",0,"CTRL"),this.setMouseAction("PAN",2),this.setMouseAction("ROTATE",0),this.setMouseAction("ZOOM","WHEEL"),this.setMouseAction("ZOOM",1),this.setMouseAction("FOV","WHEEL","SHIFT"),this.setMouseAction("FOV",1,"SHIFT")}),cX(this,"setMouseAction",(e,t,r=null)=>{let i;if(!["PAN","ROTATE","ZOOM","FOV"].includes(e)||![0,1,2,"WHEEL"].includes(t)||!["CTRL","SHIFT",null].includes(r)||"WHEEL"==t&&"ZOOM"!=e&&"FOV"!=e)return!1;switch(e){case"PAN":i=cZ.PAN;break;case"ROTATE":i=cZ.ROTATE;break;case"ZOOM":i=cZ.SCALE;break;case"FOV":i=cZ.FOV}let n={operation:e,mouse:t,key:r,state:i};for(let e=0;e<this.mouseActions.length;e++)if(this.mouseActions[e].mouse==n.mouse&&this.mouseActions[e].key==n.key)return this.mouseActions.splice(e,1,n),!0;return this.mouseActions.push(n),!0}),cX(this,"getOpFromAction",(e,t)=>{let r;for(let i=0;i<this.mouseActions.length;i++)if((r=this.mouseActions[i]).mouse==e&&r.key==t)return r.operation;if(t){for(let t=0;t<this.mouseActions.length;t++)if((r=this.mouseActions[t]).mouse==e&&null==r.key)return r.operation}return null}),cX(this,"getOpStateFromAction",(e,t)=>{let r;for(let i=0;i<this.mouseActions.length;i++)if((r=this.mouseActions[i]).mouse==e&&r.key==t)return r.state;if(t){for(let t=0;t<this.mouseActions.length;t++)if((r=this.mouseActions[t]).mouse==e&&null==r.key)return r.state}return null}),cX(this,"getAngle",(e,t)=>180*Math.atan2(t.clientY-e.clientY,t.clientX-e.clientX)/Math.PI),cX(this,"updateTouchEvent",e=>{for(let t=0;t<this._touchCurrent.length;t++)if(this._touchCurrent[t].pointerId==e.pointerId){this._touchCurrent.splice(t,1,e);break}}),cX(this,"calculateAngularSpeed",(e,t,r,i)=>{let n=(i-r)/1e3;return 0==n?0:(t-e)/n}),cX(this,"calculatePointersDistance",(e,t)=>Math.sqrt(Math.pow(t.clientX-e.clientX,2)+Math.pow(t.clientY-e.clientY,2))),cX(this,"calculateRotationAxis",(e,t)=>(this._rotationMatrix.extractRotation(this._cameraMatrixState),this._quat.setFromRotationMatrix(this._rotationMatrix),this._rotationAxis.crossVectors(e,t).applyQuaternion(this._quat),this._rotationAxis.normalize().clone())),cX(this,"calculateTbRadius",e=>{let t=e.position.distanceTo(this._gizmos.position);if(e instanceof eT.PerspectiveCamera){let r=eT.MathUtils.DEG2RAD*e.fov*.5,i=Math.atan(e.aspect*Math.tan(r));return Math.tan(Math.min(r,i))*t*.67}if(e instanceof eT.OrthographicCamera)return .67*Math.min(e.top,e.right)}),cX(this,"focus",(e,t,r=1)=>{if(this.camera){let i=e.clone();i.sub(this._gizmos.position).multiplyScalar(r),this._translationMatrix.makeTranslation(i.x,i.y,i.z);let n=this._gizmoMatrixState.clone();this._gizmoMatrixState.premultiply(this._translationMatrix),this._gizmoMatrixState.decompose(this._gizmos.position,this._gizmos.quaternion,this._gizmos.scale);let a=this._cameraMatrixState.clone();this._cameraMatrixState.premultiply(this._translationMatrix),this._cameraMatrixState.decompose(this.camera.position,this.camera.quaternion,this.camera.scale),this.enableZoom&&this.applyTransformMatrix(this.applyScale(t,this._gizmos.position)),this._gizmoMatrixState.copy(n),this._cameraMatrixState.copy(a)}}),cX(this,"drawGrid",()=>{if(this.scene){let e,t,r,i;if(this.camera instanceof eT.OrthographicCamera)i=(r=Math.max(this.camera.right-this.camera.left,this.camera.bottom-this.camera.top))/20,t=(e=r/this.camera.zoom*3)/i*this.camera.zoom;else if(this.camera instanceof eT.PerspectiveCamera){let n=this.camera.position.distanceTo(this._gizmos.position),a=eT.MathUtils.DEG2RAD*this.camera.fov*.5,o=Math.atan(this.camera.aspect*Math.tan(a));i=(r=Math.tan(Math.max(a,o))*n*2)/20,t=(e=3*r)/i}null==this._grid&&this.camera&&(this._grid=new eT.GridHelper(e,t,8947848,8947848),this._grid.position.copy(this._gizmos.position),this._gridPosition.copy(this._grid.position),this._grid.quaternion.copy(this.camera.quaternion),this._grid.rotateX(.5*Math.PI),this.scene.add(this._grid))}}),cX(this,"connect",e=>{e===document&&console.error('THREE.ArcballControls: "document" should not be used as the target "domElement". Please use "renderer.domElement" instead.'),this.domElement=e,this.domElement.style.touchAction="none",this.domElement.addEventListener("contextmenu",this.onContextMenu),this.domElement.addEventListener("pointerdown",this.onPointerDown),this.domElement.addEventListener("pointercancel",this.onPointerCancel),this.domElement.addEventListener("wheel",this.onWheel)}),cX(this,"dispose",()=>{var e,t,r,i,n;-1!=this._animationId&&window.cancelAnimationFrame(this._animationId),null==(e=this.domElement)||e.removeEventListener("pointerdown",this.onPointerDown),null==(t=this.domElement)||t.removeEventListener("pointercancel",this.onPointerCancel),null==(r=this.domElement)||r.removeEventListener("wheel",this.onWheel),null==(i=this.domElement)||i.removeEventListener("contextmenu",this.onContextMenu),window.removeEventListener("pointermove",this.onPointerMove),window.removeEventListener("pointerup",this.onPointerUp),window.removeEventListener("resize",this.onWindowResize),null==(n=this.scene)||n.remove(this._gizmos),this.disposeGrid()}),cX(this,"disposeGrid",()=>{this._grid&&this.scene&&(this.scene.remove(this._grid),this._grid=null)}),cX(this,"easeOutCubic",e=>1-Math.pow(1-e,3)),cX(this,"activateGizmos",e=>{for(let t of this._gizmos.children)t.material.setValues({opacity:e?1:.6})}),cX(this,"getCursorNDC",(e,t,r)=>{let i=r.getBoundingClientRect();return this._v2_1.setX((e-i.left)/i.width*2-1),this._v2_1.setY((i.bottom-t)/i.height*2-1),this._v2_1.clone()}),cX(this,"getCursorPosition",(e,t,r)=>(this._v2_1.copy(this.getCursorNDC(e,t,r)),this.camera instanceof eT.OrthographicCamera&&(this._v2_1.x*=(this.camera.right-this.camera.left)*.5,this._v2_1.y*=(this.camera.top-this.camera.bottom)*.5),this._v2_1.clone())),cX(this,"setCamera",e=>{if(e){e.lookAt(this.target),e.updateMatrix(),e instanceof eT.PerspectiveCamera&&(this._fov0=e.fov,this._fovState=e.fov),this._cameraMatrixState0.copy(e.matrix),this._cameraMatrixState.copy(this._cameraMatrixState0),this._cameraProjectionState.copy(e.projectionMatrix),this._zoom0=e.zoom,this._zoomState=this._zoom0,this._initialNear=e.near,this._nearPos0=e.position.distanceTo(this.target)-e.near,this._nearPos=this._initialNear,this._initialFar=e.far,this._farPos0=e.position.distanceTo(this.target)-e.far,this._farPos=this._initialFar,this._up0.copy(e.up),this._upState.copy(e.up),this.camera=e,this.camera.updateProjectionMatrix();let t=this.calculateTbRadius(e);void 0!==t&&(this._tbRadius=t),this.makeGizmos(this.target,this._tbRadius)}}),cX(this,"makeGizmos",(e,t)=>{let r=new eT.EllipseCurve(0,0,t,t).getPoints(this._curvePts),i=new eT.BufferGeometry().setFromPoints(r),n=new eT.LineBasicMaterial({color:16744576,fog:!1,transparent:!0,opacity:.6}),a=new eT.LineBasicMaterial({color:8454016,fog:!1,transparent:!0,opacity:.6}),o=new eT.LineBasicMaterial({color:8421631,fog:!1,transparent:!0,opacity:.6}),s=new eT.Line(i,n),l=new eT.Line(i,a),c=new eT.Line(i,o),u=.5*Math.PI;if(s.rotation.x=u,l.rotation.y=u,this._gizmoMatrixState0.identity().setPosition(e),this._gizmoMatrixState.copy(this._gizmoMatrixState0),this.camera&&1!=this.camera.zoom){let t=1/this.camera.zoom;this._scaleMatrix.makeScale(t,t,t),this._translationMatrix.makeTranslation(-e.x,-e.y,-e.z),this._gizmoMatrixState.premultiply(this._translationMatrix).premultiply(this._scaleMatrix),this._translationMatrix.makeTranslation(e.x,e.y,e.z),this._gizmoMatrixState.premultiply(this._translationMatrix)}this._gizmoMatrixState.decompose(this._gizmos.position,this._gizmos.quaternion,this._gizmos.scale),this._gizmos.clear(),this._gizmos.add(s),this._gizmos.add(l),this._gizmos.add(c)}),cX(this,"onFocusAnim",(e,t,r,i)=>{if(-1==this._timeStart&&(this._timeStart=e),this._state==cZ.ANIMATION_FOCUS){let n=(e-this._timeStart)/this.focusAnimationTime;if(this._gizmoMatrixState.copy(i),n>=1)this._gizmoMatrixState.decompose(this._gizmos.position,this._gizmos.quaternion,this._gizmos.scale),this.focus(t,this.scaleFactor),this._timeStart=-1,this.updateTbState(cZ.IDLE,!1),this.activateGizmos(!1),this.dispatchEvent(c2);else{let e=this.easeOutCubic(n),a=1-e+this.scaleFactor*e;this._gizmoMatrixState.decompose(this._gizmos.position,this._gizmos.quaternion,this._gizmos.scale),this.focus(t,a,e),this.dispatchEvent(c2);let o=this;this._animationId=window.requestAnimationFrame(function(e){o.onFocusAnim(e,t,r,i.clone())})}}else this._animationId=-1,this._timeStart=-1}),cX(this,"onRotationAnim",(e,t,r)=>{if(-1==this._timeStart&&(this._anglePrev=0,this._angleCurrent=0,this._timeStart=e),this._state==cZ.ANIMATION_ROTATE){let i=(e-this._timeStart)/1e3;if(r+-this.dampingFactor*i>0){this._angleCurrent=-(.5*this.dampingFactor)*Math.pow(i,2)+r*i+0,this.applyTransformMatrix(this.rotate(t,this._angleCurrent)),this.dispatchEvent(c2);let e=this;this._animationId=window.requestAnimationFrame(function(i){e.onRotationAnim(i,t,r)})}else this._animationId=-1,this._timeStart=-1,this.updateTbState(cZ.IDLE,!1),this.activateGizmos(!1),this.dispatchEvent(c2)}else this._animationId=-1,this._timeStart=-1,this._state!=cZ.ROTATE&&(this.activateGizmos(!1),this.dispatchEvent(c2))}),cX(this,"pan",(e,t,r=!1)=>{if(this.camera){let i=e.clone().sub(t);if(this.camera instanceof eT.OrthographicCamera&&i.multiplyScalar(1/this.camera.zoom),this.camera instanceof eT.PerspectiveCamera&&r){this._v3_1.setFromMatrixPosition(this._cameraMatrixState0),this._v3_2.setFromMatrixPosition(this._gizmoMatrixState0);let e=this._v3_1.distanceTo(this._v3_2)/this.camera.position.distanceTo(this._gizmos.position);i.multiplyScalar(1/e)}this._v3_1.set(i.x,i.y,0).applyQuaternion(this.camera.quaternion),this._m4_1.makeTranslation(this._v3_1.x,this._v3_1.y,this._v3_1.z),this.setTransformationMatrices(this._m4_1,this._m4_1)}return c0}),cX(this,"reset",()=>{if(this.camera){this.camera.zoom=this._zoom0,this.camera instanceof eT.PerspectiveCamera&&(this.camera.fov=this._fov0),this.camera.near=this._nearPos,this.camera.far=this._farPos,this._cameraMatrixState.copy(this._cameraMatrixState0),this._cameraMatrixState.decompose(this.camera.position,this.camera.quaternion,this.camera.scale),this.camera.up.copy(this._up0),this.camera.updateMatrix(),this.camera.updateProjectionMatrix(),this._gizmoMatrixState.copy(this._gizmoMatrixState0),this._gizmoMatrixState0.decompose(this._gizmos.position,this._gizmos.quaternion,this._gizmos.scale),this._gizmos.updateMatrix();let e=this.calculateTbRadius(this.camera);void 0!==e&&(this._tbRadius=e),this.makeGizmos(this._gizmos.position,this._tbRadius),this.camera.lookAt(this._gizmos.position),this.updateTbState(cZ.IDLE,!1),this.dispatchEvent(c2)}}),cX(this,"rotate",(e,t)=>{let r=this._gizmos.position;return this._translationMatrix.makeTranslation(-r.x,-r.y,-r.z),this._rotationMatrix.makeRotationAxis(e,-t),this._m4_1.makeTranslation(r.x,r.y,r.z),this._m4_1.multiply(this._rotationMatrix),this._m4_1.multiply(this._translationMatrix),this.setTransformationMatrices(this._m4_1),c0}),cX(this,"copyState",()=>{if(this.camera){let e=JSON.stringify(this.camera instanceof eT.OrthographicCamera?{arcballState:{cameraFar:this.camera.far,cameraMatrix:this.camera.matrix,cameraNear:this.camera.near,cameraUp:this.camera.up,cameraZoom:this.camera.zoom,gizmoMatrix:this._gizmos.matrix}}:{arcballState:{cameraFar:this.camera.far,cameraFov:this.camera.fov,cameraMatrix:this.camera.matrix,cameraNear:this.camera.near,cameraUp:this.camera.up,cameraZoom:this.camera.zoom,gizmoMatrix:this._gizmos.matrix}});navigator.clipboard.writeText(e)}}),cX(this,"pasteState",()=>{let e=this;navigator.clipboard.readText().then(function(t){e.setStateFromJSON(t)})}),cX(this,"saveState",()=>{this.camera&&(this._cameraMatrixState0.copy(this.camera.matrix),this._gizmoMatrixState0.copy(this._gizmos.matrix),this._nearPos=this.camera.near,this._farPos=this.camera.far,this._zoom0=this.camera.zoom,this._up0.copy(this.camera.up),this.camera instanceof eT.PerspectiveCamera&&(this._fov0=this.camera.fov))}),cX(this,"applyScale",(e,t,r=!0)=>{if(!this.camera)return;let i=t.clone(),n=1/e;if(this.camera instanceof eT.OrthographicCamera){this.camera.zoom=this._zoomState,this.camera.zoom*=e,this.camera.zoom>this.maxZoom?(this.camera.zoom=this.maxZoom,n=this._zoomState/this.maxZoom):this.camera.zoom<this.minZoom&&(this.camera.zoom=this.minZoom,n=this._zoomState/this.minZoom),this.camera.updateProjectionMatrix(),this._v3_1.setFromMatrixPosition(this._gizmoMatrixState),this._scaleMatrix.makeScale(n,n,n),this._translationMatrix.makeTranslation(-this._v3_1.x,-this._v3_1.y,-this._v3_1.z),this._m4_2.makeTranslation(this._v3_1.x,this._v3_1.y,this._v3_1.z).multiply(this._scaleMatrix),this._m4_2.multiply(this._translationMatrix),i.sub(this._v3_1);let t=i.clone().multiplyScalar(n);return i.sub(t),this._m4_1.makeTranslation(i.x,i.y,i.z),this._m4_2.premultiply(this._m4_1),this.setTransformationMatrices(this._m4_1,this._m4_2),c0}if(this.camera instanceof eT.PerspectiveCamera){this._v3_1.setFromMatrixPosition(this._cameraMatrixState),this._v3_2.setFromMatrixPosition(this._gizmoMatrixState);let e=this._v3_1.distanceTo(i),t=e-e*n,a=e-t;a<this.minDistance?(n=this.minDistance/e,t=e-e*n):a>this.maxDistance&&(n=this.maxDistance/e,t=e-e*n);let o=i.clone().sub(this._v3_1).normalize().multiplyScalar(t);if(this._m4_1.makeTranslation(o.x,o.y,o.z),r){let r=this._v3_2;t=(e=r.distanceTo(i))-e*n,o=i.clone().sub(this._v3_2).normalize().multiplyScalar(t),this._translationMatrix.makeTranslation(r.x,r.y,r.z),this._scaleMatrix.makeScale(n,n,n),this._m4_2.makeTranslation(o.x,o.y,o.z).multiply(this._translationMatrix),this._m4_2.multiply(this._scaleMatrix),this._translationMatrix.makeTranslation(-r.x,-r.y,-r.z),this._m4_2.multiply(this._translationMatrix),this.setTransformationMatrices(this._m4_1,this._m4_2)}else this.setTransformationMatrices(this._m4_1);return c0}}),cX(this,"setFov",e=>{this.camera instanceof eT.PerspectiveCamera&&(this.camera.fov=eT.MathUtils.clamp(e,this.minFov,this.maxFov),this.camera.updateProjectionMatrix())}),cX(this,"setTarget",(e,t,r)=>{if(this.camera){this.target.set(e,t,r),this._gizmos.position.set(e,t,r);let i=this.calculateTbRadius(this.camera);void 0!==i&&(this._tbRadius=i),this.makeGizmos(this.target,this._tbRadius),this.camera.lookAt(this.target)}}),cX(this,"zRotate",(e,t)=>(this._rotationMatrix.makeRotationAxis(this._rotationAxis,t),this._translationMatrix.makeTranslation(-e.x,-e.y,-e.z),this._m4_1.makeTranslation(e.x,e.y,e.z),this._m4_1.multiply(this._rotationMatrix),this._m4_1.multiply(this._translationMatrix),this._v3_1.setFromMatrixPosition(this._gizmoMatrixState).sub(e),this._v3_2.copy(this._v3_1).applyAxisAngle(this._rotationAxis,t),this._v3_2.sub(this._v3_1),this._m4_2.makeTranslation(this._v3_2.x,this._v3_2.y,this._v3_2.z),this.setTransformationMatrices(this._m4_1,this._m4_2),c0)),cX(this,"unprojectOnObj",(e,t)=>{if(!this.scene)return null;let r=new eT.Raycaster;r.near=t.near,r.far=t.far,r.setFromCamera(e,t);let i=r.intersectObjects(this.scene.children,!0);for(let e=0;e<i.length;e++)if(i[e].object.uuid!=this._gizmos.uuid&&i[e].face)return i[e].point.clone();return null}),cX(this,"unprojectOnTbSurface",(e,t,r,i,n)=>{if(e instanceof eT.OrthographicCamera){this._v2_1.copy(this.getCursorPosition(t,r,i)),this._v3_1.set(this._v2_1.x,this._v2_1.y,0);let e=Math.pow(this._v2_1.x,2),n=Math.pow(this._v2_1.y,2),a=Math.pow(this._tbRadius,2);return e+n<=.5*a?this._v3_1.setZ(Math.sqrt(a-(e+n))):this._v3_1.setZ(.5*a/Math.sqrt(e+n)),this._v3_1}if(e instanceof eT.PerspectiveCamera){this._v2_1.copy(this.getCursorNDC(t,r,i)),this._v3_1.set(this._v2_1.x,this._v2_1.y,-1),this._v3_1.applyMatrix4(e.projectionMatrixInverse);let a=this._v3_1.clone().normalize(),o=e.position.distanceTo(this._gizmos.position),s=Math.pow(n,2),l=this._v3_1.z,c=Math.sqrt(Math.pow(this._v3_1.x,2)+Math.pow(this._v3_1.y,2));if(0==c)return a.set(this._v3_1.x,this._v3_1.y,n),a;let u=l/c,h=Math.pow(u,2)+1,A=2*u*o,d=Math.pow(o,2)-s,f=Math.pow(A,2)-4*h*d;if(f>=0&&(this._v2_1.setX((-A-Math.sqrt(f))/(2*h)),this._v2_1.setY(u*this._v2_1.x+o),eT.MathUtils.RAD2DEG*this._v2_1.angle()>=45)){let e=Math.sqrt(Math.pow(this._v2_1.x,2)+Math.pow(o-this._v2_1.y,2));return a.multiplyScalar(e),a.z+=o,a}h=u,f=Math.pow(A=o,2)-4*h*(d=-(.5*s)),this._v2_1.setX((-A-Math.sqrt(f))/(2*h)),this._v2_1.setY(u*this._v2_1.x+o);let m=Math.sqrt(Math.pow(this._v2_1.x,2)+Math.pow(o-this._v2_1.y,2));return a.multiplyScalar(m),a.z+=o,a}}),cX(this,"unprojectOnTbPlane",(e,t,r,i,n=!1)=>{if(e instanceof eT.OrthographicCamera)return this._v2_1.copy(this.getCursorPosition(t,r,i)),this._v3_1.set(this._v2_1.x,this._v2_1.y,0),this._v3_1.clone();if(e instanceof eT.PerspectiveCamera){let a;this._v2_1.copy(this.getCursorNDC(t,r,i)),this._v3_1.set(this._v2_1.x,this._v2_1.y,-1),this._v3_1.applyMatrix4(e.projectionMatrixInverse);let o=this._v3_1.clone().normalize(),s=this._v3_1.z,l=Math.sqrt(Math.pow(this._v3_1.x,2)+Math.pow(this._v3_1.y,2));return(a=n?this._v3_1.setFromMatrixPosition(this._cameraMatrixState0).distanceTo(this._v3_2.setFromMatrixPosition(this._gizmoMatrixState0)):e.position.distanceTo(this._gizmos.position),0==l)?o.set(0,0,0):(o.multiplyScalar(Math.sqrt(Math.pow(a,2)+Math.pow(-a/(s/l),2))),o.z=0),o}}),cX(this,"updateMatrixState",()=>{this.camera&&(this._cameraMatrixState.copy(this.camera.matrix),this._gizmoMatrixState.copy(this._gizmos.matrix),this.camera instanceof eT.OrthographicCamera&&(this._cameraProjectionState.copy(this.camera.projectionMatrix),this.camera.updateProjectionMatrix(),this._zoomState=this.camera.zoom),this.camera instanceof eT.PerspectiveCamera&&(this._fovState=this.camera.fov))}),cX(this,"updateTbState",(e,t)=>{this._state=e,t&&this.updateMatrixState()}),cX(this,"update",()=>{if(!this.target.equals(this._currentTarget)&&this.camera){this._gizmos.position.set(this.target.x,this.target.y,this.target.z);let e=this.calculateTbRadius(this.camera);void 0!==e&&(this._tbRadius=e),this.makeGizmos(this.target,this._tbRadius),this._currentTarget.copy(this.target)}if(this.camera){if(this.camera instanceof eT.OrthographicCamera&&(this.camera.zoom>this.maxZoom||this.camera.zoom<this.minZoom)){let e=eT.MathUtils.clamp(this.camera.zoom,this.minZoom,this.maxZoom);this.applyTransformMatrix(this.applyScale(e/this.camera.zoom,this._gizmos.position,!0))}if(this.camera instanceof eT.PerspectiveCamera){let e=this.camera.position.distanceTo(this._gizmos.position);if(e>this.maxDistance+1e-6||e<this.minDistance-1e-6){let t=eT.MathUtils.clamp(e,this.minDistance,this.maxDistance);this.applyTransformMatrix(this.applyScale(t/e,this._gizmos.position)),this.updateMatrixState()}(this.camera.fov<this.minFov||this.camera.fov>this.maxFov)&&(this.camera.fov=eT.MathUtils.clamp(this.camera.fov,this.minFov,this.maxFov),this.camera.updateProjectionMatrix());let t=this._tbRadius,r=this.calculateTbRadius(this.camera);if(void 0!==r&&(this._tbRadius=r),t<this._tbRadius-1e-6||t>this._tbRadius+1e-6){let e=(this._gizmos.scale.x+this._gizmos.scale.y+this._gizmos.scale.z)/3,t=this._tbRadius/e,r=new eT.EllipseCurve(0,0,t,t).getPoints(this._curvePts),i=new eT.BufferGeometry().setFromPoints(r);for(let e in this._gizmos.children)this._gizmos.children[e].geometry=i}}this.camera.lookAt(this._gizmos.position)}}),cX(this,"setStateFromJSON",e=>{let t=JSON.parse(e);if(t.arcballState&&this.camera){this._cameraMatrixState.fromArray(t.arcballState.cameraMatrix.elements),this._cameraMatrixState.decompose(this.camera.position,this.camera.quaternion,this.camera.scale),this.camera.up.copy(t.arcballState.cameraUp),this.camera.near=t.arcballState.cameraNear,this.camera.far=t.arcballState.cameraFar,this.camera.zoom=t.arcballState.cameraZoom,this.camera instanceof eT.PerspectiveCamera&&(this.camera.fov=t.arcballState.cameraFov),this._gizmoMatrixState.fromArray(t.arcballState.gizmoMatrix.elements),this._gizmoMatrixState.decompose(this._gizmos.position,this._gizmos.quaternion,this._gizmos.scale),this.camera.updateMatrix(),this.camera.updateProjectionMatrix(),this._gizmos.updateMatrix();let e=this.calculateTbRadius(this.camera);void 0!==e&&(this._tbRadius=e);let r=new eT.Matrix4().copy(this._gizmoMatrixState0);this.makeGizmos(this._gizmos.position,this._tbRadius),this._gizmoMatrixState0.copy(r),this.camera.lookAt(this._gizmos.position),this.updateTbState(cZ.IDLE,!1),this.dispatchEvent(c2)}}),this.camera=null,this.domElement=t,this.scene=r,this.mouseActions=[],this._mouseOp=null,this._v2_1=new eT.Vector2,this._v3_1=new eT.Vector3,this._v3_2=new eT.Vector3,this._m4_1=new eT.Matrix4,this._m4_2=new eT.Matrix4,this._quat=new eT.Quaternion,this._translationMatrix=new eT.Matrix4,this._rotationMatrix=new eT.Matrix4,this._scaleMatrix=new eT.Matrix4,this._rotationAxis=new eT.Vector3,this._cameraMatrixState=new eT.Matrix4,this._cameraProjectionState=new eT.Matrix4,this._fovState=1,this._upState=new eT.Vector3,this._zoomState=1,this._nearPos=0,this._farPos=0,this._gizmoMatrixState=new eT.Matrix4,this._up0=new eT.Vector3,this._zoom0=1,this._fov0=0,this._initialNear=0,this._nearPos0=0,this._initialFar=0,this._farPos0=0,this._cameraMatrixState0=new eT.Matrix4,this._gizmoMatrixState0=new eT.Matrix4,this._button=-1,this._touchStart=[],this._touchCurrent=[],this._input=c$.NONE,this._switchSensibility=32,this._startFingerDistance=0,this._currentFingerDistance=0,this._startFingerRotation=0,this._currentFingerRotation=0,this._devPxRatio=0,this._downValid=!0,this._nclicks=0,this._downEvents=[],this._clickStart=0,this._maxDownTime=250,this._maxInterval=300,this._posThreshold=24,this._movementThreshold=24,this._currentCursorPosition=new eT.Vector3,this._startCursorPosition=new eT.Vector3,this._grid=null,this._gridPosition=new eT.Vector3,this._gizmos=new eT.Group,this._curvePts=128,this._timeStart=-1,this._animationId=-1,this.focusAnimationTime=500,this._timePrev=0,this._timeCurrent=0,this._anglePrev=0,this._angleCurrent=0,this._cursorPosPrev=new eT.Vector3,this._cursorPosCurr=new eT.Vector3,this._wPrev=0,this._wCurr=0,this.adjustNearFar=!1,this.scaleFactor=1.1,this.dampingFactor=25,this.wMax=20,this.enableAnimations=!0,this.enableGrid=!1,this.cursorZoom=!1,this.minFov=5,this.maxFov=90,this.enabled=!0,this.enablePan=!0,this.enableRotate=!0,this.enableZoom=!0,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.target=new eT.Vector3(0,0,0),this._currentTarget=new eT.Vector3(0,0,0),this._tbRadius=1,this._state=cZ.IDLE,this.setCamera(e),this.scene&&this.scene.add(this._gizmos),this._devPxRatio=window.devicePixelRatio,this.initializeMouseActions(),this.domElement&&this.connect(this.domElement),window.addEventListener("resize",this.onWindowResize)}applyTransformMatrix(e){if((null==e?void 0:e.camera)&&this.camera&&(this._m4_1.copy(this._cameraMatrixState).premultiply(e.camera),this._m4_1.decompose(this.camera.position,this.camera.quaternion,this.camera.scale),this.camera.updateMatrix(),(this._state==cZ.ROTATE||this._state==cZ.ZROTATE||this._state==cZ.ANIMATION_ROTATE)&&this.camera.up.copy(this._upState).applyQuaternion(this.camera.quaternion)),(null==e?void 0:e.gizmos)&&(this._m4_1.copy(this._gizmoMatrixState).premultiply(e.gizmos),this._m4_1.decompose(this._gizmos.position,this._gizmos.quaternion,this._gizmos.scale),this._gizmos.updateMatrix()),(this._state==cZ.SCALE||this._state==cZ.FOCUS||this._state==cZ.ANIMATION_FOCUS)&&this.camera){let e=this.calculateTbRadius(this.camera);if(void 0!==e&&(this._tbRadius=e),this.adjustNearFar){let e=this.camera.position.distanceTo(this._gizmos.position),t=new eT.Box3;t.setFromObject(this._gizmos);let r=new eT.Sphere;t.getBoundingSphere(r);let i=Math.max(this._nearPos0,r.radius+r.center.length()),n=e-this._initialNear;this.camera.near=e-Math.min(i,n);let a=Math.min(this._farPos0,-r.radius+r.center.length()),o=e-this._initialFar;this.camera.far=e-Math.min(a,o),this.camera.updateProjectionMatrix()}else{let e=!1;this.camera.near!=this._initialNear&&(this.camera.near=this._initialNear,e=!0),this.camera.far!=this._initialFar&&(this.camera.far=this._initialFar,e=!0),e&&this.camera.updateProjectionMatrix()}}}setGizmosVisible(e){this._gizmos.visible=e,this.dispatchEvent(c2)}setTransformationMatrices(e=null,t=null){e?c0.camera?c0.camera.copy(e):c0.camera=e.clone():c0.camera=null,t?c0.gizmos?c0.gizmos.copy(t):c0.gizmos=t.clone():c0.gizmos=null}}let c6=(0,eS.forwardRef)(({camera:e,makeDefault:t,regress:r,domElement:i,onChange:n,onStart:a,onEnd:o,...s},l)=>{let c=(0,eR.D)(e=>e.invalidate),u=(0,eR.D)(e=>e.camera),h=(0,eR.D)(e=>e.gl),A=(0,eR.D)(e=>e.events),d=(0,eR.D)(e=>e.set),f=(0,eR.D)(e=>e.get),m=(0,eR.D)(e=>e.performance),p=e||u,g=i||A.connected||h.domElement,y=(0,eS.useMemo)(()=>new c5(p),[p]);return(0,eR.F)(()=>{y.enabled&&y.update()},-1),(0,eS.useEffect)(()=>(y.connect(g),()=>void y.dispose()),[g,r,y,c]),(0,eS.useEffect)(()=>{let e=e=>{c(),r&&m.regress(),n&&n(e)};return y.addEventListener("change",e),a&&y.addEventListener("start",a),o&&y.addEventListener("end",o),()=>{y.removeEventListener("change",e),a&&y.removeEventListener("start",a),o&&y.removeEventListener("end",o)}},[n,a,o]),(0,eS.useEffect)(()=>{if(t){let e=f().controls;return d({controls:y}),()=>d({controls:e})}},[t,y]),eS.createElement("primitive",j({ref:l,object:y},s))});var c8=Object.defineProperty,c9=(e,t,r)=>t in e?c8(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,c7=(e,t,r)=>(c9(e,"symbol"!=typeof t?t+"":t,r),r);class ue extends eT.Object3D{constructor(e,t){super(),c7(this,"isTransformControls",!0),c7(this,"visible",!1),c7(this,"domElement"),c7(this,"raycaster",new eT.Raycaster),c7(this,"gizmo"),c7(this,"plane"),c7(this,"tempVector",new eT.Vector3),c7(this,"tempVector2",new eT.Vector3),c7(this,"tempQuaternion",new eT.Quaternion),c7(this,"unit",{X:new eT.Vector3(1,0,0),Y:new eT.Vector3(0,1,0),Z:new eT.Vector3(0,0,1)}),c7(this,"pointStart",new eT.Vector3),c7(this,"pointEnd",new eT.Vector3),c7(this,"offset",new eT.Vector3),c7(this,"rotationAxis",new eT.Vector3),c7(this,"startNorm",new eT.Vector3),c7(this,"endNorm",new eT.Vector3),c7(this,"rotationAngle",0),c7(this,"cameraPosition",new eT.Vector3),c7(this,"cameraQuaternion",new eT.Quaternion),c7(this,"cameraScale",new eT.Vector3),c7(this,"parentPosition",new eT.Vector3),c7(this,"parentQuaternion",new eT.Quaternion),c7(this,"parentQuaternionInv",new eT.Quaternion),c7(this,"parentScale",new eT.Vector3),c7(this,"worldPositionStart",new eT.Vector3),c7(this,"worldQuaternionStart",new eT.Quaternion),c7(this,"worldScaleStart",new eT.Vector3),c7(this,"worldPosition",new eT.Vector3),c7(this,"worldQuaternion",new eT.Quaternion),c7(this,"worldQuaternionInv",new eT.Quaternion),c7(this,"worldScale",new eT.Vector3),c7(this,"eye",new eT.Vector3),c7(this,"positionStart",new eT.Vector3),c7(this,"quaternionStart",new eT.Quaternion),c7(this,"scaleStart",new eT.Vector3),c7(this,"camera"),c7(this,"object"),c7(this,"enabled",!0),c7(this,"axis",null),c7(this,"mode","translate"),c7(this,"translationSnap",null),c7(this,"rotationSnap",null),c7(this,"scaleSnap",null),c7(this,"space","world"),c7(this,"size",1),c7(this,"dragging",!1),c7(this,"showX",!0),c7(this,"showY",!0),c7(this,"showZ",!0),c7(this,"changeEvent",{type:"change"}),c7(this,"mouseDownEvent",{type:"mouseDown",mode:this.mode}),c7(this,"mouseUpEvent",{type:"mouseUp",mode:this.mode}),c7(this,"objectChangeEvent",{type:"objectChange"}),c7(this,"intersectObjectWithRay",(e,t,r)=>{let i=t.intersectObject(e,!0);for(let e=0;e<i.length;e++)if(i[e].object.visible||r)return i[e];return!1}),c7(this,"attach",e=>(this.object=e,this.visible=!0,this)),c7(this,"detach",()=>(this.object=void 0,this.visible=!1,this.axis=null,this)),c7(this,"reset",()=>(this.enabled&&this.dragging&&void 0!==this.object&&(this.object.position.copy(this.positionStart),this.object.quaternion.copy(this.quaternionStart),this.object.scale.copy(this.scaleStart),this.dispatchEvent(this.changeEvent),this.dispatchEvent(this.objectChangeEvent),this.pointStart.copy(this.pointEnd)),this)),c7(this,"updateMatrixWorld",()=>{void 0!==this.object&&(this.object.updateMatrixWorld(),null===this.object.parent?console.error("TransformControls: The attached 3D object must be a part of the scene graph."):this.object.parent.matrixWorld.decompose(this.parentPosition,this.parentQuaternion,this.parentScale),this.object.matrixWorld.decompose(this.worldPosition,this.worldQuaternion,this.worldScale),this.parentQuaternionInv.copy(this.parentQuaternion).invert(),this.worldQuaternionInv.copy(this.worldQuaternion).invert()),this.camera.updateMatrixWorld(),this.camera.matrixWorld.decompose(this.cameraPosition,this.cameraQuaternion,this.cameraScale),this.eye.copy(this.cameraPosition).sub(this.worldPosition).normalize(),super.updateMatrixWorld()}),c7(this,"pointerHover",e=>{if(void 0===this.object||!0===this.dragging)return;this.raycaster.setFromCamera(e,this.camera);let t=this.intersectObjectWithRay(this.gizmo.picker[this.mode],this.raycaster);t?this.axis=t.object.name:this.axis=null}),c7(this,"pointerDown",e=>{if(void 0!==this.object&&!0!==this.dragging&&0===e.button&&null!==this.axis){this.raycaster.setFromCamera(e,this.camera);let t=this.intersectObjectWithRay(this.plane,this.raycaster,!0);if(t){let e=this.space;if("scale"===this.mode?e="local":("E"===this.axis||"XYZE"===this.axis||"XYZ"===this.axis)&&(e="world"),"local"===e&&"rotate"===this.mode){let e=this.rotationSnap;"X"===this.axis&&e&&(this.object.rotation.x=Math.round(this.object.rotation.x/e)*e),"Y"===this.axis&&e&&(this.object.rotation.y=Math.round(this.object.rotation.y/e)*e),"Z"===this.axis&&e&&(this.object.rotation.z=Math.round(this.object.rotation.z/e)*e)}this.object.updateMatrixWorld(),this.object.parent&&this.object.parent.updateMatrixWorld(),this.positionStart.copy(this.object.position),this.quaternionStart.copy(this.object.quaternion),this.scaleStart.copy(this.object.scale),this.object.matrixWorld.decompose(this.worldPositionStart,this.worldQuaternionStart,this.worldScaleStart),this.pointStart.copy(t.point).sub(this.worldPositionStart)}this.dragging=!0,this.mouseDownEvent.mode=this.mode,this.dispatchEvent(this.mouseDownEvent)}}),c7(this,"pointerMove",e=>{let t=this.axis,r=this.mode,i=this.object,n=this.space;if("scale"===r?n="local":("E"===t||"XYZE"===t||"XYZ"===t)&&(n="world"),void 0===i||null===t||!1===this.dragging||-1!==e.button)return;this.raycaster.setFromCamera(e,this.camera);let a=this.intersectObjectWithRay(this.plane,this.raycaster,!0);if(a){if(this.pointEnd.copy(a.point).sub(this.worldPositionStart),"translate"===r)this.offset.copy(this.pointEnd).sub(this.pointStart),"local"===n&&"XYZ"!==t&&this.offset.applyQuaternion(this.worldQuaternionInv),-1===t.indexOf("X")&&(this.offset.x=0),-1===t.indexOf("Y")&&(this.offset.y=0),-1===t.indexOf("Z")&&(this.offset.z=0),"local"===n&&"XYZ"!==t?this.offset.applyQuaternion(this.quaternionStart).divide(this.parentScale):this.offset.applyQuaternion(this.parentQuaternionInv).divide(this.parentScale),i.position.copy(this.offset).add(this.positionStart),this.translationSnap&&("local"===n&&(i.position.applyQuaternion(this.tempQuaternion.copy(this.quaternionStart).invert()),-1!==t.search("X")&&(i.position.x=Math.round(i.position.x/this.translationSnap)*this.translationSnap),-1!==t.search("Y")&&(i.position.y=Math.round(i.position.y/this.translationSnap)*this.translationSnap),-1!==t.search("Z")&&(i.position.z=Math.round(i.position.z/this.translationSnap)*this.translationSnap),i.position.applyQuaternion(this.quaternionStart)),"world"===n&&(i.parent&&i.position.add(this.tempVector.setFromMatrixPosition(i.parent.matrixWorld)),-1!==t.search("X")&&(i.position.x=Math.round(i.position.x/this.translationSnap)*this.translationSnap),-1!==t.search("Y")&&(i.position.y=Math.round(i.position.y/this.translationSnap)*this.translationSnap),-1!==t.search("Z")&&(i.position.z=Math.round(i.position.z/this.translationSnap)*this.translationSnap),i.parent&&i.position.sub(this.tempVector.setFromMatrixPosition(i.parent.matrixWorld))));else if("scale"===r){if(-1!==t.search("XYZ")){let e=this.pointEnd.length()/this.pointStart.length();0>this.pointEnd.dot(this.pointStart)&&(e*=-1),this.tempVector2.set(e,e,e)}else this.tempVector.copy(this.pointStart),this.tempVector2.copy(this.pointEnd),this.tempVector.applyQuaternion(this.worldQuaternionInv),this.tempVector2.applyQuaternion(this.worldQuaternionInv),this.tempVector2.divide(this.tempVector),-1===t.search("X")&&(this.tempVector2.x=1),-1===t.search("Y")&&(this.tempVector2.y=1),-1===t.search("Z")&&(this.tempVector2.z=1);i.scale.copy(this.scaleStart).multiply(this.tempVector2),this.scaleSnap&&this.object&&(-1!==t.search("X")&&(this.object.scale.x=Math.round(i.scale.x/this.scaleSnap)*this.scaleSnap||this.scaleSnap),-1!==t.search("Y")&&(i.scale.y=Math.round(i.scale.y/this.scaleSnap)*this.scaleSnap||this.scaleSnap),-1!==t.search("Z")&&(i.scale.z=Math.round(i.scale.z/this.scaleSnap)*this.scaleSnap||this.scaleSnap))}else if("rotate"===r){this.offset.copy(this.pointEnd).sub(this.pointStart);let e=20/this.worldPosition.distanceTo(this.tempVector.setFromMatrixPosition(this.camera.matrixWorld));"E"===t?(this.rotationAxis.copy(this.eye),this.rotationAngle=this.pointEnd.angleTo(this.pointStart),this.startNorm.copy(this.pointStart).normalize(),this.endNorm.copy(this.pointEnd).normalize(),this.rotationAngle*=0>this.endNorm.cross(this.startNorm).dot(this.eye)?1:-1):"XYZE"===t?(this.rotationAxis.copy(this.offset).cross(this.eye).normalize(),this.rotationAngle=this.offset.dot(this.tempVector.copy(this.rotationAxis).cross(this.eye))*e):("X"===t||"Y"===t||"Z"===t)&&(this.rotationAxis.copy(this.unit[t]),this.tempVector.copy(this.unit[t]),"local"===n&&this.tempVector.applyQuaternion(this.worldQuaternion),this.rotationAngle=this.offset.dot(this.tempVector.cross(this.eye).normalize())*e),this.rotationSnap&&(this.rotationAngle=Math.round(this.rotationAngle/this.rotationSnap)*this.rotationSnap),"local"===n&&"E"!==t&&"XYZE"!==t?(i.quaternion.copy(this.quaternionStart),i.quaternion.multiply(this.tempQuaternion.setFromAxisAngle(this.rotationAxis,this.rotationAngle)).normalize()):(this.rotationAxis.applyQuaternion(this.parentQuaternionInv),i.quaternion.copy(this.tempQuaternion.setFromAxisAngle(this.rotationAxis,this.rotationAngle)),i.quaternion.multiply(this.quaternionStart).normalize())}this.dispatchEvent(this.changeEvent),this.dispatchEvent(this.objectChangeEvent)}}),c7(this,"pointerUp",e=>{0===e.button&&(this.dragging&&null!==this.axis&&(this.mouseUpEvent.mode=this.mode,this.dispatchEvent(this.mouseUpEvent)),this.dragging=!1,this.axis=null)}),c7(this,"getPointer",e=>{var t;if(this.domElement&&(null==(t=this.domElement.ownerDocument)?void 0:t.pointerLockElement))return{x:0,y:0,button:e.button};{let t=e.changedTouches?e.changedTouches[0]:e,r=this.domElement.getBoundingClientRect();return{x:(t.clientX-r.left)/r.width*2-1,y:-(t.clientY-r.top)/r.height*2+1,button:e.button}}}),c7(this,"onPointerHover",e=>{if(this.enabled)switch(e.pointerType){case"mouse":case"pen":this.pointerHover(this.getPointer(e))}}),c7(this,"onPointerDown",e=>{this.enabled&&this.domElement&&(this.domElement.style.touchAction="none",this.domElement.ownerDocument.addEventListener("pointermove",this.onPointerMove),this.pointerHover(this.getPointer(e)),this.pointerDown(this.getPointer(e)))}),c7(this,"onPointerMove",e=>{this.enabled&&this.pointerMove(this.getPointer(e))}),c7(this,"onPointerUp",e=>{this.enabled&&this.domElement&&(this.domElement.style.touchAction="",this.domElement.ownerDocument.removeEventListener("pointermove",this.onPointerMove),this.pointerUp(this.getPointer(e)))}),c7(this,"getMode",()=>this.mode),c7(this,"setMode",e=>{this.mode=e}),c7(this,"setTranslationSnap",e=>{this.translationSnap=e}),c7(this,"setRotationSnap",e=>{this.rotationSnap=e}),c7(this,"setScaleSnap",e=>{this.scaleSnap=e}),c7(this,"setSize",e=>{this.size=e}),c7(this,"setSpace",e=>{this.space=e}),c7(this,"update",()=>{console.warn("THREE.TransformControls: update function has no more functionality and therefore has been deprecated.")}),c7(this,"connect",e=>{e===document&&console.error('THREE.OrbitControls: "document" should not be used as the target "domElement". Please use "renderer.domElement" instead.'),this.domElement=e,this.domElement.addEventListener("pointerdown",this.onPointerDown),this.domElement.addEventListener("pointermove",this.onPointerHover),this.domElement.ownerDocument.addEventListener("pointerup",this.onPointerUp)}),c7(this,"dispose",()=>{var e,t,r,i,n,a;null==(e=this.domElement)||e.removeEventListener("pointerdown",this.onPointerDown),null==(t=this.domElement)||t.removeEventListener("pointermove",this.onPointerHover),null==(i=null==(r=this.domElement)?void 0:r.ownerDocument)||i.removeEventListener("pointermove",this.onPointerMove),null==(a=null==(n=this.domElement)?void 0:n.ownerDocument)||a.removeEventListener("pointerup",this.onPointerUp),this.traverse(e=>{e.geometry&&e.geometry.dispose(),e.material&&e.material.dispose()})}),this.domElement=t,this.camera=e,this.gizmo=new ut,this.add(this.gizmo),this.plane=new ur,this.add(this.plane);let r=(e,t)=>{let r=t;Object.defineProperty(this,e,{get:function(){return void 0!==r?r:t},set:function(t){r!==t&&(r=t,this.plane[e]=t,this.gizmo[e]=t,this.dispatchEvent({type:e+"-changed",value:t}),this.dispatchEvent(this.changeEvent))}}),this[e]=t,this.plane[e]=t,this.gizmo[e]=t};r("camera",this.camera),r("object",this.object),r("enabled",this.enabled),r("axis",this.axis),r("mode",this.mode),r("translationSnap",this.translationSnap),r("rotationSnap",this.rotationSnap),r("scaleSnap",this.scaleSnap),r("space",this.space),r("size",this.size),r("dragging",this.dragging),r("showX",this.showX),r("showY",this.showY),r("showZ",this.showZ),r("worldPosition",this.worldPosition),r("worldPositionStart",this.worldPositionStart),r("worldQuaternion",this.worldQuaternion),r("worldQuaternionStart",this.worldQuaternionStart),r("cameraPosition",this.cameraPosition),r("cameraQuaternion",this.cameraQuaternion),r("pointStart",this.pointStart),r("pointEnd",this.pointEnd),r("rotationAxis",this.rotationAxis),r("rotationAngle",this.rotationAngle),r("eye",this.eye),void 0!==t&&this.connect(t)}}class ut extends eT.Object3D{constructor(){super(),c7(this,"isTransformControlsGizmo",!0),c7(this,"type","TransformControlsGizmo"),c7(this,"tempVector",new eT.Vector3(0,0,0)),c7(this,"tempEuler",new eT.Euler),c7(this,"alignVector",new eT.Vector3(0,1,0)),c7(this,"zeroVector",new eT.Vector3(0,0,0)),c7(this,"lookAtMatrix",new eT.Matrix4),c7(this,"tempQuaternion",new eT.Quaternion),c7(this,"tempQuaternion2",new eT.Quaternion),c7(this,"identityQuaternion",new eT.Quaternion),c7(this,"unitX",new eT.Vector3(1,0,0)),c7(this,"unitY",new eT.Vector3(0,1,0)),c7(this,"unitZ",new eT.Vector3(0,0,1)),c7(this,"gizmo"),c7(this,"picker"),c7(this,"helper"),c7(this,"rotationAxis",new eT.Vector3),c7(this,"cameraPosition",new eT.Vector3),c7(this,"worldPositionStart",new eT.Vector3),c7(this,"worldQuaternionStart",new eT.Quaternion),c7(this,"worldPosition",new eT.Vector3),c7(this,"worldQuaternion",new eT.Quaternion),c7(this,"eye",new eT.Vector3),c7(this,"camera",null),c7(this,"enabled",!0),c7(this,"axis",null),c7(this,"mode","translate"),c7(this,"space","world"),c7(this,"size",1),c7(this,"dragging",!1),c7(this,"showX",!0),c7(this,"showY",!0),c7(this,"showZ",!0),c7(this,"updateMatrixWorld",()=>{let e=this.space;"scale"===this.mode&&(e="local");let t="local"===e?this.worldQuaternion:this.identityQuaternion;this.gizmo.translate.visible="translate"===this.mode,this.gizmo.rotate.visible="rotate"===this.mode,this.gizmo.scale.visible="scale"===this.mode,this.helper.translate.visible="translate"===this.mode,this.helper.rotate.visible="rotate"===this.mode,this.helper.scale.visible="scale"===this.mode;let r=[];r=(r=(r=r.concat(this.picker[this.mode].children)).concat(this.gizmo[this.mode].children)).concat(this.helper[this.mode].children);for(let e=0;e<r.length;e++){let i;let n=r[e];if(n.visible=!0,n.rotation.set(0,0,0),n.position.copy(this.worldPosition),i=this.camera.isOrthographicCamera?(this.camera.top-this.camera.bottom)/this.camera.zoom:this.worldPosition.distanceTo(this.cameraPosition)*Math.min(1.9*Math.tan(Math.PI*this.camera.fov/360)/this.camera.zoom,7),n.scale.set(1,1,1).multiplyScalar(i*this.size/7),"helper"===n.tag){n.visible=!1,"AXIS"===n.name?(n.position.copy(this.worldPositionStart),n.visible=!!this.axis,"X"===this.axis&&(this.tempQuaternion.setFromEuler(this.tempEuler.set(0,0,0)),n.quaternion.copy(t).multiply(this.tempQuaternion),Math.abs(this.alignVector.copy(this.unitX).applyQuaternion(t).dot(this.eye))>.9&&(n.visible=!1)),"Y"===this.axis&&(this.tempQuaternion.setFromEuler(this.tempEuler.set(0,0,Math.PI/2)),n.quaternion.copy(t).multiply(this.tempQuaternion),Math.abs(this.alignVector.copy(this.unitY).applyQuaternion(t).dot(this.eye))>.9&&(n.visible=!1)),"Z"===this.axis&&(this.tempQuaternion.setFromEuler(this.tempEuler.set(0,Math.PI/2,0)),n.quaternion.copy(t).multiply(this.tempQuaternion),Math.abs(this.alignVector.copy(this.unitZ).applyQuaternion(t).dot(this.eye))>.9&&(n.visible=!1)),"XYZE"===this.axis&&(this.tempQuaternion.setFromEuler(this.tempEuler.set(0,Math.PI/2,0)),this.alignVector.copy(this.rotationAxis),n.quaternion.setFromRotationMatrix(this.lookAtMatrix.lookAt(this.zeroVector,this.alignVector,this.unitY)),n.quaternion.multiply(this.tempQuaternion),n.visible=this.dragging),"E"===this.axis&&(n.visible=!1)):"START"===n.name?(n.position.copy(this.worldPositionStart),n.visible=this.dragging):"END"===n.name?(n.position.copy(this.worldPosition),n.visible=this.dragging):"DELTA"===n.name?(n.position.copy(this.worldPositionStart),n.quaternion.copy(this.worldQuaternionStart),this.tempVector.set(1e-10,1e-10,1e-10).add(this.worldPositionStart).sub(this.worldPosition).multiplyScalar(-1),this.tempVector.applyQuaternion(this.worldQuaternionStart.clone().invert()),n.scale.copy(this.tempVector),n.visible=this.dragging):(n.quaternion.copy(t),this.dragging?n.position.copy(this.worldPositionStart):n.position.copy(this.worldPosition),this.axis&&(n.visible=-1!==this.axis.search(n.name)));continue}n.quaternion.copy(t),"translate"===this.mode||"scale"===this.mode?(("X"===n.name||"XYZX"===n.name)&&Math.abs(this.alignVector.copy(this.unitX).applyQuaternion(t).dot(this.eye))>.99&&(n.scale.set(1e-10,1e-10,1e-10),n.visible=!1),("Y"===n.name||"XYZY"===n.name)&&Math.abs(this.alignVector.copy(this.unitY).applyQuaternion(t).dot(this.eye))>.99&&(n.scale.set(1e-10,1e-10,1e-10),n.visible=!1),("Z"===n.name||"XYZZ"===n.name)&&Math.abs(this.alignVector.copy(this.unitZ).applyQuaternion(t).dot(this.eye))>.99&&(n.scale.set(1e-10,1e-10,1e-10),n.visible=!1),"XY"===n.name&&.2>Math.abs(this.alignVector.copy(this.unitZ).applyQuaternion(t).dot(this.eye))&&(n.scale.set(1e-10,1e-10,1e-10),n.visible=!1),"YZ"===n.name&&.2>Math.abs(this.alignVector.copy(this.unitX).applyQuaternion(t).dot(this.eye))&&(n.scale.set(1e-10,1e-10,1e-10),n.visible=!1),"XZ"===n.name&&.2>Math.abs(this.alignVector.copy(this.unitY).applyQuaternion(t).dot(this.eye))&&(n.scale.set(1e-10,1e-10,1e-10),n.visible=!1),-1!==n.name.search("X")&&(0>this.alignVector.copy(this.unitX).applyQuaternion(t).dot(this.eye)?"fwd"===n.tag?n.visible=!1:n.scale.x*=-1:"bwd"===n.tag&&(n.visible=!1)),-1!==n.name.search("Y")&&(0>this.alignVector.copy(this.unitY).applyQuaternion(t).dot(this.eye)?"fwd"===n.tag?n.visible=!1:n.scale.y*=-1:"bwd"===n.tag&&(n.visible=!1)),-1!==n.name.search("Z")&&(0>this.alignVector.copy(this.unitZ).applyQuaternion(t).dot(this.eye)?"fwd"===n.tag?n.visible=!1:n.scale.z*=-1:"bwd"===n.tag&&(n.visible=!1))):"rotate"===this.mode&&(this.tempQuaternion2.copy(t),this.alignVector.copy(this.eye).applyQuaternion(this.tempQuaternion.copy(t).invert()),-1!==n.name.search("E")&&n.quaternion.setFromRotationMatrix(this.lookAtMatrix.lookAt(this.eye,this.zeroVector,this.unitY)),"X"===n.name&&(this.tempQuaternion.setFromAxisAngle(this.unitX,Math.atan2(-this.alignVector.y,this.alignVector.z)),this.tempQuaternion.multiplyQuaternions(this.tempQuaternion2,this.tempQuaternion),n.quaternion.copy(this.tempQuaternion)),"Y"===n.name&&(this.tempQuaternion.setFromAxisAngle(this.unitY,Math.atan2(this.alignVector.x,this.alignVector.z)),this.tempQuaternion.multiplyQuaternions(this.tempQuaternion2,this.tempQuaternion),n.quaternion.copy(this.tempQuaternion)),"Z"===n.name&&(this.tempQuaternion.setFromAxisAngle(this.unitZ,Math.atan2(this.alignVector.y,this.alignVector.x)),this.tempQuaternion.multiplyQuaternions(this.tempQuaternion2,this.tempQuaternion),n.quaternion.copy(this.tempQuaternion))),n.visible=n.visible&&(-1===n.name.indexOf("X")||this.showX),n.visible=n.visible&&(-1===n.name.indexOf("Y")||this.showY),n.visible=n.visible&&(-1===n.name.indexOf("Z")||this.showZ),n.visible=n.visible&&(-1===n.name.indexOf("E")||this.showX&&this.showY&&this.showZ),n.material.tempOpacity=n.material.tempOpacity||n.material.opacity,n.material.tempColor=n.material.tempColor||n.material.color.clone(),n.material.color.copy(n.material.tempColor),n.material.opacity=n.material.tempOpacity,this.enabled?this.axis&&(n.name===this.axis?n.material.opacity=1:this.axis.split("").some(function(e){return n.name===e})?n.material.opacity=1:n.material.opacity*=.25,n.material.color.lerp(new eT.Color(1,1,1),.5)):(n.material.opacity*=.5,n.material.color.lerp(new eT.Color(1,1,1),.5))}super.updateMatrixWorld()});let e=new eT.MeshBasicMaterial({depthTest:!1,depthWrite:!1,transparent:!0,side:eT.DoubleSide,fog:!1,toneMapped:!1}),t=new eT.LineBasicMaterial({depthTest:!1,depthWrite:!1,transparent:!0,linewidth:1,fog:!1,toneMapped:!1}),r=e.clone();r.opacity=.15;let i=e.clone();i.opacity=.33;let n=e.clone();n.color.set(16711680);let a=e.clone();a.color.set(65280);let o=e.clone();o.color.set(255);let s=e.clone();s.opacity=.25;let l=s.clone();l.color.set(16776960);let c=s.clone();c.color.set(65535);let u=s.clone();u.color.set(16711935),e.clone().color.set(16776960);let h=t.clone();h.color.set(16711680);let A=t.clone();A.color.set(65280);let d=t.clone();d.color.set(255);let f=t.clone();f.color.set(65535);let m=t.clone();m.color.set(16711935);let p=t.clone();p.color.set(16776960);let g=t.clone();g.color.set(7895160);let y=p.clone();y.opacity=.25;let v=new eT.CylinderGeometry(0,.05,.2,12,1,!1),E=new eT.BoxGeometry(.125,.125,.125),x=new eT.BufferGeometry;x.setAttribute("position",new eT.Float32BufferAttribute([0,0,0,1,0,0],3));let C=(e,t)=>{let r=new eT.BufferGeometry,i=[];for(let r=0;r<=64*t;++r)i.push(0,Math.cos(r/32*Math.PI)*e,Math.sin(r/32*Math.PI)*e);return r.setAttribute("position",new eT.Float32BufferAttribute(i,3)),r},B={X:[[new eT.Mesh(v,n),[1,0,0],[0,0,-Math.PI/2],null,"fwd"],[new eT.Mesh(v,n),[1,0,0],[0,0,Math.PI/2],null,"bwd"],[new eT.Line(x,h)]],Y:[[new eT.Mesh(v,a),[0,1,0],null,null,"fwd"],[new eT.Mesh(v,a),[0,1,0],[Math.PI,0,0],null,"bwd"],[new eT.Line(x,A),null,[0,0,Math.PI/2]]],Z:[[new eT.Mesh(v,o),[0,0,1],[Math.PI/2,0,0],null,"fwd"],[new eT.Mesh(v,o),[0,0,1],[-Math.PI/2,0,0],null,"bwd"],[new eT.Line(x,d),null,[0,-Math.PI/2,0]]],XYZ:[[new eT.Mesh(new eT.OctahedronGeometry(.1,0),s.clone()),[0,0,0],[0,0,0]]],XY:[[new eT.Mesh(new eT.PlaneGeometry(.295,.295),l.clone()),[.15,.15,0]],[new eT.Line(x,p),[.18,.3,0],null,[.125,1,1]],[new eT.Line(x,p),[.3,.18,0],[0,0,Math.PI/2],[.125,1,1]]],YZ:[[new eT.Mesh(new eT.PlaneGeometry(.295,.295),c.clone()),[0,.15,.15],[0,Math.PI/2,0]],[new eT.Line(x,f),[0,.18,.3],[0,0,Math.PI/2],[.125,1,1]],[new eT.Line(x,f),[0,.3,.18],[0,-Math.PI/2,0],[.125,1,1]]],XZ:[[new eT.Mesh(new eT.PlaneGeometry(.295,.295),u.clone()),[.15,0,.15],[-Math.PI/2,0,0]],[new eT.Line(x,m),[.18,0,.3],null,[.125,1,1]],[new eT.Line(x,m),[.3,0,.18],[0,-Math.PI/2,0],[.125,1,1]]]},w={X:[[new eT.Mesh(new eT.CylinderGeometry(.2,0,1,4,1,!1),r),[.6,0,0],[0,0,-Math.PI/2]]],Y:[[new eT.Mesh(new eT.CylinderGeometry(.2,0,1,4,1,!1),r),[0,.6,0]]],Z:[[new eT.Mesh(new eT.CylinderGeometry(.2,0,1,4,1,!1),r),[0,0,.6],[Math.PI/2,0,0]]],XYZ:[[new eT.Mesh(new eT.OctahedronGeometry(.2,0),r)]],XY:[[new eT.Mesh(new eT.PlaneGeometry(.4,.4),r),[.2,.2,0]]],YZ:[[new eT.Mesh(new eT.PlaneGeometry(.4,.4),r),[0,.2,.2],[0,Math.PI/2,0]]],XZ:[[new eT.Mesh(new eT.PlaneGeometry(.4,.4),r),[.2,0,.2],[-Math.PI/2,0,0]]]},I={START:[[new eT.Mesh(new eT.OctahedronGeometry(.01,2),i),null,null,null,"helper"]],END:[[new eT.Mesh(new eT.OctahedronGeometry(.01,2),i),null,null,null,"helper"]],DELTA:[[new eT.Line((()=>{let e=new eT.BufferGeometry;return e.setAttribute("position",new eT.Float32BufferAttribute([0,0,0,1,1,1],3)),e})(),i),null,null,null,"helper"]],X:[[new eT.Line(x,i.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new eT.Line(x,i.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new eT.Line(x,i.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]},b={X:[[new eT.Line(C(1,.5),h)],[new eT.Mesh(new eT.OctahedronGeometry(.04,0),n),[0,0,.99],null,[1,3,1]]],Y:[[new eT.Line(C(1,.5),A),null,[0,0,-Math.PI/2]],[new eT.Mesh(new eT.OctahedronGeometry(.04,0),a),[0,0,.99],null,[3,1,1]]],Z:[[new eT.Line(C(1,.5),d),null,[0,Math.PI/2,0]],[new eT.Mesh(new eT.OctahedronGeometry(.04,0),o),[.99,0,0],null,[1,3,1]]],E:[[new eT.Line(C(1.25,1),y),null,[0,Math.PI/2,0]],[new eT.Mesh(new eT.CylinderGeometry(.03,0,.15,4,1,!1),y),[1.17,0,0],[0,0,-Math.PI/2],[1,1,.001]],[new eT.Mesh(new eT.CylinderGeometry(.03,0,.15,4,1,!1),y),[-1.17,0,0],[0,0,Math.PI/2],[1,1,.001]],[new eT.Mesh(new eT.CylinderGeometry(.03,0,.15,4,1,!1),y),[0,-1.17,0],[Math.PI,0,0],[1,1,.001]],[new eT.Mesh(new eT.CylinderGeometry(.03,0,.15,4,1,!1),y),[0,1.17,0],[0,0,0],[1,1,.001]]],XYZE:[[new eT.Line(C(1,1),g),null,[0,Math.PI/2,0]]]},_={AXIS:[[new eT.Line(x,i.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]]},M={X:[[new eT.Mesh(new eT.TorusGeometry(1,.1,4,24),r),[0,0,0],[0,-Math.PI/2,-Math.PI/2]]],Y:[[new eT.Mesh(new eT.TorusGeometry(1,.1,4,24),r),[0,0,0],[Math.PI/2,0,0]]],Z:[[new eT.Mesh(new eT.TorusGeometry(1,.1,4,24),r),[0,0,0],[0,0,-Math.PI/2]]],E:[[new eT.Mesh(new eT.TorusGeometry(1.25,.1,2,24),r)]],XYZE:[[new eT.Mesh(new eT.SphereGeometry(.7,10,8),r)]]},S={X:[[new eT.Mesh(E,n),[.8,0,0],[0,0,-Math.PI/2]],[new eT.Line(x,h),null,null,[.8,1,1]]],Y:[[new eT.Mesh(E,a),[0,.8,0]],[new eT.Line(x,A),null,[0,0,Math.PI/2],[.8,1,1]]],Z:[[new eT.Mesh(E,o),[0,0,.8],[Math.PI/2,0,0]],[new eT.Line(x,d),null,[0,-Math.PI/2,0],[.8,1,1]]],XY:[[new eT.Mesh(E,l),[.85,.85,0],null,[2,2,.2]],[new eT.Line(x,p),[.855,.98,0],null,[.125,1,1]],[new eT.Line(x,p),[.98,.855,0],[0,0,Math.PI/2],[.125,1,1]]],YZ:[[new eT.Mesh(E,c),[0,.85,.85],null,[.2,2,2]],[new eT.Line(x,f),[0,.855,.98],[0,0,Math.PI/2],[.125,1,1]],[new eT.Line(x,f),[0,.98,.855],[0,-Math.PI/2,0],[.125,1,1]]],XZ:[[new eT.Mesh(E,u),[.85,0,.85],null,[2,.2,2]],[new eT.Line(x,m),[.855,0,.98],null,[.125,1,1]],[new eT.Line(x,m),[.98,0,.855],[0,-Math.PI/2,0],[.125,1,1]]],XYZX:[[new eT.Mesh(new eT.BoxGeometry(.125,.125,.125),s.clone()),[1.1,0,0]]],XYZY:[[new eT.Mesh(new eT.BoxGeometry(.125,.125,.125),s.clone()),[0,1.1,0]]],XYZZ:[[new eT.Mesh(new eT.BoxGeometry(.125,.125,.125),s.clone()),[0,0,1.1]]]},D={X:[[new eT.Mesh(new eT.CylinderGeometry(.2,0,.8,4,1,!1),r),[.5,0,0],[0,0,-Math.PI/2]]],Y:[[new eT.Mesh(new eT.CylinderGeometry(.2,0,.8,4,1,!1),r),[0,.5,0]]],Z:[[new eT.Mesh(new eT.CylinderGeometry(.2,0,.8,4,1,!1),r),[0,0,.5],[Math.PI/2,0,0]]],XY:[[new eT.Mesh(E,r),[.85,.85,0],null,[3,3,.2]]],YZ:[[new eT.Mesh(E,r),[0,.85,.85],null,[.2,3,3]]],XZ:[[new eT.Mesh(E,r),[.85,0,.85],null,[3,.2,3]]],XYZX:[[new eT.Mesh(new eT.BoxGeometry(.2,.2,.2),r),[1.1,0,0]]],XYZY:[[new eT.Mesh(new eT.BoxGeometry(.2,.2,.2),r),[0,1.1,0]]],XYZZ:[[new eT.Mesh(new eT.BoxGeometry(.2,.2,.2),r),[0,0,1.1]]]},T={X:[[new eT.Line(x,i.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new eT.Line(x,i.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new eT.Line(x,i.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]},R=e=>{let t=new eT.Object3D;for(let r in e)for(let i=e[r].length;i--;){let n=e[r][i][0].clone(),a=e[r][i][1],o=e[r][i][2],s=e[r][i][3],l=e[r][i][4];n.name=r,n.tag=l,a&&n.position.set(a[0],a[1],a[2]),o&&n.rotation.set(o[0],o[1],o[2]),s&&n.scale.set(s[0],s[1],s[2]),n.updateMatrix();let c=n.geometry.clone();c.applyMatrix4(n.matrix),n.geometry=c,n.renderOrder=1/0,n.position.set(0,0,0),n.rotation.set(0,0,0),n.scale.set(1,1,1),t.add(n)}return t};this.gizmo={},this.picker={},this.helper={},this.add(this.gizmo.translate=R(B)),this.add(this.gizmo.rotate=R(b)),this.add(this.gizmo.scale=R(S)),this.add(this.picker.translate=R(w)),this.add(this.picker.rotate=R(M)),this.add(this.picker.scale=R(D)),this.add(this.helper.translate=R(I)),this.add(this.helper.rotate=R(_)),this.add(this.helper.scale=R(T)),this.picker.translate.visible=!1,this.picker.rotate.visible=!1,this.picker.scale.visible=!1}}class ur extends eT.Mesh{constructor(){super(new eT.PlaneGeometry(1e5,1e5,2,2),new eT.MeshBasicMaterial({visible:!1,wireframe:!0,side:eT.DoubleSide,transparent:!0,opacity:.1,toneMapped:!1})),c7(this,"isTransformControlsPlane",!0),c7(this,"type","TransformControlsPlane"),c7(this,"unitX",new eT.Vector3(1,0,0)),c7(this,"unitY",new eT.Vector3(0,1,0)),c7(this,"unitZ",new eT.Vector3(0,0,1)),c7(this,"tempVector",new eT.Vector3),c7(this,"dirVector",new eT.Vector3),c7(this,"alignVector",new eT.Vector3),c7(this,"tempMatrix",new eT.Matrix4),c7(this,"identityQuaternion",new eT.Quaternion),c7(this,"cameraQuaternion",new eT.Quaternion),c7(this,"worldPosition",new eT.Vector3),c7(this,"worldQuaternion",new eT.Quaternion),c7(this,"eye",new eT.Vector3),c7(this,"axis",null),c7(this,"mode","translate"),c7(this,"space","world"),c7(this,"updateMatrixWorld",()=>{let e=this.space;switch(this.position.copy(this.worldPosition),"scale"===this.mode&&(e="local"),this.unitX.set(1,0,0).applyQuaternion("local"===e?this.worldQuaternion:this.identityQuaternion),this.unitY.set(0,1,0).applyQuaternion("local"===e?this.worldQuaternion:this.identityQuaternion),this.unitZ.set(0,0,1).applyQuaternion("local"===e?this.worldQuaternion:this.identityQuaternion),this.alignVector.copy(this.unitY),this.mode){case"translate":case"scale":switch(this.axis){case"X":this.alignVector.copy(this.eye).cross(this.unitX),this.dirVector.copy(this.unitX).cross(this.alignVector);break;case"Y":this.alignVector.copy(this.eye).cross(this.unitY),this.dirVector.copy(this.unitY).cross(this.alignVector);break;case"Z":this.alignVector.copy(this.eye).cross(this.unitZ),this.dirVector.copy(this.unitZ).cross(this.alignVector);break;case"XY":this.dirVector.copy(this.unitZ);break;case"YZ":this.dirVector.copy(this.unitX);break;case"XZ":this.alignVector.copy(this.unitZ),this.dirVector.copy(this.unitY);break;case"XYZ":case"E":this.dirVector.set(0,0,0)}break;default:this.dirVector.set(0,0,0)}0===this.dirVector.length()?this.quaternion.copy(this.cameraQuaternion):(this.tempMatrix.lookAt(this.tempVector.set(0,0,0),this.dirVector,this.alignVector),this.quaternion.setFromRotationMatrix(this.tempMatrix)),super.updateMatrixWorld()})}}let ui=eS.forwardRef(({children:e,domElement:t,onChange:r,onMouseDown:i,onMouseUp:n,onObjectChange:a,object:o,makeDefault:s,camera:l,enabled:c,axis:u,mode:h,translationSnap:A,rotationSnap:d,scaleSnap:f,space:m,size:p,showX:g,showY:y,showZ:v,...E},x)=>{let C=(0,eR.D)(e=>e.controls),B=(0,eR.D)(e=>e.gl),w=(0,eR.D)(e=>e.events),I=(0,eR.D)(e=>e.camera),b=(0,eR.D)(e=>e.invalidate),_=(0,eR.D)(e=>e.get),M=(0,eR.D)(e=>e.set),S=l||I,D=t||w.connected||B.domElement,T=eS.useMemo(()=>new ue(S,D),[S,D]),R=eS.useRef(null);eS.useLayoutEffect(()=>(o?T.attach(o instanceof eT.Object3D?o:o.current):R.current instanceof eT.Object3D&&T.attach(R.current),()=>void T.detach()),[o,e,T]),eS.useEffect(()=>{if(C){let e=e=>C.enabled=!e.value;return T.addEventListener("dragging-changed",e),()=>T.removeEventListener("dragging-changed",e)}},[T,C]);let F=eS.useRef(),P=eS.useRef(),Q=eS.useRef(),z=eS.useRef();return eS.useLayoutEffect(()=>void(F.current=r),[r]),eS.useLayoutEffect(()=>void(P.current=i),[i]),eS.useLayoutEffect(()=>void(Q.current=n),[n]),eS.useLayoutEffect(()=>void(z.current=a),[a]),eS.useEffect(()=>{let e=e=>{b(),null==F.current||F.current(e)},t=e=>null==P.current?void 0:P.current(e),r=e=>null==Q.current?void 0:Q.current(e),i=e=>null==z.current?void 0:z.current(e);return T.addEventListener("change",e),T.addEventListener("mouseDown",t),T.addEventListener("mouseUp",r),T.addEventListener("objectChange",i),()=>{T.removeEventListener("change",e),T.removeEventListener("mouseDown",t),T.removeEventListener("mouseUp",r),T.removeEventListener("objectChange",i)}},[b,T]),eS.useEffect(()=>{if(s){let e=_().controls;return M({controls:T}),()=>M({controls:e})}},[s,T]),eS.createElement(eS.Fragment,null,eS.createElement("primitive",{ref:x,object:T,enabled:c,axis:u,mode:h,translationSnap:A,rotationSnap:d,scaleSnap:f,space:m,size:p,showX:g,showY:y,showZ:v}),eS.createElement("group",j({ref:R},E),e))});var un=Object.defineProperty,ua=(e,t,r)=>t in e?un(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,uo=(e,t,r)=>(ua(e,"symbol"!=typeof t?t+"":t,r),r);let us=new eT.Euler(0,0,0,"YXZ"),ul=new eT.Vector3,uc={type:"change"},uu={type:"lock"},uh={type:"unlock"},uA=Math.PI/2;class ud extends cx{constructor(e,t){super(),uo(this,"camera"),uo(this,"domElement"),uo(this,"isLocked"),uo(this,"minPolarAngle"),uo(this,"maxPolarAngle"),uo(this,"pointerSpeed"),uo(this,"onMouseMove",e=>{this.domElement&&!1!==this.isLocked&&(us.setFromQuaternion(this.camera.quaternion),us.y-=.002*e.movementX*this.pointerSpeed,us.x-=.002*e.movementY*this.pointerSpeed,us.x=Math.max(uA-this.maxPolarAngle,Math.min(uA-this.minPolarAngle,us.x)),this.camera.quaternion.setFromEuler(us),this.dispatchEvent(uc))}),uo(this,"onPointerlockChange",()=>{this.domElement&&(this.domElement.ownerDocument.pointerLockElement===this.domElement?(this.dispatchEvent(uu),this.isLocked=!0):(this.dispatchEvent(uh),this.isLocked=!1))}),uo(this,"onPointerlockError",()=>{console.error("THREE.PointerLockControls: Unable to use Pointer Lock API")}),uo(this,"connect",e=>{this.domElement=e||this.domElement,this.domElement&&(this.domElement.ownerDocument.addEventListener("mousemove",this.onMouseMove),this.domElement.ownerDocument.addEventListener("pointerlockchange",this.onPointerlockChange),this.domElement.ownerDocument.addEventListener("pointerlockerror",this.onPointerlockError))}),uo(this,"disconnect",()=>{this.domElement&&(this.domElement.ownerDocument.removeEventListener("mousemove",this.onMouseMove),this.domElement.ownerDocument.removeEventListener("pointerlockchange",this.onPointerlockChange),this.domElement.ownerDocument.removeEventListener("pointerlockerror",this.onPointerlockError))}),uo(this,"dispose",()=>{this.disconnect()}),uo(this,"getObject",()=>this.camera),uo(this,"direction",new eT.Vector3(0,0,-1)),uo(this,"getDirection",e=>e.copy(this.direction).applyQuaternion(this.camera.quaternion)),uo(this,"moveForward",e=>{ul.setFromMatrixColumn(this.camera.matrix,0),ul.crossVectors(this.camera.up,ul),this.camera.position.addScaledVector(ul,e)}),uo(this,"moveRight",e=>{ul.setFromMatrixColumn(this.camera.matrix,0),this.camera.position.addScaledVector(ul,e)}),uo(this,"lock",()=>{this.domElement&&this.domElement.requestPointerLock()}),uo(this,"unlock",()=>{this.domElement&&this.domElement.ownerDocument.exitPointerLock()}),this.camera=e,this.domElement=t,this.isLocked=!1,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.pointerSpeed=1,t&&this.connect(t)}}let uf=eS.forwardRef(({domElement:e,selector:t,onChange:r,onLock:i,onUnlock:n,enabled:a=!0,makeDefault:o,...s},l)=>{let{camera:c,...u}=s,h=(0,eR.D)(e=>e.setEvents),A=(0,eR.D)(e=>e.gl),d=(0,eR.D)(e=>e.camera),f=(0,eR.D)(e=>e.invalidate),m=(0,eR.D)(e=>e.events),p=(0,eR.D)(e=>e.get),g=(0,eR.D)(e=>e.set),y=c||d,v=e||m.connected||A.domElement,E=eS.useMemo(()=>new ud(y),[y]);return eS.useEffect(()=>{if(a){E.connect(v);let e=p().events.compute;return h({compute(e,t){let r=t.size.width/2,i=t.size.height/2;t.pointer.set(r/t.size.width*2-1,-(i/t.size.height*2)+1),t.raycaster.setFromCamera(t.pointer,t.camera)}}),()=>{E.disconnect(),h({compute:e})}}},[a,E]),eS.useEffect(()=>{let e=e=>{f(),r&&r(e)};E.addEventListener("change",e),i&&E.addEventListener("lock",i),n&&E.addEventListener("unlock",n);let a=()=>E.lock(),o=t?Array.from(document.querySelectorAll(t)):[document];return o.forEach(e=>e&&e.addEventListener("click",a)),()=>{E.removeEventListener("change",e),i&&E.removeEventListener("lock",i),n&&E.removeEventListener("unlock",n),o.forEach(e=>e?e.removeEventListener("click",a):void 0)}},[r,i,n,t,E,f]),eS.useEffect(()=>{if(o){let e=p().controls;return g({controls:E}),()=>g({controls:e})}},[o,E]),eS.createElement("primitive",j({ref:l,object:E},u))});var um=Object.defineProperty,up=(e,t,r)=>t in e?um(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,ug=(e,t,r)=>(up(e,"symbol"!=typeof t?t+"":t,r),r);let uy=new eT.Vector3;class uv extends cx{constructor(e,t){super(),ug(this,"object"),ug(this,"domElement"),ug(this,"enabled",!0),ug(this,"movementSpeed",1),ug(this,"lookSpeed",.005),ug(this,"lookVertical",!0),ug(this,"autoForward",!1),ug(this,"activeLook",!0),ug(this,"heightSpeed",!1),ug(this,"heightCoef",1),ug(this,"heightMin",0),ug(this,"heightMax",1),ug(this,"constrainVertical",!1),ug(this,"verticalMin",0),ug(this,"verticalMax",Math.PI),ug(this,"mouseDragOn",!1),ug(this,"autoSpeedFactor",0),ug(this,"mouseX",0),ug(this,"mouseY",0),ug(this,"moveForward",!1),ug(this,"moveBackward",!1),ug(this,"moveLeft",!1),ug(this,"moveRight",!1),ug(this,"moveUp",!1),ug(this,"moveDown",!1),ug(this,"viewHalfX",0),ug(this,"viewHalfY",0),ug(this,"lat",0),ug(this,"lon",0),ug(this,"lookDirection",new eT.Vector3),ug(this,"spherical",new eT.Spherical),ug(this,"target",new eT.Vector3),ug(this,"connect",e=>{e.setAttribute("tabindex","-1"),e.style.touchAction="none",e.addEventListener("contextmenu",this.contextmenu),e.addEventListener("mousemove",this.onMouseMove),e.addEventListener("mousedown",this.onMouseDown),e.addEventListener("mouseup",this.onMouseUp),this.domElement=e,window.addEventListener("keydown",this.onKeyDown),window.addEventListener("keyup",this.onKeyUp),this.handleResize()}),ug(this,"dispose",()=>{var e,t,r,i;null==(e=this.domElement)||e.removeEventListener("contextmenu",this.contextmenu),null==(t=this.domElement)||t.removeEventListener("mousedown",this.onMouseDown),null==(r=this.domElement)||r.removeEventListener("mousemove",this.onMouseMove),null==(i=this.domElement)||i.removeEventListener("mouseup",this.onMouseUp),window.removeEventListener("keydown",this.onKeyDown),window.removeEventListener("keyup",this.onKeyUp)}),ug(this,"handleResize",()=>{this.domElement&&(this.viewHalfX=this.domElement.offsetWidth/2,this.viewHalfY=this.domElement.offsetHeight/2)}),ug(this,"onMouseDown",e=>{var t;if(null==(t=this.domElement)||t.focus(),this.activeLook)switch(e.button){case 0:this.moveForward=!0;break;case 2:this.moveBackward=!0}this.mouseDragOn=!0}),ug(this,"onMouseUp",e=>{if(this.activeLook)switch(e.button){case 0:this.moveForward=!1;break;case 2:this.moveBackward=!1}this.mouseDragOn=!1}),ug(this,"onMouseMove",e=>{this.domElement&&(this.mouseX=e.pageX-this.domElement.offsetLeft-this.viewHalfX,this.mouseY=e.pageY-this.domElement.offsetTop-this.viewHalfY)}),ug(this,"onKeyDown",e=>{switch(e.code){case"ArrowUp":case"KeyW":this.moveForward=!0;break;case"ArrowLeft":case"KeyA":this.moveLeft=!0;break;case"ArrowDown":case"KeyS":this.moveBackward=!0;break;case"ArrowRight":case"KeyD":this.moveRight=!0;break;case"KeyR":this.moveUp=!0;break;case"KeyF":this.moveDown=!0}}),ug(this,"onKeyUp",e=>{switch(e.code){case"ArrowUp":case"KeyW":this.moveForward=!1;break;case"ArrowLeft":case"KeyA":this.moveLeft=!1;break;case"ArrowDown":case"KeyS":this.moveBackward=!1;break;case"ArrowRight":case"KeyD":this.moveRight=!1;break;case"KeyR":this.moveUp=!1;break;case"KeyF":this.moveDown=!1}}),ug(this,"lookAt",(e,t,r)=>(e instanceof eT.Vector3?this.target.copy(e):t&&r&&this.target.set(e,t,r),this.object.lookAt(this.target),this.setOrientation(),this)),ug(this,"update",e=>{if(!this.enabled)return;if(this.heightSpeed){let t=eT.MathUtils.clamp(this.object.position.y,this.heightMin,this.heightMax)-this.heightMin;this.autoSpeedFactor=t*this.heightCoef*e}else this.autoSpeedFactor=0;let t=e*this.movementSpeed;(this.moveForward||this.autoForward&&!this.moveBackward)&&this.object.translateZ(-(t+this.autoSpeedFactor)),this.moveBackward&&this.object.translateZ(t),this.moveLeft&&this.object.translateX(-t),this.moveRight&&this.object.translateX(t),this.moveUp&&this.object.translateY(t),this.moveDown&&this.object.translateY(-t);let r=e*this.lookSpeed;this.activeLook||(r=0);let i=1;this.constrainVertical&&(i=Math.PI/(this.verticalMax-this.verticalMin)),this.lon-=this.mouseX*r,this.lookVertical&&(this.lat-=this.mouseY*r*i),this.lat=Math.max(-85,Math.min(85,this.lat));let n=eT.MathUtils.degToRad(90-this.lat),a=eT.MathUtils.degToRad(this.lon);this.constrainVertical&&(n=eT.MathUtils.mapLinear(n,0,Math.PI,this.verticalMin,this.verticalMax));let o=this.object.position;uy.setFromSphericalCoords(1,n,a).add(o),this.object.lookAt(uy)}),ug(this,"contextmenu",e=>e.preventDefault()),ug(this,"setOrientation",()=>{this.lookDirection.set(0,0,-1).applyQuaternion(this.object.quaternion),this.spherical.setFromVector3(this.lookDirection),this.lat=90-eT.MathUtils.radToDeg(this.spherical.phi),this.lon=eT.MathUtils.radToDeg(this.spherical.theta)}),this.object=e,this.domElement=t,this.setOrientation(),t&&this.connect(t)}}let uE=eS.forwardRef(({domElement:e,makeDefault:t,...r},i)=>{let n=(0,eR.D)(e=>e.camera),a=(0,eR.D)(e=>e.gl),o=(0,eR.D)(e=>e.events),s=(0,eR.D)(e=>e.get),l=(0,eR.D)(e=>e.set),c=e||o.connected||a.domElement,[u]=eS.useState(()=>new uv(n,c));return eS.useEffect(()=>{if(t){let e=s().controls;return l({controls:u}),()=>l({controls:e})}},[t,u]),(0,eR.F)((e,t)=>{u.update(t)},-1),u?eS.createElement("primitive",j({ref:i,object:u},r)):null}),ux={LEFT:1,RIGHT:2,MIDDLE:4},uC=Object.freeze({NONE:0,ROTATE:1,TRUCK:2,SCREEN_PAN:4,OFFSET:8,DOLLY:16,ZOOM:32,TOUCH_ROTATE:64,TOUCH_TRUCK:128,TOUCH_SCREEN_PAN:256,TOUCH_OFFSET:512,TOUCH_DOLLY:1024,TOUCH_ZOOM:2048,TOUCH_DOLLY_TRUCK:4096,TOUCH_DOLLY_SCREEN_PAN:8192,TOUCH_DOLLY_OFFSET:16384,TOUCH_DOLLY_ROTATE:32768,TOUCH_ZOOM_TRUCK:65536,TOUCH_ZOOM_OFFSET:131072,TOUCH_ZOOM_SCREEN_PAN:262144,TOUCH_ZOOM_ROTATE:524288}),uB={NONE:0,IN:1,OUT:-1};function uw(e){return e.isPerspectiveCamera}function uI(e){return e.isOrthographicCamera}let ub=2*Math.PI,u_=Math.PI/2,uM=Math.PI/180;function uS(e,t,r){return Math.max(t,Math.min(r,e))}function uD(e,t=1e-5){return Math.abs(e)<t}function uT(e,t,r=1e-5){return uD(e-t,r)}function uR(e,t){return Math.round(e/t)*t}function uF(e){return isFinite(e)?e:e<0?-Number.MAX_VALUE:Number.MAX_VALUE}function uP(e){return Math.abs(e)<Number.MAX_VALUE?e:1/0*e}function uQ(e,t,r,i,n=1/0,a){let o=2/(i=Math.max(1e-4,i)),s=o*a,l=1/(1+s+.48*s*s+.235*s*s*s),c=e-t,u=t,h=n*i;t=e-(c=uS(c,-h,h));let A=(r.value+o*c)*a;r.value=(r.value-o*A)*l;let d=t+(c+A)*l;return u-e>0==d>u&&(d=u,r.value=(d-u)/a),d}function uz(e,t,r,i,n=1/0,a,o){let s=2/(i=Math.max(1e-4,i)),l=s*a,c=1/(1+l+.48*l*l+.235*l*l*l),u=t.x,h=t.y,A=t.z,d=e.x-u,f=e.y-h,m=e.z-A,p=u,g=h,y=A,v=n*i,E=d*d+f*f+m*m;if(E>v*v){let e=Math.sqrt(E);d=d/e*v,f=f/e*v,m=m/e*v}u=e.x-d,h=e.y-f,A=e.z-m;let x=(r.x+s*d)*a,C=(r.y+s*f)*a,B=(r.z+s*m)*a;r.x=(r.x-s*x)*c,r.y=(r.y-s*C)*c,r.z=(r.z-s*B)*c,o.x=u+(d+x)*c,o.y=h+(f+C)*c,o.z=A+(m+B)*c;let w=p-e.x,I=g-e.y,b=y-e.z;return w*(o.x-p)+I*(o.y-g)+b*(o.z-y)>0&&(o.x=p,o.y=g,o.z=y,r.x=(o.x-p)/a,r.y=(o.y-g)/a,r.z=(o.z-y)/a),o}function uL(e,t){t.set(0,0),e.forEach(e=>{t.x+=e.clientX,t.y+=e.clientY}),t.x/=e.length,t.y/=e.length}function uO(e,t){return!!uI(e)&&(console.warn(`${t} is not supported in OrthographicCamera`),!0)}class uU{constructor(){this._listeners={}}addEventListener(e,t){let r=this._listeners;void 0===r[e]&&(r[e]=[]),-1===r[e].indexOf(t)&&r[e].push(t)}hasEventListener(e,t){let r=this._listeners;return void 0!==r[e]&&-1!==r[e].indexOf(t)}removeEventListener(e,t){let r=this._listeners[e];if(void 0!==r){let e=r.indexOf(t);-1!==e&&r.splice(e,1)}}removeAllEventListeners(e){if(!e){this._listeners={};return}Array.isArray(this._listeners[e])&&(this._listeners[e].length=0)}dispatchEvent(e){let t=this._listeners[e.type];if(void 0!==t){e.target=this;let r=t.slice(0);for(let t=0,i=r.length;t<i;t++)r[t].call(this,e)}}}let uk=1/8,uG=/Mac/.test(null===(eb=null==globalThis?void 0:globalThis.navigator)||void 0===eb?void 0:eb.platform);class uN extends uU{static install(e){s=Object.freeze(new(o=e.THREE).Vector3(0,0,0)),l=Object.freeze(new o.Vector3(0,1,0)),c=Object.freeze(new o.Vector3(0,0,1)),u=new o.Vector2,h=new o.Vector3,A=new o.Vector3,d=new o.Vector3,f=new o.Vector3,m=new o.Vector3,p=new o.Vector3,g=new o.Vector3,y=new o.Vector3,v=new o.Vector3,E=new o.Spherical,x=new o.Spherical,C=new o.Box3,B=new o.Box3,w=new o.Sphere,I=new o.Quaternion,b=new o.Quaternion,_=new o.Matrix4,M=new o.Raycaster}static get ACTION(){return uC}constructor(e,t){super(),this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.minDistance=Number.EPSILON,this.maxDistance=1/0,this.infinityDolly=!1,this.minZoom=.01,this.maxZoom=1/0,this.smoothTime=.25,this.draggingSmoothTime=.125,this.maxSpeed=1/0,this.azimuthRotateSpeed=1,this.polarRotateSpeed=1,this.dollySpeed=1,this.dollyDragInverted=!1,this.truckSpeed=2,this.dollyToCursor=!1,this.dragToOffset=!1,this.boundaryFriction=0,this.restThreshold=.01,this.colliderMeshes=[],this.cancel=()=>{},this._enabled=!0,this._state=uC.NONE,this._viewport=null,this._changedDolly=0,this._changedZoom=0,this._hasRested=!0,this._boundaryEnclosesCamera=!1,this._needsUpdate=!0,this._updatedLastTime=!1,this._elementRect=new DOMRect,this._isDragging=!1,this._dragNeedsUpdate=!0,this._activePointers=[],this._lockedPointer=null,this._interactiveArea=new DOMRect(0,0,1,1),this._isUserControllingRotate=!1,this._isUserControllingDolly=!1,this._isUserControllingTruck=!1,this._isUserControllingOffset=!1,this._isUserControllingZoom=!1,this._lastDollyDirection=uB.NONE,this._thetaVelocity={value:0},this._phiVelocity={value:0},this._radiusVelocity={value:0},this._targetVelocity=new o.Vector3,this._focalOffsetVelocity=new o.Vector3,this._zoomVelocity={value:0},this._truckInternal=(e,t,r,i)=>{let n,a;if(uw(this._camera)){let r=h.copy(this._camera.position).sub(this._target),i=this._camera.getEffectiveFOV()*uM,o=r.length()*Math.tan(.5*i);n=this.truckSpeed*e*o/this._elementRect.height,a=this.truckSpeed*t*o/this._elementRect.height}else{if(!uI(this._camera))return;let r=this._camera;n=this.truckSpeed*e*(r.right-r.left)/r.zoom/this._elementRect.width,a=this.truckSpeed*t*(r.top-r.bottom)/r.zoom/this._elementRect.height}i?(r?this.setFocalOffset(this._focalOffsetEnd.x+n,this._focalOffsetEnd.y,this._focalOffsetEnd.z,!0):this.truck(n,0,!0),this.forward(-a,!0)):r?this.setFocalOffset(this._focalOffsetEnd.x+n,this._focalOffsetEnd.y+a,this._focalOffsetEnd.z,!0):this.truck(n,a,!0)},this._rotateInternal=(e,t)=>{let r=ub*this.azimuthRotateSpeed*e/this._elementRect.height,i=ub*this.polarRotateSpeed*t/this._elementRect.height;this.rotate(r,i,!0)},this._dollyInternal=(e,t,r)=>{let i=Math.pow(.95,-e*this.dollySpeed),n=this._sphericalEnd.radius,a=this._sphericalEnd.radius*i,o=uS(a,this.minDistance,this.maxDistance);this.infinityDolly&&this.dollyToCursor?this._dollyToNoClamp(a,!0):(this.infinityDolly&&!this.dollyToCursor&&this.dollyInFixed(o-a,!0),this._dollyToNoClamp(o,!0)),this.dollyToCursor&&(this._changedDolly+=(this.infinityDolly?a:o)-n,this._dollyControlCoord.set(t,r)),this._lastDollyDirection=Math.sign(-e)},this._zoomInternal=(e,t,r)=>{let i=Math.pow(.95,e*this.dollySpeed),n=this._zoom,a=this._zoom*i;this.zoomTo(a,!0),this.dollyToCursor&&(this._changedZoom+=a-n,this._dollyControlCoord.set(t,r))},void 0===o&&console.error("camera-controls: `THREE` is undefined. You must first run `CameraControls.install( { THREE: THREE } )`. Check the docs for further information."),this._camera=e,this._yAxisUpSpace=new o.Quaternion().setFromUnitVectors(this._camera.up,l),this._yAxisUpSpaceInverse=this._yAxisUpSpace.clone().invert(),this._state=uC.NONE,this._target=new o.Vector3,this._targetEnd=this._target.clone(),this._focalOffset=new o.Vector3,this._focalOffsetEnd=this._focalOffset.clone(),this._spherical=new o.Spherical().setFromVector3(h.copy(this._camera.position).applyQuaternion(this._yAxisUpSpace)),this._sphericalEnd=this._spherical.clone(),this._lastDistance=this._spherical.radius,this._zoom=this._camera.zoom,this._zoomEnd=this._zoom,this._lastZoom=this._zoom,this._nearPlaneCorners=[new o.Vector3,new o.Vector3,new o.Vector3,new o.Vector3],this._updateNearPlaneCorners(),this._boundary=new o.Box3(new o.Vector3(-1/0,-1/0,-1/0),new o.Vector3(1/0,1/0,1/0)),this._cameraUp0=this._camera.up.clone(),this._target0=this._target.clone(),this._position0=this._camera.position.clone(),this._zoom0=this._zoom,this._focalOffset0=this._focalOffset.clone(),this._dollyControlCoord=new o.Vector2,this.mouseButtons={left:uC.ROTATE,middle:uC.DOLLY,right:uC.TRUCK,wheel:uw(this._camera)?uC.DOLLY:uI(this._camera)?uC.ZOOM:uC.NONE},this.touches={one:uC.TOUCH_ROTATE,two:uw(this._camera)?uC.TOUCH_DOLLY_TRUCK:uI(this._camera)?uC.TOUCH_ZOOM_TRUCK:uC.NONE,three:uC.TOUCH_TRUCK};let r=new o.Vector2,i=new o.Vector2,n=new o.Vector2,a=e=>{if(!this._enabled||!this._domElement)return;if(0!==this._interactiveArea.left||0!==this._interactiveArea.top||1!==this._interactiveArea.width||1!==this._interactiveArea.height){let t=this._domElement.getBoundingClientRect(),r=e.clientX/t.width,i=e.clientY/t.height;if(r<this._interactiveArea.left||r>this._interactiveArea.right||i<this._interactiveArea.top||i>this._interactiveArea.bottom)return}let t="mouse"!==e.pointerType?null:(e.buttons&ux.LEFT)===ux.LEFT?ux.LEFT:(e.buttons&ux.MIDDLE)===ux.MIDDLE?ux.MIDDLE:(e.buttons&ux.RIGHT)===ux.RIGHT?ux.RIGHT:null;if(null!==t){let e=this._findPointerByMouseButton(t);e&&this._disposePointer(e)}if((e.buttons&ux.LEFT)===ux.LEFT&&this._lockedPointer)return;let r={pointerId:e.pointerId,clientX:e.clientX,clientY:e.clientY,deltaX:0,deltaY:0,mouseButton:t};this._activePointers.push(r),this._domElement.ownerDocument.removeEventListener("pointermove",s,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",c),this._domElement.ownerDocument.addEventListener("pointermove",s,{passive:!1}),this._domElement.ownerDocument.addEventListener("pointerup",c),this._isDragging=!0,m(e)},s=e=>{e.cancelable&&e.preventDefault();let t=e.pointerId,r=this._lockedPointer||this._findPointerById(t);if(r){if(r.clientX=e.clientX,r.clientY=e.clientY,r.deltaX=e.movementX,r.deltaY=e.movementY,this._state=0,"touch"===e.pointerType)switch(this._activePointers.length){case 1:this._state=this.touches.one;break;case 2:this._state=this.touches.two;break;case 3:this._state=this.touches.three}else(!this._isDragging&&this._lockedPointer||this._isDragging&&(e.buttons&ux.LEFT)===ux.LEFT)&&(this._state=this._state|this.mouseButtons.left),this._isDragging&&(e.buttons&ux.MIDDLE)===ux.MIDDLE&&(this._state=this._state|this.mouseButtons.middle),this._isDragging&&(e.buttons&ux.RIGHT)===ux.RIGHT&&(this._state=this._state|this.mouseButtons.right);p()}},c=e=>{let t=this._findPointerById(e.pointerId);if(!t||t!==this._lockedPointer){if(t&&this._disposePointer(t),"touch"===e.pointerType)switch(this._activePointers.length){case 0:this._state=uC.NONE;break;case 1:this._state=this.touches.one;break;case 2:this._state=this.touches.two;break;case 3:this._state=this.touches.three}else this._state=uC.NONE;g()}},A=-1,d=e=>{if(!this._domElement||!this._enabled||this.mouseButtons.wheel===uC.NONE)return;if(0!==this._interactiveArea.left||0!==this._interactiveArea.top||1!==this._interactiveArea.width||1!==this._interactiveArea.height){let t=this._domElement.getBoundingClientRect(),r=e.clientX/t.width,i=e.clientY/t.height;if(r<this._interactiveArea.left||r>this._interactiveArea.right||i<this._interactiveArea.top||i>this._interactiveArea.bottom)return}if(e.preventDefault(),this.dollyToCursor||this.mouseButtons.wheel===uC.ROTATE||this.mouseButtons.wheel===uC.TRUCK){let e=performance.now();A-e<1e3&&this._getClientRect(this._elementRect),A=e}let t=uG?-1:-3,r=1===e.deltaMode?e.deltaY/t:e.deltaY/(10*t),i=this.dollyToCursor?(e.clientX-this._elementRect.x)/this._elementRect.width*2-1:0,n=this.dollyToCursor?-((e.clientY-this._elementRect.y)/this._elementRect.height*2)+1:0;switch(this.mouseButtons.wheel){case uC.ROTATE:this._rotateInternal(e.deltaX,e.deltaY),this._isUserControllingRotate=!0;break;case uC.TRUCK:this._truckInternal(e.deltaX,e.deltaY,!1,!1),this._isUserControllingTruck=!0;break;case uC.SCREEN_PAN:this._truckInternal(e.deltaX,e.deltaY,!1,!0),this._isUserControllingTruck=!0;break;case uC.OFFSET:this._truckInternal(e.deltaX,e.deltaY,!0,!1),this._isUserControllingOffset=!0;break;case uC.DOLLY:this._dollyInternal(-r,i,n),this._isUserControllingDolly=!0;break;case uC.ZOOM:this._zoomInternal(-r,i,n),this._isUserControllingZoom=!0}this.dispatchEvent({type:"control"})},f=e=>{if(this._domElement&&this._enabled){if(this.mouseButtons.right===uN.ACTION.NONE){let t=e instanceof PointerEvent?e.pointerId:0,r=this._findPointerById(t);r&&this._disposePointer(r),this._domElement.ownerDocument.removeEventListener("pointermove",s,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",c);return}e.preventDefault()}},m=e=>{if(this._enabled){if(uL(this._activePointers,u),this._getClientRect(this._elementRect),r.copy(u),i.copy(u),this._activePointers.length>=2){let e=u.x-this._activePointers[1].clientX,t=u.y-this._activePointers[1].clientY;n.set(0,Math.sqrt(e*e+t*t));let r=(this._activePointers[0].clientX+this._activePointers[1].clientX)*.5,a=(this._activePointers[0].clientY+this._activePointers[1].clientY)*.5;i.set(r,a)}if(this._state=0,e){if("pointerType"in e&&"touch"===e.pointerType)switch(this._activePointers.length){case 1:this._state=this.touches.one;break;case 2:this._state=this.touches.two;break;case 3:this._state=this.touches.three}else this._lockedPointer||(e.buttons&ux.LEFT)!==ux.LEFT||(this._state=this._state|this.mouseButtons.left),(e.buttons&ux.MIDDLE)===ux.MIDDLE&&(this._state=this._state|this.mouseButtons.middle),(e.buttons&ux.RIGHT)===ux.RIGHT&&(this._state=this._state|this.mouseButtons.right)}else this._lockedPointer&&(this._state=this._state|this.mouseButtons.left);((this._state&uC.ROTATE)===uC.ROTATE||(this._state&uC.TOUCH_ROTATE)===uC.TOUCH_ROTATE||(this._state&uC.TOUCH_DOLLY_ROTATE)===uC.TOUCH_DOLLY_ROTATE||(this._state&uC.TOUCH_ZOOM_ROTATE)===uC.TOUCH_ZOOM_ROTATE)&&(this._sphericalEnd.theta=this._spherical.theta,this._sphericalEnd.phi=this._spherical.phi,this._thetaVelocity.value=0,this._phiVelocity.value=0),((this._state&uC.TRUCK)===uC.TRUCK||(this._state&uC.SCREEN_PAN)===uC.SCREEN_PAN||(this._state&uC.TOUCH_TRUCK)===uC.TOUCH_TRUCK||(this._state&uC.TOUCH_SCREEN_PAN)===uC.TOUCH_SCREEN_PAN||(this._state&uC.TOUCH_DOLLY_TRUCK)===uC.TOUCH_DOLLY_TRUCK||(this._state&uC.TOUCH_DOLLY_SCREEN_PAN)===uC.TOUCH_DOLLY_SCREEN_PAN||(this._state&uC.TOUCH_ZOOM_TRUCK)===uC.TOUCH_ZOOM_TRUCK||(this._state&uC.TOUCH_ZOOM_SCREEN_PAN)===uC.TOUCH_DOLLY_SCREEN_PAN)&&(this._targetEnd.copy(this._target),this._targetVelocity.set(0,0,0)),((this._state&uC.DOLLY)===uC.DOLLY||(this._state&uC.TOUCH_DOLLY)===uC.TOUCH_DOLLY||(this._state&uC.TOUCH_DOLLY_TRUCK)===uC.TOUCH_DOLLY_TRUCK||(this._state&uC.TOUCH_DOLLY_SCREEN_PAN)===uC.TOUCH_DOLLY_SCREEN_PAN||(this._state&uC.TOUCH_DOLLY_OFFSET)===uC.TOUCH_DOLLY_OFFSET||(this._state&uC.TOUCH_DOLLY_ROTATE)===uC.TOUCH_DOLLY_ROTATE)&&(this._sphericalEnd.radius=this._spherical.radius,this._radiusVelocity.value=0),((this._state&uC.ZOOM)===uC.ZOOM||(this._state&uC.TOUCH_ZOOM)===uC.TOUCH_ZOOM||(this._state&uC.TOUCH_ZOOM_TRUCK)===uC.TOUCH_ZOOM_TRUCK||(this._state&uC.TOUCH_ZOOM_SCREEN_PAN)===uC.TOUCH_ZOOM_SCREEN_PAN||(this._state&uC.TOUCH_ZOOM_OFFSET)===uC.TOUCH_ZOOM_OFFSET||(this._state&uC.TOUCH_ZOOM_ROTATE)===uC.TOUCH_ZOOM_ROTATE)&&(this._zoomEnd=this._zoom,this._zoomVelocity.value=0),((this._state&uC.OFFSET)===uC.OFFSET||(this._state&uC.TOUCH_OFFSET)===uC.TOUCH_OFFSET||(this._state&uC.TOUCH_DOLLY_OFFSET)===uC.TOUCH_DOLLY_OFFSET||(this._state&uC.TOUCH_ZOOM_OFFSET)===uC.TOUCH_ZOOM_OFFSET)&&(this._focalOffsetEnd.copy(this._focalOffset),this._focalOffsetVelocity.set(0,0,0)),this.dispatchEvent({type:"controlstart"})}},p=()=>{if(!this._enabled||!this._dragNeedsUpdate)return;this._dragNeedsUpdate=!1,uL(this._activePointers,u);let e=this._domElement&&this._domElement.ownerDocument.pointerLockElement===this._domElement?this._lockedPointer||this._activePointers[0]:null,t=e?-e.deltaX:i.x-u.x,a=e?-e.deltaY:i.y-u.y;if(i.copy(u),((this._state&uC.ROTATE)===uC.ROTATE||(this._state&uC.TOUCH_ROTATE)===uC.TOUCH_ROTATE||(this._state&uC.TOUCH_DOLLY_ROTATE)===uC.TOUCH_DOLLY_ROTATE||(this._state&uC.TOUCH_ZOOM_ROTATE)===uC.TOUCH_ZOOM_ROTATE)&&(this._rotateInternal(t,a),this._isUserControllingRotate=!0),(this._state&uC.DOLLY)===uC.DOLLY||(this._state&uC.ZOOM)===uC.ZOOM){let e=this.dollyToCursor?(r.x-this._elementRect.x)/this._elementRect.width*2-1:0,t=this.dollyToCursor?-((r.y-this._elementRect.y)/this._elementRect.height*2)+1:0,i=this.dollyDragInverted?-1:1;(this._state&uC.DOLLY)===uC.DOLLY?(this._dollyInternal(i*a*uk,e,t),this._isUserControllingDolly=!0):(this._zoomInternal(i*a*uk,e,t),this._isUserControllingZoom=!0)}if((this._state&uC.TOUCH_DOLLY)===uC.TOUCH_DOLLY||(this._state&uC.TOUCH_ZOOM)===uC.TOUCH_ZOOM||(this._state&uC.TOUCH_DOLLY_TRUCK)===uC.TOUCH_DOLLY_TRUCK||(this._state&uC.TOUCH_ZOOM_TRUCK)===uC.TOUCH_ZOOM_TRUCK||(this._state&uC.TOUCH_DOLLY_SCREEN_PAN)===uC.TOUCH_DOLLY_SCREEN_PAN||(this._state&uC.TOUCH_ZOOM_SCREEN_PAN)===uC.TOUCH_ZOOM_SCREEN_PAN||(this._state&uC.TOUCH_DOLLY_OFFSET)===uC.TOUCH_DOLLY_OFFSET||(this._state&uC.TOUCH_ZOOM_OFFSET)===uC.TOUCH_ZOOM_OFFSET||(this._state&uC.TOUCH_DOLLY_ROTATE)===uC.TOUCH_DOLLY_ROTATE||(this._state&uC.TOUCH_ZOOM_ROTATE)===uC.TOUCH_ZOOM_ROTATE){let e=u.x-this._activePointers[1].clientX,t=u.y-this._activePointers[1].clientY,r=Math.sqrt(e*e+t*t),a=n.y-r;n.set(0,r);let o=this.dollyToCursor?(i.x-this._elementRect.x)/this._elementRect.width*2-1:0,s=this.dollyToCursor?-((i.y-this._elementRect.y)/this._elementRect.height*2)+1:0;(this._state&uC.TOUCH_DOLLY)===uC.TOUCH_DOLLY||(this._state&uC.TOUCH_DOLLY_ROTATE)===uC.TOUCH_DOLLY_ROTATE||(this._state&uC.TOUCH_DOLLY_TRUCK)===uC.TOUCH_DOLLY_TRUCK||(this._state&uC.TOUCH_DOLLY_SCREEN_PAN)===uC.TOUCH_DOLLY_SCREEN_PAN||(this._state&uC.TOUCH_DOLLY_OFFSET)===uC.TOUCH_DOLLY_OFFSET?(this._dollyInternal(a*uk,o,s),this._isUserControllingDolly=!0):(this._zoomInternal(a*uk,o,s),this._isUserControllingZoom=!0)}((this._state&uC.TRUCK)===uC.TRUCK||(this._state&uC.TOUCH_TRUCK)===uC.TOUCH_TRUCK||(this._state&uC.TOUCH_DOLLY_TRUCK)===uC.TOUCH_DOLLY_TRUCK||(this._state&uC.TOUCH_ZOOM_TRUCK)===uC.TOUCH_ZOOM_TRUCK)&&(this._truckInternal(t,a,!1,!1),this._isUserControllingTruck=!0),((this._state&uC.SCREEN_PAN)===uC.SCREEN_PAN||(this._state&uC.TOUCH_SCREEN_PAN)===uC.TOUCH_SCREEN_PAN||(this._state&uC.TOUCH_DOLLY_SCREEN_PAN)===uC.TOUCH_DOLLY_SCREEN_PAN||(this._state&uC.TOUCH_ZOOM_SCREEN_PAN)===uC.TOUCH_ZOOM_SCREEN_PAN)&&(this._truckInternal(t,a,!1,!0),this._isUserControllingTruck=!0),((this._state&uC.OFFSET)===uC.OFFSET||(this._state&uC.TOUCH_OFFSET)===uC.TOUCH_OFFSET||(this._state&uC.TOUCH_DOLLY_OFFSET)===uC.TOUCH_DOLLY_OFFSET||(this._state&uC.TOUCH_ZOOM_OFFSET)===uC.TOUCH_ZOOM_OFFSET)&&(this._truckInternal(t,a,!0,!1),this._isUserControllingOffset=!0),this.dispatchEvent({type:"control"})},g=()=>{uL(this._activePointers,u),i.copy(u),this._dragNeedsUpdate=!1,(0===this._activePointers.length||1===this._activePointers.length&&this._activePointers[0]===this._lockedPointer)&&(this._isDragging=!1),0===this._activePointers.length&&this._domElement&&(this._domElement.ownerDocument.removeEventListener("pointermove",s,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",c),this.dispatchEvent({type:"controlend"}))};this.lockPointer=()=>{this._enabled&&this._domElement&&(this.cancel(),this._lockedPointer={pointerId:-1,clientX:0,clientY:0,deltaX:0,deltaY:0,mouseButton:null},this._activePointers.push(this._lockedPointer),this._domElement.ownerDocument.removeEventListener("pointermove",s,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",c),this._domElement.requestPointerLock(),this._domElement.ownerDocument.addEventListener("pointerlockchange",y),this._domElement.ownerDocument.addEventListener("pointerlockerror",v),this._domElement.ownerDocument.addEventListener("pointermove",s,{passive:!1}),this._domElement.ownerDocument.addEventListener("pointerup",c),m())},this.unlockPointer=()=>{var e,t,r;null!==this._lockedPointer&&(this._disposePointer(this._lockedPointer),this._lockedPointer=null),null===(e=this._domElement)||void 0===e||e.ownerDocument.exitPointerLock(),null===(t=this._domElement)||void 0===t||t.ownerDocument.removeEventListener("pointerlockchange",y),null===(r=this._domElement)||void 0===r||r.ownerDocument.removeEventListener("pointerlockerror",v),this.cancel()};let y=()=>{this._domElement&&this._domElement.ownerDocument.pointerLockElement===this._domElement||this.unlockPointer()},v=()=>{this.unlockPointer()};this._addAllEventListeners=e=>{this._domElement=e,this._domElement.style.touchAction="none",this._domElement.style.userSelect="none",this._domElement.style.webkitUserSelect="none",this._domElement.addEventListener("pointerdown",a),this._domElement.addEventListener("pointercancel",c),this._domElement.addEventListener("wheel",d,{passive:!1}),this._domElement.addEventListener("contextmenu",f)},this._removeAllEventListeners=()=>{this._domElement&&(this._domElement.style.touchAction="",this._domElement.style.userSelect="",this._domElement.style.webkitUserSelect="",this._domElement.removeEventListener("pointerdown",a),this._domElement.removeEventListener("pointercancel",c),this._domElement.removeEventListener("wheel",d,{passive:!1}),this._domElement.removeEventListener("contextmenu",f),this._domElement.ownerDocument.removeEventListener("pointermove",s,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",c),this._domElement.ownerDocument.removeEventListener("pointerlockchange",y),this._domElement.ownerDocument.removeEventListener("pointerlockerror",v))},this.cancel=()=>{this._state!==uC.NONE&&(this._state=uC.NONE,this._activePointers.length=0,g())},t&&this.connect(t),this.update(0)}get camera(){return this._camera}set camera(e){this._camera=e,this.updateCameraUp(),this._camera.updateProjectionMatrix(),this._updateNearPlaneCorners(),this._needsUpdate=!0}get enabled(){return this._enabled}set enabled(e){this._enabled=e,this._domElement&&(e?(this._domElement.style.touchAction="none",this._domElement.style.userSelect="none",this._domElement.style.webkitUserSelect="none"):(this.cancel(),this._domElement.style.touchAction="",this._domElement.style.userSelect="",this._domElement.style.webkitUserSelect=""))}get active(){return!this._hasRested}get currentAction(){return this._state}get distance(){return this._spherical.radius}set distance(e){(this._spherical.radius!==e||this._sphericalEnd.radius!==e)&&(this._spherical.radius=e,this._sphericalEnd.radius=e,this._needsUpdate=!0)}get azimuthAngle(){return this._spherical.theta}set azimuthAngle(e){(this._spherical.theta!==e||this._sphericalEnd.theta!==e)&&(this._spherical.theta=e,this._sphericalEnd.theta=e,this._needsUpdate=!0)}get polarAngle(){return this._spherical.phi}set polarAngle(e){(this._spherical.phi!==e||this._sphericalEnd.phi!==e)&&(this._spherical.phi=e,this._sphericalEnd.phi=e,this._needsUpdate=!0)}get boundaryEnclosesCamera(){return this._boundaryEnclosesCamera}set boundaryEnclosesCamera(e){this._boundaryEnclosesCamera=e,this._needsUpdate=!0}set interactiveArea(e){this._interactiveArea.width=uS(e.width,0,1),this._interactiveArea.height=uS(e.height,0,1),this._interactiveArea.x=uS(e.x,0,1-this._interactiveArea.width),this._interactiveArea.y=uS(e.y,0,1-this._interactiveArea.height)}addEventListener(e,t){super.addEventListener(e,t)}removeEventListener(e,t){super.removeEventListener(e,t)}rotate(e,t,r=!1){return this.rotateTo(this._sphericalEnd.theta+e,this._sphericalEnd.phi+t,r)}rotateAzimuthTo(e,t=!1){return this.rotateTo(e,this._sphericalEnd.phi,t)}rotatePolarTo(e,t=!1){return this.rotateTo(this._sphericalEnd.theta,e,t)}rotateTo(e,t,r=!1){this._isUserControllingRotate=!1;let i=uS(e,this.minAzimuthAngle,this.maxAzimuthAngle),n=uS(t,this.minPolarAngle,this.maxPolarAngle);this._sphericalEnd.theta=i,this._sphericalEnd.phi=n,this._sphericalEnd.makeSafe(),this._needsUpdate=!0,r||(this._spherical.theta=this._sphericalEnd.theta,this._spherical.phi=this._sphericalEnd.phi);let a=!r||uT(this._spherical.theta,this._sphericalEnd.theta,this.restThreshold)&&uT(this._spherical.phi,this._sphericalEnd.phi,this.restThreshold);return this._createOnRestPromise(a)}dolly(e,t=!1){return this.dollyTo(this._sphericalEnd.radius-e,t)}dollyTo(e,t=!1){return this._isUserControllingDolly=!1,this._lastDollyDirection=uB.NONE,this._changedDolly=0,this._dollyToNoClamp(uS(e,this.minDistance,this.maxDistance),t)}_dollyToNoClamp(e,t=!1){let r=this._sphericalEnd.radius;if(this.colliderMeshes.length>=1){let t=this._collisionTest(),i=uT(t,this._spherical.radius);if(!(r>e)&&i)return Promise.resolve();this._sphericalEnd.radius=Math.min(e,t)}else this._sphericalEnd.radius=e;this._needsUpdate=!0,t||(this._spherical.radius=this._sphericalEnd.radius);let i=!t||uT(this._spherical.radius,this._sphericalEnd.radius,this.restThreshold);return this._createOnRestPromise(i)}dollyInFixed(e,t=!1){this._targetEnd.add(this._getCameraDirection(f).multiplyScalar(e)),t||this._target.copy(this._targetEnd);let r=!t||uT(this._target.x,this._targetEnd.x,this.restThreshold)&&uT(this._target.y,this._targetEnd.y,this.restThreshold)&&uT(this._target.z,this._targetEnd.z,this.restThreshold);return this._createOnRestPromise(r)}zoom(e,t=!1){return this.zoomTo(this._zoomEnd+e,t)}zoomTo(e,t=!1){this._isUserControllingZoom=!1,this._zoomEnd=uS(e,this.minZoom,this.maxZoom),this._needsUpdate=!0,t||(this._zoom=this._zoomEnd);let r=!t||uT(this._zoom,this._zoomEnd,this.restThreshold);return this._changedZoom=0,this._createOnRestPromise(r)}pan(e,t,r=!1){return console.warn("`pan` has been renamed to `truck`"),this.truck(e,t,r)}truck(e,t,r=!1){this._camera.updateMatrix(),m.setFromMatrixColumn(this._camera.matrix,0),p.setFromMatrixColumn(this._camera.matrix,1),m.multiplyScalar(e),p.multiplyScalar(-t);let i=h.copy(m).add(p),n=A.copy(this._targetEnd).add(i);return this.moveTo(n.x,n.y,n.z,r)}forward(e,t=!1){h.setFromMatrixColumn(this._camera.matrix,0),h.crossVectors(this._camera.up,h),h.multiplyScalar(e);let r=A.copy(this._targetEnd).add(h);return this.moveTo(r.x,r.y,r.z,t)}elevate(e,t=!1){return h.copy(this._camera.up).multiplyScalar(e),this.moveTo(this._targetEnd.x+h.x,this._targetEnd.y+h.y,this._targetEnd.z+h.z,t)}moveTo(e,t,r,i=!1){this._isUserControllingTruck=!1;let n=h.set(e,t,r).sub(this._targetEnd);this._encloseToBoundary(this._targetEnd,n,this.boundaryFriction),this._needsUpdate=!0,i||this._target.copy(this._targetEnd);let a=!i||uT(this._target.x,this._targetEnd.x,this.restThreshold)&&uT(this._target.y,this._targetEnd.y,this.restThreshold)&&uT(this._target.z,this._targetEnd.z,this.restThreshold);return this._createOnRestPromise(a)}lookInDirectionOf(e,t,r,i=!1){let n=h.set(e,t,r).sub(this._targetEnd).normalize().multiplyScalar(-this._sphericalEnd.radius).add(this._targetEnd);return this.setPosition(n.x,n.y,n.z,i)}fitToBox(e,t,{cover:r=!1,paddingLeft:i=0,paddingRight:n=0,paddingBottom:a=0,paddingTop:o=0}={}){let s=[],u=e.isBox3?C.copy(e):C.setFromObject(e);u.isEmpty()&&(console.warn("camera-controls: fitTo() cannot be used with an empty box. Aborting"),Promise.resolve());let d=uR(this._sphericalEnd.theta,u_),f=uR(this._sphericalEnd.phi,u_);s.push(this.rotateTo(d,f,t));let m=h.setFromSpherical(this._sphericalEnd).normalize(),p=I.setFromUnitVectors(m,c),g=uT(Math.abs(m.y),1);g&&p.multiply(b.setFromAxisAngle(l,d)),p.multiply(this._yAxisUpSpaceInverse);let y=B.makeEmpty();A.copy(u.min).applyQuaternion(p),y.expandByPoint(A),A.copy(u.min).setX(u.max.x).applyQuaternion(p),y.expandByPoint(A),A.copy(u.min).setY(u.max.y).applyQuaternion(p),y.expandByPoint(A),A.copy(u.max).setZ(u.min.z).applyQuaternion(p),y.expandByPoint(A),A.copy(u.min).setZ(u.max.z).applyQuaternion(p),y.expandByPoint(A),A.copy(u.max).setY(u.min.y).applyQuaternion(p),y.expandByPoint(A),A.copy(u.max).setX(u.min.x).applyQuaternion(p),y.expandByPoint(A),A.copy(u.max).applyQuaternion(p),y.expandByPoint(A),y.min.x-=i,y.min.y-=a,y.max.x+=n,y.max.y+=o,p.setFromUnitVectors(c,m),g&&p.premultiply(b.invert()),p.premultiply(this._yAxisUpSpace);let v=y.getSize(h),E=y.getCenter(A).applyQuaternion(p);if(uw(this._camera)){let e=this.getDistanceToFitBox(v.x,v.y,v.z,r);s.push(this.moveTo(E.x,E.y,E.z,t)),s.push(this.dollyTo(e,t)),s.push(this.setFocalOffset(0,0,0,t))}else if(uI(this._camera)){let e=this._camera,i=e.right-e.left,n=e.top-e.bottom,a=r?Math.max(i/v.x,n/v.y):Math.min(i/v.x,n/v.y);s.push(this.moveTo(E.x,E.y,E.z,t)),s.push(this.zoomTo(a,t)),s.push(this.setFocalOffset(0,0,0,t))}return Promise.all(s)}fitToSphere(e,t){let r=[],i="isObject3D"in e?uN.createBoundingSphere(e,w):w.copy(e);if(r.push(this.moveTo(i.center.x,i.center.y,i.center.z,t)),uw(this._camera)){let e=this.getDistanceToFitSphere(i.radius);r.push(this.dollyTo(e,t))}else if(uI(this._camera)){let e=this._camera.right-this._camera.left,n=this._camera.top-this._camera.bottom,a=2*i.radius;r.push(this.zoomTo(Math.min(e/a,n/a),t))}return r.push(this.setFocalOffset(0,0,0,t)),Promise.all(r)}setLookAt(e,t,r,i,n,a,o=!1){this._isUserControllingRotate=!1,this._isUserControllingDolly=!1,this._isUserControllingTruck=!1,this._lastDollyDirection=uB.NONE,this._changedDolly=0;let s=A.set(i,n,a),l=h.set(e,t,r);this._targetEnd.copy(s),this._sphericalEnd.setFromVector3(l.sub(s).applyQuaternion(this._yAxisUpSpace)),this.normalizeRotations(),this._needsUpdate=!0,o||(this._target.copy(this._targetEnd),this._spherical.copy(this._sphericalEnd));let c=!o||uT(this._target.x,this._targetEnd.x,this.restThreshold)&&uT(this._target.y,this._targetEnd.y,this.restThreshold)&&uT(this._target.z,this._targetEnd.z,this.restThreshold)&&uT(this._spherical.theta,this._sphericalEnd.theta,this.restThreshold)&&uT(this._spherical.phi,this._sphericalEnd.phi,this.restThreshold)&&uT(this._spherical.radius,this._sphericalEnd.radius,this.restThreshold);return this._createOnRestPromise(c)}lerpLookAt(e,t,r,i,n,a,o,s,l,c,u,f,m,p=!1){this._isUserControllingRotate=!1,this._isUserControllingDolly=!1,this._isUserControllingTruck=!1,this._lastDollyDirection=uB.NONE,this._changedDolly=0;let g=h.set(i,n,a),y=A.set(e,t,r);E.setFromVector3(y.sub(g).applyQuaternion(this._yAxisUpSpace));let v=d.set(c,u,f),C=A.set(o,s,l);x.setFromVector3(C.sub(v).applyQuaternion(this._yAxisUpSpace)),this._targetEnd.copy(g.lerp(v,m));let B=x.theta-E.theta,w=x.phi-E.phi,I=x.radius-E.radius;this._sphericalEnd.set(E.radius+I*m,E.phi+w*m,E.theta+B*m),this.normalizeRotations(),this._needsUpdate=!0,p||(this._target.copy(this._targetEnd),this._spherical.copy(this._sphericalEnd));let b=!p||uT(this._target.x,this._targetEnd.x,this.restThreshold)&&uT(this._target.y,this._targetEnd.y,this.restThreshold)&&uT(this._target.z,this._targetEnd.z,this.restThreshold)&&uT(this._spherical.theta,this._sphericalEnd.theta,this.restThreshold)&&uT(this._spherical.phi,this._sphericalEnd.phi,this.restThreshold)&&uT(this._spherical.radius,this._sphericalEnd.radius,this.restThreshold);return this._createOnRestPromise(b)}setPosition(e,t,r,i=!1){return this.setLookAt(e,t,r,this._targetEnd.x,this._targetEnd.y,this._targetEnd.z,i)}setTarget(e,t,r,i=!1){let n=this.getPosition(h),a=this.setLookAt(n.x,n.y,n.z,e,t,r,i);return this._sphericalEnd.phi=uS(this._sphericalEnd.phi,this.minPolarAngle,this.maxPolarAngle),a}setFocalOffset(e,t,r,i=!1){this._isUserControllingOffset=!1,this._focalOffsetEnd.set(e,t,r),this._needsUpdate=!0,i||this._focalOffset.copy(this._focalOffsetEnd);let n=!i||uT(this._focalOffset.x,this._focalOffsetEnd.x,this.restThreshold)&&uT(this._focalOffset.y,this._focalOffsetEnd.y,this.restThreshold)&&uT(this._focalOffset.z,this._focalOffsetEnd.z,this.restThreshold);return this._createOnRestPromise(n)}setOrbitPoint(e,t,r){this._camera.updateMatrixWorld(),m.setFromMatrixColumn(this._camera.matrixWorldInverse,0),p.setFromMatrixColumn(this._camera.matrixWorldInverse,1),g.setFromMatrixColumn(this._camera.matrixWorldInverse,2);let i=h.set(e,t,r),n=i.distanceTo(this._camera.position),a=i.sub(this._camera.position);m.multiplyScalar(a.x),p.multiplyScalar(a.y),g.multiplyScalar(a.z),h.copy(m).add(p).add(g),h.z=h.z+n,this.dollyTo(n,!1),this.setFocalOffset(-h.x,h.y,-h.z,!1),this.moveTo(e,t,r,!1)}setBoundary(e){if(!e){this._boundary.min.set(-1/0,-1/0,-1/0),this._boundary.max.set(1/0,1/0,1/0),this._needsUpdate=!0;return}this._boundary.copy(e),this._boundary.clampPoint(this._targetEnd,this._targetEnd),this._needsUpdate=!0}setViewport(e,t,r,i){if(null===e){this._viewport=null;return}this._viewport=this._viewport||new o.Vector4,"number"==typeof e?this._viewport.set(e,t,r,i):this._viewport.copy(e)}getDistanceToFitBox(e,t,r,i=!1){if(uO(this._camera,"getDistanceToFitBox"))return this._spherical.radius;let n=e/t,a=this._camera.getEffectiveFOV()*uM,o=this._camera.aspect;return .5*((i?n>o:n<o)?t:e/o)/Math.tan(.5*a)+.5*r}getDistanceToFitSphere(e){if(uO(this._camera,"getDistanceToFitSphere"))return this._spherical.radius;let t=this._camera.getEffectiveFOV()*uM,r=2*Math.atan(Math.tan(.5*t)*this._camera.aspect);return e/Math.sin(.5*(1<this._camera.aspect?t:r))}getTarget(e,t=!0){return(e&&e.isVector3?e:new o.Vector3).copy(t?this._targetEnd:this._target)}getPosition(e,t=!0){return(e&&e.isVector3?e:new o.Vector3).setFromSpherical(t?this._sphericalEnd:this._spherical).applyQuaternion(this._yAxisUpSpaceInverse).add(t?this._targetEnd:this._target)}getSpherical(e,t=!0){return(e||new o.Spherical).copy(t?this._sphericalEnd:this._spherical)}getFocalOffset(e,t=!0){return(e&&e.isVector3?e:new o.Vector3).copy(t?this._focalOffsetEnd:this._focalOffset)}normalizeRotations(){this._sphericalEnd.theta=this._sphericalEnd.theta%ub,this._sphericalEnd.theta<0&&(this._sphericalEnd.theta+=ub),this._spherical.theta+=ub*Math.round((this._sphericalEnd.theta-this._spherical.theta)/ub)}stop(){this._focalOffset.copy(this._focalOffsetEnd),this._target.copy(this._targetEnd),this._spherical.copy(this._sphericalEnd),this._zoom=this._zoomEnd}reset(e=!1){if(!uT(this._camera.up.x,this._cameraUp0.x)||!uT(this._camera.up.y,this._cameraUp0.y)||!uT(this._camera.up.z,this._cameraUp0.z)){this._camera.up.copy(this._cameraUp0);let e=this.getPosition(h);this.updateCameraUp(),this.setPosition(e.x,e.y,e.z)}return Promise.all([this.setLookAt(this._position0.x,this._position0.y,this._position0.z,this._target0.x,this._target0.y,this._target0.z,e),this.setFocalOffset(this._focalOffset0.x,this._focalOffset0.y,this._focalOffset0.z,e),this.zoomTo(this._zoom0,e)])}saveState(){this._cameraUp0.copy(this._camera.up),this.getTarget(this._target0),this.getPosition(this._position0),this._zoom0=this._zoom,this._focalOffset0.copy(this._focalOffset)}updateCameraUp(){this._yAxisUpSpace.setFromUnitVectors(this._camera.up,l),this._yAxisUpSpaceInverse.copy(this._yAxisUpSpace).invert()}applyCameraUp(){let e=h.subVectors(this._target,this._camera.position).normalize(),t=A.crossVectors(e,this._camera.up);this._camera.up.crossVectors(t,e).normalize(),this._camera.updateMatrixWorld();let r=this.getPosition(h);this.updateCameraUp(),this.setPosition(r.x,r.y,r.z)}update(e){let t=this._sphericalEnd.theta-this._spherical.theta,r=this._sphericalEnd.phi-this._spherical.phi,i=this._sphericalEnd.radius-this._spherical.radius,n=y.subVectors(this._targetEnd,this._target),a=v.subVectors(this._focalOffsetEnd,this._focalOffset),o=this._zoomEnd-this._zoom;if(uD(t))this._thetaVelocity.value=0,this._spherical.theta=this._sphericalEnd.theta;else{let t=this._isUserControllingRotate?this.draggingSmoothTime:this.smoothTime;this._spherical.theta=uQ(this._spherical.theta,this._sphericalEnd.theta,this._thetaVelocity,t,1/0,e),this._needsUpdate=!0}if(uD(r))this._phiVelocity.value=0,this._spherical.phi=this._sphericalEnd.phi;else{let t=this._isUserControllingRotate?this.draggingSmoothTime:this.smoothTime;this._spherical.phi=uQ(this._spherical.phi,this._sphericalEnd.phi,this._phiVelocity,t,1/0,e),this._needsUpdate=!0}if(uD(i))this._radiusVelocity.value=0,this._spherical.radius=this._sphericalEnd.radius;else{let t=this._isUserControllingDolly?this.draggingSmoothTime:this.smoothTime;this._spherical.radius=uQ(this._spherical.radius,this._sphericalEnd.radius,this._radiusVelocity,t,this.maxSpeed,e),this._needsUpdate=!0}if(uD(n.x)&&uD(n.y)&&uD(n.z))this._targetVelocity.set(0,0,0),this._target.copy(this._targetEnd);else{let t=this._isUserControllingTruck?this.draggingSmoothTime:this.smoothTime;uz(this._target,this._targetEnd,this._targetVelocity,t,this.maxSpeed,e,this._target),this._needsUpdate=!0}if(uD(a.x)&&uD(a.y)&&uD(a.z))this._focalOffsetVelocity.set(0,0,0),this._focalOffset.copy(this._focalOffsetEnd);else{let t=this._isUserControllingOffset?this.draggingSmoothTime:this.smoothTime;uz(this._focalOffset,this._focalOffsetEnd,this._focalOffsetVelocity,t,this.maxSpeed,e,this._focalOffset),this._needsUpdate=!0}if(uD(o))this._zoomVelocity.value=0,this._zoom=this._zoomEnd;else{let t=this._isUserControllingZoom?this.draggingSmoothTime:this.smoothTime;this._zoom=uQ(this._zoom,this._zoomEnd,this._zoomVelocity,t,1/0,e)}if(this.dollyToCursor){if(uw(this._camera)&&0!==this._changedDolly){let e=this._spherical.radius-this._lastDistance,t=this._camera,r=this._getCameraDirection(f),i=h.copy(r).cross(t.up).normalize();0===i.lengthSq()&&(i.x=1);let n=A.crossVectors(i,r),a=this._sphericalEnd.radius*Math.tan(t.getEffectiveFOV()*uM*.5),o=(this._sphericalEnd.radius-e-this._sphericalEnd.radius)/this._sphericalEnd.radius,s=d.copy(this._targetEnd).add(i.multiplyScalar(this._dollyControlCoord.x*a*t.aspect)).add(n.multiplyScalar(this._dollyControlCoord.y*a)),l=h.copy(this._targetEnd).lerp(s,o),c=this._lastDollyDirection===uB.IN&&this._spherical.radius<=this.minDistance,u=this._lastDollyDirection===uB.OUT&&this.maxDistance<=this._spherical.radius;if(this.infinityDolly&&(c||u)){this._sphericalEnd.radius-=e,this._spherical.radius-=e;let t=A.copy(r).multiplyScalar(-e);l.add(t)}this._boundary.clampPoint(l,l);let m=A.subVectors(l,this._targetEnd);this._targetEnd.copy(l),this._target.add(m),this._changedDolly-=e,uD(this._changedDolly)&&(this._changedDolly=0)}else if(uI(this._camera)&&0!==this._changedZoom){let e=this._zoom-this._lastZoom,t=this._camera,r=h.set(this._dollyControlCoord.x,this._dollyControlCoord.y,(t.near+t.far)/(t.near-t.far)).unproject(t),i=A.set(0,0,-1).applyQuaternion(t.quaternion),n=d.copy(r).add(i.multiplyScalar(-r.dot(t.up))),a=-(this._zoom-e-this._zoom)/this._zoom,o=this._getCameraDirection(f),s=this._targetEnd.dot(o),l=h.copy(this._targetEnd).lerp(n,a),c=l.dot(o),u=o.multiplyScalar(c-s);l.sub(u),this._boundary.clampPoint(l,l);let m=A.subVectors(l,this._targetEnd);this._targetEnd.copy(l),this._target.add(m),this._changedZoom-=e,uD(this._changedZoom)&&(this._changedZoom=0)}}this._camera.zoom!==this._zoom&&(this._camera.zoom=this._zoom,this._camera.updateProjectionMatrix(),this._updateNearPlaneCorners(),this._needsUpdate=!0),this._dragNeedsUpdate=!0;let s=this._collisionTest();this._spherical.radius=Math.min(this._spherical.radius,s),this._spherical.makeSafe(),this._camera.position.setFromSpherical(this._spherical).applyQuaternion(this._yAxisUpSpaceInverse).add(this._target),this._camera.lookAt(this._target),uD(this._focalOffset.x)&&uD(this._focalOffset.y)&&uD(this._focalOffset.z)||(m.setFromMatrixColumn(this._camera.matrix,0),p.setFromMatrixColumn(this._camera.matrix,1),g.setFromMatrixColumn(this._camera.matrix,2),m.multiplyScalar(this._focalOffset.x),p.multiplyScalar(-this._focalOffset.y),g.multiplyScalar(this._focalOffset.z),h.copy(m).add(p).add(g),this._camera.position.add(h),this._camera.updateMatrixWorld()),this._boundaryEnclosesCamera&&this._encloseToBoundary(this._camera.position.copy(this._target),h.setFromSpherical(this._spherical).applyQuaternion(this._yAxisUpSpaceInverse),1);let l=this._needsUpdate;return l&&!this._updatedLastTime?(this._hasRested=!1,this.dispatchEvent({type:"wake"}),this.dispatchEvent({type:"update"})):l?(this.dispatchEvent({type:"update"}),uD(t,this.restThreshold)&&uD(r,this.restThreshold)&&uD(i,this.restThreshold)&&uD(n.x,this.restThreshold)&&uD(n.y,this.restThreshold)&&uD(n.z,this.restThreshold)&&uD(a.x,this.restThreshold)&&uD(a.y,this.restThreshold)&&uD(a.z,this.restThreshold)&&uD(o,this.restThreshold)&&!this._hasRested&&(this._hasRested=!0,this.dispatchEvent({type:"rest"}))):!l&&this._updatedLastTime&&this.dispatchEvent({type:"sleep"}),this._lastDistance=this._spherical.radius,this._lastZoom=this._zoom,this._updatedLastTime=l,this._needsUpdate=!1,l}toJSON(){return JSON.stringify({enabled:this._enabled,minDistance:this.minDistance,maxDistance:uF(this.maxDistance),minZoom:this.minZoom,maxZoom:uF(this.maxZoom),minPolarAngle:this.minPolarAngle,maxPolarAngle:uF(this.maxPolarAngle),minAzimuthAngle:uF(this.minAzimuthAngle),maxAzimuthAngle:uF(this.maxAzimuthAngle),smoothTime:this.smoothTime,draggingSmoothTime:this.draggingSmoothTime,dollySpeed:this.dollySpeed,truckSpeed:this.truckSpeed,dollyToCursor:this.dollyToCursor,target:this._targetEnd.toArray(),position:h.setFromSpherical(this._sphericalEnd).add(this._targetEnd).toArray(),zoom:this._zoomEnd,focalOffset:this._focalOffsetEnd.toArray(),target0:this._target0.toArray(),position0:this._position0.toArray(),zoom0:this._zoom0,focalOffset0:this._focalOffset0.toArray()})}fromJSON(e,t=!1){let r=JSON.parse(e);this.enabled=r.enabled,this.minDistance=r.minDistance,this.maxDistance=uP(r.maxDistance),this.minZoom=r.minZoom,this.maxZoom=uP(r.maxZoom),this.minPolarAngle=r.minPolarAngle,this.maxPolarAngle=uP(r.maxPolarAngle),this.minAzimuthAngle=uP(r.minAzimuthAngle),this.maxAzimuthAngle=uP(r.maxAzimuthAngle),this.smoothTime=r.smoothTime,this.draggingSmoothTime=r.draggingSmoothTime,this.dollySpeed=r.dollySpeed,this.truckSpeed=r.truckSpeed,this.dollyToCursor=r.dollyToCursor,this._target0.fromArray(r.target0),this._position0.fromArray(r.position0),this._zoom0=r.zoom0,this._focalOffset0.fromArray(r.focalOffset0),this.moveTo(r.target[0],r.target[1],r.target[2],t),E.setFromVector3(h.fromArray(r.position).sub(this._targetEnd).applyQuaternion(this._yAxisUpSpace)),this.rotateTo(E.theta,E.phi,t),this.dollyTo(E.radius,t),this.zoomTo(r.zoom,t),this.setFocalOffset(r.focalOffset[0],r.focalOffset[1],r.focalOffset[2],t),this._needsUpdate=!0}connect(e){if(this._domElement){console.warn("camera-controls is already connected.");return}e.setAttribute("data-camera-controls-version","2.10.0"),this._addAllEventListeners(e),this._getClientRect(this._elementRect)}disconnect(){this.cancel(),this._removeAllEventListeners(),this._domElement&&(this._domElement.removeAttribute("data-camera-controls-version"),this._domElement=void 0)}dispose(){this.removeAllEventListeners(),this.disconnect()}_getTargetDirection(e){return e.setFromSpherical(this._spherical).divideScalar(this._spherical.radius).applyQuaternion(this._yAxisUpSpaceInverse)}_getCameraDirection(e){return this._getTargetDirection(e).negate()}_findPointerById(e){return this._activePointers.find(t=>t.pointerId===e)}_findPointerByMouseButton(e){return this._activePointers.find(t=>t.mouseButton===e)}_disposePointer(e){this._activePointers.splice(this._activePointers.indexOf(e),1)}_encloseToBoundary(e,t,r){let i=t.lengthSq();if(0===i)return e;let n=A.copy(t).add(e),a=this._boundary.clampPoint(n,d).sub(n),o=a.lengthSq();if(0===o)return e.add(t);if(o===i)return e;if(0===r)return e.add(t).add(a);{let i=1+r*o/t.dot(a);return e.add(A.copy(t).multiplyScalar(i)).add(a.multiplyScalar(1-r))}}_updateNearPlaneCorners(){if(uw(this._camera)){let e=this._camera,t=e.near,r=Math.tan(e.getEffectiveFOV()*uM*.5)*t,i=r*e.aspect;this._nearPlaneCorners[0].set(-i,-r,0),this._nearPlaneCorners[1].set(i,-r,0),this._nearPlaneCorners[2].set(i,r,0),this._nearPlaneCorners[3].set(-i,r,0)}else if(uI(this._camera)){let e=this._camera,t=1/e.zoom,r=e.left*t,i=e.right*t,n=e.top*t,a=e.bottom*t;this._nearPlaneCorners[0].set(r,n,0),this._nearPlaneCorners[1].set(i,n,0),this._nearPlaneCorners[2].set(i,a,0),this._nearPlaneCorners[3].set(r,a,0)}}_collisionTest(){let e=1/0;if(!(this.colliderMeshes.length>=1)||uO(this._camera,"_collisionTest"))return e;let t=this._getTargetDirection(f);_.lookAt(s,t,this._camera.up);for(let r=0;r<4;r++){let i=A.copy(this._nearPlaneCorners[r]);i.applyMatrix4(_);let n=d.addVectors(this._target,i);M.set(n,t),M.far=this._spherical.radius+1;let a=M.intersectObjects(this.colliderMeshes);0!==a.length&&a[0].distance<e&&(e=a[0].distance)}return e}_getClientRect(e){if(!this._domElement)return;let t=this._domElement.getBoundingClientRect();return e.x=t.left,e.y=t.top,this._viewport?(e.x+=this._viewport.x,e.y+=t.height-this._viewport.w-this._viewport.y,e.width=this._viewport.z,e.height=this._viewport.w):(e.width=t.width,e.height=t.height),e}_createOnRestPromise(e){return e?Promise.resolve():(this._hasRested=!1,this.dispatchEvent({type:"transitionstart"}),new Promise(e=>{let t=()=>{this.removeEventListener("rest",t),e()};this.addEventListener("rest",t)}))}_addAllEventListeners(e){}_removeAllEventListeners(){}get dampingFactor(){return console.warn(".dampingFactor has been deprecated. use smoothTime (in seconds) instead."),0}set dampingFactor(e){console.warn(".dampingFactor has been deprecated. use smoothTime (in seconds) instead.")}get draggingDampingFactor(){return console.warn(".draggingDampingFactor has been deprecated. use draggingSmoothTime (in seconds) instead."),0}set draggingDampingFactor(e){console.warn(".draggingDampingFactor has been deprecated. use draggingSmoothTime (in seconds) instead.")}static createBoundingSphere(e,t=new o.Sphere){let r=t.center;C.makeEmpty(),e.traverseVisible(e=>{e.isMesh&&C.expandByObject(e)}),C.getCenter(r);let i=0;return e.traverseVisible(e=>{if(!e.isMesh||!e.geometry)return;let t=e.geometry.clone();t.applyMatrix4(e.matrixWorld);let n=t.attributes.position;for(let e=0,t=n.count;e<t;e++)h.fromBufferAttribute(n,e),i=Math.max(i,r.distanceToSquared(h))}),t.radius=Math.sqrt(i),t}}let uH=(0,eS.forwardRef)((e,t)=>{(0,eS.useMemo)(()=>{let e={Box3:eT.Box3,MathUtils:{clamp:eT.MathUtils.clamp},Matrix4:eT.Matrix4,Quaternion:eT.Quaternion,Raycaster:eT.Raycaster,Sphere:eT.Sphere,Spherical:eT.Spherical,Vector2:eT.Vector2,Vector3:eT.Vector3,Vector4:eT.Vector4};uN.install({THREE:e}),(0,eR.e)({CameraControlsImpl:uN})},[]);let{camera:r,domElement:i,makeDefault:n,onStart:a,onEnd:o,onChange:s,regress:l,...c}=e,u=(0,eR.D)(e=>e.camera),h=(0,eR.D)(e=>e.gl),A=(0,eR.D)(e=>e.invalidate),d=(0,eR.D)(e=>e.events),f=(0,eR.D)(e=>e.setEvents),m=(0,eR.D)(e=>e.set),p=(0,eR.D)(e=>e.get),g=(0,eR.D)(e=>e.performance),y=r||u,v=i||d.connected||h.domElement,E=(0,eS.useMemo)(()=>new uN(y),[y]);return(0,eR.F)((e,t)=>{E.enabled&&E.update(t)},-1),(0,eS.useEffect)(()=>(E.connect(v),()=>void E.disconnect()),[v,E]),(0,eS.useEffect)(()=>{let e=e=>{A(),l&&g.regress(),s&&s(e)},t=e=>{a&&a(e)},r=e=>{o&&o(e)};return E.addEventListener("update",e),E.addEventListener("controlstart",t),E.addEventListener("controlend",r),E.addEventListener("control",e),E.addEventListener("transitionstart",e),E.addEventListener("wake",e),()=>{E.removeEventListener("update",e),E.removeEventListener("controlstart",t),E.removeEventListener("controlend",r),E.removeEventListener("control",e),E.removeEventListener("transitionstart",e),E.removeEventListener("wake",e)}},[E,a,o,A,f,l,s]),(0,eS.useEffect)(()=>{if(n){let e=p().controls;return m({controls:E}),()=>m({controls:e})}},[n,E]),eS.createElement("primitive",j({ref:t,object:E},c))}),uV=e=>(null==e?void 0:e.current)instanceof eT.Object3D,uj=eS.createContext(null);function uJ(){let e=eS.useContext(uj);if(!e)throw Error("useMotion hook must be used in a MotionPathControls component.");return e}function uY({points:e=50,color:t="black"}){let{path:r}=uJ(),[i,n]=eS.useState([]),a=eS.useMemo(()=>new eT.MeshBasicMaterial({color:t}),[t]),o=eS.useMemo(()=>new eT.SphereGeometry(.025,16,16),[]),s=eS.useRef([]);return eS.useEffect(()=>{r.curves!==s.current&&(n(r.getPoints(e)),s.current=r.curves)}),i.map((e,t)=>eS.createElement("mesh",{key:t,material:a,geometry:o,position:[e.x,e.y,e.z]}))}let uW=eS.forwardRef(({children:e,curves:t=[],debug:r=!1,debugColor:i="black",object:n,focus:a,loop:o=!0,offset:s,smooth:l=!1,eps:c=1e-5,damping:u=.1,focusDamping:h=.1,maxSpeed:A=1/0,...d},f)=>{let{camera:m}=(0,eR.D)(),p=eS.useRef(null),g=eS.useRef(null!=s?s:0),y=eS.useMemo(()=>new eT.CurvePath,[]),v=eS.useMemo(()=>({focus:a,object:(null==n?void 0:n.current)instanceof eT.Object3D?n:{current:m},path:y,current:g.current,offset:g.current,point:new eT.Vector3,tangent:new eT.Vector3,next:new eT.Vector3}),[a,n]);eS.useLayoutEffect(()=>{var e,r;y.curves=[];let i=t.length>0?t:null!==(e=null==(r=p.current)||null==(r=r.__r3f)?void 0:r.objects)&&void 0!==e?e:[];for(let e=0;e<i.length;e++)y.add(i[e]);if(l){let e=y.getPoints("number"==typeof l?l:1),t=new eT.CatmullRomCurve3(e);y.curves=[t]}y.updateArcLengths()}),eS.useImperativeHandle(f,()=>Object.assign(p.current,{motion:v}),[v]),eS.useLayoutEffect(()=>{g.current=rp.repeat(g.current,1)},[s]);let E=eS.useMemo(()=>new eT.Vector3,[]);return(0,eR.F)((e,t)=>{let r=v.offset;if(rW.damp(g,"current",void 0!==s?s:v.current,u,t,A,void 0,c),v.offset=o?rp.repeat(g.current,1):rp.clamp(g.current,0,1),y.getCurveLengths().length>0){y.getPointAt(v.offset,v.point),y.getTangentAt(v.offset,v.tangent).normalize(),y.getPointAt(rp.repeat(g.current-(r-v.offset),1),v.next);let e=(null==n?void 0:n.current)instanceof eT.Object3D?n.current:m;e.position.copy(v.point),a&&rW.dampLookAt(e,uV(a)?a.current.getWorldPosition(E):a,h,t,A,void 0,c)}}),eS.createElement("group",j({ref:p},d),eS.createElement(uj.Provider,{value:v},e,r&&eS.createElement(uY,{color:i})))});function uK({defaultScene:e,defaultCamera:t,renderPriority:r=1}){let i;let{gl:n,scene:a,camera:o}=(0,eR.D)();return(0,eR.F)(()=>{i=n.autoClear,1===r&&(n.autoClear=!0,n.render(e,t)),n.autoClear=!1,n.clearDepth(),n.render(a,o),n.autoClear=i},r),eS.createElement("group",{onPointerOver:()=>null})}function uq({children:e,renderPriority:t=1}){let{scene:r,camera:i}=(0,eR.D)(),[n]=eS.useState(()=>new eT.Scene);return eS.createElement(eS.Fragment,null,(0,eR.h)(eS.createElement(eS.Fragment,null,e,eS.createElement(uK,{defaultScene:r,defaultCamera:i,renderPriority:t})),n,{events:{priority:t+1}}))}let uX=eS.createContext({}),uZ=()=>eS.useContext(uX),u$=2*Math.PI,u1=new eT.Object3D,u0=new eT.Matrix4,[u2,u3]=[new eT.Quaternion,new eT.Quaternion],u4=new eT.Vector3,u5=new eT.Vector3,u6=e=>"minPolarAngle"in e,u8=e=>"getTarget"in e,u9=({alignment:e="bottom-right",margin:t=[80,80],renderPriority:r=1,onUpdate:i,onTarget:n,children:a})=>{let o=(0,eR.D)(e=>e.size),s=(0,eR.D)(e=>e.camera),l=(0,eR.D)(e=>e.controls),c=(0,eR.D)(e=>e.invalidate),u=eS.useRef(null),h=eS.useRef(null),A=eS.useRef(!1),d=eS.useRef(0),f=eS.useRef(new eT.Vector3(0,0,0)),m=eS.useRef(new eT.Vector3(0,0,0));eS.useEffect(()=>{m.current.copy(s.up),u1.up.copy(s.up)},[s]);let p=eS.useCallback(e=>{A.current=!0,(l||n)&&(f.current=(null==n?void 0:n())||(u8(l)?l.getTarget(f.current):null==l?void 0:l.target)),d.current=s.position.distanceTo(u4),u2.copy(s.quaternion),u5.copy(e).multiplyScalar(d.current).add(u4),u1.lookAt(u5),u3.copy(u1.quaternion),c()},[l,s,n,c]);(0,eR.F)((e,t)=>{if(h.current&&u.current){var r;A.current&&(.01>u2.angleTo(u3)?(A.current=!1,u6(l)&&s.up.copy(m.current)):(u2.rotateTowards(u3,t*u$),s.position.set(0,0,1).applyQuaternion(u2).multiplyScalar(d.current).add(f.current),s.up.set(0,1,0).applyQuaternion(u2).normalize(),s.quaternion.copy(u2),u8(l)&&l.setPosition(s.position.x,s.position.y,s.position.z),i?i():l&&l.update(t),c())),u0.copy(s.matrix).invert(),null==(r=u.current)||r.quaternion.setFromRotationMatrix(u0)}});let g=eS.useMemo(()=>({tweenCamera:p}),[p]),[y,v]=t,E=e.endsWith("-center")?0:e.endsWith("-left")?-o.width/2+y:o.width/2-y,x=e.startsWith("center-")?0:e.startsWith("top-")?o.height/2-v:-o.height/2+v;return eS.createElement(uq,{renderPriority:r},eS.createElement(uX.Provider,{value:g},eS.createElement(cd,{makeDefault:!0,ref:h,position:[0,0,200]}),eS.createElement("group",{ref:u,position:[E,x,0]},a)))},u7={bg:"#f0f0f0",hover:"#999",text:"black",stroke:"black"},he=["Right","Left","Top","Bottom","Front","Back"],ht=e=>new eT.Vector3(...e).multiplyScalar(.38),hr=[[1,1,1],[1,1,-1],[1,-1,1],[1,-1,-1],[-1,1,1],[-1,1,-1],[-1,-1,1],[-1,-1,-1]].map(ht),hi=[.25,.25,.25],hn=[[1,1,0],[1,0,1],[1,0,-1],[1,-1,0],[0,1,1],[0,1,-1],[0,-1,1],[0,-1,-1],[-1,1,0],[-1,0,1],[-1,0,-1],[-1,-1,0]].map(ht),ha=hn.map(e=>e.toArray().map(e=>0==e?.5:.25)),ho=({hover:e,index:t,font:r="20px Inter var, Arial, sans-serif",faces:i=he,color:n=u7.bg,hoverColor:a=u7.hover,textColor:o=u7.text,strokeColor:s=u7.stroke,opacity:l=1})=>{let c=(0,eR.D)(e=>e.gl),u=eS.useMemo(()=>{let e=document.createElement("canvas");e.width=128,e.height=128;let a=e.getContext("2d");return a.fillStyle=n,a.fillRect(0,0,e.width,e.height),a.strokeStyle=s,a.strokeRect(0,0,e.width,e.height),a.font=r,a.textAlign="center",a.fillStyle=o,a.fillText(i[t].toUpperCase(),64,76),new eT.CanvasTexture(e)},[t,i,r,n,o,s]);return eS.createElement("meshBasicMaterial",{map:u,"map-anisotropy":c.capabilities.getMaxAnisotropy()||1,attach:`material-${t}`,color:e?a:"white",transparent:!0,opacity:l})},hs=e=>{let{tweenCamera:t}=uZ(),[r,i]=eS.useState(null);return eS.createElement("mesh",{onPointerOut:e=>{e.stopPropagation(),i(null)},onPointerMove:e=>{e.stopPropagation(),i(Math.floor(e.faceIndex/2))},onClick:e.onClick||(e=>{e.stopPropagation(),t(e.face.normal)})},[...Array(6)].map((t,i)=>eS.createElement(ho,j({key:i,index:i,hover:r===i},e))),eS.createElement("boxGeometry",null))},hl=({onClick:e,dimensions:t,position:r,hoverColor:i=u7.hover})=>{let{tweenCamera:n}=uZ(),[a,o]=eS.useState(!1);return eS.createElement("mesh",{scale:1.01,position:r,onPointerOver:e=>{e.stopPropagation(),o(!0)},onPointerOut:e=>{e.stopPropagation(),o(!1)},onClick:e||(e=>{e.stopPropagation(),n(r)})},eS.createElement("meshBasicMaterial",{color:a?i:"white",transparent:!0,opacity:.6,visible:a}),eS.createElement("boxGeometry",{args:t}))},hc=e=>eS.createElement("group",{scale:[60,60,60]},eS.createElement(hs,e),hn.map((t,r)=>eS.createElement(hl,j({key:r,position:t,dimensions:ha[r]},e))),hr.map((t,r)=>eS.createElement(hl,j({key:r,position:t,dimensions:hi},e))));function hu({scale:e=[.8,.05,.05],color:t,rotation:r}){return eS.createElement("group",{rotation:r},eS.createElement("mesh",{position:[.4,0,0]},eS.createElement("boxGeometry",{args:e}),eS.createElement("meshBasicMaterial",{color:t,toneMapped:!1})))}function hh({onClick:e,font:t,disabled:r,arcStyle:i,label:n,labelColor:a,axisHeadScale:o=1,...s}){let l=(0,eR.D)(e=>e.gl),c=eS.useMemo(()=>{let e=document.createElement("canvas");e.width=64,e.height=64;let r=e.getContext("2d");return r.beginPath(),r.arc(32,32,16,0,2*Math.PI),r.closePath(),r.fillStyle=i,r.fill(),n&&(r.font=t,r.textAlign="center",r.fillStyle=a,r.fillText(n,32,41)),new eT.CanvasTexture(e)},[i,n,a,t]),[u,h]=eS.useState(!1),A=(n?1:.75)*(u?1.2:1)*o;return eS.createElement("sprite",j({scale:A,onPointerOver:r?void 0:e=>{e.stopPropagation(),h(!0)},onPointerOut:r?void 0:e||(e=>{e.stopPropagation(),h(!1)})},s),eS.createElement("spriteMaterial",{map:c,"map-anisotropy":l.capabilities.getMaxAnisotropy()||1,alphaTest:.3,opacity:n?1:.75,toneMapped:!1}))}let hA=({hideNegativeAxes:e,hideAxisHeads:t,disabled:r,font:i="18px Inter var, Arial, sans-serif",axisColors:n=["#ff2060","#20df80","#2080ff"],axisHeadScale:a=1,axisScale:o,labels:s=["X","Y","Z"],labelColor:l="#000",onClick:c,...u})=>{let[h,A,d]=n,{tweenCamera:f}=uZ(),m={font:i,disabled:r,labelColor:l,onClick:c,axisHeadScale:a,onPointerDown:r?void 0:e=>{f(e.object.position),e.stopPropagation()}};return eS.createElement("group",j({scale:40},u),eS.createElement(hu,{color:h,rotation:[0,0,0],scale:o}),eS.createElement(hu,{color:A,rotation:[0,0,Math.PI/2],scale:o}),eS.createElement(hu,{color:d,rotation:[0,-Math.PI/2,0],scale:o}),!t&&eS.createElement(eS.Fragment,null,eS.createElement(hh,j({arcStyle:h,position:[1,0,0],label:s[0]},m)),eS.createElement(hh,j({arcStyle:A,position:[0,1,0],label:s[1]},m)),eS.createElement(hh,j({arcStyle:d,position:[0,0,1],label:s[2]},m)),!e&&eS.createElement(eS.Fragment,null,eS.createElement(hh,j({arcStyle:h,position:[-1,0,0]},m)),eS.createElement(hh,j({arcStyle:A,position:[0,-1,0]},m)),eS.createElement(hh,j({arcStyle:d,position:[0,0,-1]},m)))))},hd=sx({cellSize:.5,sectionSize:1,fadeDistance:100,fadeStrength:1,fadeFrom:1,cellThickness:.5,sectionThickness:1,cellColor:new eT.Color,sectionColor:new eT.Color,infiniteGrid:!1,followCamera:!1,worldCamProjPosition:new eT.Vector3,worldPlanePosition:new eT.Vector3},`
    varying vec3 localPosition;
    varying vec4 worldPosition;

    uniform vec3 worldCamProjPosition;
    uniform vec3 worldPlanePosition;
    uniform float fadeDistance;
    uniform bool infiniteGrid;
    uniform bool followCamera;

    void main() {
      localPosition = position.xzy;
      if (infiniteGrid) localPosition *= 1.0 + fadeDistance;
      
      worldPosition = modelMatrix * vec4(localPosition, 1.0);
      if (followCamera) {
        worldPosition.xyz += (worldCamProjPosition - worldPlanePosition);
        localPosition = (inverse(modelMatrix) * worldPosition).xyz;
      }

      gl_Position = projectionMatrix * viewMatrix * worldPosition;
    }
  `,`
    varying vec3 localPosition;
    varying vec4 worldPosition;

    uniform vec3 worldCamProjPosition;
    uniform float cellSize;
    uniform float sectionSize;
    uniform vec3 cellColor;
    uniform vec3 sectionColor;
    uniform float fadeDistance;
    uniform float fadeStrength;
    uniform float fadeFrom;
    uniform float cellThickness;
    uniform float sectionThickness;

    float getGrid(float size, float thickness) {
      vec2 r = localPosition.xz / size;
      vec2 grid = abs(fract(r - 0.5) - 0.5) / fwidth(r);
      float line = min(grid.x, grid.y) + 1.0 - thickness;
      return 1.0 - min(line, 1.0);
    }

    void main() {
      float g1 = getGrid(cellSize, cellThickness);
      float g2 = getGrid(sectionSize, sectionThickness);

      vec3 from = worldCamProjPosition*vec3(fadeFrom);
      float dist = distance(from, worldPosition.xyz);
      float d = 1.0 - min(dist / fadeDistance, 1.0);
      vec3 color = mix(cellColor, sectionColor, min(1.0, sectionThickness * g2));

      gl_FragColor = vec4(color, (g1 + g2) * pow(d, fadeStrength));
      gl_FragColor.a = mix(0.75 * gl_FragColor.a, gl_FragColor.a, g2);
      if (gl_FragColor.a <= 0.0) discard;

      #include <tonemapping_fragment>
      #include <${sI>=154?"colorspace_fragment":"encodings_fragment"}>
    }
  `),hf=eS.forwardRef(({args:e,cellColor:t="#000000",sectionColor:r="#2080ff",cellSize:i=.5,sectionSize:n=1,followCamera:a=!1,infiniteGrid:o=!1,fadeDistance:s=100,fadeStrength:l=1,fadeFrom:c=1,cellThickness:u=.5,sectionThickness:h=1,side:A=eT.BackSide,...d},f)=>{(0,eR.e)({GridMaterial:hd});let m=eS.useRef(null);eS.useImperativeHandle(f,()=>m.current,[]);let p=new eT.Plane,g=new eT.Vector3(0,1,0),y=new eT.Vector3(0,0,0);return(0,eR.F)(e=>{p.setFromNormalAndCoplanarPoint(g,y).applyMatrix4(m.current.matrixWorld);let t=m.current.material,r=t.uniforms.worldCamProjPosition,i=t.uniforms.worldPlanePosition;p.projectPoint(e.camera.position,r.value),i.value.set(0,0,0).applyMatrix4(m.current.matrixWorld)}),eS.createElement("mesh",j({ref:m,frustumCulled:!1},d),eS.createElement("gridMaterial",j({transparent:!0,"extensions-derivatives":!0,side:A},{cellSize:i,sectionSize:n,cellColor:t,sectionColor:r,cellThickness:u,sectionThickness:h},{fadeDistance:s,fadeStrength:l,fadeFrom:c,infiniteGrid:o,followCamera:a})),eS.createElement("planeGeometry",{args:e}))});function hm(e,{path:t}){let[r]=(0,eR.H)(eT.CubeTextureLoader,[e],e=>e.setPath(t));return r}function hp({children:e,files:t,...r}){let i=hm(t,{...r});return eS.createElement(eS.Fragment,null,null==e?void 0:e(i))}hm.preload=(e,{path:t})=>eR.H.preload(eT.CubeTextureLoader,[e],e=>e.setPath(t));var hg={},hy=Uint8Array,hv=Uint16Array,hE=Uint32Array,hx=new hy([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),hC=new hy([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),hB=new hy([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),hw=function(e,t){for(var r=new hv(31),i=0;i<31;++i)r[i]=t+=1<<e[i-1];for(var n=new hE(r[30]),i=1;i<30;++i)for(var a=r[i];a<r[i+1];++a)n[a]=a-r[i]<<5|i;return[r,n]},hI=hw(hx,2),hb=hI[0],h_=hI[1];hb[28]=258,h_[258]=28;for(var hM=hw(hC,0),hS=hM[0],hD=hM[1],hT=new hv(32768),hR=0;hR<32768;++hR){var hF=(43690&hR)>>>1|(21845&hR)<<1;hF=(61680&(hF=(52428&hF)>>>2|(13107&hF)<<2))>>>4|(3855&hF)<<4,hT[hR]=((65280&hF)>>>8|(255&hF)<<8)>>>1}for(var hP=function(e,t,r){for(var i,n=e.length,a=0,o=new hv(t);a<n;++a)++o[e[a]-1];var s=new hv(t);for(a=0;a<t;++a)s[a]=s[a-1]+o[a-1]<<1;if(r){i=new hv(1<<t);var l=15-t;for(a=0;a<n;++a)if(e[a])for(var c=a<<4|e[a],u=t-e[a],h=s[e[a]-1]++<<u,A=h|(1<<u)-1;h<=A;++h)i[hT[h]>>>l]=c}else for(a=0,i=new hv(n);a<n;++a)e[a]&&(i[a]=hT[s[e[a]-1]++]>>>15-e[a]);return i},hQ=new hy(288),hR=0;hR<144;++hR)hQ[hR]=8;for(var hR=144;hR<256;++hR)hQ[hR]=9;for(var hR=256;hR<280;++hR)hQ[hR]=7;for(var hR=280;hR<288;++hR)hQ[hR]=8;for(var hz=new hy(32),hR=0;hR<32;++hR)hz[hR]=5;var hL=hP(hQ,9,1),hO=hP(hz,5,1),hU=function(e){for(var t=e[0],r=1;r<e.length;++r)e[r]>t&&(t=e[r]);return t},hk=function(e,t,r){var i=t/8|0;return(e[i]|e[i+1]<<8)>>(7&t)&r},hG=function(e,t){var r=t/8|0;return(e[r]|e[r+1]<<8|e[r+2]<<16)>>(7&t)},hN=function(e){return(e/8|0)+(7&e&&1)},hH=function(e,t,r){(null==t||t<0)&&(t=0),(null==r||r>e.length)&&(r=e.length);var i=new(e instanceof hv?hv:e instanceof hE?hE:hy)(r-t);return i.set(e.subarray(t,r)),i},hV=function(e,t,r){var i=e.length;if(!i||r&&!r.l&&i<5)return t||new hy(0);var n=!t||r,a=!r||r.i;r||(r={}),t||(t=new hy(3*i));var o=function(e){var r=t.length;if(e>r){var i=new hy(Math.max(2*r,e));i.set(t),t=i}},s=r.f||0,l=r.p||0,c=r.b||0,u=r.l,h=r.d,A=r.m,d=r.n,f=8*i;do{if(!u){r.f=s=hk(e,l,1);var m=hk(e,l+1,3);if(l+=3,m){if(1==m)u=hL,h=hO,A=9,d=5;else if(2==m){var p=hk(e,l,31)+257,g=hk(e,l+10,15)+4,y=p+hk(e,l+5,31)+1;l+=14;for(var v=new hy(y),E=new hy(19),x=0;x<g;++x)E[hB[x]]=hk(e,l+3*x,7);l+=3*g;for(var C=hU(E),B=(1<<C)-1,w=hP(E,C,1),x=0;x<y;){var I=w[hk(e,l,B)];l+=15&I;var b=I>>>4;if(b<16)v[x++]=b;else{var _=0,M=0;for(16==b?(M=3+hk(e,l,3),l+=2,_=v[x-1]):17==b?(M=3+hk(e,l,7),l+=3):18==b&&(M=11+hk(e,l,127),l+=7);M--;)v[x++]=_}}var S=v.subarray(0,p),D=v.subarray(p);A=hU(S),d=hU(D),u=hP(S,A,1),h=hP(D,d,1)}else throw"invalid block type"}else{var b=hN(l)+4,T=e[b-4]|e[b-3]<<8,R=b+T;if(R>i){if(a)throw"unexpected EOF";break}n&&o(c+T),t.set(e.subarray(b,R),c),r.b=c+=T,r.p=l=8*R;continue}if(l>f){if(a)throw"unexpected EOF";break}}n&&o(c+131072);for(var F=(1<<A)-1,P=(1<<d)-1,Q=l;;Q=l){var _=u[hG(e,l)&F],z=_>>>4;if((l+=15&_)>f){if(a)throw"unexpected EOF";break}if(!_)throw"invalid length/literal";if(z<256)t[c++]=z;else if(256==z){Q=l,u=null;break}else{var L=z-254;if(z>264){var x=z-257,O=hx[x];L=hk(e,l,(1<<O)-1)+hb[x],l+=O}var U=h[hG(e,l)&P],k=U>>>4;if(!U)throw"invalid distance";l+=15&U;var D=hS[k];if(k>3){var O=hC[k];D+=hG(e,l)&(1<<O)-1,l+=O}if(l>f){if(a)throw"unexpected EOF";break}n&&o(c+131072);for(var G=c+L;c<G;c+=4)t[c]=t[c-D],t[c+1]=t[c+1-D],t[c+2]=t[c+2-D],t[c+3]=t[c+3-D];c=G}}r.l=u,r.p=Q,r.b=c,u&&(s=1,r.m=A,r.d=h,r.n=d)}while(!s);return c==t.length?t:hH(t,0,c)},hj=function(e,t,r){r<<=7&t;var i=t/8|0;e[i]|=r,e[i+1]|=r>>>8},hJ=function(e,t,r){r<<=7&t;var i=t/8|0;e[i]|=r,e[i+1]|=r>>>8,e[i+2]|=r>>>16},hY=function(e,t){for(var r=[],i=0;i<e.length;++i)e[i]&&r.push({s:i,f:e[i]});var n=r.length,a=r.slice();if(!n)return[h1,0];if(1==n){var o=new hy(r[0].s+1);return o[r[0].s]=1,[o,1]}r.sort(function(e,t){return e.f-t.f}),r.push({s:-1,f:25001});var s=r[0],l=r[1],c=0,u=1,h=2;for(r[0]={s:-1,f:s.f+l.f,l:s,r:l};u!=n-1;)s=r[r[c].f<r[h].f?c++:h++],l=r[c!=u&&r[c].f<r[h].f?c++:h++],r[u++]={s:-1,f:s.f+l.f,l:s,r:l};for(var A=a[0].s,i=1;i<n;++i)a[i].s>A&&(A=a[i].s);var d=new hv(A+1),f=hW(r[u-1],d,0);if(f>t){var i=0,m=0,p=f-t,g=1<<p;for(a.sort(function(e,t){return d[t.s]-d[e.s]||e.f-t.f});i<n;++i){var y=a[i].s;if(d[y]>t)m+=g-(1<<f-d[y]),d[y]=t;else break}for(m>>>=p;m>0;){var v=a[i].s;d[v]<t?m-=1<<t-d[v]++-1:++i}for(;i>=0&&m;--i){var E=a[i].s;d[E]==t&&(--d[E],++m)}f=t}return[new hy(d),f]},hW=function(e,t,r){return -1==e.s?Math.max(hW(e.l,t,r+1),hW(e.r,t,r+1)):t[e.s]=r},hK=function(e){for(var t=e.length;t&&!e[--t];);for(var r=new hv(++t),i=0,n=e[0],a=1,o=function(e){r[i++]=e},s=1;s<=t;++s)if(e[s]==n&&s!=t)++a;else{if(!n&&a>2){for(;a>138;a-=138)o(32754);a>2&&(o(a>10?a-11<<5|28690:a-3<<5|12305),a=0)}else if(a>3){for(o(n),--a;a>6;a-=6)o(8304);a>2&&(o(a-3<<5|8208),a=0)}for(;a--;)o(n);a=1,n=e[s]}return[r.subarray(0,i),t]},hq=function(e,t){for(var r=0,i=0;i<t.length;++i)r+=e[i]*t[i];return r},hX=function(e,t,r){var i=r.length,n=hN(t+2);e[n]=255&i,e[n+1]=i>>>8,e[n+2]=255^e[n],e[n+3]=255^e[n+1];for(var a=0;a<i;++a)e[n+a+4]=r[a];return(n+4+i)*8},hZ=function(e,t,r,i,n,a,o,s,l,c,u){hj(t,u++,r),++n[256];for(var h,A,d,f,m=hY(n,15),p=m[0],g=m[1],y=hY(a,15),v=y[0],E=y[1],x=hK(p),C=x[0],B=x[1],w=hK(v),I=w[0],b=w[1],_=new hv(19),M=0;M<C.length;++M)_[31&C[M]]++;for(var M=0;M<I.length;++M)_[31&I[M]]++;for(var S=hY(_,7),D=S[0],T=S[1],R=19;R>4&&!D[hB[R-1]];--R);var F=c+5<<3,P=hq(n,hQ)+hq(a,hz)+o,Q=hq(n,p)+hq(a,v)+o+14+3*R+hq(_,D)+(2*_[16]+3*_[17]+7*_[18]);if(F<=P&&F<=Q)return hX(t,u,e.subarray(l,l+c));if(hj(t,u,1+(Q<P)),u+=2,Q<P){h=hP(p,g,0),A=p,d=hP(v,E,0),f=v;var z=hP(D,T,0);hj(t,u,B-257),hj(t,u+5,b-1),hj(t,u+10,R-4),u+=14;for(var M=0;M<R;++M)hj(t,u+3*M,D[hB[M]]);u+=3*R;for(var L=[C,I],O=0;O<2;++O)for(var U=L[O],M=0;M<U.length;++M){var k=31&U[M];hj(t,u,z[k]),u+=D[k],k>15&&(hj(t,u,U[M]>>>5&127),u+=U[M]>>>12)}}else h=null,A=hQ,d=null,f=hz;for(var M=0;M<s;++M)if(i[M]>255){var k=i[M]>>>18&31;hJ(t,u,h[k+257]),u+=A[k+257],k>7&&(hj(t,u,i[M]>>>23&31),u+=hx[k]);var G=31&i[M];hJ(t,u,d[G]),u+=f[G],G>3&&(hJ(t,u,i[M]>>>5&8191),u+=hC[G])}else hJ(t,u,h[i[M]]),u+=A[i[M]];return hJ(t,u,h[256]),u+A[256]},h$=new hE([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),h1=new hy(0),h0=function(e){if((15&e[0])!=8||e[0]>>>4>7||(e[0]<<8|e[1])%31)throw"invalid zlib data";if(32&e[1])throw"invalid zlib data: preset dictionaries not supported"};function h2(e,t){return hV((h0(e),e.subarray(2,-4)),t)}var h3="undefined"!=typeof TextDecoder&&new TextDecoder;try{h3.decode(h1,{stream:!0})}catch(e){}function h4(e,t,r){let i=r.length-e-1;if(t>=r[i])return i-1;if(t<=r[e])return e;let n=e,a=i,o=Math.floor((n+a)/2);for(;t<r[o]||t>=r[o+1];)t<r[o]?a=o:n=o,o=Math.floor((n+a)/2);return o}class h5 extends eT.Curve{constructor(e,t,r,i,n){super(),this.degree=e,this.knots=t,this.controlPoints=[],this.startKnot=i||0,this.endKnot=n||this.knots.length-1;for(let e=0;e<r.length;++e){let t=r[e];this.controlPoints[e]=new eT.Vector4(t.x,t.y,t.z,t.w)}}getPoint(e,t){let r=t||new eT.Vector3,i=this.knots[this.startKnot]+e*(this.knots[this.endKnot]-this.knots[this.startKnot]),n=function(e,t,r,i){let n=h4(e,i,t),a=function(e,t,r,i){let n=[],a=[],o=[];n[0]=1;for(let s=1;s<=r;++s){a[s]=t-i[e+1-s],o[s]=i[e+s]-t;let r=0;for(let e=0;e<s;++e){let t=o[e+1],i=a[s-e],l=n[e]/(t+i);n[e]=r+t*l,r=i*l}n[s]=r}return n}(n,i,e,t),o=new eT.Vector4(0,0,0,0);for(let t=0;t<=e;++t){let i=r[n-e+t],s=a[t],l=i.w*s;o.x+=i.x*l,o.y+=i.y*l,o.z+=i.z*l,o.w+=i.w*s}return o}(this.degree,this.knots,this.controlPoints,i);return 1!=n.w&&n.divideScalar(n.w),r.set(n.x,n.y,n.z)}getTangent(e,t){var r;let i=t||new eT.Vector3,n=this.knots[0]+e*(this.knots[this.knots.length-1]-this.knots[0]),a=(r=this.degree,function(e){let t=e.length,r=[],i=[];for(let n=0;n<t;++n){let t=e[n];r[n]=new eT.Vector3(t.x,t.y,t.z),i[n]=t.w}let n=[];for(let e=0;e<t;++e){let t=r[e].clone();for(let r=1;r<=e;++r)t.sub(n[e-r].clone().multiplyScalar(function(e,t){let r=1;for(let t=2;t<=e;++t)r*=t;let i=1;for(let e=2;e<=t;++e)i*=e;for(let r=2;r<=e-t;++r)i*=r;return r/i}(e,r)*i[r]));n[e]=t.divideScalar(i[0])}return n}(function(e,t,r,i,n){let a=n<e?n:e,o=[],s=h4(e,i,t),l=function(e,t,r,i,n){let a=[];for(let e=0;e<=r;++e)a[e]=0;let o=[];for(let e=0;e<=i;++e)o[e]=a.slice(0);let s=[];for(let e=0;e<=r;++e)s[e]=a.slice(0);s[0][0]=1;let l=a.slice(0),c=a.slice(0);for(let i=1;i<=r;++i){l[i]=t-n[e+1-i],c[i]=n[e+i]-t;let r=0;for(let e=0;e<i;++e){let t=c[e+1],n=l[i-e];s[i][e]=t+n;let a=s[e][i-1]/s[i][e];s[e][i]=r+t*a,r=n*a}s[i][i]=r}for(let e=0;e<=r;++e)o[0][e]=s[e][r];for(let e=0;e<=r;++e){let t=0,n=1,l=[];for(let e=0;e<=r;++e)l[e]=a.slice(0);l[0][0]=1;for(let a=1;a<=i;++a){let i=0,c=e-a,u=r-a;e>=a&&(l[n][0]=l[t][0]/s[u+1][c],i=l[n][0]*s[c][u]);let h=c>=-1?1:-c,A=e-1<=u?a-1:r-e;for(let e=h;e<=A;++e)l[n][e]=(l[t][e]-l[t][e-1])/s[u+1][c+e],i+=l[n][e]*s[c+e][u];e<=u&&(l[n][a]=-l[t][a-1]/s[u+1][e],i+=l[n][a]*s[e][u]),o[a][e]=i;let d=t;t=n,n=d}}let u=r;for(let e=1;e<=i;++e){for(let t=0;t<=r;++t)o[e][t]*=u;u*=r-e}return o}(s,i,e,a,t),c=[];for(let e=0;e<r.length;++e){let t=r[e].clone(),i=t.w;t.x*=i,t.y*=i,t.z*=i,c[e]=t}for(let t=0;t<=a;++t){let r=c[s-e].clone().multiplyScalar(l[t][0]);for(let i=1;i<=e;++i)r.add(c[s-e+i].clone().multiplyScalar(l[t][i]));o[t]=r}for(let e=a+1;e<=n+1;++e)o[e]=new eT.Vector4(0,0,0);return o}(r,this.knots,this.controlPoints,n,1)));return i.copy(a[1]).normalize(),i}}class h6 extends eT.Loader{constructor(e){super(e)}load(e,t,r,i){let n=this,a=""===n.path?eT.LoaderUtils.extractUrlBase(e):n.path,o=new eT.FileLoader(this.manager);o.setPath(n.path),o.setResponseType("arraybuffer"),o.setRequestHeader(n.requestHeader),o.setWithCredentials(n.withCredentials),o.load(e,function(r){try{t(n.parse(r,a))}catch(t){i?i(t):console.error(t),n.manager.itemError(e)}},r,i)}parse(e,t){if(function(e){let t="Kaydara FBX Binary  \x00";return e.byteLength>=t.length&&t===Ad(e,0,t.length)}(e))S=new At().parse(e);else{let t=Ad(e);if(!function(e){let t=["K","a","y","d","a","r","a","\\","F","B","X","\\","B","i","n","a","r","y","\\","\\"],r=0;for(let i=0;i<t.length;++i)if(function(t){let i=e[t-1];return e=e.slice(r+t),r++,i}(1)===t[i])return!1;return!0}(t))throw Error("THREE.FBXLoader: Unknown format.");if(7e3>An(t))throw Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+An(t));S=new Ae().parse(t)}return new h8(new eT.TextureLoader(this.manager).setPath(this.resourcePath||t).setCrossOrigin(this.crossOrigin),this.manager).parse(S)}}class h8{constructor(e,t){this.textureLoader=e,this.manager=t}parse(){D=this.parseConnections();let e=this.parseImages(),t=this.parseTextures(e),r=this.parseMaterials(t),i=this.parseDeformers(),n=new h9().parse(i);return this.parseScene(i,n,r),T}parseConnections(){let e=new Map;return"Connections"in S&&S.Connections.connections.forEach(function(t){let r=t[0],i=t[1],n=t[2];e.has(r)||e.set(r,{parents:[],children:[]}),e.get(r).parents.push({ID:i,relationship:n}),e.has(i)||e.set(i,{parents:[],children:[]}),e.get(i).children.push({ID:r,relationship:n})}),e}parseImages(){let e={},t={};if("Video"in S.Objects){let r=S.Objects.Video;for(let i in r){let n=r[i];if(e[parseInt(i)]=n.RelativeFilename||n.Filename,"Content"in n){let e=n.Content instanceof ArrayBuffer&&n.Content.byteLength>0,a="string"==typeof n.Content&&""!==n.Content;if(e||a){let e=this.parseImage(r[i]);t[n.RelativeFilename||n.Filename]=e}}}}for(let r in e){let i=e[r];void 0!==t[i]?e[r]=t[i]:e[r]=e[r].split("\\").pop()}return e}parseImage(e){let t;let r=e.Content,i=e.RelativeFilename||e.Filename,n=i.slice(i.lastIndexOf(".")+1).toLowerCase();switch(n){case"bmp":t="image/bmp";break;case"jpg":case"jpeg":t="image/jpeg";break;case"png":t="image/png";break;case"tif":t="image/tiff";break;case"tga":null===this.manager.getHandler(".tga")&&console.warn("FBXLoader: TGA loader not found, skipping ",i),t="image/tga";break;default:console.warn('FBXLoader: Image type "'+n+'" is not supported.');return}if("string"==typeof r)return"data:"+t+";base64,"+r;{let e=new Uint8Array(r);return window.URL.createObjectURL(new Blob([e],{type:t}))}}parseTextures(e){let t=new Map;if("Texture"in S.Objects){let r=S.Objects.Texture;for(let i in r){let n=this.parseTexture(r[i],e);t.set(parseInt(i),n)}}return t}parseTexture(e,t){let r=this.loadTexture(e,t);r.ID=e.id,r.name=e.attrName;let i=e.WrapModeU,n=e.WrapModeV,a=void 0!==i?i.value:0,o=void 0!==n?n.value:0;if(r.wrapS=0===a?eT.RepeatWrapping:eT.ClampToEdgeWrapping,r.wrapT=0===o?eT.RepeatWrapping:eT.ClampToEdgeWrapping,"Scaling"in e){let t=e.Scaling.value;r.repeat.x=t[0],r.repeat.y=t[1]}return r}loadTexture(e,t){let r,i;let n=this.textureLoader.path,a=D.get(e.id).children;void 0!==a&&a.length>0&&void 0!==t[a[0].ID]&&(0===(r=t[a[0].ID]).indexOf("blob:")||0===r.indexOf("data:"))&&this.textureLoader.setPath(void 0);let o=e.FileName.slice(-3).toLowerCase();if("tga"===o){let t=this.manager.getHandler(".tga");null===t?(console.warn("FBXLoader: TGA loader not found, creating placeholder texture for",e.RelativeFilename),i=new eT.Texture):(t.setPath(this.textureLoader.path),i=t.load(r))}else"psd"===o?(console.warn("FBXLoader: PSD textures are not supported, creating placeholder texture for",e.RelativeFilename),i=new eT.Texture):i=this.textureLoader.load(r);return this.textureLoader.setPath(n),i}parseMaterials(e){let t=new Map;if("Material"in S.Objects){let r=S.Objects.Material;for(let i in r){let n=this.parseMaterial(r[i],e);null!==n&&t.set(parseInt(i),n)}}return t}parseMaterial(e,t){let r;let i=e.id,n=e.attrName,a=e.ShadingModel;if("object"==typeof a&&(a=a.value),!D.has(i))return null;let o=this.parseParameters(e,t,i);switch(a.toLowerCase()){case"phong":r=new eT.MeshPhongMaterial;break;case"lambert":r=new eT.MeshLambertMaterial;break;default:console.warn('THREE.FBXLoader: unknown material type "%s". Defaulting to MeshPhongMaterial.',a),r=new eT.MeshPhongMaterial}return r.setValues(o),r.name=n,r}parseParameters(e,t,r){let i={};e.BumpFactor&&(i.bumpScale=e.BumpFactor.value),e.Diffuse?i.color=new eT.Color().fromArray(e.Diffuse.value):e.DiffuseColor&&("Color"===e.DiffuseColor.type||"ColorRGB"===e.DiffuseColor.type)&&(i.color=new eT.Color().fromArray(e.DiffuseColor.value)),e.DisplacementFactor&&(i.displacementScale=e.DisplacementFactor.value),e.Emissive?i.emissive=new eT.Color().fromArray(e.Emissive.value):e.EmissiveColor&&("Color"===e.EmissiveColor.type||"ColorRGB"===e.EmissiveColor.type)&&(i.emissive=new eT.Color().fromArray(e.EmissiveColor.value)),e.EmissiveFactor&&(i.emissiveIntensity=parseFloat(e.EmissiveFactor.value)),e.Opacity&&(i.opacity=parseFloat(e.Opacity.value)),i.opacity<1&&(i.transparent=!0),e.ReflectionFactor&&(i.reflectivity=e.ReflectionFactor.value),e.Shininess&&(i.shininess=e.Shininess.value),e.Specular?i.specular=new eT.Color().fromArray(e.Specular.value):e.SpecularColor&&"Color"===e.SpecularColor.type&&(i.specular=new eT.Color().fromArray(e.SpecularColor.value));let n=this;return D.get(r).children.forEach(function(e){let r=e.relationship;switch(r){case"Bump":i.bumpMap=n.getTexture(t,e.ID);break;case"Maya|TEX_ao_map":i.aoMap=n.getTexture(t,e.ID);break;case"DiffuseColor":case"Maya|TEX_color_map":i.map=n.getTexture(t,e.ID),void 0!==i.map&&("colorSpace"in i.map?i.map.colorSpace="srgb":i.map.encoding=3001);break;case"DisplacementColor":i.displacementMap=n.getTexture(t,e.ID);break;case"EmissiveColor":i.emissiveMap=n.getTexture(t,e.ID),void 0!==i.emissiveMap&&("colorSpace"in i.emissiveMap?i.emissiveMap.colorSpace="srgb":i.emissiveMap.encoding=3001);break;case"NormalMap":case"Maya|TEX_normal_map":i.normalMap=n.getTexture(t,e.ID);break;case"ReflectionColor":i.envMap=n.getTexture(t,e.ID),void 0!==i.envMap&&(i.envMap.mapping=eT.EquirectangularReflectionMapping,"colorSpace"in i.envMap?i.envMap.colorSpace="srgb":i.envMap.encoding=3001);break;case"SpecularColor":i.specularMap=n.getTexture(t,e.ID),void 0!==i.specularMap&&("colorSpace"in i.specularMap?i.specularMap.colorSpace="srgb":i.specularMap.encoding=3001);break;case"TransparentColor":case"TransparencyFactor":i.alphaMap=n.getTexture(t,e.ID),i.transparent=!0;break;default:console.warn("THREE.FBXLoader: %s map is not supported in three.js, skipping texture.",r)}}),i}getTexture(e,t){return"LayeredTexture"in S.Objects&&t in S.Objects.LayeredTexture&&(console.warn("THREE.FBXLoader: layered textures are not supported in three.js. Discarding all but first layer."),t=D.get(t).children[0].ID),e.get(t)}parseDeformers(){let e={},t={};if("Deformer"in S.Objects){let r=S.Objects.Deformer;for(let i in r){let n=r[i],a=D.get(parseInt(i));if("Skin"===n.attrType){let t=this.parseSkeleton(a,r);t.ID=i,a.parents.length>1&&console.warn("THREE.FBXLoader: skeleton attached to more than one geometry is not supported."),t.geometryID=a.parents[0].ID,e[i]=t}else if("BlendShape"===n.attrType){let e={id:i};e.rawTargets=this.parseMorphTargets(a,r),e.id=i,a.parents.length>1&&console.warn("THREE.FBXLoader: morph target attached to more than one geometry is not supported."),t[i]=e}}}return{skeletons:e,morphTargets:t}}parseSkeleton(e,t){let r=[];return e.children.forEach(function(e){let i=t[e.ID];if("Cluster"!==i.attrType)return;let n={ID:e.ID,indices:[],weights:[],transformLink:new eT.Matrix4().fromArray(i.TransformLink.a)};"Indexes"in i&&(n.indices=i.Indexes.a,n.weights=i.Weights.a),r.push(n)}),{rawBones:r,bones:[]}}parseMorphTargets(e,t){let r=[];for(let i=0;i<e.children.length;i++){let n=e.children[i],a=t[n.ID],o={name:a.attrName,initialWeight:a.DeformPercent,id:a.id,fullWeights:a.FullWeights.a};if("BlendShapeChannel"!==a.attrType)return;o.geoID=D.get(parseInt(n.ID)).children.filter(function(e){return void 0===e.relationship})[0].ID,r.push(o)}return r}parseScene(e,t,r){T=new eT.Group;let i=this.parseModels(e.skeletons,t,r),n=S.Objects.Model,a=this;i.forEach(function(e){let t=n[e.ID];a.setLookAtProperties(e,t),D.get(e.ID).parents.forEach(function(t){let r=i.get(t.ID);void 0!==r&&r.add(e)}),null===e.parent&&T.add(e)}),this.bindSkeleton(e.skeletons,t,i),this.createAmbientLight(),T.traverse(function(e){if(e.userData.transformData){e.parent&&(e.userData.transformData.parentMatrix=e.parent.matrix,e.userData.transformData.parentMatrixWorld=e.parent.matrixWorld);let t=Au(e.userData.transformData);e.applyMatrix4(t),e.updateWorldMatrix()}});let o=new h7().parse();1===T.children.length&&T.children[0].isGroup&&(T.children[0].animations=o,T=T.children[0]),T.animations=o}parseModels(e,t,r){let i=new Map,n=S.Objects.Model;for(let a in n){let o=parseInt(a),s=n[a],l=D.get(o),c=this.buildSkeleton(l,e,o,s.attrName);if(!c){switch(s.attrType){case"Camera":c=this.createCamera(l);break;case"Light":c=this.createLight(l);break;case"Mesh":c=this.createMesh(l,t,r);break;case"NurbsCurve":c=this.createCurve(l,t);break;case"LimbNode":case"Root":c=new eT.Bone;break;default:c=new eT.Group}c.name=s.attrName?eT.PropertyBinding.sanitizeNodeName(s.attrName):"",c.ID=o}this.getTransformData(c,s),i.set(o,c)}return i}buildSkeleton(e,t,r,i){let n=null;return e.parents.forEach(function(e){for(let a in t){let o=t[a];o.rawBones.forEach(function(t,a){if(t.ID===e.ID){let e=n;(n=new eT.Bone).matrixWorld.copy(t.transformLink),n.name=i?eT.PropertyBinding.sanitizeNodeName(i):"",n.ID=r,o.bones[a]=n,null!==e&&n.add(e)}})}}),n}createCamera(e){let t,r;if(e.children.forEach(function(e){let t=S.Objects.NodeAttribute[e.ID];void 0!==t&&(r=t)}),void 0===r)t=new eT.Object3D;else{let e=0;void 0!==r.CameraProjectionType&&1===r.CameraProjectionType.value&&(e=1);let i=1;void 0!==r.NearPlane&&(i=r.NearPlane.value/1e3);let n=1e3;void 0!==r.FarPlane&&(n=r.FarPlane.value/1e3);let a=window.innerWidth,o=window.innerHeight;void 0!==r.AspectWidth&&void 0!==r.AspectHeight&&(a=r.AspectWidth.value,o=r.AspectHeight.value);let s=a/o,l=45;void 0!==r.FieldOfView&&(l=r.FieldOfView.value);let c=r.FocalLength?r.FocalLength.value:null;switch(e){case 0:t=new eT.PerspectiveCamera(l,s,i,n),null!==c&&t.setFocalLength(c);break;case 1:t=new eT.OrthographicCamera(-a/2,a/2,o/2,-o/2,i,n);break;default:console.warn("THREE.FBXLoader: Unknown camera type "+e+"."),t=new eT.Object3D}}return t}createLight(e){let t,r;if(e.children.forEach(function(e){let t=S.Objects.NodeAttribute[e.ID];void 0!==t&&(r=t)}),void 0===r)t=new eT.Object3D;else{let e;e=void 0===r.LightType?0:r.LightType.value;let i=16777215;void 0!==r.Color&&(i=new eT.Color().fromArray(r.Color.value));let n=void 0===r.Intensity?1:r.Intensity.value/100;void 0!==r.CastLightOnObject&&0===r.CastLightOnObject.value&&(n=0);let a=0;switch(void 0!==r.FarAttenuationEnd&&(a=void 0!==r.EnableFarAttenuation&&0===r.EnableFarAttenuation.value?0:r.FarAttenuationEnd.value),e){case 0:t=new eT.PointLight(i,n,a,1);break;case 1:t=new eT.DirectionalLight(i,n);break;case 2:let o=Math.PI/3;void 0!==r.InnerAngle&&(o=eT.MathUtils.degToRad(r.InnerAngle.value));let s=0;void 0!==r.OuterAngle&&(s=Math.max(s=eT.MathUtils.degToRad(r.OuterAngle.value),1)),t=new eT.SpotLight(i,n,a,o,s,1);break;default:console.warn("THREE.FBXLoader: Unknown light type "+r.LightType.value+", defaulting to a PointLight."),t=new eT.PointLight(i,n)}void 0!==r.CastShadows&&1===r.CastShadows.value&&(t.castShadow=!0)}return t}createMesh(e,t,r){let i;let n=null,a=null,o=[];return e.children.forEach(function(e){t.has(e.ID)&&(n=t.get(e.ID)),r.has(e.ID)&&o.push(r.get(e.ID))}),o.length>1?a=o:o.length>0?a=o[0]:(a=new eT.MeshPhongMaterial({color:13421772}),o.push(a)),"color"in n.attributes&&o.forEach(function(e){e.vertexColors=!0}),n.FBX_Deformer?(i=new eT.SkinnedMesh(n,a)).normalizeSkinWeights():i=new eT.Mesh(n,a),i}createCurve(e,t){let r=e.children.reduce(function(e,r){return t.has(r.ID)&&(e=t.get(r.ID)),e},null),i=new eT.LineBasicMaterial({color:3342591,linewidth:1});return new eT.Line(r,i)}getTransformData(e,t){let r={};"InheritType"in t&&(r.inheritType=parseInt(t.InheritType.value)),"RotationOrder"in t?r.eulerOrder=Ah(t.RotationOrder.value):r.eulerOrder="ZYX","Lcl_Translation"in t&&(r.translation=t.Lcl_Translation.value),"PreRotation"in t&&(r.preRotation=t.PreRotation.value),"Lcl_Rotation"in t&&(r.rotation=t.Lcl_Rotation.value),"PostRotation"in t&&(r.postRotation=t.PostRotation.value),"Lcl_Scaling"in t&&(r.scale=t.Lcl_Scaling.value),"ScalingOffset"in t&&(r.scalingOffset=t.ScalingOffset.value),"ScalingPivot"in t&&(r.scalingPivot=t.ScalingPivot.value),"RotationOffset"in t&&(r.rotationOffset=t.RotationOffset.value),"RotationPivot"in t&&(r.rotationPivot=t.RotationPivot.value),e.userData.transformData=r}setLookAtProperties(e,t){"LookAtProperty"in t&&D.get(e.ID).children.forEach(function(t){if("LookAtProperty"===t.relationship){let r=S.Objects.Model[t.ID];if("Lcl_Translation"in r){let t=r.Lcl_Translation.value;void 0!==e.target?(e.target.position.fromArray(t),T.add(e.target)):e.lookAt(new eT.Vector3().fromArray(t))}}})}bindSkeleton(e,t,r){let i=this.parsePoseNodes();for(let n in e){let a=e[n];D.get(parseInt(a.ID)).parents.forEach(function(e){if(t.has(e.ID)){let t=e.ID;D.get(t).parents.forEach(function(e){r.has(e.ID)&&r.get(e.ID).bind(new eT.Skeleton(a.bones),i[e.ID])})}})}}parsePoseNodes(){let e={};if("Pose"in S.Objects){let t=S.Objects.Pose;for(let r in t)if("BindPose"===t[r].attrType&&t[r].NbPoseNodes>0){let i=t[r].PoseNode;Array.isArray(i)?i.forEach(function(t){e[t.Node]=new eT.Matrix4().fromArray(t.Matrix.a)}):e[i.Node]=new eT.Matrix4().fromArray(i.Matrix.a)}}return e}createAmbientLight(){if("GlobalSettings"in S&&"AmbientColor"in S.GlobalSettings){let e=S.GlobalSettings.AmbientColor.value,t=e[0],r=e[1],i=e[2];if(0!==t||0!==r||0!==i){let e=new eT.Color(t,r,i);T.add(new eT.AmbientLight(e,1))}}}}class h9{parse(e){let t=new Map;if("Geometry"in S.Objects){let r=S.Objects.Geometry;for(let i in r){let n=D.get(parseInt(i)),a=this.parseGeometry(n,r[i],e);t.set(parseInt(i),a)}}return t}parseGeometry(e,t,r){switch(t.attrType){case"Mesh":return this.parseMeshGeometry(e,t,r);case"NurbsCurve":return this.parseNurbsGeometry(t)}}parseMeshGeometry(e,t,r){let i=r.skeletons,n=[],a=e.parents.map(function(e){return S.Objects.Model[e.ID]});if(0===a.length)return;let o=e.children.reduce(function(e,t){return void 0!==i[t.ID]&&(e=i[t.ID]),e},null);e.children.forEach(function(e){void 0!==r.morphTargets[e.ID]&&n.push(r.morphTargets[e.ID])});let s=a[0],l={};"RotationOrder"in s&&(l.eulerOrder=Ah(s.RotationOrder.value)),"InheritType"in s&&(l.inheritType=parseInt(s.InheritType.value)),"GeometricTranslation"in s&&(l.translation=s.GeometricTranslation.value),"GeometricRotation"in s&&(l.rotation=s.GeometricRotation.value),"GeometricScaling"in s&&(l.scale=s.GeometricScaling.value);let c=Au(l);return this.genGeometry(t,o,n,c)}genGeometry(e,t,r,i){let n=new eT.BufferGeometry;e.attrName&&(n.name=e.attrName);let a=this.parseGeoNode(e,t),o=this.genBuffers(a),s=new eT.Float32BufferAttribute(o.vertex,3);if(s.applyMatrix4(i),n.setAttribute("position",s),o.colors.length>0&&n.setAttribute("color",new eT.Float32BufferAttribute(o.colors,3)),t&&(n.setAttribute("skinIndex",new eT.Uint16BufferAttribute(o.weightsIndices,4)),n.setAttribute("skinWeight",new eT.Float32BufferAttribute(o.vertexWeights,4)),n.FBX_Deformer=t),o.normal.length>0){let e=new eT.Matrix3().getNormalMatrix(i),t=new eT.Float32BufferAttribute(o.normal,3);t.applyNormalMatrix(e),n.setAttribute("normal",t)}if(o.uvs.forEach(function(e,t){"uv2"===om&&t++;let r=0===t?"uv":`uv${t}`;n.setAttribute(r,new eT.Float32BufferAttribute(o.uvs[t],2))}),a.material&&"AllSame"!==a.material.mappingType){let e=o.materialIndex[0],t=0;if(o.materialIndex.forEach(function(r,i){r!==e&&(n.addGroup(t,i-t,e),e=r,t=i)}),n.groups.length>0){let t=n.groups[n.groups.length-1],r=t.start+t.count;r!==o.materialIndex.length&&n.addGroup(r,o.materialIndex.length-r,e)}0===n.groups.length&&n.addGroup(0,o.materialIndex.length,o.materialIndex[0])}return this.addMorphTargets(n,e,r,i),n}parseGeoNode(e,t){let r={};if(r.vertexPositions=void 0!==e.Vertices?e.Vertices.a:[],r.vertexIndices=void 0!==e.PolygonVertexIndex?e.PolygonVertexIndex.a:[],e.LayerElementColor&&(r.color=this.parseVertexColors(e.LayerElementColor[0])),e.LayerElementMaterial&&(r.material=this.parseMaterialIndices(e.LayerElementMaterial[0])),e.LayerElementNormal&&(r.normal=this.parseNormals(e.LayerElementNormal[0])),e.LayerElementUV){r.uv=[];let t=0;for(;e.LayerElementUV[t];)e.LayerElementUV[t].UV&&r.uv.push(this.parseUVs(e.LayerElementUV[t])),t++}return r.weightTable={},null!==t&&(r.skeleton=t,t.rawBones.forEach(function(e,t){e.indices.forEach(function(i,n){void 0===r.weightTable[i]&&(r.weightTable[i]=[]),r.weightTable[i].push({id:t,weight:e.weights[n]})})})),r}genBuffers(e){let t={vertex:[],normal:[],colors:[],uvs:[],materialIndex:[],vertexWeights:[],weightsIndices:[]},r=0,i=0,n=!1,a=[],o=[],s=[],l=[],c=[],u=[],h=this;return e.vertexIndices.forEach(function(A,d){let f;let m=!1;A<0&&(A^=-1,m=!0);let p=[],g=[];if(a.push(3*A,3*A+1,3*A+2),e.color){let t=As(d,r,A,e.color);s.push(t[0],t[1],t[2])}if(e.skeleton){if(void 0!==e.weightTable[A]&&e.weightTable[A].forEach(function(e){g.push(e.weight),p.push(e.id)}),g.length>4){n||(console.warn("THREE.FBXLoader: Vertex has more than 4 skinning weights assigned to vertex. Deleting additional weights."),n=!0);let e=[0,0,0,0],t=[0,0,0,0];g.forEach(function(r,i){let n=r,a=p[i];t.forEach(function(t,r,i){if(n>t){i[r]=n,n=t;let o=e[r];e[r]=a,a=o}})}),p=e,g=t}for(;g.length<4;)g.push(0),p.push(0);for(let e=0;e<4;++e)c.push(g[e]),u.push(p[e])}if(e.normal){let t=As(d,r,A,e.normal);o.push(t[0],t[1],t[2])}e.material&&"AllSame"!==e.material.mappingType&&(f=As(d,r,A,e.material)[0]),e.uv&&e.uv.forEach(function(e,t){let i=As(d,r,A,e);void 0===l[t]&&(l[t]=[]),l[t].push(i[0]),l[t].push(i[1])}),i++,m&&(h.genFace(t,e,a,f,o,s,l,c,u,i),r++,i=0,a=[],o=[],s=[],l=[],c=[],u=[])}),t}genFace(e,t,r,i,n,a,o,s,l,c){for(let u=2;u<c;u++)e.vertex.push(t.vertexPositions[r[0]]),e.vertex.push(t.vertexPositions[r[1]]),e.vertex.push(t.vertexPositions[r[2]]),e.vertex.push(t.vertexPositions[r[(u-1)*3]]),e.vertex.push(t.vertexPositions[r[(u-1)*3+1]]),e.vertex.push(t.vertexPositions[r[(u-1)*3+2]]),e.vertex.push(t.vertexPositions[r[3*u]]),e.vertex.push(t.vertexPositions[r[3*u+1]]),e.vertex.push(t.vertexPositions[r[3*u+2]]),t.skeleton&&(e.vertexWeights.push(s[0]),e.vertexWeights.push(s[1]),e.vertexWeights.push(s[2]),e.vertexWeights.push(s[3]),e.vertexWeights.push(s[(u-1)*4]),e.vertexWeights.push(s[(u-1)*4+1]),e.vertexWeights.push(s[(u-1)*4+2]),e.vertexWeights.push(s[(u-1)*4+3]),e.vertexWeights.push(s[4*u]),e.vertexWeights.push(s[4*u+1]),e.vertexWeights.push(s[4*u+2]),e.vertexWeights.push(s[4*u+3]),e.weightsIndices.push(l[0]),e.weightsIndices.push(l[1]),e.weightsIndices.push(l[2]),e.weightsIndices.push(l[3]),e.weightsIndices.push(l[(u-1)*4]),e.weightsIndices.push(l[(u-1)*4+1]),e.weightsIndices.push(l[(u-1)*4+2]),e.weightsIndices.push(l[(u-1)*4+3]),e.weightsIndices.push(l[4*u]),e.weightsIndices.push(l[4*u+1]),e.weightsIndices.push(l[4*u+2]),e.weightsIndices.push(l[4*u+3])),t.color&&(e.colors.push(a[0]),e.colors.push(a[1]),e.colors.push(a[2]),e.colors.push(a[(u-1)*3]),e.colors.push(a[(u-1)*3+1]),e.colors.push(a[(u-1)*3+2]),e.colors.push(a[3*u]),e.colors.push(a[3*u+1]),e.colors.push(a[3*u+2])),t.material&&"AllSame"!==t.material.mappingType&&(e.materialIndex.push(i),e.materialIndex.push(i),e.materialIndex.push(i)),t.normal&&(e.normal.push(n[0]),e.normal.push(n[1]),e.normal.push(n[2]),e.normal.push(n[(u-1)*3]),e.normal.push(n[(u-1)*3+1]),e.normal.push(n[(u-1)*3+2]),e.normal.push(n[3*u]),e.normal.push(n[3*u+1]),e.normal.push(n[3*u+2])),t.uv&&t.uv.forEach(function(t,r){void 0===e.uvs[r]&&(e.uvs[r]=[]),e.uvs[r].push(o[r][0]),e.uvs[r].push(o[r][1]),e.uvs[r].push(o[r][(u-1)*2]),e.uvs[r].push(o[r][(u-1)*2+1]),e.uvs[r].push(o[r][2*u]),e.uvs[r].push(o[r][2*u+1])})}addMorphTargets(e,t,r,i){if(0===r.length)return;e.morphTargetsRelative=!0,e.morphAttributes.position=[];let n=this;r.forEach(function(r){r.rawTargets.forEach(function(r){let a=S.Objects.Geometry[r.geoID];void 0!==a&&n.genMorphGeometry(e,t,a,i,r.name)})})}genMorphGeometry(e,t,r,i,n){let a=void 0!==t.PolygonVertexIndex?t.PolygonVertexIndex.a:[],o=void 0!==r.Vertices?r.Vertices.a:[],s=void 0!==r.Indexes?r.Indexes.a:[],l=3*e.attributes.position.count,c=new Float32Array(l);for(let e=0;e<s.length;e++){let t=3*s[e];c[t]=o[3*e],c[t+1]=o[3*e+1],c[t+2]=o[3*e+2]}let u=this.genBuffers({vertexIndices:a,vertexPositions:c}),h=new eT.Float32BufferAttribute(u.vertex,3);h.name=n||r.attrName,h.applyMatrix4(i),e.morphAttributes.position.push(h)}parseNormals(e){let t=e.MappingInformationType,r=e.ReferenceInformationType,i=e.Normals.a,n=[];return"IndexToDirect"===r&&("NormalIndex"in e?n=e.NormalIndex.a:"NormalsIndex"in e&&(n=e.NormalsIndex.a)),{dataSize:3,buffer:i,indices:n,mappingType:t,referenceType:r}}parseUVs(e){let t=e.MappingInformationType,r=e.ReferenceInformationType,i=e.UV.a,n=[];return"IndexToDirect"===r&&(n=e.UVIndex.a),{dataSize:2,buffer:i,indices:n,mappingType:t,referenceType:r}}parseVertexColors(e){let t=e.MappingInformationType,r=e.ReferenceInformationType,i=e.Colors.a,n=[];return"IndexToDirect"===r&&(n=e.ColorIndex.a),{dataSize:4,buffer:i,indices:n,mappingType:t,referenceType:r}}parseMaterialIndices(e){let t=e.MappingInformationType,r=e.ReferenceInformationType;if("NoMappingInformation"===t)return{dataSize:1,buffer:[0],indices:[0],mappingType:"AllSame",referenceType:r};let i=e.Materials.a,n=[];for(let e=0;e<i.length;++e)n.push(e);return{dataSize:1,buffer:i,indices:n,mappingType:t,referenceType:r}}parseNurbsGeometry(e){let t,r;if(void 0===h5)return console.error("THREE.FBXLoader: The loader relies on NURBSCurve for any nurbs present in the model. Nurbs will show up as empty geometry."),new eT.BufferGeometry;let i=parseInt(e.Order);if(isNaN(i))return console.error("THREE.FBXLoader: Invalid Order %s given for geometry ID: %s",e.Order,e.id),new eT.BufferGeometry;let n=i-1,a=e.KnotVector.a,o=[],s=e.Points.a;for(let e=0,t=s.length;e<t;e+=4)o.push(new eT.Vector4().fromArray(s,e));if("Closed"===e.Form)o.push(o[0]);else if("Periodic"===e.Form){t=n,r=a.length-1-t;for(let e=0;e<n;++e)o.push(o[e])}let l=new h5(n,a,o,t,r).getPoints(12*o.length);return new eT.BufferGeometry().setFromPoints(l)}}class h7{parse(){let e=[],t=this.parseClips();if(void 0!==t)for(let r in t){let i=t[r],n=this.addClip(i);e.push(n)}return e}parseClips(){if(void 0===S.Objects.AnimationCurve)return;let e=this.parseAnimationCurveNodes();this.parseAnimationCurves(e);let t=this.parseAnimationLayers(e);return this.parseAnimStacks(t)}parseAnimationCurveNodes(){let e=S.Objects.AnimationCurveNode,t=new Map;for(let r in e){let i=e[r];if(null!==i.attrName.match(/S|R|T|DeformPercent/)){let e={id:i.id,attr:i.attrName,curves:{}};t.set(e.id,e)}}return t}parseAnimationCurves(e){let t=S.Objects.AnimationCurve;for(let r in t){let i={id:t[r].id,times:t[r].KeyTime.a.map(Aa),values:t[r].KeyValueFloat.a},n=D.get(i.id);if(void 0!==n){let t=n.parents[0].ID,r=n.parents[0].relationship;r.match(/X/)?e.get(t).curves.x=i:r.match(/Y/)?e.get(t).curves.y=i:r.match(/Z/)?e.get(t).curves.z=i:r.match(/d|DeformPercent/)&&e.has(t)&&(e.get(t).curves.morph=i)}}}parseAnimationLayers(e){let t=S.Objects.AnimationLayer,r=new Map;for(let i in t){let t=[],n=D.get(parseInt(i));void 0!==n&&(n.children.forEach(function(r,i){if(e.has(r.ID)){let n=e.get(r.ID);if(void 0!==n.curves.x||void 0!==n.curves.y||void 0!==n.curves.z){if(void 0===t[i]){let e=D.get(r.ID).parents.filter(function(e){return void 0!==e.relationship})[0].ID;if(void 0!==e){let n=S.Objects.Model[e.toString()];if(void 0===n){console.warn("THREE.FBXLoader: Encountered a unused curve.",r);return}let a={modelName:n.attrName?eT.PropertyBinding.sanitizeNodeName(n.attrName):"",ID:n.id,initialPosition:[0,0,0],initialRotation:[0,0,0],initialScale:[1,1,1]};T.traverse(function(e){e.ID===n.id&&(a.transform=e.matrix,e.userData.transformData&&(a.eulerOrder=e.userData.transformData.eulerOrder))}),a.transform||(a.transform=new eT.Matrix4),"PreRotation"in n&&(a.preRotation=n.PreRotation.value),"PostRotation"in n&&(a.postRotation=n.PostRotation.value),t[i]=a}}t[i]&&(t[i][n.attr]=n)}else if(void 0!==n.curves.morph){if(void 0===t[i]){let e=D.get(r.ID).parents.filter(function(e){return void 0!==e.relationship})[0].ID,n=D.get(e).parents[0].ID,a=D.get(n).parents[0].ID,o=D.get(a).parents[0].ID,s=S.Objects.Model[o],l={modelName:s.attrName?eT.PropertyBinding.sanitizeNodeName(s.attrName):"",morphName:S.Objects.Deformer[e].attrName};t[i]=l}t[i][n.attr]=n}}}),r.set(parseInt(i),t))}return r}parseAnimStacks(e){let t=S.Objects.AnimationStack,r={};for(let i in t){let n=D.get(parseInt(i)).children;n.length>1&&console.warn("THREE.FBXLoader: Encountered an animation stack with multiple layers, this is currently not supported. Ignoring subsequent layers.");let a=e.get(n[0].ID);r[i]={name:t[i].attrName,layer:a}}return r}addClip(e){let t=[],r=this;return e.layer.forEach(function(e){t=t.concat(r.generateTracks(e))}),new eT.AnimationClip(e.name,-1,t)}generateTracks(e){let t=[],r=new eT.Vector3,i=new eT.Quaternion,n=new eT.Vector3;if(e.transform&&e.transform.decompose(r,i,n),r=r.toArray(),i=new eT.Euler().setFromQuaternion(i,e.eulerOrder).toArray(),n=n.toArray(),void 0!==e.T&&Object.keys(e.T.curves).length>0){let i=this.generateVectorTrack(e.modelName,e.T.curves,r,"position");void 0!==i&&t.push(i)}if(void 0!==e.R&&Object.keys(e.R.curves).length>0){let r=this.generateRotationTrack(e.modelName,e.R.curves,i,e.preRotation,e.postRotation,e.eulerOrder);void 0!==r&&t.push(r)}if(void 0!==e.S&&Object.keys(e.S.curves).length>0){let r=this.generateVectorTrack(e.modelName,e.S.curves,n,"scale");void 0!==r&&t.push(r)}if(void 0!==e.DeformPercent){let r=this.generateMorphTrack(e);void 0!==r&&t.push(r)}return t}generateVectorTrack(e,t,r,i){let n=this.getTimesForAllAxes(t),a=this.getKeyframeTrackValues(n,t,r);return new eT.VectorKeyframeTrack(e+"."+i,n,a)}generateRotationTrack(e,t,r,i,n,a){void 0!==t.x&&(this.interpolateRotations(t.x),t.x.values=t.x.values.map(eT.MathUtils.degToRad)),void 0!==t.y&&(this.interpolateRotations(t.y),t.y.values=t.y.values.map(eT.MathUtils.degToRad)),void 0!==t.z&&(this.interpolateRotations(t.z),t.z.values=t.z.values.map(eT.MathUtils.degToRad));let o=this.getTimesForAllAxes(t),s=this.getKeyframeTrackValues(o,t,r);void 0!==i&&((i=i.map(eT.MathUtils.degToRad)).push(a),i=new eT.Euler().fromArray(i),i=new eT.Quaternion().setFromEuler(i)),void 0!==n&&((n=n.map(eT.MathUtils.degToRad)).push(a),n=new eT.Euler().fromArray(n),n=new eT.Quaternion().setFromEuler(n).invert());let l=new eT.Quaternion,c=new eT.Euler,u=[];for(let e=0;e<s.length;e+=3)c.set(s[e],s[e+1],s[e+2],a),l.setFromEuler(c),void 0!==i&&l.premultiply(i),void 0!==n&&l.multiply(n),l.toArray(u,e/3*4);return new eT.QuaternionKeyframeTrack(e+".quaternion",o,u)}generateMorphTrack(e){let t=e.DeformPercent.curves.morph,r=t.values.map(function(e){return e/100}),i=T.getObjectByName(e.modelName).morphTargetDictionary[e.morphName];return new eT.NumberKeyframeTrack(e.modelName+".morphTargetInfluences["+i+"]",t.times,r)}getTimesForAllAxes(e){let t=[];if(void 0!==e.x&&(t=t.concat(e.x.times)),void 0!==e.y&&(t=t.concat(e.y.times)),void 0!==e.z&&(t=t.concat(e.z.times)),(t=t.sort(function(e,t){return e-t})).length>1){let e=1,r=t[0];for(let i=1;i<t.length;i++){let n=t[i];n!==r&&(t[e]=n,r=n,e++)}t=t.slice(0,e)}return t}getKeyframeTrackValues(e,t,r){let i=[],n=-1,a=-1,o=-1;return e.forEach(function(e){if(t.x&&(n=t.x.times.indexOf(e)),t.y&&(a=t.y.times.indexOf(e)),t.z&&(o=t.z.times.indexOf(e)),-1!==n){let e=t.x.values[n];i.push(e),r[0]=e}else i.push(r[0]);if(-1!==a){let e=t.y.values[a];i.push(e),r[1]=e}else i.push(r[1]);if(-1!==o){let e=t.z.values[o];i.push(e),r[2]=e}else i.push(r[2])}),i}interpolateRotations(e){for(let t=1;t<e.values.length;t++){let r=e.values[t-1],i=e.values[t]-r,n=Math.abs(i);if(n>=180){let a=n/180,o=i/a,s=r+o,l=e.times[t-1],c=(e.times[t]-l)/a,u=l+c,h=[],A=[];for(;u<e.times[t];)h.push(u),u+=c,A.push(s),s+=o;e.times=Af(e.times,t,h),e.values=Af(e.values,t,A)}}}}class Ae{getPrevNode(){return this.nodeStack[this.currentIndent-2]}getCurrentNode(){return this.nodeStack[this.currentIndent-1]}getCurrentProp(){return this.currentProp}pushStack(e){this.nodeStack.push(e),this.currentIndent+=1}popStack(){this.nodeStack.pop(),this.currentIndent-=1}setCurrentProp(e,t){this.currentProp=e,this.currentPropName=t}parse(e){this.currentIndent=0,this.allNodes=new Ai,this.nodeStack=[],this.currentProp=[],this.currentPropName="";let t=this,r=e.split(/[\r\n]+/);return r.forEach(function(e,i){let n=e.match(/^[\s\t]*;/),a=e.match(/^[\s\t]*$/);if(n||a)return;let o=e.match("^\\t{"+t.currentIndent+"}(\\w+):(.*){",""),s=e.match("^\\t{"+t.currentIndent+"}(\\w+):[\\s\\t\\r\\n](.*)"),l=e.match("^\\t{"+(t.currentIndent-1)+"}}");o?t.parseNodeBegin(e,o):s?t.parseNodeProperty(e,s,r[++i]):l?t.popStack():e.match(/^[^\s\t}]/)&&t.parseNodePropertyContinued(e)}),this.allNodes}parseNodeBegin(e,t){let r=t[1].trim().replace(/^"/,"").replace(/"$/,""),i=t[2].split(",").map(function(e){return e.trim().replace(/^"/,"").replace(/"$/,"")}),n={name:r},a=this.parseNodeAttr(i),o=this.getCurrentNode();0===this.currentIndent?this.allNodes.add(r,n):r in o?("PoseNode"===r?o.PoseNode.push(n):void 0!==o[r].id&&(o[r]={},o[r][o[r].id]=o[r]),""!==a.id&&(o[r][a.id]=n)):"number"==typeof a.id?(o[r]={},o[r][a.id]=n):"Properties70"!==r&&("PoseNode"===r?o[r]=[n]:o[r]=n),"number"==typeof a.id&&(n.id=a.id),""!==a.name&&(n.attrName=a.name),""!==a.type&&(n.attrType=a.type),this.pushStack(n)}parseNodeAttr(e){let t=e[0];""!==e[0]&&isNaN(t=parseInt(e[0]))&&(t=e[0]);let r="",i="";return e.length>1&&(r=e[1].replace(/^(\w+)::/,""),i=e[2]),{id:t,name:r,type:i}}parseNodeProperty(e,t,r){let i=t[1].replace(/^"/,"").replace(/"$/,"").trim(),n=t[2].replace(/^"/,"").replace(/"$/,"").trim();"Content"===i&&","===n&&(n=r.replace(/"/g,"").replace(/,$/,"").trim());let a=this.getCurrentNode();if("Properties70"===a.name){this.parseNodeSpecialProperty(e,i,n);return}if("C"===i){let e=n.split(",").slice(1),t=parseInt(e[0]),r=parseInt(e[1]),o=n.split(",").slice(3);o=o.map(function(e){return e.trim().replace(/^"/,"")}),i="connections",function(e,t){for(let r=0,i=e.length,n=t.length;r<n;r++,i++)e[i]=t[r]}(n=[t,r],o),void 0===a[i]&&(a[i]=[])}"Node"===i&&(a.id=n),i in a&&Array.isArray(a[i])?a[i].push(n):"a"!==i?a[i]=n:a.a=n,this.setCurrentProp(a,i),"a"===i&&","!==n.slice(-1)&&(a.a=AA(n))}parseNodePropertyContinued(e){let t=this.getCurrentNode();t.a+=e,","!==e.slice(-1)&&(t.a=AA(t.a))}parseNodeSpecialProperty(e,t,r){let i=r.split('",').map(function(e){return e.trim().replace(/^\"/,"").replace(/\s/,"_")}),n=i[0],a=i[1],o=i[2],s=i[3],l=i[4];switch(a){case"int":case"enum":case"bool":case"ULongLong":case"double":case"Number":case"FieldOfView":l=parseFloat(l);break;case"Color":case"ColorRGB":case"Vector3D":case"Lcl_Translation":case"Lcl_Rotation":case"Lcl_Scaling":l=AA(l)}this.getPrevNode()[n]={type:a,type2:o,flag:s,value:l},this.setCurrentProp(this.getPrevNode(),n)}}class At{parse(e){let t=new Ar(e);t.skip(23);let r=t.getUint32();if(r<6400)throw Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+r);let i=new Ai;for(;!this.endOfContent(t);){let e=this.parseNode(t,r);null!==e&&i.add(e.name,e)}return i}endOfContent(e){return e.size()%16==0?(e.getOffset()+160+16&-16)>=e.size():e.getOffset()+160+16>=e.size()}parseNode(e,t){let r={},i=t>=7500?e.getUint64():e.getUint32(),n=t>=7500?e.getUint64():e.getUint32();t>=7500?e.getUint64():e.getUint32();let a=e.getUint8(),o=e.getString(a);if(0===i)return null;let s=[];for(let t=0;t<n;t++)s.push(this.parseProperty(e));let l=s.length>0?s[0]:"",c=s.length>1?s[1]:"",u=s.length>2?s[2]:"";for(r.singleProperty=1===n&&e.getOffset()===i;i>e.getOffset();){let i=this.parseNode(e,t);null!==i&&this.parseSubNode(o,r,i)}return r.propertyList=s,"number"==typeof l&&(r.id=l),""!==c&&(r.attrName=c),""!==u&&(r.attrType=u),""!==o&&(r.name=o),r}parseSubNode(e,t,r){if(!0===r.singleProperty){let e=r.propertyList[0];Array.isArray(e)?(t[r.name]=r,r.a=e):t[r.name]=e}else if("Connections"===e&&"C"===r.name){let e=[];r.propertyList.forEach(function(t,r){0!==r&&e.push(t)}),void 0===t.connections&&(t.connections=[]),t.connections.push(e)}else if("Properties70"===r.name)Object.keys(r).forEach(function(e){t[e]=r[e]});else if("Properties70"===e&&"P"===r.name){let e,i=r.propertyList[0],n=r.propertyList[1],a=r.propertyList[2],o=r.propertyList[3];0===i.indexOf("Lcl ")&&(i=i.replace("Lcl ","Lcl_")),0===n.indexOf("Lcl ")&&(n=n.replace("Lcl ","Lcl_")),e="Color"===n||"ColorRGB"===n||"Vector"===n||"Vector3D"===n||0===n.indexOf("Lcl_")?[r.propertyList[4],r.propertyList[5],r.propertyList[6]]:r.propertyList[4],t[i]={type:n,type2:a,flag:o,value:e}}else void 0===t[r.name]?"number"==typeof r.id?(t[r.name]={},t[r.name][r.id]=r):t[r.name]=r:"PoseNode"===r.name?(Array.isArray(t[r.name])||(t[r.name]=[t[r.name]]),t[r.name].push(r)):void 0===t[r.name][r.id]&&(t[r.name][r.id]=r)}parseProperty(e){let t;let r=e.getString(1);switch(r){case"C":return e.getBoolean();case"D":return e.getFloat64();case"F":return e.getFloat32();case"I":return e.getInt32();case"L":return e.getInt64();case"R":return t=e.getUint32(),e.getArrayBuffer(t);case"S":return t=e.getUint32(),e.getString(t);case"Y":return e.getInt16();case"b":case"c":case"d":case"f":case"i":case"l":let i=e.getUint32(),n=e.getUint32(),a=e.getUint32();if(0===n)switch(r){case"b":case"c":return e.getBooleanArray(i);case"d":return e.getFloat64Array(i);case"f":return e.getFloat32Array(i);case"i":return e.getInt32Array(i);case"l":return e.getInt64Array(i)}let o=new Ar(h2(new Uint8Array(e.getArrayBuffer(a))).buffer);switch(r){case"b":case"c":return o.getBooleanArray(i);case"d":return o.getFloat64Array(i);case"f":return o.getFloat32Array(i);case"i":return o.getInt32Array(i);case"l":return o.getInt64Array(i)}default:throw Error("THREE.FBXLoader: Unknown property type "+r)}}}class Ar{constructor(e,t){this.dv=new DataView(e),this.offset=0,this.littleEndian=void 0===t||t}getOffset(){return this.offset}size(){return this.dv.buffer.byteLength}skip(e){this.offset+=e}getBoolean(){return(1&this.getUint8())==1}getBooleanArray(e){let t=[];for(let r=0;r<e;r++)t.push(this.getBoolean());return t}getUint8(){let e=this.dv.getUint8(this.offset);return this.offset+=1,e}getInt16(){let e=this.dv.getInt16(this.offset,this.littleEndian);return this.offset+=2,e}getInt32(){let e=this.dv.getInt32(this.offset,this.littleEndian);return this.offset+=4,e}getInt32Array(e){let t=[];for(let r=0;r<e;r++)t.push(this.getInt32());return t}getUint32(){let e=this.dv.getUint32(this.offset,this.littleEndian);return this.offset+=4,e}getInt64(){let e,t;return(this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),2147483648&t)?(t=4294967295&~t,4294967295==(e=4294967295&~e)&&(t=t+1&4294967295),-(4294967296*t+(e=e+1&4294967295))):4294967296*t+e}getInt64Array(e){let t=[];for(let r=0;r<e;r++)t.push(this.getInt64());return t}getUint64(){let e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),4294967296*t+e}getFloat32(){let e=this.dv.getFloat32(this.offset,this.littleEndian);return this.offset+=4,e}getFloat32Array(e){let t=[];for(let r=0;r<e;r++)t.push(this.getFloat32());return t}getFloat64(){let e=this.dv.getFloat64(this.offset,this.littleEndian);return this.offset+=8,e}getFloat64Array(e){let t=[];for(let r=0;r<e;r++)t.push(this.getFloat64());return t}getArrayBuffer(e){let t=this.dv.buffer.slice(this.offset,this.offset+e);return this.offset+=e,t}getString(e){let t=[];for(let r=0;r<e;r++)t[r]=this.getUint8();let r=t.indexOf(0);return r>=0&&(t=t.slice(0,r)),lh(new Uint8Array(t))}}class Ai{add(e,t){this[e]=t}}function An(e){let t=e.match(/FBXVersion: (\d+)/);if(t)return parseInt(t[1]);throw Error("THREE.FBXLoader: Cannot find the version number for the file given.")}function Aa(e){return e/46186158e3}let Ao=[];function As(e,t,r,i){let n;switch(i.mappingType){case"ByPolygonVertex":n=e;break;case"ByPolygon":n=t;break;case"ByVertice":n=r;break;case"AllSame":n=i.indices[0];break;default:console.warn("THREE.FBXLoader: unknown attribute mapping type "+i.mappingType)}"IndexToDirect"===i.referenceType&&(n=i.indices[n]);let a=n*i.dataSize,o=a+i.dataSize;return function(e,t,r,i){for(let n=r,a=0;n<i;n++,a++)e[a]=t[n];return e}(Ao,i.buffer,a,o)}let Al=new eT.Euler,Ac=new eT.Vector3;function Au(e){let t=new eT.Matrix4,r=new eT.Matrix4,i=new eT.Matrix4,n=new eT.Matrix4,a=new eT.Matrix4,o=new eT.Matrix4,s=new eT.Matrix4,l=new eT.Matrix4,c=new eT.Matrix4,u=new eT.Matrix4,h=new eT.Matrix4,A=new eT.Matrix4,d=e.inheritType?e.inheritType:0;if(e.translation&&t.setPosition(Ac.fromArray(e.translation)),e.preRotation){let t=e.preRotation.map(eT.MathUtils.degToRad);t.push(e.eulerOrder),r.makeRotationFromEuler(Al.fromArray(t))}if(e.rotation){let t=e.rotation.map(eT.MathUtils.degToRad);t.push(e.eulerOrder),i.makeRotationFromEuler(Al.fromArray(t))}if(e.postRotation){let t=e.postRotation.map(eT.MathUtils.degToRad);t.push(e.eulerOrder),n.makeRotationFromEuler(Al.fromArray(t)),n.invert()}e.scale&&a.scale(Ac.fromArray(e.scale)),e.scalingOffset&&s.setPosition(Ac.fromArray(e.scalingOffset)),e.scalingPivot&&o.setPosition(Ac.fromArray(e.scalingPivot)),e.rotationOffset&&l.setPosition(Ac.fromArray(e.rotationOffset)),e.rotationPivot&&c.setPosition(Ac.fromArray(e.rotationPivot)),e.parentMatrixWorld&&(h.copy(e.parentMatrix),u.copy(e.parentMatrixWorld));let f=r.clone().multiply(i).multiply(n),m=new eT.Matrix4;m.extractRotation(u);let p=new eT.Matrix4;p.copyPosition(u);let g=p.clone().invert().multiply(u),y=m.clone().invert().multiply(g),v=new eT.Matrix4;if(0===d)v.copy(m).multiply(f).multiply(y).multiply(a);else if(1===d)v.copy(m).multiply(y).multiply(f).multiply(a);else{let e=new eT.Matrix4().scale(new eT.Vector3().setFromMatrixScale(h)).clone().invert(),t=y.clone().multiply(e);v.copy(m).multiply(f).multiply(t).multiply(a)}let E=c.clone().invert(),x=o.clone().invert(),C=t.clone().multiply(l).multiply(c).multiply(r).multiply(i).multiply(n).multiply(E).multiply(s).multiply(o).multiply(a).multiply(x),B=new eT.Matrix4().copyPosition(C),w=u.clone().multiply(B);return A.copyPosition(w),(C=A.clone().multiply(v)).premultiply(u.invert()),C}function Ah(e){return 6===(e=e||0)?(console.warn("THREE.FBXLoader: unsupported Euler Order: Spherical XYZ. Animations and rotations may be incorrect."),"ZYX"):["ZYX","YZX","XZY","ZXY","YXZ","XYZ"][e]}function AA(e){return e.split(",").map(function(e){return parseFloat(e)})}function Ad(e,t,r){return void 0===t&&(t=0),void 0===r&&(r=e.byteLength),lh(new Uint8Array(e,t,r))}function Af(e,t,r){return e.slice(0,t).concat(r).concat(e.slice(t))}function Am(e){return(0,eR.H)(h6,e)}function Ap({path:e,...t}){let r=Am(e).children[0];return eS.createElement(s3,j({},t,{object:r}))}Am.preload=e=>eR.H.preload(h6,e),Am.clear=e=>eR.H.clear(h6,e);class Ag{constructor(e=4){this.pool=e,this.queue=[],this.workers=[],this.workersResolve=[],this.workerStatus=0}_initWorker(e){if(!this.workers[e]){let t=this.workerCreator();t.addEventListener("message",this._onMessage.bind(this,e)),this.workers[e]=t}}_getIdleWorker(){for(let e=0;e<this.pool;e++)if(!(this.workerStatus&1<<e))return e;return -1}_onMessage(e,t){let r=this.workersResolve[e];if(r&&r(t),this.queue.length){let{resolve:t,msg:r,transfer:i}=this.queue.shift();this.workersResolve[e]=t,this.workers[e].postMessage(r,i)}else this.workerStatus^=1<<e}setWorkerCreator(e){this.workerCreator=e}setWorkerLimit(e){this.pool=e}postMessage(e,t){return new Promise(r=>{let i=this._getIdleWorker();-1!==i?(this._initWorker(i),this.workerStatus|=1<<i,this.workersResolve[i]=r,this.workers[i].postMessage(e,t)):this.queue.push({resolve:r,msg:e,transfer:t})})}dispose(){this.workers.forEach(e=>e.terminate()),this.workersResolve.length=0,this.workers.length=0,this.queue.length=0,this.workerStatus=0}}var Ay=r(7133).lW;class Av{constructor(){this.vkFormat=0,this.typeSize=1,this.pixelWidth=0,this.pixelHeight=0,this.pixelDepth=0,this.layerCount=0,this.faceCount=1,this.supercompressionScheme=0,this.levels=[],this.dataFormatDescriptor=[{vendorId:0,descriptorType:0,descriptorBlockSize:0,versionNumber:2,colorModel:0,colorPrimaries:1,transferFunction:2,flags:0,texelBlockDimension:[0,0,0,0],bytesPlane:[0,0,0,0,0,0,0,0],samples:[]}],this.keyValue={},this.globalData=null}}class AE{constructor(e,t,r,i){this._dataView=void 0,this._littleEndian=void 0,this._offset=void 0,this._dataView=new DataView(e.buffer,e.byteOffset+t,r),this._littleEndian=i,this._offset=0}_nextUint8(){let e=this._dataView.getUint8(this._offset);return this._offset+=1,e}_nextUint16(){let e=this._dataView.getUint16(this._offset,this._littleEndian);return this._offset+=2,e}_nextUint32(){let e=this._dataView.getUint32(this._offset,this._littleEndian);return this._offset+=4,e}_nextUint64(){let e=this._dataView.getUint32(this._offset,this._littleEndian),t=this._dataView.getUint32(this._offset+4,this._littleEndian);return this._offset+=8,e+4294967296*t}_nextInt32(){let e=this._dataView.getInt32(this._offset,this._littleEndian);return this._offset+=4,e}_nextUint8Array(e){let t=new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+this._offset,e);return this._offset+=e,t}_skip(e){return this._offset+=e,this}_scan(e,t){void 0===t&&(t=0);let r=this._offset,i=0;for(;this._dataView.getUint8(this._offset)!==t&&i<e;)i++,this._offset++;return i<e&&this._offset++,new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+r,i)}}let Ax=[171,75,84,88,32,50,48,187,13,10,26,10];function AC(e){return"undefined"!=typeof TextDecoder?new TextDecoder().decode(e):Ay.from(e).toString("utf8")}var AB=r(7133).lW;let Aw={env:{emscripten_notify_memory_growth:function(e){P=new Uint8Array(F.exports.memory.buffer)}}};class AI{init(){return R||(R="undefined"!=typeof fetch?fetch("data:application/wasm;base64,"+Ab).then(e=>e.arrayBuffer()).then(e=>WebAssembly.instantiate(e,Aw)).then(this._init):WebAssembly.instantiate(AB.from(Ab,"base64"),Aw).then(this._init))}_init(e){F=e.instance,Aw.env.emscripten_notify_memory_growth(0)}decode(e,t=0){if(!F)throw Error("ZSTDDecoder: Await .init() before decoding.");let r=e.byteLength,i=F.exports.malloc(r);P.set(e,i),t=t||Number(F.exports.ZSTD_findDecompressedSize(i,r));let n=F.exports.malloc(t),a=F.exports.ZSTD_decompress(n,t,i,r),o=P.slice(n,n+a);return F.exports.free(i),F.exports.free(n),o}}let Ab="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IAMNACAEQQNxBEADQCACRQ0FIAAgAkF/aiICaiIDIAEgAmotAAA6AAAgA0EDcQ0ACwsgAkEDTQ0AA0AgACACQXxqIgJqIAEgAmooAgA2AgAgAkEDSw0ACwsgAkUNAgNAIAAgAkF/aiICaiABIAJqLQAAOgAAIAINAAsMAgsgAkEDTQ0AIAIhBANAIAMgASgCADYCACABQQRqIQEgA0EEaiEDIARBfGoiBEEDSw0ACyACQQNxIQILIAJFDQADQCADIAEtAAA6AAAgA0EBaiEDIAFBAWohASACQX9qIgINAAsLIAAL8wICAn8BfgJAIAJFDQAgACACaiIDQX9qIAE6AAAgACABOgAAIAJBA0kNACADQX5qIAE6AAAgACABOgABIANBfWogAToAACAAIAE6AAIgAkEHSQ0AIANBfGogAToAACAAIAE6AAMgAkEJSQ0AIABBACAAa0EDcSIEaiIDIAFB/wFxQYGChAhsIgE2AgAgAyACIARrQXxxIgRqIgJBfGogATYCACAEQQlJDQAgAyABNgIIIAMgATYCBCACQXhqIAE2AgAgAkF0aiABNgIAIARBGUkNACADIAE2AhggAyABNgIUIAMgATYCECADIAE2AgwgAkFwaiABNgIAIAJBbGogATYCACACQWhqIAE2AgAgAkFkaiABNgIAIAQgA0EEcUEYciIEayICQSBJDQAgAa0iBUIghiAFhCEFIAMgBGohAQNAIAEgBTcDGCABIAU3AxAgASAFNwMIIAEgBTcDACABQSBqIQEgAkFgaiICQR9LDQALCyAACy8BAn8gACgCBCAAKAIAQQJ0aiICLQACIQMgACACLwEAIAEgAi0AAxAIajYCACADCy8BAn8gACgCBCAAKAIAQQJ0aiICLQACIQMgACACLwEAIAEgAi0AAxAFajYCACADCx8AIAAgASACKAIEEAg2AgAgARAEGiAAIAJBCGo2AgQLCAAgAGdBH3MLugUBDX8jAEEQayIKJAACfyAEQQNNBEAgCkEANgIMIApBDGogAyAEEAsaIAAgASACIApBDGpBBBAVIgBBbCAAEAMbIAAgACAESxsMAQsgAEEAIAEoAgBBAXRBAmoQECENQVQgAygAACIGQQ9xIgBBCksNABogAiAAQQVqNgIAIAMgBGoiAkF8aiEMIAJBeWohDiACQXtqIRAgAEEGaiELQQQh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ASIDNgLE4AEgACgCvOABIQQgACABNgK84AEgACABIAJqNgK44AEgACABIAQgA2tqNgLA4AELpgEBAX8gACAAKALs4QEQFjYCyOABIABCADcD+OABIABCADcDuOABIABBwOABakIANwMAIABBqNAAaiIBQYyAgOAANgIAIABBADYCmOIBIABCADcDiOEBIABCAzcDgOEBIABBrNABakHgEikCADcCACAAQbTQAWpB6BIoAgA2AgAgACABNgIMIAAgAEGYIGo2AgggACAAQaAwajYCBCAAIABBEGo2AgALYQEBf0G4fyEDAkAgAUEDSQ0AIAIgABAhIgFBA3YiADYCCCACIAFBAXE2AgQgAiABQQF2QQNxIgM2AgACQCADQX9qIgFBAksNAAJAIAFBAWsOAgEAAgtBbA8LIAAhAwsgAwsMACAAIAEgAkEAEC4LiAQCA38CfiADEBYhBCAAQQBBKBAQIQAgBCACSwRAIAQPCyABRQRAQX8PCwJAAkAgA0EBRg0AIAEoAAAiBkGo6r5pRg0AQXYhAyAGQXBxQdDUtMIBRw0BQQghAyACQQhJDQEgAEEAQSgQECEAIAEoAAQhASAAQQE2AhQgACABrTcDAEEADwsgASACIAMQLyIDIAJLDQAgACADNgIYQXIhAyABIARqIgVBf2otAAAiAkEIcQ0AIAJBIHEiBkUEQEFwIQMgBS0AACIFQacBSw0BIAVBB3GtQgEgBUEDdkEKaq2GIgdCA4h+IAd8IQggBEEBaiEECyACQQZ2IQMgAkECdiEFAkAgAkEDcUF/aiICQQJLBEBBACECDAELAkACQAJAIAJBAWsOAgECAAsgASAEai0AACECIARBAWohBAwCCyABIARqLwAAIQIgBEECaiEEDAELIAEgBGooAAAhAiAEQQRqIQQLIAVBAXEhBQJ+AkACQAJAIANBf2oiA0ECTQRAIANBAWsOAgIDAQtCfyAGRQ0DGiABIARqMQAADAMLIAEgBGovAACtQoACfAwCCyABIARqKAAArQwBCyABIARqKQAACyEHIAAgBTYCICAAIAI2AhwgACAHNwMAQQAhAyAAQQA2AhQgACAHIAggBhsiBzcDCCAAIAdCgIAIIAdCgIAIVBs+AhALIAMLWwEBf0G4fyEDIAIQFiICIAFNBH8gACACakF/ai0AACIAQQNxQQJ0QaAeaigCACACaiAAQQZ2IgFBAnRBsB5qKAIAaiAAQSBxIgBFaiABRSAAQQV2cWoFQbh/CwsdACAAKAKQ4gEQWiAAQQA2AqDiASAAQgA3A5DiAQu1AwEFfyMAQZACayIKJABBuH8hBgJAIAVFDQAgBCwAACIIQf8BcSEHAkAgCEF/TARAIAdBgn9qQQF2IgggBU8NAkFsIQYgB0GBf2oiBUGAAk8NAiAEQQFqIQdBACEGA0AgBiAFTwRAIAUhBiAIIQcMAwUgACAGaiAHIAZBAXZqIgQtAABBBHY6AAAgACAGQQFyaiAELQAAQQ9xOgAAIAZBAmohBgwBCwAACwALIAcgBU8NASAAIARBAWogByAKEFMiBhADDQELIAYhBEEAIQYgAUEAQTQQECEJQQAhBQNAIAQgBkcEQCAAIAZqIggtAAAiAUELSwRAQWwhBgwDBSAJIAFBAnRqIgEgASgCAEEBajYCACAGQQFqIQZBASAILQAAdEEBdSAFaiEFDAILAAsLQWwhBiAFRQ0AIAUQFEEBaiIBQQxLDQAgAyABNgIAQQFBASABdCAFayIDEBQiAXQgA0cNACAAIARqIAFBAWoiADoAACAJIABBAnRqIgAgACgCAEEBajYCACAJKAIEIgBBAkkgAEEBcXINACACIARBAWo2AgAgB0EBaiEGCyAKQZACaiQAIAYLxhEBDH8jAEHwAGsiBSQAQWwhCwJAIANBCkkNACACLwAAIQogAi8AAiEJIAIvAAQhByAFQQhqIAQQDgJAIAMgByAJIApqakEGaiIMSQ0AIAUtAAohCCAFQdgAaiACQQZqIgIgChAGIgsQAw0BIAVBQGsgAiAKaiICIAkQBiILEAMNASAFQShqIAIgCWoiAiAHEAYiCxADDQEgBUEQaiACIAdqIAMgDGsQBiILEAMNASAAIAFqIg9BfWohECAEQQRqIQZBASELIAAgAUEDakECdiIDaiIMIANqIgIgA2oiDiEDIAIhBCAMIQcDQCALIAMgEElxBEAgACAGIAVB2ABqIAgQAkECdGoiCS8BADsAACAFQdgAaiAJLQACEAEgCS0AAyELIAcgBiAFQUBrIAgQAkECdGoiCS8BADsAACAFQUBrIAktAAIQASAJLQADIQogBCAGIAVBKGogCBACQQJ0aiIJLwEAOwAAIAVBKGogCS0AAhABIAktAAMhCSADIAYgBUEQaiAIEAJBAnRqIg0vAQA7AAAgBUEQaiANLQACEAEgDS0AAyENIAAgC2oiCyAGIAVB2ABqIAgQAkECdGoiAC8BADsAACAFQdgAaiAALQACEAEgAC0AAyEAIAcgCmoiCiAGIAVBQGsgCBACQQJ0aiIHLwEAOwAAIAVBQGsgBy0AAhABIActAAMhByAEIAlqIgkgBiAFQShqIAgQAkECdGoiBC8BADsAACAFQShqIAQtAAIQASAELQADIQQgAyANaiIDIAYgBUEQaiAIEAJBAnRqIg0vAQA7AAAgBUEQaiANLQACEAEgACALaiEAIAcgCmohByAEIAlqIQQgAyANLQADaiEDIAVB2ABqEA0gBUFAaxANciAFQShqEA1yIAVBEGoQDXJFIQsMAQsLIAQgDksgByACS3INAEFsIQsgACAMSw0BIAxBfWohCQNAQQAgACAJSSAFQdgAahAEGwRAIAAgBiAFQdgAaiAIEAJBAnRqIgovAQA7AAAgBUHYAGogCi0AAhABIAAgCi0AA2oiACAGIAVB2ABqIAgQAkECdGoiCi8BADsAACAFQdgAaiAKLQACEAEgACAKLQADaiEADAEFIAxBfmohCgNAIAVB2ABqEAQgACAKS3JFBEAgACAGIAVB2ABqIAgQAkECdGoiCS8BADsAACAFQdgAaiAJLQACEAEgACAJLQADaiEADAELCwNAIAAgCk0EQCAAIAYgBUHYAGogCBACQQJ0aiIJLwEAOwAAIAVB2ABqIAktAAIQASAAIAktAANqIQAMAQsLAkAgACAMTw0AIAAgBiAFQdgAaiAIEAIiAEECdGoiDC0AADoAACAMLQADQQFGBEAgBUHYAGogDC0AAhABDAELIAUoAlxBH0sNACAFQdgAaiAGIABBAnRqLQACEAEgBSgCXEEhSQ0AIAVBIDYCXAsgAkF9aiEMA0BBACAHIAxJIAVBQGsQBBsEQCAHIAYgBUFAayAIEAJBAnRqIgAvAQA7AAAgBUFAayAALQACEAEgByAALQADaiIAIAYgBUFAayAIEAJBAnRqIgcvAQA7AAAgBUFAayAHLQACEAEgACAHLQADaiEHDAEFIAJBfmohDANAIAVBQGsQBCAHIAxLckUEQCAHIAYgBUFAayAIEAJBAnRqIgAvAQA7AAAgBUFAayAALQACEAEgByAALQADaiEHDAELCwNAIAcgDE0EQCAHIAYgBUFAayAIEAJBAnRqIgAvAQA7AAAgBUFAayAALQACEAEgByAALQADaiEHDAELCwJAIAcgAk8NACAHIAYgBUFAayAIEAIiAEECdGoiAi0AADoAACACLQADQQFGBEAgBUFAayACLQACEAEMAQsgBSgCREEfSw0AIAVBQGsgBiAAQQJ0ai0AAhABIAUoAkRBIUkNACAFQSA2AkQLIA5BfWohAgNAQQAgBCACSSAFQShqEAQbBEAgBCAGIAVBKGogCBACQQJ0aiIALwEAOwAAIAVBKGogAC0AAhABIAQgAC0AA2oiACAGIAVBKGogCBACQQJ0aiIELwEAOwAAIAVBKGogBC0AAhABIAAgBC0AA2ohBAwBBSAOQX5qIQIDQCAFQShqEAQgBCACS3JFBEAgBCAGIAVBKGogCBACQQJ0aiIALwEAOwAAIAVBKGogAC0AAhABIAQgAC0AA2ohBAwBCwsDQCAEIAJNBEAgBCAGIAVBKGogCBACQQJ0aiIALwEAOwAAIAVBKGogAC0AAhABIAQgAC0AA2ohBAwBCwsCQCAEIA5PDQAgBCAGIAVBKGogCBACIgBBAnRqIgItAAA6AAAgAi0AA0EBRgRAIAVBKGogAi0AAhABDAELIAUoAixBH0sNACAFQShqIAYgAEECdGotAAIQASAFKAIsQSFJDQAgBUEgNgIsCwNAQQAgAyAQSSAFQRBqEAQbBEAgAyAGIAVBEGogCBACQQJ0aiIALwEAOwAAIAVBEGogAC0AAhABIAMgAC0AA2oiACAGIAVBEGogCBACQQJ0aiICLwEAOwAAIAVBEGogAi0AAhABIAAgAi0AA2ohAwwBBSAPQX5qIQIDQCAFQRBqEAQgAyACS3JFBEAgAyAGIAVBEGogCBACQQJ0aiIALwEAOwAAIAVBEGogAC0AAhABIAMgAC0AA2ohAwwBCwsDQCADIAJNBEAgAyAGIAVBEGogCBACQQJ0aiIALwEAOwAAIAVBEGogAC0AAhABIAMgAC0AA2ohAwwBCwsCQCADIA9PDQAgAyAGIAVBEGogCBACIgBBAnRqIgItAAA6AAAgAi0AA0EBRgRAIAVBEGogAi0AAhABDAELIAUoAhRBH0sNACAFQRBqIAYgAEECdGotAAIQASAFKAIUQSFJDQAgBUEgNgIUCyABQWwgBUHYAGoQCiAFQUBrEApxIAVBKGoQCnEgBUEQahAKcRshCwwJCwAACwALAAALAAsAAAsACwAACwALQWwhCwsgBUHwAGokACALC7UEAQ5/IwBBEGsiBiQAIAZBBGogABAOQVQhBQJAIARB3AtJDQAgBi0ABCEHIANB8ARqQQBB7AAQECEIIAdBDEsNACADQdwJaiIJIAggBkEIaiAGQQxqIAEgAhAxIhAQA0UEQCAGKAIMIgQgB0sNASADQdwFaiEPIANBpAVqIREgAEEEaiESIANBqAVqIQEgBCEFA0AgBSICQX9qIQUgCCACQQJ0aigCAEUNAAsgAkEBaiEOQQEhBQNAIAUgDk9FBEAgCCAFQQJ0IgtqKAIAIQwgASALaiAKNgIAIAVBAWohBSAKIAxqIQoMAQsLIAEgCjYCAEEAIQUgBigCCCELA0AgBSALRkUEQCABIAUgCWotAAAiDEECdGoiDSANKAIAIg1BAWo2AgAgDyANQQF0aiINIAw6AAEgDSAFOgAAIAVBAWohBQwBCwtBACEBIANBADYCqAUgBEF/cyAHaiEJQQEhBQNAIAUgDk9FBEAgCCAFQQJ0IgtqKAIAIQwgAyALaiABNgIAIAwgBSAJanQgAWohASAFQQFqIQUMAQsLIAcgBEEBaiIBIAJrIgRrQQFqIQgDQEEBIQUgBCAIT0UEQANAIAUgDk9FBEAgBUECdCIJIAMgBEE0bGpqIAMgCWooAgAgBHY2AgAgBUEBaiEFDAELCyAEQQFqIQQMAQsLIBIgByAPIAogESADIAIgARBkIAZBAToABSAGIAc6AAYgACAGKAIENgIACyAQIQULIAZBEGokACAFC8ENAQt/IwBB8ABrIgUkAEFsIQkCQCADQQpJDQAgAi8AACEKIAIvAAIhDCACLwAEIQYgBUEIaiAEEA4CQCADIAYgCiAMampBBmoiDUkNACAFLQAKIQcgBUHYAGogAkEGaiICIAoQBiIJEAMNASAFQUBrIAIgCmoiAiAMEAYiCRADDQEgBUEoaiACIAxqIgIgBhAGIgkQAw0BIAVBEGogAiAGaiADIA1rEAYiCRADDQEgACABaiIOQX1qIQ8gBEEEaiEGQQEhCSAAIAFBA2pBAnYiAmoiCiACaiIMIAJqIg0hAyAMIQQgCiECA0AgCSADIA9JcQRAIAYgBUHYAGogBxACQQF0aiIILQAAIQsgBUHYAGogCC0AARABIAAgCzoAACAGIAVBQGsgBxACQQF0aiIILQAAIQsgBUFAayAILQABEAEgAiALOgAAIAYgBUEoaiAHEAJBAXRqIggtAAAhCyAFQShqIAgtAAEQASAEIAs6AAAgBiAFQRBqIAcQAkEBdGoiCC0AACELIAVBEGogCC0AARABIAMgCzoAACAGIAVB2ABqIAcQAkEBdGoiCC0AACELIAVB2ABqIAgtAAEQASAAIAs6AAEgBiAFQUBrIAcQAkEBdGoiCC0AACELIAVBQGsgCC0AARABIAIgCzoAASAGIAVBKGogBxACQQF0aiIILQAAIQsgBUEoaiAILQABEAEgBCALOgABIAYgBUEQaiAHEAJBAXRqIggtAAAhCyAFQRBqIAgtAAEQASADIAs6AAEgA0ECaiEDIARBAmohBCACQQJqIQIgAEECaiEAIAkgBUHYAGoQDUVxIAVBQGsQDUVxIAVBKGoQDUVxIAVBEGoQDUVxIQkMAQsLIAQgDUsgAiAMS3INAEFsIQkgACAKSw0BIApBfWohCQNAIAVB2ABqEAQgACAJT3JFBEAgBiAFQdgAaiAHEAJBAXRqIggtAAAhCyAFQdgAaiAILQABEAEgACALOgAAIAYgBUHYAGogBxACQQF0aiIILQAAIQsgBUHYAGogCC0AARABIAAgCzoAASAAQQJqIQAMAQsLA0AgBUHYAGoQBCAAIApPckUEQCAGIAVB2ABqIAcQAkEBdGoiCS0AACEIIAVB2ABqIAktAAEQASAAIAg6AAAgAEEBaiEADAELCwNAIAAgCkkEQCAGIAVB2ABqIAcQAkEBdGoiCS0AACEIIAVB2ABqIAktAAEQASAAIAg6AAAgAEEBaiEADAELCyAMQX1qIQADQCAFQUBrEAQgAiAAT3JFBEAgBiAFQUBrIAcQAkEBdGoiCi0AACEJIAVBQGsgCi0AARABIAIgCToAACAGIAVBQGsgBxACQQF0aiIKLQAAIQkgBUFAayAKLQABEAEgAiAJOgABIAJBAmohAgwBCwsDQCAFQUBrEAQgAiAMT3JFBEAgBiAFQUBrIAcQAkEBdGoiAC0AACEKIAVBQGsgAC0AARABIAIgCjoAACACQQFqIQIMAQsLA0AgAiAMSQRAIAYgBUFAayAHEAJBAXRqIgAtAAAhCiAFQUBrIAAtAAEQASACIAo6AAAgAkEBaiECDAELCyANQX1qIQADQCAFQShqEAQgBCAAT3JFBEAgBiAFQShqIAcQAkEBdGoiAi0AACEKIAVBKGogAi0AARABIAQgCjoAACAGIAVBKGogBxACQQF0aiICLQAAIQogBUEoaiACLQABEAEgBCAKOgABIARBAmohBAwBCwsDQCAFQShqEAQgBCANT3JFBEAgBiAFQShqIAcQAkEBdGoiAC0AACECIAVBKGogAC0AARABIAQgAjoAACAEQQFqIQQMAQsLA0AgBCANSQRAIAYgBUEoaiAHEAJBAXRqIgAtAAAhAiAFQShqIAAtAAEQASAEIAI6AAAgBEEBaiEEDAELCwNAIAVBEGoQBCADIA9PckUEQCAGIAVBEGogBxACQQF0aiIALQAAIQIgBUEQaiAALQABEAEgAyACOgAAIAYgBUEQaiAHEAJBAXRqIgAtAAAhAiAFQRBqIAAtAAEQASADIAI6AAEgA0ECaiEDDAELCwNAIAVBEGoQBCADIA5PckUEQCAGIAVBEGogBxACQQF0aiIALQAAIQIgBUEQaiAALQABEAEgAyACOgAAIANBAWohAwwBCwsDQCADIA5JBEAgBiAFQRBqIAcQAkEBdGoiAC0AACECIAVBEGogAC0AARABIAMgAjoAACADQQFqIQMMAQsLIAFBbCAFQdgAahAKIAVBQGsQCnEgBUEoahAKcSAFQRBqEApxGyEJDAELQWwhCQsgBUHwAGokACAJC8oCAQR/IwBBIGsiBSQAIAUgBBAOIAUtAAIhByAFQQhqIAIgAxAGIgIQA0UEQCAEQQRqIQIgACABaiIDQX1qIQQDQCAFQQhqEAQgACAET3JFBEAgAiAFQQhqIAcQAkEBdGoiBi0AACEIIAVBCGogBi0AARABIAAgCDoAACACIAVBCGogBxACQQF0aiIGLQAAIQggBUEIaiAGLQABEAEgACAIOgABIABBAmohAAwBCwsDQCAFQQhqEAQgACADT3JFBEAgAiAFQQhqIAcQAkEBdGoiBC0AACEGIAVBCGogBC0AARABIAAgBjoAACAAQQFqIQAMAQsLA0AgACADT0UEQCACIAVBCGogBxACQQF0aiIELQAAIQYgBUEIaiAELQABEAEgACAGOgAAIABBAWohAAwBCwsgAUFsIAVBCGoQChshAgsgBUEgaiQAIAILtgMBCX8jAEEQayIGJAAgBkEANgIMIAZBADYCCEFUIQQCQAJAIANBQGsiDCADIAZBCGogBkEMaiABIAIQMSICEAMNACAGQQRqIAAQDiAGKAIMIgcgBi0ABEEBaksNASAAQQRqIQogBkEAOgAFIAYgBzoABiAAIAYoAgQ2AgAgB0EBaiEJQQEhBANAIAQgCUkEQCADIARBAnRqIgEoAgAhACABIAU2AgAgACAEQX9qdCAFaiEFIARBAWohBAwBCwsgB0EBaiEHQQAhBSAGKAIIIQkDQCAFIAlGDQEgAyAFIAxqLQAAIgRBAnRqIgBBASAEdEEBdSILIAAoAgAiAWoiADYCACAHIARrIQhBACEEAkAgC0EDTQRAA0AgBCALRg0CIAogASAEakEBdGoiACAIOgABIAAgBToAACAEQQFqIQQMAAALAAsDQCABIABPDQEgCiABQQF0aiIEIAg6AAEgBCAFOgAAIAQgCDoAAyAEIAU6AAIgBCAIOgAFIAQgBToABCAEIAg6AAcgBCAFOgAGIAFBBGohAQwAAAsACyAFQQFqIQUMAAALAAsgAiEECyAGQRBqJAAgBAutAQECfwJAQYQgKAIAIABHIAAoAgBBAXYiAyABa0F4aiICQXhxQQhHcgR/IAIFIAMQJ0UNASACQQhqC0EQSQ0AIAAgACgCACICQQFxIAAgAWpBD2pBeHEiASAAa0EBdHI2AgAgASAANgIEIAEgASgCAEEBcSAAIAJBAXZqIAFrIgJBAXRyNgIAQYQgIAEgAkH/////B3FqQQRqQYQgKAIAIABGGyABNgIAIAEQJQsLygIBBX8CQAJAAkAgAEEIIABBCEsbZ0EfcyAAaUEBR2oiAUEESSAAIAF2cg0AIAFBAnRB/B5qKAIAIgJFDQADQCACQXhqIgMoAgBBAXZBeGoiBSAATwRAIAIgBUEIIAVBCEsbZ0Efc0ECdEGAH2oiASgCAEYEQCABIAIoAgQ2AgALDAMLIARBHksNASAEQQFqIQQgAigCBCICDQALC0EAIQMgAUEgTw0BA0AgAUECdEGAH2ooAgAiAkUEQCABQR5LIQIgAUEBaiEBIAJFDQEMAwsLIAIgAkF4aiIDKAIAQQF2QXhqIgFBCCABQQhLG2dBH3NBAnRBgB9qIgEoAgBGBEAgASACKAIENgIACwsgAigCACIBBEAgASACKAIENgIECyACKAIEIgEEQCABIAIoAgA2AgALIAMgAygCAEEBcjYCACADIAAQNwsgAwvhCwINfwV+IwBB8ABrIgckACAHIAAoAvDhASIINgJcIAEgAmohDSAIIAAoAoDiAWohDwJAAkAgBUUEQCABIQQMAQsgACgCxOABIRAgACgCwOABIREgACgCvOABIQ4gAEEBNgKM4QFBACEIA0AgCEEDRwRAIAcgCEECdCICaiAAIAJqQazQAWooAgA2AkQgCEEBaiEIDAELC0FsIQwgB0EYaiADIAQQBhADDQEgB0EsaiAHQRhqIAAoAgAQEyAHQTRqIAdBGGogACgCCBATIAdBPGogB0EYaiAAKAIEEBMgDUFgaiESIAEhBEEAIQwDQCAHKAIwIAcoAixBA3RqKQIAIhRCEIinQf8BcSEIIAcoAkAgBygCPEEDdGopAgAiFUIQiKdB/wFxIQsgBygCOCAHKAI0QQN0aikCACIWQiCIpyEJIBVCIIghFyAUQiCIpyECAkAgFkIQiKdB/wFxIgNBAk8EQAJAIAZFIANBGUlyRQRAIAkgB0EYaiADQSAgBygCHGsiCiAKIANLGyIKEAUgAyAKayIDdGohCSAHQRhqEAQaIANFDQEgB0EYaiADEAUgCWohCQwBCyAHQRhqIAMQBSAJaiEJIAdBGGoQBBoLIAcpAkQhGCAHIAk2AkQgByAYNwNIDAELAkAgA0UEQCACBEAgBygCRCEJDAMLIAcoAkghCQwBCwJAAkAgB0EYakEBEAUgCSACRWpqIgNBA0YEQCAHKAJEQX9qIgMgA0VqIQkMAQsgA0ECdCAHaigCRCIJIAlFaiEJIANBAUYNAQsgByAHKAJINgJMCwsgByAHKAJENgJIIAcgCTYCRAsgF6chAyALBEAgB0EYaiALEAUgA2ohAwsgCCALakEUTwRAIAdBGGoQBBoLIAgEQCAHQRhqIAgQBSACaiECCyAHQRhqEAQaIAcgB0EYaiAUQhiIp0H/AXEQCCAUp0H//wNxajYCLCAHIAdBGGogFUIYiKdB/wFxEAggFadB//8DcWo2AjwgB0EYahAEGiAHIAdBGGogFkIYiKdB/wFxEAggFqdB//8DcWo2AjQgByACNgJgIAcoAlwhCiAHIAk2AmggByADNgJkAkACQAJAIAQgAiADaiILaiASSw0AIAIgCmoiEyAPSw0AIA0gBGsgC0Egak8NAQsgByAHKQNoNwMQIAcgBykDYDcDCCAEIA0gB0EIaiAHQdwAaiAPIA4gESAQEB4hCwwBCyACIARqIQggBCAKEAcgAkERTwRAIARBEGohAgNAIAIgCkEQaiIKEAcgAkEQaiICIAhJDQALCyAIIAlrIQIgByATNgJcIAkgCCAOa0sEQCAJIAggEWtLBEBBbCELDAILIBAgAiAOayICaiIKIANqIBBNBEAgCCAKIAMQDxoMAgsgCCAKQQAgAmsQDyEIIAcgAiADaiIDNgJkIAggAmshCCAOIQILIAlBEE8EQCADIAhqIQMDQCAIIAIQByACQRBqIQIgCEEQaiIIIANJDQALDAELAkAgCUEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgCUECdCIDQcAeaigCAGoiAhAXIAIgA0HgHmooAgBrIQIgBygCZCEDDAELIAggAhAMCyADQQlJDQAgAyAIaiEDIAhBCGoiCCACQQhqIgJrQQ9MBEADQCAIIAIQDCACQQhqIQIgCEEIaiIIIANJDQAMAgALAAsDQCAIIAIQByACQRBqIQIgCEEQaiIIIANJDQALCyAHQRhqEAQaIAsgDCALEAMiAhshDCAEIAQgC2ogAhshBCAFQX9qIgUNAAsgDBADDQFBbCEMIAdBGGoQBEECSQ0BQQAhCANAIAhBA0cEQCAAIAhBAnQiAmpBrNABaiACIAdqKAJENgIAIAhBAWohCAwBCwsgBygCXCEIC0G6fyEMIA8gCGsiACANIARrSw0AIAQEfyAEIAggABALIABqBUEACyABayEMCyAHQfAAaiQAIAwLkRcCFn8FfiMAQdABayIHJAAgByAAKALw4QEiCDYCvAEgASACaiESIAggACgCgOIBaiETAkACQCAFRQRAIAEhAwwBCyAAKALE4AEhESAAKALA4AEhFSAAKAK84AEhDyAAQQE2AozhAUEAIQgDQCAIQQNHBEAgByAIQQJ0IgJqIAAgAmpBrNABaigCADYCVCAIQQFqIQgMAQsLIAcgETYCZCAHIA82AmAgByABIA9rNgJoQWwhECAHQShqIAMgBBAGEAMNASAFQQQgBUEESBshFyAHQTxqIAdBKGogACgCABATIAdBxABqIAdBKGogACgCCBATIAdBzABqIAdB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IAdB0AFqJAAgEAslACAAQgA3AgAgAEEAOwEIIABBADoACyAAIAE2AgwgACACOgAKC7QFAQN/IwBBMGsiBCQAIABB/wFqIgVBfWohBgJAIAMvAQIEQCAEQRhqIAEgAhAGIgIQAw0BIARBEGogBEEYaiADEBwgBEEIaiAEQRhqIAMQHCAAIQMDQAJAIARBGGoQBCADIAZPckUEQCADIARBEGogBEEYahASOgAAIAMgBEEIaiAEQRhqEBI6AAEgBEEYahAERQ0BIANBAmohAwsgBUF+aiEFAn8DQEG6fyECIAMiASAFSw0FIAEgBEEQaiAEQRhqEBI6AAAgAUEBaiEDIARBGGoQBEEDRgRAQQIhAiAEQQhqDAILIAMgBUsNBSABIARBCGogBEEYahASOgABIAFBAmohA0EDIQIgBEEYahAEQQNHDQALIARBEGoLIQUgAyAFIARBGGoQEjoAACABIAJqIABrIQIMAwsgAyAEQRBqIARBGGoQEjoAAiADIARBCGogBEEYahASOgADIANBBGohAwwAAAsACyAEQRhqIAEgAhAGIgIQAw0AIARBEGogBEEYaiADEBwgBEEIaiAEQRhqIAMQHCAAIQMDQAJAIARBGGoQBCADIAZPckUEQCADIARBEGogBEEYahAROgAAIAMgBEEIaiAEQRhqEBE6AAEgBEEYahAERQ0BIANBAmohAwsgBUF+aiEFAn8DQEG6fyECIAMiASAFSw0EIAEgBEEQaiAEQRhqEBE6AAAgAUEBaiEDIARBGGoQBEEDRgRAQQIhAiAEQQhqDAILIAMgBUsNBCABIARBCGogBEEYahAROgABIAFBAmohA0EDIQIgBEEYahAEQQNHDQALIARBEGoLIQUgAyAFIARBGGoQEToAACABIAJqIABrIQIMAgsgAyAEQRBqIARBGGoQEToAAiADIARBCGogBEEYahAROgADIANBBGohAwwAAAsACyAEQTBqJAAgAgtpAQF/An8CQAJAIAJBB00NACABKAAAQbfIwuF+Rw0AIAAgASgABDYCmOIBQWIgAEEQaiABIAIQPiIDEAMNAhogAEKBgICAEDcDiOEBIAAgASADaiACIANrECoMAQsgACABIAIQKgtBAAsLrQMBBn8jAEGAAWsiAyQAQWIhCAJAIAJBCUkNACAAQZjQAGogAUEIaiIEIAJBeGogAEGY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wOABCwutAgIEfwF+IwBBQGoiBCQAAkACQCACQQhJDQAgASgAAEFwcUHQ1LTCAUcNACABIAIQIiEBIABCADcDCCAAQQA2AgQgACABNgIADAELIARBGGogASACEC0iAxADBEAgACADEBoMAQsgAwRAIABBuH8QGgwBCyACIAQoAjAiA2shAiABIANqIQMDQAJAIAAgAyACIARBCGoQLCIFEAMEfyAFBSACIAVBA2oiBU8NAUG4fwsQGgwCCyAGQQFqIQYgAiAFayECIAMgBWohAyAEKAIMRQ0ACyAEKAI4BEAgAkEDTQRAIABBuH8QGgwCCyADQQRqIQMLIAQoAighAiAEKQMYIQcgAEEANgIEIAAgAyABazYCACAAIAIgBmytIAcgB0J/URs3AwgLIARBQGskAAslAQF/IwBBEGsiAiQAIAIgACABEFEgAigCACEAIAJBEGokACAAC30BBH8jAEGQBGsiBCQAIARB/wE2AggCQCAEQRBqIARBCGogBEEMaiABIAIQFSIGEAMEQCAGIQUMAQtBVCEFIAQoAgwiB0EGSw0AIAMgBEEQaiAEKAIIIAcQQSIFEAMNACAAIAEgBmogAiAGayADEDwhBQsgBEGQBGokACAFC4cBAgJ/An5BABAWIQMCQANAIAEgA08EQAJAIAAoAABBcHFB0NS0wgFGBEAgACABECIiAhADRQ0BQn4PCyAAIAEQVSIEQn1WDQMgBCAFfCIFIARUIQJCfiEEIAINAyAAIAEQUiICEAMNAwsgASACayEBIAAgAmohAAwBCwtCfiAFIAEbIQQLIAQLPwIBfwF+IwBBMGsiAiQAAn5CfiACQQhqIAAgARAtDQAaQgAgAigCHEEBRg0AGiACKQMICyEDIAJBMGokACADC40BAQJ/IwBBMGsiASQAAkAgAEUNACAAKAKI4gENACABIABB/OEBaigCADYCKCABIAApAvThATcDICAAEDAgACgCqOIBIQIgASABKAIoNgIYIAEgASkDIDcDECACIAFBEGoQGyAAQQA2AqjiASABIAEoAig2AgggASABKQMgNwMAIAAgARAbCyABQTBqJAALKgECfyMAQRBrIgAkACAAQQA2AgggAEIANwMAIAAQWCEBIABBEGokACABC4cBAQN/IwBBEGsiAiQAAkAgACgCAEUgACgCBEVzDQAgAiAAKAIINgIIIAIgACkCADcDAAJ/IAIoAgAiAQRAIAIoAghBqOMJIAERBQAMAQtBqOMJECgLIgFFDQAgASAAKQIANwL04QEgAUH84QFqIAAoAgg2AgAgARBZIAEhAwsgAkEQaiQAIAMLywEBAn8jAEEgayIBJAAgAEGBgIDAADYCtOIBIABBADYCiOIBIABBADYC7OEBIABCADcDkOIBIABBADYCpOMJIABBADYC3OIBIABCADcCzOIBIABBADYCvOIBIABBADYCxOABIABCADcCnOIBIABBpOIBakIANwIAIABBrOIBakEANgIAIAFCADcCECABQgA3AhggASABKQMYNwMIIAEgASkDEDcDACABKAIIQQh2QQFxIQIgAEEANgLg4gEgACACNgKM4gEgAUEgaiQAC3YBA38jAEEwayIBJAAgAARAIAEgAEHE0AFqIgIoAgA2AiggASAAKQK80AE3AyAgACgCACEDIAEgAigCADYCGCABIAApArzQATcDECADIAFBEGoQGyABIAEoAig2AgggASABKQMgNwMAIAAgARAbCyABQTBqJAALzAEBAX8gACABKAK00AE2ApjiASAAIAEoAgQiAjYCwOABIAAgAjYCvOABIAAgAiABKAIIaiICNgK44AEgACACNgLE4AEgASgCuNABBEAgAEKBgICAEDcDiOEBIAAgAUGk0ABqNgIMIAAgAUGUIGo2AgggACABQZwwajYCBCAAIAFBDGo2AgAgAEGs0AFqIAFBqNABaigCADYCACAAQbDQAWogAUGs0AFqKAIANgIAIABBtNABaiABQbDQAWooAgA2AgAPCyAAQgA3A4jhAQs7ACACRQRAQbp/DwsgBEUEQEFsDwsgAiAEEGAEQCAAIAEgAiADIAQgBRBhDwsgACABIAIgAyAEIAUQZQtGAQF/IwBBEGsiBSQAIAVBCGogBBAOAn8gBS0ACQRAIAAgASACIAMgBBAyDAELIAAgASACIAMgBBA0CyEAIAVBEGokACAACzQAIAAgAyAEIAUQNiIFEAMEQCAFDwsgBSAESQR/IAEgAiADIAVqIAQgBWsgABA1BUG4fwsLRgEBfyMAQRBrIgUkACAFQQhqIAQQDgJ/IAUtAAkEQCAAIAEgAiADIAQQYgwBCyAAIAEgAiADIAQQNQshACAFQRBqJAAgAAtZAQF/QQ8hAiABIABJBEAgAUEE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";class A_ extends eT.CompressedTexture{constructor(e,t,r){super(void 0,e[0].width,e[0].height,t,r,eT.CubeReflectionMapping),this.isCompressedCubeTexture=!0,this.isCubeTexture=!0,this.image=e}}class AM extends eT.CompressedTexture{constructor(e,t,r,i,n,a){super(e,t,r,n,a),this.isCompressedArrayTexture=!0,this.image.depth=i,this.wrapR=eT.ClampToEdgeWrapping}}class AS extends eT.Texture{constructor(e=null,t=1,r=1,i=1){super(null),this.isData3DTexture=!0,this.image={data:e,width:t,height:r,depth:i},this.magFilter=eT.NearestFilter,this.minFilter=eT.NearestFilter,this.wrapR=eT.ClampToEdgeWrapping,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}var AD=Object.defineProperty,AT=(e,t,r)=>t in e?AD(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,AR=(e,t,r)=>(AT(e,"symbol"!=typeof t?t+"":t,r),r);let AF="srgb",AP=new WeakMap,AQ=0,Az=(()=>{let e=class extends eT.Loader{constructor(e){super(e),this.transcoderPath="",this.transcoderBinary=null,this.transcoderPending=null,this.workerPool=new Ag,this.workerSourceURL="",this.workerConfig=null,"undefined"!=typeof MSC_TRANSCODER&&console.warn('THREE.KTX2Loader: Please update to latest "basis_transcoder". "msc_basis_transcoder" is no longer supported in three.js r125+.')}setTranscoderPath(e){return this.transcoderPath=e,this}setWorkerLimit(e){return this.workerPool.setWorkerLimit(e),this}detectSupport(e){return this.workerConfig={astcSupported:e.extensions.has("WEBGL_compressed_texture_astc"),etc1Supported:e.extensions.has("WEBGL_compressed_texture_etc1"),etc2Supported:e.extensions.has("WEBGL_compressed_texture_etc"),dxtSupported:e.extensions.has("WEBGL_compressed_texture_s3tc"),bptcSupported:e.extensions.has("EXT_texture_compression_bptc"),pvrtcSupported:e.extensions.has("WEBGL_compressed_texture_pvrtc")||e.extensions.has("WEBKIT_WEBGL_compressed_texture_pvrtc")},e.capabilities.isWebGL2&&(this.workerConfig.etc1Supported=!1),this}init(){if(!this.transcoderPending){let t=new eT.FileLoader(this.manager);t.setPath(this.transcoderPath),t.setWithCredentials(this.withCredentials);let r=t.loadAsync("basis_transcoder.js"),i=new eT.FileLoader(this.manager);i.setPath(this.transcoderPath),i.setResponseType("arraybuffer"),i.setWithCredentials(this.withCredentials);let n=i.loadAsync("basis_transcoder.wasm");this.transcoderPending=Promise.all([r,n]).then(([t,r])=>{let i=e.BasisWorker.toString(),n=["/* constants */","let _EngineFormat = "+JSON.stringify(e.EngineFormat),"let _TranscoderFormat = "+JSON.stringify(e.TranscoderFormat),"let _BasisFormat = "+JSON.stringify(e.BasisFormat),"/* basis_transcoder.js */",t,"/* worker */",i.substring(i.indexOf("{")+1,i.lastIndexOf("}"))].join("\n");this.workerSourceURL=URL.createObjectURL(new Blob([n])),this.transcoderBinary=r,this.workerPool.setWorkerCreator(()=>{let e=new Worker(this.workerSourceURL),t=this.transcoderBinary.slice(0);return e.postMessage({type:"init",config:this.workerConfig,transcoderBinary:t},[t]),e})}),AQ>0&&console.warn("THREE.KTX2Loader: Multiple active KTX2 loaders may cause performance issues. Use a single KTX2Loader instance, or call .dispose() on old instances."),AQ++}return this.transcoderPending}load(e,t,r,i){if(null===this.workerConfig)throw Error("THREE.KTX2Loader: Missing initialization with `.detectSupport( renderer )`.");let n=new eT.FileLoader(this.manager);n.setResponseType("arraybuffer"),n.setWithCredentials(this.withCredentials),n.load(e,e=>{if(AP.has(e))return AP.get(e).promise.then(t).catch(i);this._createTexture(e).then(e=>t?t(e):null).catch(i)},r,i)}_createTextureFrom(e,t){let r;let{faces:i,width:n,height:a,format:o,type:s,error:l,dfdFlags:c}=e;if("error"===s)return Promise.reject(l);if(6===t.faceCount)r=new A_(i,o,eT.UnsignedByteType);else{let e=i[0].mipmaps;r=t.layerCount>1?new AM(e,n,a,t.layerCount,o,eT.UnsignedByteType):new eT.CompressedTexture(e,n,a,o,eT.UnsignedByteType)}r.minFilter=1===i[0].mipmaps.length?eT.LinearFilter:eT.LinearMipmapLinearFilter,r.magFilter=eT.LinearFilter,r.generateMipmaps=!1,r.needsUpdate=!0;let u=AG(t);return"colorSpace"in r?r.colorSpace=u:r.encoding=u===AF?3001:3e3,r.premultiplyAlpha=!!(1&c),r}async _createTexture(e,t={}){let r=function(e){let t=new Uint8Array(e.buffer,e.byteOffset,Ax.length);if(t[0]!==Ax[0]||t[1]!==Ax[1]||t[2]!==Ax[2]||t[3]!==Ax[3]||t[4]!==Ax[4]||t[5]!==Ax[5]||t[6]!==Ax[6]||t[7]!==Ax[7]||t[8]!==Ax[8]||t[9]!==Ax[9]||t[10]!==Ax[10]||t[11]!==Ax[11])throw Error("Missing KTX 2.0 identifier.");let r=new Av,i=17*Uint32Array.BYTES_PER_ELEMENT,n=new AE(e,Ax.length,i,!0);r.vkFormat=n._nextUint32(),r.typeSize=n._nextUint32(),r.pixelWidth=n._nextUint32(),r.pixelHeight=n._nextUint32(),r.pixelDepth=n._nextUint32(),r.layerCount=n._nextUint32(),r.faceCount=n._nextUint32();let a=n._nextUint32();r.supercompressionScheme=n._nextUint32();let o=n._nextUint32(),s=n._nextUint32(),l=n._nextUint32(),c=n._nextUint32(),u=n._nextUint64(),h=n._nextUint64(),A=new AE(e,Ax.length+i,24*a,!0);for(let t=0;t<a;t++)r.levels.push({levelData:new Uint8Array(e.buffer,e.byteOffset+A._nextUint64(),A._nextUint64()),uncompressedByteLength:A._nextUint64()});let d=new AE(e,o,s,!0),f={vendorId:d._skip(4)._nextUint16(),descriptorType:d._nextUint16(),versionNumber:d._nextUint16(),descriptorBlockSize:d._nextUint16(),colorModel:d._nextUint8(),colorPrimaries:d._nextUint8(),transferFunction:d._nextUint8(),flags:d._nextUint8(),texelBlockDimension:[d._nextUint8(),d._nextUint8(),d._nextUint8(),d._nextUint8()],bytesPlane:[d._nextUint8(),d._nextUint8(),d._nextUint8(),d._nextUint8(),d._nextUint8(),d._nextUint8(),d._nextUint8(),d._nextUint8()],samples:[]},m=(f.descriptorBlockSize/4-6)/4;for(let e=0;e<m;e++){let t={bitOffset:d._nextUint16(),bitLength:d._nextUint8(),channelType:d._nextUint8(),samplePosition:[d._nextUint8(),d._nextUint8(),d._nextUint8(),d._nextUint8()],sampleLower:-1/0,sampleUpper:1/0};64&t.channelType?(t.sampleLower=d._nextInt32(),t.sampleUpper=d._nextInt32()):(t.sampleLower=d._nextUint32(),t.sampleUpper=d._nextUint32()),f.samples[e]=t}r.dataFormatDescriptor.length=0,r.dataFormatDescriptor.push(f);let p=new AE(e,l,c,!0);for(;p._offset<c;){let e=p._nextUint32(),t=p._scan(e),i=AC(t);if(r.keyValue[i]=p._nextUint8Array(e-t.byteLength-1),i.match(/^ktx/i)){let e=AC(r.keyValue[i]);r.keyValue[i]=e.substring(0,e.lastIndexOf("\x00"))}let n=e%4?4-e%4:0;p._skip(n)}if(h<=0)return r;let g=new AE(e,u,h,!0),y=g._nextUint16(),v=g._nextUint16(),E=g._nextUint32(),x=g._nextUint32(),C=g._nextUint32(),B=g._nextUint32(),w=[];for(let e=0;e<a;e++)w.push({imageFlags:g._nextUint32(),rgbSliceByteOffset:g._nextUint32(),rgbSliceByteLength:g._nextUint32(),alphaSliceByteOffset:g._nextUint32(),alphaSliceByteLength:g._nextUint32()});let I=u+g._offset,b=I+E,_=b+x,M=_+C,S=new Uint8Array(e.buffer,e.byteOffset+I,E),D=new Uint8Array(e.buffer,e.byteOffset+b,x),T=new Uint8Array(e.buffer,e.byteOffset+_,C),R=new Uint8Array(e.buffer,e.byteOffset+M,B);return r.globalData={endpointCount:y,selectorCount:v,imageDescs:w,endpointsData:S,selectorsData:D,tablesData:T,extendedData:R},r}(new Uint8Array(e));if(0!==r.vkFormat)return Ak(r);let i=this.init().then(()=>this.workerPool.postMessage({type:"transcode",buffer:e,taskConfig:t},[e])).then(e=>this._createTextureFrom(e.data,r));return AP.set(e,{promise:i}),i}dispose(){return this.workerPool.dispose(),this.workerSourceURL&&URL.revokeObjectURL(this.workerSourceURL),AQ--,this}};return AR(e,"BasisFormat",{ETC1S:0,UASTC_4x4:1}),AR(e,"TranscoderFormat",{ETC1:0,ETC2:1,BC1:2,BC3:3,BC4:4,BC5:5,BC7_M6_OPAQUE_ONLY:6,BC7_M5:7,PVRTC1_4_RGB:8,PVRTC1_4_RGBA:9,ASTC_4x4:10,ATC_RGB:11,ATC_RGBA_INTERPOLATED_ALPHA:12,RGBA32:13,RGB565:14,BGR565:15,RGBA4444:16}),AR(e,"EngineFormat",{RGBAFormat:eT.RGBAFormat,RGBA_ASTC_4x4_Format:eT.RGBA_ASTC_4x4_Format,RGBA_BPTC_Format:eT.RGBA_BPTC_Format,RGBA_ETC2_EAC_Format:eT.RGBA_ETC2_EAC_Format,RGBA_PVRTC_4BPPV1_Format:eT.RGBA_PVRTC_4BPPV1_Format,RGBA_S3TC_DXT5_Format:eT.RGBA_S3TC_DXT5_Format,RGB_ETC1_Format:eT.RGB_ETC1_Format,RGB_ETC2_Format:eT.RGB_ETC2_Format,RGB_PVRTC_4BPPV1_Format:eT.RGB_PVRTC_4BPPV1_Format,RGB_S3TC_DXT1_Format:eT.RGB_S3TC_DXT1_Format}),AR(e,"BasisWorker",function(){let e,t,r;let i=_EngineFormat,n=_TranscoderFormat,a=_BasisFormat;self.addEventListener("message",function(o){let u=o.data;switch(u.type){case"init":var h;e=u.config,h=u.transcoderBinary,t=new Promise(e=>{r={wasmBinary:h,onRuntimeInitialized:e},BASIS(r)}).then(()=>{r.initializeBasis(),void 0===r.KTX2File&&console.warn("THREE.KTX2Loader: Please update Basis Universal transcoder.")});break;case"transcode":t.then(()=>{try{let{faces:t,buffers:o,width:h,height:A,hasAlpha:d,format:f,dfdFlags:m}=function(t){let o=new r.KTX2File(new Uint8Array(t));function u(){o.close(),o.delete()}if(!o.isValid())throw u(),Error("THREE.KTX2Loader:	Invalid or unsupported .ktx2 file");let h=o.isUASTC()?a.UASTC_4x4:a.ETC1S,A=o.getWidth(),d=o.getHeight(),f=o.getLayers()||1,m=o.getLevels(),p=o.getFaces(),g=o.getHasAlpha(),y=o.getDFDFlags(),{transcoderFormat:v,engineFormat:E}=function(t,r,o,u){let h;let A=t===a.ETC1S?s:l;for(let i=0;i<A.length;i++){let n=A[i];if(e[n.if]&&n.basisFormat.includes(t)&&(!u||!(n.transcoderFormat.length<2))&&(!n.needsPowerOfTwo||c(r)&&c(o)))return{transcoderFormat:n.transcoderFormat[u?1:0],engineFormat:n.engineFormat[u?1:0]}}return console.warn("THREE.KTX2Loader: No suitable compressed texture format found. Decoding to RGBA32."),{transcoderFormat:n.RGBA32,engineFormat:i.RGBAFormat}}(h,A,d,g);if(!A||!d||!m)throw u(),Error("THREE.KTX2Loader:	Invalid texture");if(!o.startTranscoding())throw u(),Error("THREE.KTX2Loader: .startTranscoding failed");let x=[],C=[];for(let e=0;e<p;e++){let t=[];for(let r=0;r<m;r++){let i,n;let a=[];for(let t=0;t<f;t++){let s=o.getImageLevelInfo(r,t,e);0===e&&0===r&&0===t&&(s.origWidth%4!=0||s.origHeight%4!=0)&&console.warn("THREE.KTX2Loader: ETC1S and UASTC textures should use multiple-of-four dimensions."),m>1?(i=s.origWidth,n=s.origHeight):(i=s.width,n=s.height);let l=new Uint8Array(o.getImageTranscodedSizeInBytes(r,t,0,v));if(!o.transcodeImage(l,r,t,e,v,0,-1,-1))throw u(),Error("THREE.KTX2Loader: .transcodeImage failed.");a.push(l)}let s=function(e){if(1===e.length)return e[0];let t=0;for(let r=0;r<e.length;r++)t+=e[r].byteLength;let r=new Uint8Array(t),i=0;for(let t=0;t<e.length;t++){let n=e[t];r.set(n,i),i+=n.byteLength}return r}(a);t.push({data:s,width:i,height:n}),C.push(s.buffer)}x.push({mipmaps:t,width:A,height:d,format:E})}return u(),{faces:x,buffers:C,width:A,height:d,hasAlpha:g,format:E,dfdFlags:y}}(u.buffer);self.postMessage({type:"transcode",id:u.id,faces:t,width:h,height:A,hasAlpha:d,format:f,dfdFlags:m},o)}catch(e){console.error(e),self.postMessage({type:"error",id:u.id,error:e.message})}})}});let o=[{if:"astcSupported",basisFormat:[a.UASTC_4x4],transcoderFormat:[n.ASTC_4x4,n.ASTC_4x4],engineFormat:[i.RGBA_ASTC_4x4_Format,i.RGBA_ASTC_4x4_Format],priorityETC1S:1/0,priorityUASTC:1,needsPowerOfTwo:!1},{if:"bptcSupported",basisFormat:[a.ETC1S,a.UASTC_4x4],transcoderFormat:[n.BC7_M5,n.BC7_M5],engineFormat:[i.RGBA_BPTC_Format,i.RGBA_BPTC_Format],priorityETC1S:3,priorityUASTC:2,needsPowerOfTwo:!1},{if:"dxtSupported",basisFormat:[a.ETC1S,a.UASTC_4x4],transcoderFormat:[n.BC1,n.BC3],engineFormat:[i.RGB_S3TC_DXT1_Format,i.RGBA_S3TC_DXT5_Format],priorityETC1S:4,priorityUASTC:5,needsPowerOfTwo:!1},{if:"etc2Supported",basisFormat:[a.ETC1S,a.UASTC_4x4],transcoderFormat:[n.ETC1,n.ETC2],engineFormat:[i.RGB_ETC2_Format,i.RGBA_ETC2_EAC_Format],priorityETC1S:1,priorityUASTC:3,needsPowerOfTwo:!1},{if:"etc1Supported",basisFormat:[a.ETC1S,a.UASTC_4x4],transcoderFormat:[n.ETC1],engineFormat:[i.RGB_ETC1_Format],priorityETC1S:2,priorityUASTC:4,needsPowerOfTwo:!1},{if:"pvrtcSupported",basisFormat:[a.ETC1S,a.UASTC_4x4],transcoderFormat:[n.PVRTC1_4_RGB,n.PVRTC1_4_RGBA],engineFormat:[i.RGB_PVRTC_4BPPV1_Format,i.RGBA_PVRTC_4BPPV1_Format],priorityETC1S:5,priorityUASTC:6,needsPowerOfTwo:!0}],s=o.sort(function(e,t){return e.priorityETC1S-t.priorityETC1S}),l=o.sort(function(e,t){return e.priorityUASTC-t.priorityUASTC});function c(e){return e<=2||(e&e-1)==0&&0!==e}}),e})(),AL=new Set([eT.RGBAFormat,eT.RGFormat,eT.RedFormat]),AO={109:eT.RGBAFormat,97:eT.RGBAFormat,37:eT.RGBAFormat,43:eT.RGBAFormat,103:eT.RGFormat,83:eT.RGFormat,16:eT.RGFormat,22:eT.RGFormat,100:eT.RedFormat,76:eT.RedFormat,15:eT.RedFormat,9:eT.RedFormat,166:eT.RGBA_ASTC_6x6_Format,165:eT.RGBA_ASTC_6x6_Format},AU={109:eT.FloatType,97:eT.HalfFloatType,37:eT.UnsignedByteType,43:eT.UnsignedByteType,103:eT.FloatType,83:eT.HalfFloatType,16:eT.UnsignedByteType,22:eT.UnsignedByteType,100:eT.FloatType,76:eT.HalfFloatType,15:eT.UnsignedByteType,9:eT.UnsignedByteType,166:eT.UnsignedByteType,165:eT.UnsignedByteType};async function Ak(e){let t,r;let{vkFormat:i}=e;if(void 0===AO[i])throw Error("THREE.KTX2Loader: Unsupported vkFormat.");2===e.supercompressionScheme&&(Q||(Q=new Promise(async e=>{let t=new AI;await t.init(),e(t)})),t=await Q);let n=[];for(let r=0;r<e.levels.length;r++){let a,o;let s=Math.max(1,e.pixelWidth>>r),l=Math.max(1,e.pixelHeight>>r),c=e.pixelDepth?Math.max(1,e.pixelDepth>>r):0,u=e.levels[r];if(0===e.supercompressionScheme)a=u.levelData;else if(2===e.supercompressionScheme)a=t.decode(u.levelData,u.uncompressedByteLength);else throw Error("THREE.KTX2Loader: Unsupported supercompressionScheme.");o=AU[i]===eT.FloatType?new Float32Array(a.buffer,a.byteOffset,a.byteLength/Float32Array.BYTES_PER_ELEMENT):AU[i]===eT.HalfFloatType?new Uint16Array(a.buffer,a.byteOffset,a.byteLength/Uint16Array.BYTES_PER_ELEMENT):a,n.push({data:o,width:s,height:l,depth:c})}if(AL.has(AO[i]))r=0===e.pixelDepth?new eT.DataTexture(n[0].data,e.pixelWidth,e.pixelHeight):new AS(n[0].data,e.pixelWidth,e.pixelHeight,e.pixelDepth);else{if(e.pixelDepth>0)throw Error("THREE.KTX2Loader: Unsupported pixelDepth.");r=new eT.CompressedTexture(n,e.pixelWidth,e.pixelHeight)}r.mipmaps=n,r.type=AU[i],r.format=AO[i],r.needsUpdate=!0;let a=AG(e);return"colorSpace"in r?r.colorSpace=a:r.encoding=a===AF?3001:3e3,Promise.resolve(r)}function AG(e){let t=e.dataFormatDescriptor[0];return 1===t.colorPrimaries?2===t.transferFunction?AF:"srgb-linear":10===t.colorPrimaries?2===t.transferFunction?"display-p3":"display-p3-linear":(0===t.colorPrimaries||console.warn(`THREE.KTX2Loader: Unsupported color primaries, "${t.colorPrimaries}"`),"")}let AN="https://cdn.jsdelivr.net/gh/pmndrs/drei-assets@master";function AH(e,t=`${AN}/basis/`){let r=(0,eR.D)(e=>e.gl),i=(0,eR.H)(Az,sC(e)?Object.values(e):e,e=>{e.detectSupport(r),e.setTranscoderPath(t)});if((0,eS.useEffect)(()=>{(Array.isArray(i)?i:[i]).forEach(r.initTexture)},[r,i]),!sC(e))return i;{let t=Object.keys(e),r={};return t.forEach(e=>Object.assign(r,{[e]:i[t.indexOf(e)]})),r}}AH.preload=(e,t=`${AN}/basis/`)=>eR.H.preload(Az,e,e=>{e.setTranscoderPath(t)}),AH.clear=e=>eR.H.clear(Az,e);let AV=({children:e,input:t,basisPath:r})=>{let i=AH(t,r);return eS.createElement(eS.Fragment,null,null==e?void 0:e(i))};var Aj=r(2513);let AJ="undefined"!=typeof window&&"function"==typeof(null==(K=window.document)?void 0:K.createElement)&&"string"==typeof(null==(q=window.navigator)?void 0:q.userAgent),AY=null;async function AW(...e){var t;null!==(t=AY)&&void 0!==t||(AY=await Promise.resolve().then(r.bind(r,2513)));let i=AY.default;return i.isSupported()?new i(...e):null}function AK(e,{unsuspend:t="loadedmetadata",start:r=!0,hls:i={},crossOrigin:n="anonymous",muted:a=!0,loop:o=!0,playsInline:s=!0,onVideoFrame:l,...c}={}){let u=(0,eR.D)(e=>e.gl),h=(0,eS.useRef)(null),A=(0,ok.Rq)(()=>new Promise(async r=>{let l,A;"string"==typeof e?l=e:A=e;let d=Object.assign(document.createElement("video"),{src:l,srcObject:A,crossOrigin:n,loop:o,muted:a,playsInline:s,...c});if(l&&AJ&&l.endsWith(".m3u8")){let e=h.current=await AW(i);e&&(e.on(Aj.Events.MEDIA_ATTACHED,()=>void e.loadSource(l)),e.attachMedia(d))}let f=new eT.VideoTexture(d);"colorSpace"in f?f.colorSpace=u.outputColorSpace:f.encoding=u.outputEncoding,d.addEventListener(t,()=>r(f))}),[e]);return AX(A.source.data,l),(0,eS.useEffect)(()=>(r&&A.image.play(),()=>{h.current&&(h.current.destroy(),h.current=null)}),[A,r]),A}let Aq=(0,eS.forwardRef)(({children:e,src:t,...r},i)=>{let n=AK(t,r);return(0,eS.useEffect)(()=>()=>void n.dispose(),[n]),(0,eS.useImperativeHandle)(i,()=>n,[n]),eS.createElement(eS.Fragment,null,null==e?void 0:e(n))}),AX=(e,t)=>{(0,eS.useEffect)(()=>{let r;if(!t||!e.requestVideoFrameCallback)return;let i=(...n)=>{t(...n),r=e.requestVideoFrameCallback(i)};return e.requestVideoFrameCallback(i),()=>e.cancelVideoFrameCallback(r)},[e,t])},AZ=(e,t)=>{if(Array.isArray(e))return e[0];{let r=null!=t?t:Object.keys(e)[0];return e[r][0]}},A$=e=>{for(let t=3;t<e.length;t+=4)if(0!==e[t])return!1;return!0};function A1(e,t,r,i,n,a){let o=eS.useRef((0,eR.D)(e=>e.viewport)),s=eS.useRef(null),l=eS.useRef(0),c=eS.useRef(e),u=eS.useRef(t),h=eS.useRef(r),[A,d]=(0,eS.useState)(null),[f,m]=eS.useState(new eT.Texture),p=eS.useMemo(()=>new eT.TextureLoader,[]),[g,y]=(0,eS.useState)(null),v=eS.useCallback((e,t,r)=>{let i=t*(o.current.aspect>e/t?o.current.width/e:o.current.height/t),n=e*(o.current.aspect>e/t?o.current.width/e:o.current.height/t)*r,a=i*r,s=Math.min(1,n),l=Math.min(1,a);return n>1&&(s=1,l=a/n*1),new eT.Vector3(s,l,1)},[]),E=eS.useCallback((e,t)=>{if(!e.image)return{rows:0,columns:0,frameWidth:0,frameHeight:0,emptyFrames:[]};{let r=document.createElement("canvas"),i=r.getContext("2d",a);if(!i)throw Error("Failed to get 2d context");r.width=e.image.width,r.height=e.image.height,i.drawImage(e.image,0,0);let n=e.image.width,o=e.image.height,s=Math.round(Math.sqrt(n/o*t)),l=Math.round(t/s),c=n/s,u=o/l,h=[];for(let e=0;e<l;e++)for(let r=0;r<s;r++){if(e*s+r>=t){h.push({row:e,col:r});continue}A$(i.getImageData(r*c,e*u,c,u).data)&&h.push({row:e,col:r})}return{rows:l,columns:s,frameWidth:c,frameHeight:u,emptyFrames:h}}},[a]),x=eS.useCallback(e=>{let t=e=>{let t=null;for(let r of e){let{w:e,h:i}=r.frame,n=e*i;(!t||n>t.area)&&(t={w:e,h:i,area:n})}return e.map(e=>{let{w:r,h:i}=e.frame,n=r*i,a=t?n===t.area?1:Math.sqrt(n/t.area):1;return{...e,scaleRatio:a}})};if(Array.isArray(e))return t(e);{let r={};for(let i in e)r[i]=t(e[i]);return r}},[]),C=eS.useCallback(()=>{let e={},t=s.current,r=h.current;if(t){if(r&&Array.isArray(t.frames)){for(let i=0;i<r.length;i++)for(let n of(e[r[i]]=[],t.frames)){let t=n.frame,a=n.sourceSize.w,o=n.sourceSize.h;"string"==typeof n.filename&&-1!==n.filename.toLowerCase().indexOf(r[i].toLowerCase())&&e[r[i]].push({...n,frame:t,sourceSize:{w:a,h:o}})}for(let t in e){let r=x(e[t]);Array.isArray(r)&&(e[t]=r)}return e}if(r&&"object"==typeof t.frames){for(let i=0;i<r.length;i++)for(let n in e[r[i]]=[],t.frames){let a=t.frames[n],o=a.frame,s=a.sourceSize.w,l=a.sourceSize.h;"string"==typeof n&&-1!==n.toLowerCase().indexOf(r[i].toLowerCase())&&e[r[i]].push({...a,frame:o,sourceSize:{w:s,h:l}})}for(let t in e){let r=x(e[t]);Array.isArray(r)&&(e[t]=r)}return e}{let e=[];return null!=t&&t.frames&&(e=Array.isArray(t.frames)?t.frames.map(e=>({...e,x:e.frame.x,y:e.frame.y,w:e.frame.w,h:e.frame.h})):Object.values(t.frames).flat().map(e=>({...e,x:e.frame.x,y:e.frame.y,w:e.frame.w,h:e.frame.h}))),x(e)}}return[]},[x,s]),B=eS.useCallback((e,t)=>{let r=new eT.Vector3(1,1,1);if(null===e){if(t&&i){let e=t.image.width,n=t.image.height;l.current=i;let{rows:a,columns:o,frameWidth:c,frameHeight:u,emptyFrames:h}=E(t,i),A={frames:[],meta:{version:"1.0",size:{w:e,h:n},rows:a,columns:o,frameWidth:c,frameHeight:u,scale:"1"}};for(let e=0;e<a;e++)for(let t=0;t<o;t++)!(null!=h?h:[]).some(r=>r.row===e&&r.col===t)&&Array.isArray(A.frames)&&A.frames.push({frame:{x:t*c,y:e*u,w:c,h:u},scaleRatio:1,rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:c,h:u},sourceSize:{w:c,h:u}});r=v(c,u,.1),s.current=A}s.current&&s.current.frames&&(s.current.frames=x(s.current.frames))}else if(t){s.current=e,s.current.frames=C(),l.current=Array.isArray(e.frames)?e.frames.length:Object.keys(e.frames).length;let{w:t,h:i}=AZ(e.frames).sourceSize;r=v(t,i,.1)}d(s.current),"encoding"in t?t.encoding=3001:"colorSpace"in t&&(t.colorSpace=eT.SRGBColorSpace),m(t),y({spriteTexture:t,spriteData:s.current,aspect:r})},[E,i,C,v,x]),w=eS.useCallback((e,t,r)=>{Promise.all([fetch(e).then(e=>e.json()),new Promise(e=>{p.load(t,e)})]).then(e=>{r(e[0],e[1])})},[p]),I=eS.useCallback(e=>{if(!e&&!c.current)throw Error("Either textureUrl or input must be provided");let t=null!=e?e:c.current;if(!t)throw Error("A valid texture URL must be provided");p.load(t,e=>B(null,e))},[p,B]),b=eS.useCallback((e,t)=>{t&&e?w(t,e,B):I(e)},[w,I,B]);return eS.useLayoutEffect(()=>{u.current&&c.current?w(u.current,c.current,B):c.current&&I();let e=c.current;return()=>{e&&eR.H.clear(eT.TextureLoader,e)}},[w,I,B]),eS.useLayoutEffect(()=>{null==n||n(f,null!=A?A:null)},[f,A,n]),{spriteObj:g,loadJsonAndTexture:b}}function A0(e,t,...r){let i=eS.useRef(),n=(0,eR.D)(e=>e.scene);return eS.useLayoutEffect(()=>{let a;if(e&&null!=e&&e.current&&t&&(i.current=a=new t(e.current,...r)),a)return a.traverse(e=>e.raycast=()=>null),n.add(a),()=>{i.current=void 0,n.remove(a),null==a.dispose||a.dispose()}},[n,t,e,...r]),(0,eR.F)(()=>{var e;null==(e=i.current)||null==e.update||e.update()}),i}A1.preload=e=>eR.H.preload(eT.TextureLoader,e),A1.clear=e=>eR.H.clear(eT.TextureLoader,e);let A2=({type:e,args:t=[]})=>{let r=eS.useRef(null),i=eS.useRef(null);return eS.useLayoutEffect(()=>{i.current=r.current.parent}),A0(i,e,...t),eS.createElement("object3D",{ref:r})};var A3=r(6563),A4=r.n(A3);function A5(e,t){"function"==typeof e?e(t):null!=e&&(e.current=t)}function A6({showPanel:e=0,className:t,parent:r}){let i=function(e,t=[],r){let[i,n]=eS.useState();return eS.useLayoutEffect(()=>{let t=e();return n(t),A5(r,t),()=>A5(r,null)},t),i}(()=>new(A4()),[]);return eS.useEffect(()=>{if(i){let n=r&&r.current||document.body;i.showPanel(e),null==n||n.appendChild(i.dom);let a=(null!=t?t:"").split(" ").filter(e=>e);a.length&&i.dom.classList.add(...a);let o=(0,eR.o)(()=>i.begin()),s=(0,eR.p)(()=>i.end());return()=>{a.length&&i.dom.classList.remove(...a),null==n||n.removeChild(i.dom),o(),s()}}},[r,i,t,e]),null}class A8{constructor(e,t,r){this.name=e,this.fg=t,this.bg=r,this.gradient=null,this.PR=Math.round(window.devicePixelRatio||1),this.WIDTH=90*this.PR,this.HEIGHT=48*this.PR,this.TEXT_X=3*this.PR,this.TEXT_Y=2*this.PR,this.GRAPH_X=3*this.PR,this.GRAPH_Y=15*this.PR,this.GRAPH_WIDTH=84*this.PR,this.GRAPH_HEIGHT=30*this.PR,this.canvas=document.createElement("canvas"),this.canvas.width=this.WIDTH,this.canvas.height=this.HEIGHT,this.canvas.style.width="90px",this.canvas.style.height="48px",this.canvas.style.position="absolute",this.canvas.style.cssText="width:90px;height:48px",this.context=this.canvas.getContext("2d"),this.initializeCanvas()}createGradient(){let e;if(!this.context)throw Error("No context");let t=this.context.createLinearGradient(0,this.GRAPH_Y,0,this.GRAPH_Y+this.GRAPH_HEIGHT),r=this.fg;switch(this.fg.toLowerCase()){case"#0ff":e="#006666";break;case"#0f0":e="#006600";break;case"#ff0":e="#666600";break;case"#e1e1e1":e="#666666";break;default:e=this.bg}return t.addColorStop(0,e),t.addColorStop(1,r),t}initializeCanvas(){this.context&&(this.context.font="bold "+9*this.PR+"px Helvetica,Arial,sans-serif",this.context.textBaseline="top",this.gradient=this.createGradient(),this.context.fillStyle=this.bg,this.context.fillRect(0,0,this.WIDTH,this.HEIGHT),this.context.fillStyle=this.fg,this.context.fillText(this.name,this.TEXT_X,this.TEXT_Y),this.context.fillStyle=this.fg,this.context.fillRect(this.GRAPH_X,this.GRAPH_Y,this.GRAPH_WIDTH,this.GRAPH_HEIGHT),this.context.fillStyle=this.bg,this.context.globalAlpha=.9,this.context.fillRect(this.GRAPH_X,this.GRAPH_Y,this.GRAPH_WIDTH,this.GRAPH_HEIGHT))}update(e,t,r,i,n=0){if(!this.context||!this.gradient)return;i=Math.max(i,t),this.context.globalAlpha=1,this.context.fillStyle=this.bg,this.context.fillRect(0,0,this.WIDTH,this.GRAPH_Y),this.context.fillStyle=this.fg,this.context.fillText(`${e.toFixed(n)} ${this.name} (${Math.min(1/0,e).toFixed(n)}-${parseFloat(Math.max(r,e).toFixed(n))})`,this.TEXT_X,this.TEXT_Y),this.context.drawImage(this.canvas,this.GRAPH_X+this.PR,this.GRAPH_Y,this.GRAPH_WIDTH-this.PR,this.GRAPH_HEIGHT,this.GRAPH_X,this.GRAPH_Y,this.GRAPH_WIDTH-this.PR,this.GRAPH_HEIGHT);let a=this.GRAPH_HEIGHT-(1-t/i)*this.GRAPH_HEIGHT;a>0&&(this.context.globalAlpha=1,this.context.fillStyle=this.gradient,this.context.fillRect(this.GRAPH_X+this.GRAPH_WIDTH-this.PR,this.GRAPH_Y+this.GRAPH_HEIGHT-a,this.PR,a))}}let A9=class e{constructor({trackGPU:t=!1,logsPerSecond:r=30,samplesLog:i=60,samplesGraph:n=10,precision:a=2,minimal:o=!1,horizontal:s=!0,mode:l=0}={}){this.gl=null,this.ext=null,this.activeQuery=null,this.gpuQueries=[],this.threeRendererPatched=!1,this.frames=0,this.renderCount=0,this.isRunningCPUProfiling=!1,this.totalCpuDuration=0,this.totalGpuDuration=0,this.totalGpuDurationCompute=0,this.totalFps=0,this.gpuPanel=null,this.gpuPanelCompute=null,this.averageFps={logs:[],graph:[]},this.averageCpu={logs:[],graph:[]},this.averageGpu={logs:[],graph:[]},this.averageGpuCompute={logs:[],graph:[]},this.handleClick=e=>{e.preventDefault(),this.showPanel(++this.mode%this.dom.children.length)},this.handleResize=()=>{this.resizePanel(this.fpsPanel,0),this.resizePanel(this.msPanel,1),this.gpuPanel&&this.resizePanel(this.gpuPanel,2),this.gpuPanelCompute&&this.resizePanel(this.gpuPanelCompute,3)},this.mode=l,this.horizontal=s,this.minimal=o,this.trackGPU=t,this.samplesLog=i,this.samplesGraph=n,this.precision=a,this.logsPerSecond=r,this.dom=document.createElement("div"),this.initializeDOM(),this.beginTime=performance.now(),this.prevTime=this.beginTime,this.prevCpuTime=this.beginTime,this.fpsPanel=this.addPanel(new e.Panel("FPS","#0ff","#002"),0),this.msPanel=this.addPanel(new e.Panel("CPU","#0f0","#020"),1),this.setupEventListeners()}initializeDOM(){this.dom.style.cssText=`
      position: fixed;
      top: 0;
      left: 0;
      opacity: 0.9;
      z-index: 10000;
      ${this.minimal?"cursor: pointer;":""}
    `}setupEventListeners(){this.minimal?(this.dom.addEventListener("click",this.handleClick),this.showPanel(this.mode)):window.addEventListener("resize",this.handleResize)}async init(e){if(!e){console.error('Stats: The "canvas" parameter is undefined.');return}if(this.handleThreeRenderer(e)||!await this.handleWebGPURenderer(e)&&!this.initializeWebGL(e))return}handleThreeRenderer(e){return!!e.isWebGLRenderer&&!this.threeRendererPatched&&(this.patchThreeRenderer(e),this.gl=e.getContext(),this.trackGPU&&this.initializeGPUTracking(),!0)}async handleWebGPURenderer(e){return!!e.isWebGPURenderer&&(this.trackGPU&&(e.backend.trackTimestamp=!0,await e.hasFeatureAsync("timestamp-query")&&this.initializeWebGPUPanels()),this.info=e.info,!0)}initializeWebGPUPanels(){this.gpuPanel=this.addPanel(new e.Panel("GPU","#ff0","#220"),2),this.gpuPanelCompute=this.addPanel(new e.Panel("CPT","#e1e1e1","#212121"),3)}initializeWebGL(e){if(e instanceof WebGL2RenderingContext)this.gl=e;else if(!(e instanceof HTMLCanvasElement||e instanceof OffscreenCanvas))return console.error("Stats: Invalid input type. Expected WebGL2RenderingContext, HTMLCanvasElement, or OffscreenCanvas."),!1;else if(this.gl=e.getContext("webgl2"),!this.gl)return console.error("Stats: Unable to obtain WebGL2 context."),!1;return!0}initializeGPUTracking(){this.gl&&(this.ext=this.gl.getExtension("EXT_disjoint_timer_query_webgl2"),this.ext&&(this.gpuPanel=this.addPanel(new e.Panel("GPU","#ff0","#220"),2)))}begin(){this.isRunningCPUProfiling||this.beginProfiling("cpu-started"),this.gl&&this.ext&&(this.activeQuery&&this.gl.endQuery(this.ext.TIME_ELAPSED_EXT),this.activeQuery=this.gl.createQuery(),this.activeQuery&&this.gl.beginQuery(this.ext.TIME_ELAPSED_EXT,this.activeQuery))}end(){this.renderCount++,this.gl&&this.ext&&this.activeQuery&&(this.gl.endQuery(this.ext.TIME_ELAPSED_EXT),this.gpuQueries.push({query:this.activeQuery}),this.activeQuery=null)}update(){this.info?this.processWebGPUTimestamps():this.processGpuQueries(),this.endProfiling("cpu-started","cpu-finished","cpu-duration"),this.updateAverages(),this.resetCounters()}processWebGPUTimestamps(){this.totalGpuDuration=this.info.render.timestamp,this.totalGpuDurationCompute=this.info.compute.timestamp,this.addToAverage(this.totalGpuDurationCompute,this.averageGpuCompute)}updateAverages(){this.addToAverage(this.totalCpuDuration,this.averageCpu),this.addToAverage(this.totalGpuDuration,this.averageGpu)}resetCounters(){this.renderCount=0,0===this.totalCpuDuration&&this.beginProfiling("cpu-started"),this.totalCpuDuration=0,this.totalFps=0,this.beginTime=this.endInternal()}resizePanel(e,t){e.canvas.style.position="absolute",this.minimal?e.canvas.style.display="none":(e.canvas.style.display="block",this.horizontal?(e.canvas.style.top="0px",e.canvas.style.left=t*e.WIDTH/e.PR+"px"):(e.canvas.style.left="0px",e.canvas.style.top=t*e.HEIGHT/e.PR+"px"))}addPanel(e,t){return e.canvas&&(this.dom.appendChild(e.canvas),this.resizePanel(e,t)),e}showPanel(e){for(let t=0;t<this.dom.children.length;t++)this.dom.children[t].style.display=t===e?"block":"none";this.mode=e}processGpuQueries(){this.gl&&this.ext&&(this.totalGpuDuration=0,this.gpuQueries.forEach((e,t)=>{if(this.gl){let r=this.gl.getQueryParameter(e.query,this.gl.QUERY_RESULT_AVAILABLE),i=this.gl.getParameter(this.ext.GPU_DISJOINT_EXT);if(r&&!i){let r=this.gl.getQueryParameter(e.query,this.gl.QUERY_RESULT);this.totalGpuDuration+=1e-6*r,this.gl.deleteQuery(e.query),this.gpuQueries.splice(t,1)}}}))}endInternal(){this.frames++;let e=(performance||Date).now(),t=e-this.prevTime;if(e>=this.prevCpuTime+1e3/this.logsPerSecond){let r=Math.round(1e3*this.frames/t);this.addToAverage(r,this.averageFps),this.updatePanel(this.fpsPanel,this.averageFps,0),this.updatePanel(this.msPanel,this.averageCpu,this.precision),this.updatePanel(this.gpuPanel,this.averageGpu,this.precision),this.gpuPanelCompute&&this.updatePanel(this.gpuPanelCompute,this.averageGpuCompute),this.frames=0,this.prevCpuTime=e,this.prevTime=e}return e}addToAverage(e,t){t.logs.push(e),t.logs.length>this.samplesLog&&t.logs.shift(),t.graph.push(e),t.graph.length>this.samplesGraph&&t.graph.shift()}beginProfiling(e){window.performance&&(window.performance.mark(e),this.isRunningCPUProfiling=!0)}endProfiling(e,t,r){if(window.performance&&t&&this.isRunningCPUProfiling){window.performance.mark(t);let i=performance.measure(r,e,t);this.totalCpuDuration+=i.duration,this.isRunningCPUProfiling=!1}}updatePanel(e,t,r=2){if(t.logs.length>0){let i=0,n=.01;for(let e=0;e<t.logs.length;e++)i+=t.logs[e],t.logs[e]>n&&(n=t.logs[e]);let a=0,o=.01;for(let e=0;e<t.graph.length;e++)a+=t.graph[e],t.graph[e]>o&&(o=t.graph[e]);e&&e.update(i/Math.min(t.logs.length,this.samplesLog),a/Math.min(t.graph.length,this.samplesGraph),n,o,r)}}get domElement(){return this.dom}patchThreeRenderer(e){let t=e.render,r=this;e.render=function(e,i){r.begin(),t.call(this,e,i),r.end()},this.threeRendererPatched=!0}};A9.Panel=A8;let A7=eS.forwardRef(function({className:e,parent:t,id:r,clearStatsGlStyle:i,...n},a){let o=(0,eR.D)(e=>e.gl),s=eS.useMemo(()=>{let e=new A9({...n});return e.init(o),e},[o]);return eS.useImperativeHandle(a,()=>s.domElement,[s]),eS.useEffect(()=>{if(s){let n=t&&t.current||document.body;null==n||n.appendChild(s.domElement),s.domElement.querySelectorAll("canvas").forEach(e=>{e.style.removeProperty("position")}),r&&(s.domElement.id=r),i&&s.domElement.removeAttribute("style"),s.domElement.removeAttribute("style");let a=(null!=e?e:"").split(" ").filter(e=>e);a.length&&s.domElement.classList.add(...a);let o=(0,eR.p)(()=>s.update());return()=>{a.length&&s.domElement.classList.remove(...a),null==n||n.removeChild(s.domElement),o()}}},[t,s,e,r,i]),null});function de({size:e=256,frames:t=1/0}={}){let r=(0,eR.D)(e=>e.viewport.dpr),{width:i,height:n}=(0,eR.D)(e=>e.size),a=e||i*r,o=e||n*r,s=eS.useMemo(()=>{let e=new eT.DepthTexture(a,o);return e.format=eT.DepthFormat,e.type=eT.UnsignedShortType,{depthTexture:e}},[a,o]),l=0,c=cu(a,o,s);return(0,eR.F)(e=>{(t===1/0||l<t)&&(e.gl.setRenderTarget(c),e.gl.render(e.scene,e.camera),e.gl.setRenderTarget(null),l++)}),c.depthTexture}function dt(e,t,r=1){let i=(0,eR.D)(e=>e.viewport),n=t*(i.aspect>e/t?i.width/e:i.height/t);return[e*(i.aspect>e/t?i.width/e:i.height/t)*r,n*r,1]}function dr(e,t){let r=(0,eR.D)(e=>e.pointer),[i]=eS.useState(()=>{let i=new eT.Raycaster;return t&&(0,eR.k)(i,t,{}),function(t,n){i.setFromCamera(r,e instanceof eT.Camera?e:e.current);let a=this.constructor.prototype.raycast.bind(this);a&&a(i,n)}});return i}function di(e,t,r,i){return new(r||(r=Promise))(function(n,a){function o(e){try{l(i.next(e))}catch(e){a(e)}}function s(e){try{l(i.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?n(e.value):((t=e.value)instanceof r?t:new r(function(e){e(t)})).then(o,s)}l((i=i.apply(e,t||[])).next())})}"function"==typeof SuppressedError&&SuppressedError;let dn=["geforce 320m","geforce 8600","geforce 8600m gt","geforce 8800 gs","geforce 8800 gt","geforce 9400","geforce 9400m g","geforce 9400m","geforce 9600m gt","geforce 9600m","geforce fx go5200","geforce gt 120","geforce gt 130","geforce gt 330m","geforce gtx 285","google swiftshader","intel g41","intel g45","intel gma 4500mhd","intel gma x3100","intel hd 3000","intel q45","legacy","mali-2","mali-3","mali-4","quadro fx 1500","quadro fx 4","quadro fx 5","radeon hd 2400","radeon hd 2600","radeon hd 4670","radeon hd 4850","radeon hd 4870","radeon hd 5670","radeon hd 5750","radeon hd 6290","radeon hd 6300","radeon hd 6310","radeon hd 6320","radeon hd 6490m","radeon hd 6630m","radeon hd 6750m","radeon hd 6770m","radeon hd 6970m","sgx 543","sgx543"];function da(e){return e=e.toLowerCase().replace(/.*angle ?\((.+)\)(?: on vulkan [0-9.]+)?$/i,"$1").replace(/\s(\d{1,2}gb|direct3d.+$)|\(r\)| \([^)]+\)$/g,"").replace(/(?:vulkan|opengl) \d+\.\d+(?:\.\d+)?(?: \((.*)\))?/,"$1")}let ds="undefined"==typeof window,dl=(()=>{if(ds)return;let{userAgent:e,platform:t,maxTouchPoints:r}=window.navigator,i=/(iphone|ipod|ipad)/i.test(e),n="iPad"===t||"MacIntel"===t&&r>0&&!window.MSStream;return{isIpad:n,isMobile:/android/i.test(e)||i||n,isSafari12:/Version\/12.+Safari/.test(e),isFirefox:/Firefox/.test(e)}})();class dc extends Error{constructor(e){super(e),Object.setPrototypeOf(this,new.target.prototype)}}let du=[],dh=[];function dA(e){return null!=e}let dd=({mobileTiers:e=[0,15,30,60],desktopTiers:t=[0,15,30,60],override:r={},glContext:i,failIfMajorPerformanceCaveat:n=!1,benchmarksURL:a="https://unpkg.com/detect-gpu@5.0.70/dist/benchmarks"}={})=>di(void 0,void 0,void 0,function*(){let o={};if(ds)return{tier:0,type:"SSR"};let{isIpad:s=!!(null==dl?void 0:dl.isIpad),isMobile:l=!!(null==dl?void 0:dl.isMobile),screenSize:c=window.screen,loadBenchmarks:u=e=>di(void 0,void 0,void 0,function*(){let t=yield fetch(`${a}/${e}`).then(e=>e.json());if(4>parseInt(t.shift().split(".")[0],10))throw new dc("Detect GPU benchmark data is out of date. Please update to version 4x");return t})}=r,{renderer:h}=r,A=(e,t,r,i,n)=>({device:n,fps:i,gpu:r,isMobile:l,tier:e,type:t}),d,f="";if(h)d=[h=da(h)];else{var m;let e=i||function(e,t=!1){let r={alpha:!1,antialias:!1,depth:!1,failIfMajorPerformanceCaveat:t,powerPreference:"high-performance",stencil:!1};e&&delete r.powerPreference;let i=window.document.createElement("canvas"),n=i.getContext("webgl",r)||i.getContext("experimental-webgl",r);return null!=n?n:void 0}(null==dl?void 0:dl.isSafari12,n);if(!e)return A(0,"WEBGL_UNSUPPORTED");let t=(null==dl?void 0:dl.isFirefox)?null:e.getExtension("WEBGL_debug_renderer_info");if(!(h=t?e.getParameter(t.UNMASKED_RENDERER_WEBGL):e.getParameter(e.RENDERER)))return A(1,"FALLBACK");f=h,d="apple gpu"===(m=h=da(h))?function(e,t,r){let i;if(!r)return[t];let n=function(e){let t=e.createShader(35633),r=e.createShader(35632),i=e.createProgram();if(!(r&&t&&i))return;e.shaderSource(t,"\n    precision highp float;\n    attribute vec3 aPosition;\n    varying float vvv;\n    void main() {\n      vvv = 0.31622776601683794;\n      gl_Position = vec4(aPosition, 1.0);\n    }\n  "),e.shaderSource(r,"\n    precision highp float;\n    varying float vvv;\n    void main() {\n      vec4 enc = vec4(1.0, 255.0, 65025.0, 16581375.0) * vvv;\n      enc = fract(enc);\n      enc -= enc.yzww * vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0, 0.0);\n      gl_FragColor = enc;\n    }\n  "),e.compileShader(t),e.compileShader(r),e.attachShader(i,t),e.attachShader(i,r),e.linkProgram(i),e.detachShader(i,t),e.detachShader(i,r),e.deleteShader(t),e.deleteShader(r),e.useProgram(i);let n=e.createBuffer();e.bindBuffer(34962,n),e.bufferData(34962,new Float32Array([-1,-1,0,3,-1,0,-1,3,0]),35044);let a=e.getAttribLocation(i,"aPosition");e.vertexAttribPointer(a,3,5126,!1,0,0),e.enableVertexAttribArray(a),e.clearColor(1,1,1,1),e.clear(16384),e.viewport(0,0,1,1),e.drawArrays(4,0,3);let o=new Uint8Array(4);return e.readPixels(0,0,1,1,6408,5121,o),e.deleteProgram(i),e.deleteBuffer(n),o.join("")}(e),a="801621810",o="8016218135",s="80162181161",l=(null==dl?void 0:dl.isIpad)?[["a7",s,12],["a8",o,15],["a8x",o,15],["a9",o,15],["a9x",o,15],["a10",o,15],["a10x",o,15],["a12",a,15],["a12x",a,15],["a12z",a,15],["a14",a,15],["a15",a,15],["m1",a,15],["m2",a,15]]:[["a7",s,12],["a8",o,12],["a9",o,15],["a10",o,15],["a11",a,15],["a12",a,15],["a13",a,15],["a14",a,15],["a15",a,15],["a16",a,15],["a17",a,15]];return"80162181255"===n?i=l.filter(([,,e])=>e>=14):(i=l.filter(([,e])=>e===n)).length||(i=l),i.map(([e])=>`apple ${e} gpu`)}(e,m,l):[m]}let p=(yield Promise.all(d.map(function(e){var t;return di(this,void 0,void 0,function*(){let r;let i=(e=>{for(let t of l?["adreno","apple","mali-t","mali","nvidia","powervr","samsung"]:["intel","apple","amd","radeon","nvidia","geforce","adreno"])if(e.includes(t))return t})(e);if(!i)return;let n=`${l?"m":"d"}-${i}${s?"-ipad":""}.json`,a=o[n]=null!==(t=o[n])&&void 0!==t?t:u(n);try{r=yield a}catch(e){if(e instanceof dc)throw e;return}let h=function(e){var t;let r=(e=e.replace(/\([^)]+\)/,"")).match(/\d+/)||e.match(/(\W|^)([A-Za-z]{1,3})(\W|$)/g);return null!==(t=null==r?void 0:r.join("").replace(/\W|amd/g,""))&&void 0!==t?t:""}(e),A=r.filter(([,e])=>e===h);A.length||(A=r.filter(([t])=>t.includes(e)));let d=A.length;if(0===d)return;let f=e.split(/[.,()\[\]/\s]/g).sort().filter((e,t,r)=>0===t||e!==r[t-1]).join(" "),m,[p,,,,g]=d>1?A.map(e=>[e,function(e,t){if(e===t)return 0;let r=e;e.length>t.length&&(e=t,t=r);let i=e.length,n=t.length;for(;i>0&&e.charCodeAt(~-i)===t.charCodeAt(~-n);)i--,n--;let a,o=0;for(;o<i&&e.charCodeAt(o)===t.charCodeAt(o);)o++;if(i-=o,n-=o,0===i)return n;let s,l,c=0,u=0,h=0;for(;u<i;)dh[u]=e.charCodeAt(o+u),du[u]=++u;for(;h<n;)for(a=t.charCodeAt(o+h),s=h++,c=h,u=0;u<i;u++)l=a===dh[u]?s:s+1,s=du[u],c=du[u]=s>c?l>c?c+1:l:l>s?s+1:l;return c}(f,e[2])]).sort(([,e],[,t])=>e-t)[0][0]:A[0],y=Number.MAX_VALUE,{devicePixelRatio:v}=window,E=c.width*v*c.height*v;for(let e of g){let[t,r]=e,i=Math.abs(E-t*r);i<y&&(y=i,m=e)}if(!m)return;let[,,x,C]=m;return[y,x,p,C]})}))).filter(dA).sort(([e=Number.MAX_VALUE,t],[r=Number.MAX_VALUE,i])=>e===r?t-i:e-r);if(!p.length){let e=dn.find(e=>h.includes(e));return e?A(0,"BLOCKLISTED",e):A(1,"FALLBACK",`${h} (${f})`)}let[,g,y,v]=p[0];if(-1===g)return A(0,"BLOCKLISTED",y,g,v);let E=l?e:t,x=0;for(let e=0;e<E.length;e++)g>=E[e]&&(x=e);return A(x,"BENCHMARK",y,g,v)}),df=e=>(0,ok.Rq)(()=>dd(e),["useDetectGPU"]);function dm({children:e,...t}){let r=df(t);return eS.createElement(eS.Fragment,null,null==e?void 0:e(r))}let dp=2,dg=Symbol("SKIP_GENERATION");function dy(e,t,r){return null===e?null:(e.point.applyMatrix4(t.matrixWorld),e.distance=e.point.distanceTo(r.ray.origin),e.object=t,e)}function dv(e){return e.index?e.index.count:e.attributes.position.count}function dE(e){return dv(e)/3}function dx(e,t=ArrayBuffer){return e>65535?new Uint32Array(new t(4*e)):new Uint16Array(new t(2*e))}function dC(e,t){let r=dE(e),i=t||e.drawRange,n=i.start/3,a=(i.start+i.count)/3,o=Math.max(0,n);return[{offset:Math.floor(o),count:Math.floor(Math.min(r,a)-o)}]}function dB(e,t){if(!e.groups||!e.groups.length)return dC(e,t);let r=[],i=new Set,n=t||e.drawRange,a=n.start/3,o=(n.start+n.count)/3;for(let t of e.groups){let e=t.start/3,r=(t.start+t.count)/3;i.add(Math.max(a,e)),i.add(Math.min(o,r))}let s=Array.from(i.values()).sort((e,t)=>e-t);for(let e=0;e<s.length-1;e++){let t=s[e],i=s[e+1];r.push({offset:Math.floor(t),count:Math.floor(i-t)})}return r}function dw(e,t,r,i,n){let a=1/0,o=1/0,s=1/0,l=-1/0,c=-1/0,u=-1/0,h=1/0,A=1/0,d=1/0,f=-1/0,m=-1/0,p=-1/0;for(let i=6*t,n=(t+r)*6;i<n;i+=6){let t=e[i+0],r=e[i+1],n=t-r,g=t+r;n<a&&(a=n),g>l&&(l=g),t<h&&(h=t),t>f&&(f=t);let y=e[i+2],v=e[i+3],E=y-v,x=y+v;E<o&&(o=E),x>c&&(c=x),y<A&&(A=y),y>m&&(m=y);let C=e[i+4],B=e[i+5],w=C-B,I=C+B;w<s&&(s=w),I>u&&(u=I),C<d&&(d=C),C>p&&(p=C)}i[0]=a,i[1]=o,i[2]=s,i[3]=l,i[4]=c,i[5]=u,n[0]=h,n[1]=A,n[2]=d,n[3]=f,n[4]=m,n[5]=p}function dI(e,t,r){return r.min.x=t[e],r.min.y=t[e+1],r.min.z=t[e+2],r.max.x=t[e+3],r.max.y=t[e+4],r.max.z=t[e+5],r}function db(e){let t=-1,r=-1/0;for(let i=0;i<3;i++){let n=e[i+3]-e[i];n>r&&(r=n,t=i)}return t}function d_(e,t,r){let i,n;for(let a=0;a<3;a++){let o=a+3;i=e[a],n=t[a],r[a]=i<n?i:n,i=e[o],n=t[o],r[o]=i>n?i:n}}function dM(e,t,r){for(let i=0;i<3;i++){let n=t[e+2*i],a=t[e+2*i+1],o=n-a,s=n+a;o<r[i]&&(r[i]=o),s>r[i+3]&&(r[i+3]=s)}}function dS(e){let t=e[3]-e[0],r=e[4]-e[1],i=e[5]-e[2];return 2*(t*r+r*i+i*t)}let dD=(e,t)=>e.candidate-t.candidate,dT=Array(32).fill().map(()=>({count:0,bounds:new Float32Array(6),rightCacheBounds:new Float32Array(6),leftCacheBounds:new Float32Array(6),candidate:0})),dR=new Float32Array(6);class dF{constructor(){this.boundingData=new Float32Array(6)}}function dP(e,t,r,i,n,a){let o=i,s=i+n-1,l=a.pos,c=2*a.axis;for(;;){for(;o<=s&&r[6*o+c]<l;)o++;for(;o<=s&&r[6*s+c]>=l;)s--;if(!(o<s))return o;for(let e=0;e<3;e++){let r=t[3*o+e];t[3*o+e]=t[3*s+e],t[3*s+e]=r}for(let e=0;e<6;e++){let t=r[6*o+e];r[6*o+e]=r[6*s+e],r[6*s+e]=t}o++,s--}}function dQ(e,t,r,i,n,a){let o=i,s=i+n-1,l=a.pos,c=2*a.axis;for(;;){for(;o<=s&&r[6*o+c]<l;)o++;for(;o<=s&&r[6*s+c]>=l;)s--;if(!(o<s))return o;{let t=e[o];e[o]=e[s],e[s]=t;for(let e=0;e<6;e++){let t=r[6*o+e];r[6*o+e]=r[6*s+e],r[6*s+e]=t}o++,s--}}}function dz(e,t){return 65535===t[e+15]}function dL(e,t){return t[e+14]}class dO{constructor(){this.min=1/0,this.max=-1/0}setFromPointsField(e,t){let r=1/0,i=-1/0;for(let n=0,a=e.length;n<a;n++){let a=e[n][t];r=a<r?a:r,i=a>i?a:i}this.min=r,this.max=i}setFromPoints(e,t){let r=1/0,i=-1/0;for(let n=0,a=t.length;n<a;n++){let a=t[n],o=e.dot(a);r=o<r?o:r,i=o>i?o:i}this.min=r,this.max=i}isSeparated(e){return this.min>e.max||e.min>this.max}}dO.prototype.setFromBox=function(){let e=new eT.Vector3;return function(t,r){let i=r.min,n=r.max,a=1/0,o=-1/0;for(let r=0;r<=1;r++)for(let s=0;s<=1;s++)for(let l=0;l<=1;l++){e.x=i.x*r+n.x*(1-r),e.y=i.y*s+n.y*(1-s),e.z=i.z*l+n.z*(1-l);let c=t.dot(e);a=Math.min(c,a),o=Math.max(c,o)}this.min=a,this.max=o}}(),new dO;let dU=function(){let e=new eT.Vector3,t=new eT.Vector3,r=new eT.Vector3;return function(i,n,a){let o,s;let l=i.start,c=n.start;r.subVectors(l,c),e.subVectors(i.end,i.start),t.subVectors(n.end,n.start);let u=r.dot(t),h=t.dot(e),A=t.dot(t),d=r.dot(e),f=e.dot(e)*A-h*h;o=0!==f?(u*h-d*A)/f:0,s=(u+o*h)/A,a.x=o,a.y=s}}(),dk=function(){let e=new eT.Vector2,t=new eT.Vector3,r=new eT.Vector3;return function(i,n,a,o){dU(i,n,e);let s=e.x,l=e.y;if(s>=0&&s<=1&&l>=0&&l<=1){i.at(s,a),n.at(l,o);return}if(s>=0&&s<=1){l<0?n.at(0,o):n.at(1,o),i.closestPointToPoint(o,!0,a);return}if(l>=0&&l<=1){s<0?i.at(0,a):i.at(1,a),n.closestPointToPoint(a,!0,o);return}{let e,c;if(e=s<0?i.start:i.end,c=l<0?n.start:n.end,i.closestPointToPoint(c,!0,t),n.closestPointToPoint(e,!0,r),t.distanceToSquared(c)<=r.distanceToSquared(e)){a.copy(t),o.copy(c);return}a.copy(e),o.copy(r);return}}}(),dG=function(){let e=new eT.Vector3,t=new eT.Vector3,r=new eT.Plane,i=new eT.Line3;return function(n,a){let{radius:o,center:s}=n,{a:l,b:c,c:u}=a;if(i.start=l,i.end=c,i.closestPointToPoint(s,!0,e).distanceTo(s)<=o||(i.start=l,i.end=u,i.closestPointToPoint(s,!0,e).distanceTo(s)<=o)||(i.start=c,i.end=u,i.closestPointToPoint(s,!0,e).distanceTo(s)<=o))return!0;let h=a.getPlane(r);if(Math.abs(h.distanceToPoint(s))<=o){let e=h.projectPoint(s,t);if(a.containsPoint(e))return!0}return!1}}();function dN(e){return 1e-15>Math.abs(e)}class dH extends eT.Triangle{constructor(...e){super(...e),this.isExtendedTriangle=!0,this.satAxes=[,,,,].fill().map(()=>new eT.Vector3),this.satBounds=[,,,,].fill().map(()=>new dO),this.points=[this.a,this.b,this.c],this.sphere=new eT.Sphere,this.plane=new eT.Plane,this.needsUpdate=!0}intersectsSphere(e){return dG(e,this)}update(){let e=this.a,t=this.b,r=this.c,i=this.points,n=this.satAxes,a=this.satBounds,o=n[0],s=a[0];this.getNormal(o),s.setFromPoints(o,i);let l=n[1],c=a[1];l.subVectors(e,t),c.setFromPoints(l,i);let u=n[2],h=a[2];u.subVectors(t,r),h.setFromPoints(u,i);let A=n[3],d=a[3];A.subVectors(r,e),d.setFromPoints(A,i),this.sphere.setFromPoints(this.points),this.plane.setFromNormalAndCoplanarPoint(o,e),this.needsUpdate=!1}}dH.prototype.closestPointToSegment=function(){let e=new eT.Vector3,t=new eT.Vector3,r=new eT.Line3;return function(i,n=null,a=null){let o;let{start:s,end:l}=i,c=this.points,u=1/0;for(let s=0;s<3;s++){let l=(s+1)%3;r.start.copy(c[s]),r.end.copy(c[l]),dk(r,i,e,t),(o=e.distanceToSquared(t))<u&&(u=o,n&&n.copy(e),a&&a.copy(t))}return this.closestPointToPoint(s,e),(o=s.distanceToSquared(e))<u&&(u=o,n&&n.copy(e),a&&a.copy(s)),this.closestPointToPoint(l,e),(o=l.distanceToSquared(e))<u&&(u=o,n&&n.copy(e),a&&a.copy(l)),Math.sqrt(u)}}(),dH.prototype.intersectsTriangle=function(){let e=new dH,t=[,,,],r=[,,,],i=new dO,n=new dO,a=new eT.Vector3,o=new eT.Vector3,s=new eT.Vector3,l=new eT.Vector3,c=new eT.Vector3,u=new eT.Line3,h=new eT.Line3,A=new eT.Line3,d=new eT.Vector3;function f(e,t,r){let i=e.points,n=0,a=-1;for(let e=0;e<3;e++){let{start:s,end:l}=u;s.copy(i[e]),l.copy(i[(e+1)%3]),u.delta(o);let c=dN(t.distanceToPoint(s));if(dN(t.normal.dot(o))&&c){r.copy(u),n=2;break}let h=t.intersectLine(u,d);if(!h&&c&&d.copy(s),(h||c)&&!dN(d.distanceTo(l))){if(n<=1)(1===n?r.start:r.end).copy(d),c&&(a=n);else if(n>=2){(1===a?r.start:r.end).copy(d),n=2;break}if(2==++n&&-1===a)break}}return n}return function(o,u=null,d=!1){this.needsUpdate&&this.update(),o.isExtendedTriangle?o.needsUpdate&&o.update():(e.copy(o),e.update(),o=e);let m=this.plane,p=o.plane;if(Math.abs(m.normal.dot(p.normal))>1-1e-10){let e=this.satBounds,s=this.satAxes;r[0]=o.a,r[1]=o.b,r[2]=o.c;for(let t=0;t<4;t++){let n=e[t],a=s[t];if(i.setFromPoints(a,r),n.isSeparated(i))return!1}let l=o.satBounds,c=o.satAxes;t[0]=this.a,t[1]=this.b,t[2]=this.c;for(let e=0;e<4;e++){let r=l[e],n=c[e];if(i.setFromPoints(n,t),r.isSeparated(i))return!1}for(let e=0;e<4;e++){let o=s[e];for(let e=0;e<4;e++){let s=c[e];if(a.crossVectors(o,s),i.setFromPoints(a,t),n.setFromPoints(a,r),i.isSeparated(n))return!1}}return u&&(d||console.warn("ExtendedTriangle.intersectsTriangle: Triangles are coplanar which does not support an output edge. Setting edge to 0, 0, 0."),u.start.set(0,0,0),u.end.set(0,0,0)),!0}{let e=f(this,p,h);if(1===e&&o.containsPoint(h.end))return u&&(u.start.copy(h.end),u.end.copy(h.end)),!0;if(2!==e)return!1;let t=f(o,m,A);if(1===t&&this.containsPoint(A.end))return u&&(u.start.copy(A.end),u.end.copy(A.end)),!0;if(2!==t)return!1;if(h.delta(s),A.delta(l),0>s.dot(l)){let e=A.start;A.start=A.end,A.end=e}let r=h.start.dot(s),i=h.end.dot(s),n=A.start.dot(s),a=A.end.dot(s);return(r===a||n===i||i<n!=r<a)&&(u&&(c.subVectors(h.start,A.start),c.dot(s)>0?u.start.copy(h.start):u.start.copy(A.start),c.subVectors(h.end,A.end),0>c.dot(s)?u.end.copy(h.end):u.end.copy(A.end)),!0)}}}(),dH.prototype.distanceToPoint=function(){let e=new eT.Vector3;return function(t){return this.closestPointToPoint(t,e),t.distanceTo(e)}}(),dH.prototype.distanceToTriangle=function(){let e=new eT.Vector3,t=new eT.Vector3,r=["a","b","c"],i=new eT.Line3,n=new eT.Line3;return function(a,o=null,s=null){let l=o||s?i:null;if(this.intersectsTriangle(a,l))return(o||s)&&(o&&l.getCenter(o),s&&l.getCenter(s)),0;let c=1/0;for(let t=0;t<3;t++){let i;let n=r[t],l=a[n];this.closestPointToPoint(l,e),(i=l.distanceToSquared(e))<c&&(c=i,o&&o.copy(e),s&&s.copy(l));let u=this[n];a.closestPointToPoint(u,e),(i=u.distanceToSquared(e))<c&&(c=i,o&&o.copy(u),s&&s.copy(e))}for(let l=0;l<3;l++){let u=r[l],h=r[(l+1)%3];i.set(this[u],this[h]);for(let l=0;l<3;l++){let u=r[l],h=r[(l+1)%3];n.set(a[u],a[h]),dk(i,n,e,t);let A=e.distanceToSquared(t);A<c&&(c=A,o&&o.copy(e),s&&s.copy(t))}}return Math.sqrt(c)}}();class dV{constructor(e,t,r){this.isOrientedBox=!0,this.min=new eT.Vector3,this.max=new eT.Vector3,this.matrix=new eT.Matrix4,this.invMatrix=new eT.Matrix4,this.points=Array(8).fill().map(()=>new eT.Vector3),this.satAxes=[,,,].fill().map(()=>new eT.Vector3),this.satBounds=[,,,].fill().map(()=>new dO),this.alignedSatBounds=[,,,].fill().map(()=>new dO),this.needsUpdate=!1,e&&this.min.copy(e),t&&this.max.copy(t),r&&this.matrix.copy(r)}set(e,t,r){this.min.copy(e),this.max.copy(t),this.matrix.copy(r),this.needsUpdate=!0}copy(e){this.min.copy(e.min),this.max.copy(e.max),this.matrix.copy(e.matrix),this.needsUpdate=!0}}dV.prototype.update=function(){let e=this.matrix,t=this.min,r=this.max,i=this.points;for(let n=0;n<=1;n++)for(let a=0;a<=1;a++)for(let o=0;o<=1;o++){let s=i[1*n|2*a|4*o];s.x=n?r.x:t.x,s.y=a?r.y:t.y,s.z=o?r.z:t.z,s.applyMatrix4(e)}let n=this.satBounds,a=this.satAxes,o=i[0];for(let e=0;e<3;e++){let t=a[e],r=n[e],s=i[1<<e];t.subVectors(o,s),r.setFromPoints(t,i)}let s=this.alignedSatBounds;s[0].setFromPointsField(i,"x"),s[1].setFromPointsField(i,"y"),s[2].setFromPointsField(i,"z"),this.invMatrix.copy(this.matrix).invert(),this.needsUpdate=!1},dV.prototype.intersectsBox=function(){let e=new dO;return function(t){this.needsUpdate&&this.update();let r=t.min,i=t.max,n=this.satBounds,a=this.satAxes,o=this.alignedSatBounds;if(e.min=r.x,e.max=i.x,o[0].isSeparated(e)||(e.min=r.y,e.max=i.y,o[1].isSeparated(e))||(e.min=r.z,e.max=i.z,o[2].isSeparated(e)))return!1;for(let r=0;r<3;r++){let i=a[r],o=n[r];if(e.setFromBox(i,t),o.isSeparated(e))return!1}return!0}}(),dV.prototype.intersectsTriangle=function(){let e=new dH,t=[,,,],r=new dO,i=new dO,n=new eT.Vector3;return function(a){this.needsUpdate&&this.update(),a.isExtendedTriangle?a.needsUpdate&&a.update():(e.copy(a),e.update(),a=e);let o=this.satBounds,s=this.satAxes;t[0]=a.a,t[1]=a.b,t[2]=a.c;for(let e=0;e<3;e++){let i=o[e],n=s[e];if(r.setFromPoints(n,t),i.isSeparated(r))return!1}let l=a.satBounds,c=a.satAxes,u=this.points;for(let e=0;e<3;e++){let t=l[e],i=c[e];if(r.setFromPoints(i,u),t.isSeparated(r))return!1}for(let e=0;e<3;e++){let a=s[e];for(let e=0;e<4;e++){let o=c[e];if(n.crossVectors(a,o),r.setFromPoints(n,t),i.setFromPoints(n,u),r.isSeparated(i))return!1}}return!0}}(),dV.prototype.closestPointToPoint=function(e,t){return this.needsUpdate&&this.update(),t.copy(e).applyMatrix4(this.invMatrix).clamp(this.min,this.max).applyMatrix4(this.matrix),t},dV.prototype.distanceToPoint=function(){let e=new eT.Vector3;return function(t){return this.closestPointToPoint(t,e),t.distanceTo(e)}}(),dV.prototype.distanceToBox=function(){let e=["x","y","z"],t=Array(12).fill().map(()=>new eT.Line3),r=Array(12).fill().map(()=>new eT.Line3),i=new eT.Vector3,n=new eT.Vector3;return function(a,o=0,s=null,l=null){if(this.needsUpdate&&this.update(),this.intersectsBox(a))return(s||l)&&(a.getCenter(n),this.closestPointToPoint(n,i),a.closestPointToPoint(i,n),s&&s.copy(i),l&&l.copy(n)),0;let c=o*o,u=a.min,h=a.max,A=this.points,d=1/0;for(let e=0;e<8;e++){let t=A[e];n.copy(t).clamp(u,h);let r=t.distanceToSquared(n);if(r<d&&(d=r,s&&s.copy(t),l&&l.copy(n),r<c))return Math.sqrt(r)}let f=0;for(let i=0;i<3;i++)for(let n=0;n<=1;n++)for(let a=0;a<=1;a++){let o=(i+1)%3,s=(i+2)%3,l=n<<o|a<<s,c=1<<i|n<<o|a<<s,d=A[l],m=A[c];t[f].set(d,m);let p=e[i],g=e[o],y=e[s],v=r[f],E=v.start,x=v.end;E[p]=u[p],E[g]=n?u[g]:h[g],E[y]=a?u[y]:h[g],x[p]=h[p],x[g]=n?u[g]:h[g],x[y]=a?u[y]:h[g],f++}for(let e=0;e<=1;e++)for(let t=0;t<=1;t++)for(let r=0;r<=1;r++){n.x=e?h.x:u.x,n.y=t?h.y:u.y,n.z=r?h.z:u.z,this.closestPointToPoint(n,i);let a=n.distanceToSquared(i);if(a<d&&(d=a,s&&s.copy(i),l&&l.copy(n),a<c))return Math.sqrt(a)}for(let e=0;e<12;e++){let a=t[e];for(let e=0;e<12;e++){dk(a,r[e],i,n);let t=i.distanceToSquared(n);if(t<d&&(d=t,s&&s.copy(i),l&&l.copy(n),t<c))return Math.sqrt(t)}}return Math.sqrt(d)}}();class dj{constructor(e){this._getNewPrimitive=e,this._primitives=[]}getPrimitive(){let e=this._primitives;return 0===e.length?this._getNewPrimitive():e.pop()}releasePrimitive(e){this._primitives.push(e)}}class dJ extends dj{constructor(){super(()=>new dH)}}let dY=new dJ;class dW{constructor(){this.float32Array=null,this.uint16Array=null,this.uint32Array=null;let e=[],t=null;this.setBuffer=r=>{t&&e.push(t),t=r,this.float32Array=new Float32Array(r),this.uint16Array=new Uint16Array(r),this.uint32Array=new Uint32Array(r)},this.clearBuffer=()=>{t=null,this.float32Array=null,this.uint16Array=null,this.uint32Array=null,0!==e.length&&this.setBuffer(e.pop())}}}let dK=new dW,dq=[],dX=new dj(()=>new eT.Box3),dZ=new eT.Vector3,d$=new eT.Vector3,d1=new eT.Vector3,d0=new eT.Vector3,d2=new eT.Vector3,d3=new eT.Vector2,d4=new eT.Vector2,d5=new eT.Vector2,d6=new eT.Vector3,d8=new eT.Vector3,d9=new eT.Vector3,d7=new eT.Vector3;function fe(e,t,r,i,n,a,o){let s=3*i,l=s+0,c=s+1,u=s+2,h=e.index;e.index&&(l=h.getX(l),c=h.getX(c),u=h.getX(u));let{position:A,normal:d,uv:f,uv1:m}=e.attributes,p=function(e,t,r,i,n,a,o,s,l,c,u){d1.fromBufferAttribute(t,a),d0.fromBufferAttribute(t,o),d2.fromBufferAttribute(t,s);let h=function(e,t,r,i,n,a,o,s){if(null===(a===eT.BackSide?e.intersectTriangle(i,r,t,!0,n):e.intersectTriangle(t,r,i,a!==eT.DoubleSide,n)))return null;let l=e.origin.distanceTo(n);return l<o||l>s?null:{distance:l,point:n.clone()}}(e,d1,d0,d2,d7,l,c,u);if(h){i&&(d3.fromBufferAttribute(i,a),d4.fromBufferAttribute(i,o),d5.fromBufferAttribute(i,s),h.uv=eT.Triangle.getInterpolation(d7,d1,d0,d2,d3,d4,d5,new eT.Vector2)),n&&(d3.fromBufferAttribute(n,a),d4.fromBufferAttribute(n,o),d5.fromBufferAttribute(n,s),h.uv1=eT.Triangle.getInterpolation(d7,d1,d0,d2,d3,d4,d5,new eT.Vector2)),r&&(d6.fromBufferAttribute(r,a),d8.fromBufferAttribute(r,o),d9.fromBufferAttribute(r,s),h.normal=eT.Triangle.getInterpolation(d7,d1,d0,d2,d6,d8,d9,new eT.Vector3),h.normal.dot(e.direction)>0&&h.normal.multiplyScalar(-1));let t={a:a,b:o,c:s,normal:new eT.Vector3,materialIndex:0};eT.Triangle.getNormal(d1,d0,d2,t.normal),h.face=t,h.faceIndex=a}return h}(r,A,d,f,m,l,c,u,t,a,o);return p?(p.faceIndex=i,n&&n.push(p),p):null}function ft(e,t,r,i){let n=e.a,a=e.b,o=e.c,s=t,l=t+1,c=t+2;r&&(s=r.getX(s),l=r.getX(l),c=r.getX(c)),n.x=i.getX(s),n.y=i.getY(s),n.z=i.getZ(s),a.x=i.getX(l),a.y=i.getY(l),a.z=i.getZ(l),o.x=i.getX(c),o.y=i.getY(c),o.z=i.getZ(c)}function fr(e,t,r,i,n,a,o){let{geometry:s}=r,{index:l}=s,c=s.attributes.position;for(let r=e,s=t+e;r<s;r++){let e;if(ft(o,3*(e=r),l,c),o.needsUpdate=!0,i(o,e,n,a))return!0}return!1}function fi(e,t,r,i,n){let a,o,s,l,c,u;let h=1/r.direction.x,A=1/r.direction.y,d=1/r.direction.z,f=r.origin.x,m=r.origin.y,p=r.origin.z,g=t[e],y=t[e+3],v=t[e+1],E=t[e+3+1],x=t[e+2],C=t[e+3+2];return h>=0?(a=(g-f)*h,o=(y-f)*h):(a=(y-f)*h,o=(g-f)*h),A>=0?(s=(v-m)*A,l=(E-m)*A):(s=(E-m)*A,l=(v-m)*A),!(a>l)&&!(s>o)&&((s>a||isNaN(a))&&(a=s),(l<o||isNaN(o))&&(o=l),d>=0?(c=(x-p)*d,u=(C-p)*d):(c=(C-p)*d,u=(x-p)*d),!(a>u)&&!(c>o)&&((c>a||a!=a)&&(a=c),(u<o||o!=o)&&(o=u),a<=n&&o>=i))}function fn(e,t,r,i,n,a,o){dK.setBuffer(e._roots[t]),function e(t,r,i,n,a,o,s){let{float32Array:l,uint16Array:c,uint32Array:u}=dK,h=2*t;if(dz(h,c))!function(e,t,r,i,n,a,o,s){let{geometry:l,_indirectBuffer:c}=e;for(let e=i,c=i+n;e<c;e++)fe(l,t,r,e,a,o,s)}(r,i,n,u[t+6],dL(h,c),a,o,s);else{let c=t+8;fi(c,l,n,o,s)&&e(c,r,i,n,a,o,s);let h=u[t+6];fi(h,l,n,o,s)&&e(h,r,i,n,a,o,s)}}(0,e,r,i,n,a,o),dK.clearBuffer()}let fa=["x","y","z"];function fo(e,t,r,i,n,a){dK.setBuffer(e._roots[t]);let o=function e(t,r,i,n,a,o){let{float32Array:s,uint16Array:l,uint32Array:c}=dK,u=2*t;if(dz(u,l))return function(e,t,r,i,n,a,o){let{geometry:s,_indirectBuffer:l}=e,c=1/0,u=null;for(let e=i,l=i+n;e<l;e++){let i;(i=fe(s,t,r,e,null,a,o))&&i.distance<c&&(u=i,c=i.distance)}return u}(r,i,n,c[t+6],dL(u,l),a,o);{let l,u;let h=c[t+7],A=fa[h],d=n.direction[A]>=0;d?(l=t+8,u=c[t+6]):(l=c[t+6],u=t+8);let f=fi(l,s,n,a,o)?e(l,r,i,n,a,o):null;if(f){let e=f.point[A];if(d?e<=s[u+h]:e>=s[u+h+3])return f}let m=fi(u,s,n,a,o)?e(u,r,i,n,a,o):null;return f&&m?f.distance<=m.distance?f:m:f||m||null}}(0,e,r,i,n,a);return dK.clearBuffer(),o}let fs=new eT.Box3,fl=new dH,fc=new dH,fu=new eT.Matrix4,fh=new dV,fA=new dV;function fd(e,t,r,i){dK.setBuffer(e._roots[t]);let n=function e(t,r,i,n,a=null){let{float32Array:o,uint16Array:s,uint32Array:l}=dK,c=2*t;if(null===a&&(i.boundingBox||i.computeBoundingBox(),fh.set(i.boundingBox.min,i.boundingBox.max,n),a=fh),dz(c,s)){let e=r.geometry,a=e.index,u=e.attributes.position,h=i.index,A=i.attributes.position,d=l[t+6],f=dL(c,s);if(fu.copy(n).invert(),i.boundsTree)return dI(t,o,fA),fA.matrix.copy(fu),fA.needsUpdate=!0,i.boundsTree.shapecast({intersectsBounds:e=>fA.intersectsBox(e),intersectsTriangle:e=>{e.a.applyMatrix4(n),e.b.applyMatrix4(n),e.c.applyMatrix4(n),e.needsUpdate=!0;for(let t=3*d,r=(f+d)*3;t<r;t+=3)if(ft(fc,t,a,u),fc.needsUpdate=!0,e.intersectsTriangle(fc))return!0;return!1}});for(let e=3*d,t=(f+d)*3;e<t;e+=3){ft(fl,e,a,u),fl.a.applyMatrix4(fu),fl.b.applyMatrix4(fu),fl.c.applyMatrix4(fu),fl.needsUpdate=!0;for(let e=0,t=h.count;e<t;e+=3)if(ft(fc,e,h,A),fc.needsUpdate=!0,fl.intersectsTriangle(fc))return!0}}else{let s=t+8,c=l[t+6];return dI(s,o,fs),!!(a.intersectsBox(fs)&&e(s,r,i,n,a))||(dI(c,o,fs),!!(a.intersectsBox(fs)&&e(c,r,i,n,a)))}}(0,e,r,i);return dK.clearBuffer(),n}let ff=new eT.Matrix4,fm=new dV,fp=new dV,fg=new eT.Vector3,fy=new eT.Vector3,fv=new eT.Vector3,fE=new eT.Vector3;function fx(e,t,r,i,n,a,o){let{geometry:s}=r,{index:l}=s,c=s.attributes.position;for(let s=e,u=t+e;s<u;s++){let e;if(ft(o,3*(e=r.resolveTriangleIndex(s)),l,c),o.needsUpdate=!0,i(o,e,n,a))return!0}return!1}function fC(e,t,r,i,n,a,o){dK.setBuffer(e._roots[t]),function e(t,r,i,n,a,o,s){let{float32Array:l,uint16Array:c,uint32Array:u}=dK,h=2*t;if(dz(h,c))!function(e,t,r,i,n,a,o,s){let{geometry:l,_indirectBuffer:c}=e;for(let e=i,u=i+n;e<u;e++)fe(l,t,r,c?c[e]:e,a,o,s)}(r,i,n,u[t+6],dL(h,c),a,o,s);else{let c=t+8;fi(c,l,n,o,s)&&e(c,r,i,n,a,o,s);let h=u[t+6];fi(h,l,n,o,s)&&e(h,r,i,n,a,o,s)}}(0,e,r,i,n,a,o),dK.clearBuffer()}let fB=["x","y","z"];function fw(e,t,r,i,n,a){dK.setBuffer(e._roots[t]);let o=function e(t,r,i,n,a,o){let{float32Array:s,uint16Array:l,uint32Array:c}=dK,u=2*t;if(dz(u,l))return function(e,t,r,i,n,a,o){let{geometry:s,_indirectBuffer:l}=e,c=1/0,u=null;for(let e=i,h=i+n;e<h;e++){let i;(i=fe(s,t,r,l?l[e]:e,null,a,o))&&i.distance<c&&(u=i,c=i.distance)}return u}(r,i,n,c[t+6],dL(u,l),a,o);{let l,u;let h=c[t+7],A=fB[h],d=n.direction[A]>=0;d?(l=t+8,u=c[t+6]):(l=c[t+6],u=t+8);let f=fi(l,s,n,a,o)?e(l,r,i,n,a,o):null;if(f){let e=f.point[A];if(d?e<=s[u+h]:e>=s[u+h+3])return f}let m=fi(u,s,n,a,o)?e(u,r,i,n,a,o):null;return f&&m?f.distance<=m.distance?f:m:f||m||null}}(0,e,r,i,n,a);return dK.clearBuffer(),o}let fI=new eT.Box3,fb=new dH,f_=new dH,fM=new eT.Matrix4,fS=new dV,fD=new dV;function fT(e,t,r,i){dK.setBuffer(e._roots[t]);let n=function e(t,r,i,n,a=null){let{float32Array:o,uint16Array:s,uint32Array:l}=dK,c=2*t;if(null===a&&(i.boundingBox||i.computeBoundingBox(),fS.set(i.boundingBox.min,i.boundingBox.max,n),a=fS),dz(c,s)){let e=r.geometry,a=e.index,u=e.attributes.position,h=i.index,A=i.attributes.position,d=l[t+6],f=dL(c,s);if(fM.copy(n).invert(),i.boundsTree)return dI(t,o,fD),fD.matrix.copy(fM),fD.needsUpdate=!0,i.boundsTree.shapecast({intersectsBounds:e=>fD.intersectsBox(e),intersectsTriangle:e=>{e.a.applyMatrix4(n),e.b.applyMatrix4(n),e.c.applyMatrix4(n),e.needsUpdate=!0;for(let t=d,i=f+d;t<i;t++)if(ft(f_,3*r.resolveTriangleIndex(t),a,u),f_.needsUpdate=!0,e.intersectsTriangle(f_))return!0;return!1}});for(let e=d,t=f+d;e<t;e++){ft(fb,3*r.resolveTriangleIndex(e),a,u),fb.a.applyMatrix4(fM),fb.b.applyMatrix4(fM),fb.c.applyMatrix4(fM),fb.needsUpdate=!0;for(let e=0,t=h.count;e<t;e+=3)if(ft(f_,e,h,A),f_.needsUpdate=!0,fb.intersectsTriangle(f_))return!0}}else{let s=t+8,c=l[t+6];return dI(s,o,fI),!!(a.intersectsBox(fI)&&e(s,r,i,n,a))||(dI(c,o,fI),!!(a.intersectsBox(fI)&&e(c,r,i,n,a)))}}(0,e,r,i);return dK.clearBuffer(),n}let fR=new eT.Matrix4,fF=new dV,fP=new dV,fQ=new eT.Vector3,fz=new eT.Vector3,fL=new eT.Vector3,fO=new eT.Vector3,fU=new dK.constructor,fk=new dK.constructor,fG=new dj(()=>new eT.Box3),fN=new eT.Box3,fH=new eT.Box3,fV=new eT.Box3,fj=new eT.Box3,fJ=!1,fY=new dV,fW=new eT.Box3,fK={strategy:0,maxDepth:40,maxLeafTris:10,useSharedArrayBuffer:!1,setBoundingBox:!0,onProgress:null,indirect:!1,verbose:!0,range:null};class fq{static serialize(e,t={}){t={cloneBuffers:!0,...t};let r=e.geometry,i=e._roots,n=e._indirectBuffer,a=r.getIndex();return t.cloneBuffers?{roots:i.map(e=>e.slice()),index:a?a.array.slice():null,indirectBuffer:n?n.slice():null}:{roots:i,index:a?a.array:null,indirectBuffer:n}}static deserialize(e,t,r={}){r={setIndex:!0,indirect:!!e.indirectBuffer,...r};let{index:i,roots:n,indirectBuffer:a}=e,o=new fq(t,{...r,[dg]:!0});if(o._roots=n,o._indirectBuffer=a||null,r.setIndex){let r=t.getIndex();if(null===r){let r=new eT.BufferAttribute(e.index,1,!1);t.setIndex(r)}else r.array!==i&&(r.array.set(i),r.needsUpdate=!0)}return o}get indirect(){return!!this._indirectBuffer}constructor(e,t={}){if(e.isBufferGeometry){if(e.index&&e.index.isInterleavedBufferAttribute)throw Error("MeshBVH: InterleavedBufferAttribute is not supported for the index attribute.")}else throw Error("MeshBVH: Only BufferGeometries are supported.");if((t=Object.assign({...fK,[dg]:!1},t)).useSharedArrayBuffer&&!("undefined"!=typeof SharedArrayBuffer))throw Error("MeshBVH: SharedArrayBuffer is not available.");this.geometry=e,this._roots=null,this._indirectBuffer=null,t[dg]||(function(e,t){let r=e.geometry;t.indirect&&(e._indirectBuffer=function(e,t){let r=(e.index?e.index.count:e.attributes.position.count)/3,i=r>65536,n=i?4:2,a=t?new SharedArrayBuffer(r*n):new ArrayBuffer(r*n),o=i?new Uint32Array(a):new Uint16Array(a);for(let e=0,t=o.length;e<t;e++)o[e]=e;return o}(r,t.useSharedArrayBuffer),function(e,t){let r=dE(e),i=dB(e,t).sort((e,t)=>e.offset-t.offset),n=i[i.length-1];n.count=Math.min(r-n.offset,n.count);let a=0;return i.forEach(({count:e})=>a+=e),r!==a}(r,t.range)&&!t.verbose&&console.warn('MeshBVH: Provided geometry contains groups or a range that do not fully span the vertex contents while using the "indirect" option. BVH may incorrectly report intersections on unrendered portions of the geometry.')),e._indirectBuffer||function(e,t){if(!e.index){let r=e.attributes.position.count,i=dx(r,t.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer);e.setIndex(new eT.BufferAttribute(i,1));for(let e=0;e<r;e++)i[e]=e}}(r,t);let i=t.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer,n=function(e,t=null,r=null,i=null){let n;let a=e.attributes.position,o=e.index?e.index.array:null,s=dE(e),l=a.normalized;null===t?(n=new Float32Array(24*s),r=0,i=s):(n=t,r=r||0,i=i||s);let c=a.array,u=a.offset||0,h=3;a.isInterleavedBufferAttribute&&(h=a.data.stride);let A=["getX","getY","getZ"];for(let e=r;e<r+i;e++){let t=3*e,r=6*e,i=t+0,s=t+1,d=t+2;o&&(i=o[i],s=o[s],d=o[d]),l||(i=i*h+u,s=s*h+u,d=d*h+u);for(let e=0;e<3;e++){let t,o,u;l?(t=a[A[e]](i),o=a[A[e]](s),u=a[A[e]](d)):(t=c[i+e],o=c[s+e],u=c[d+e]);let h=t;o<h&&(h=o),u<h&&(h=u);let f=t;o>f&&(f=o),u>f&&(f=u);let m=(f-h)/2,p=2*e;n[r+p+0]=h+m,n[r+p+1]=m+(Math.abs(h)+m)*5960464477539063e-23}}return n}(r),a=t.indirect?dC(r,t.range):dB(r,t.range);e._roots=a.map(r=>{let a=function(e,t,r,i,n){let{maxDepth:a,verbose:o,maxLeafTris:s,strategy:l,onProgress:c,indirect:u}=n,h=e._indirectBuffer,A=e.geometry,d=A.index?A.index.array:null,f=u?dQ:dP,m=dE(A),p=new Float32Array(6),g=!1,y=new dF;return dw(t,r,i,y.boundingData,p),function e(r,i,n,c=null,u=0){if(!g&&u>=a&&(g=!0,o&&(console.warn(`MeshBVH: Max depth of ${a} reached when generating BVH. Consider increasing maxDepth.`),console.warn(A))),n<=s||u>=a)return v(i+n),r.offset=i,r.count=n,r;let m=function(e,t,r,i,n,a){let o=-1,s=0;if(0===a)-1!==(o=db(t))&&(s=(t[o]+t[o+3])/2);else if(1===a)-1!==(o=db(e))&&(s=function(e,t,r,i){let n=0;for(let a=t,o=t+r;a<o;a++)n+=e[6*a+2*i];return n/r}(r,i,n,o));else if(a===dp){let a=dS(e),l=1.25*n,c=6*i,u=(i+n)*6;for(let e=0;e<3;e++){let i=t[e],h=(t[e+3]-i)/32;if(n<8){let t=[...dT];t.length=n;let i=0;for(let n=c;n<u;n+=6,i++){let a=t[i];a.candidate=r[n+2*e],a.count=0;let{bounds:o,leftCacheBounds:s,rightCacheBounds:l}=a;for(let e=0;e<3;e++)l[e]=1/0,l[e+3]=-1/0,s[e]=1/0,s[e+3]=-1/0,o[e]=1/0,o[e+3]=-1/0;dM(n,r,o)}t.sort(dD);let h=n;for(let e=0;e<h;e++){let r=t[e];for(;e+1<h&&t[e+1].candidate===r.candidate;)t.splice(e+1,1),h--}for(let i=c;i<u;i+=6){let n=r[i+2*e];for(let e=0;e<h;e++){let a=t[e];n>=a.candidate?dM(i,r,a.rightCacheBounds):(dM(i,r,a.leftCacheBounds),a.count++)}}for(let r=0;r<h;r++){let i=t[r],c=i.count,u=n-i.count,h=i.leftCacheBounds,A=i.rightCacheBounds,d=0;0!==c&&(d=dS(h)/a);let f=0;0!==u&&(f=dS(A)/a);let m=1+1.25*(d*c+f*u);m<l&&(o=e,l=m,s=i.candidate)}}else{for(let e=0;e<32;e++){let t=dT[e];t.count=0,t.candidate=i+h+e*h;let r=t.bounds;for(let e=0;e<3;e++)r[e]=1/0,r[e+3]=-1/0}for(let t=c;t<u;t+=6){let n=~~((r[t+2*e]-i)/h);n>=32&&(n=31);let a=dT[n];a.count++,dM(t,r,a.bounds)}let t=dT[31];!function(e,t){t.set(e)}(t.bounds,t.rightCacheBounds);for(let e=30;e>=0;e--){let t=dT[e],r=dT[e+1];d_(t.bounds,r.rightCacheBounds,t.rightCacheBounds)}let A=0;for(let t=0;t<31;t++){let r=dT[t],i=r.count,c=r.bounds,u=dT[t+1].rightCacheBounds;0!==i&&(0===A?function(e,t){t.set(e)}(c,dR):d_(c,dR,dR));let h=0,d=0;0!==(A+=i)&&(h=dS(dR)/a);let f=n-A;0!==f&&(d=dS(u)/a);let m=1+1.25*(h*A+d*f);m<l&&(o=e,l=m,s=r.candidate)}}}}else console.warn(`MeshBVH: Invalid build strategy value ${a} used.`);return{axis:o,pos:s}}(r.boundingData,c,t,i,n,l);if(-1===m.axis)return v(i+n),r.offset=i,r.count=n,r;let y=f(h,d,t,i,n,m);if(y===i||y===i+n)v(i+n),r.offset=i,r.count=n;else{r.splitAxis=m.axis;let a=new dF,o=y-i;r.left=a,dw(t,i,o,a.boundingData,p),e(a,i,o,p,u+1);let s=new dF,l=n-o;r.right=s,dw(t,y,l,s.boundingData,p),e(s,y,l,p,u+1)}return r}(y,r,i,p),y;function v(e){c&&c(e/m)}}(e,n,r.offset,r.count,t),o=new i(32*function e(t){return"count"in t?1:1+e(t.left)+e(t.right)}(a));return z=new Float32Array(o),L=new Uint32Array(o),O=new Uint16Array(o),U=new Uint8Array(o),function e(t,r){let i=t/4,n=t/2,a=r.boundingData;for(let e=0;e<6;e++)z[i+e]=a[e];if("count"in r){if(r.buffer){let e=r.buffer;U.set(new Uint8Array(e),t);for(let r=t,n=t+e.byteLength;r<n;r+=32)dz(r/2,O)||(L[r/4+6]+=i);return t+e.byteLength}{let e=r.offset,a=r.count;return L[i+6]=e,O[n+14]=a,O[n+15]=65535,t+32}}{let n;let a=r.left,o=r.right,s=r.splitAxis;if((n=e(t+32,a))/4>4294967296)throw Error("MeshBVH: Cannot store child pointer greater than 32 bits.");return L[i+6]=n/4,n=e(n,o),L[i+7]=s,n}}(0,a),o})}(this,t),!e.boundingBox&&t.setBoundingBox&&(e.boundingBox=this.getBoundingBox(new eT.Box3))),this.resolveTriangleIndex=t.indirect?e=>this._indirectBuffer[e]:e=>e}refit(e=null){return(this.indirect?function(e,t=null){let r,i,n,a;t&&Array.isArray(t)&&(t=new Set(t));let o=e.geometry,s=o.index?o.index.array:null,l=o.attributes.position,c=0,u=e._roots;for(let o=0,h=u.length;o<h;o++)r=u[o],i=new Uint32Array(r),n=new Uint16Array(r),a=new Float32Array(r),function r(o,c,u=!1){let h=2*o;if(65535===n[h+15]){let t=i[o+6],r=n[h+14],c=1/0,u=1/0,A=1/0,d=-1/0,f=-1/0,m=-1/0;for(let i=t,n=t+r;i<n;i++){let t=3*e.resolveTriangleIndex(i);for(let e=0;e<3;e++){let r=t+e;r=s?s[r]:r;let i=l.getX(r),n=l.getY(r),a=l.getZ(r);i<c&&(c=i),i>d&&(d=i),n<u&&(u=n),n>f&&(f=n),a<A&&(A=a),a>m&&(m=a)}}return(a[o+0]!==c||a[o+1]!==u||a[o+2]!==A||a[o+3]!==d||a[o+4]!==f||a[o+5]!==m)&&(a[o+0]=c,a[o+1]=u,a[o+2]=A,a[o+3]=d,a[o+4]=f,a[o+5]=m,!0)}{let e=o+8,n=i[o+6],s=u,l=!1,h=!1;t?s||(l=t.has(e+c),h=t.has(n+c),s=!l&&!h):(l=!0,h=!0);let A=s||l,d=s||h,f=!1;A&&(f=r(e,c,s));let m=!1;d&&(m=r(n,c,s));let p=f||m;if(p)for(let t=0;t<3;t++){let r=e+t,i=n+t,s=a[r],l=a[r+3],c=a[i],u=a[i+3];a[o+t]=s<c?s:c,a[o+t+3]=l>u?l:u}return p}}(0,c),c+=r.byteLength}:function(e,t=null){let r,i,n,a;t&&Array.isArray(t)&&(t=new Set(t));let o=e.geometry,s=o.index?o.index.array:null,l=o.attributes.position,c=0,u=e._roots;for(let e=0,o=u.length;e<o;e++)r=u[e],i=new Uint32Array(r),n=new Uint16Array(r),a=new Float32Array(r),function e(r,o,c=!1){let u=2*r;if(65535===n[u+15]){let e=i[r+6],t=n[u+14],o=1/0,c=1/0,h=1/0,A=-1/0,d=-1/0,f=-1/0;for(let r=3*e,i=3*(e+t);r<i;r++){let e=s[r],t=l.getX(e),i=l.getY(e),n=l.getZ(e);t<o&&(o=t),t>A&&(A=t),i<c&&(c=i),i>d&&(d=i),n<h&&(h=n),n>f&&(f=n)}return(a[r+0]!==o||a[r+1]!==c||a[r+2]!==h||a[r+3]!==A||a[r+4]!==d||a[r+5]!==f)&&(a[r+0]=o,a[r+1]=c,a[r+2]=h,a[r+3]=A,a[r+4]=d,a[r+5]=f,!0)}{let n=r+8,s=i[r+6],l=c,u=!1,h=!1;t?l||(u=t.has(n+o),h=t.has(s+o),l=!u&&!h):(u=!0,h=!0);let A=l||u,d=l||h,f=!1;A&&(f=e(n,o,l));let m=!1;d&&(m=e(s,o,l));let p=f||m;if(p)for(let e=0;e<3;e++){let t=n+e,i=s+e,o=a[t],l=a[t+3],c=a[i],u=a[i+3];a[r+e]=o<c?o:c,a[r+e+3]=l>u?l:u}return p}}(0,c),c+=r.byteLength})(this,e)}traverse(e,t=0){let r=this._roots[t],i=new Uint32Array(r),n=new Uint16Array(r);!function t(a,o=0){let s=2*a,l=65535===n[s+15];if(l){let t=i[a+6],c=n[s+14];e(o,l,new Float32Array(r,4*a,6),t,c)}else{let n=i[a+6],s=i[a+7];e(o,l,new Float32Array(r,4*a,6),s)||(t(a+8,o+1),t(n,o+1))}}(0)}raycast(e,t=eT.FrontSide,r=0,i=1/0){let n=this._roots,a=this.geometry,o=[],s=t.isMaterial,l=Array.isArray(t),c=a.groups,u=s?t.side:t,h=this.indirect?fC:fn;for(let a=0,s=n.length;a<s;a++){let n=l?t[c[a].materialIndex].side:u,s=o.length;if(h(this,a,n,e,o,r,i),l){let e=c[a].materialIndex;for(let t=s,r=o.length;t<r;t++)o[t].face.materialIndex=e}}return o}raycastFirst(e,t=eT.FrontSide,r=0,i=1/0){let n=this._roots,a=this.geometry,o=t.isMaterial,s=Array.isArray(t),l=null,c=a.groups,u=o?t.side:t,h=this.indirect?fw:fo;for(let a=0,o=n.length;a<o;a++){let n=s?t[c[a].materialIndex].side:u,o=h(this,a,n,e,r,i);null!=o&&(null==l||o.distance<l.distance)&&(l=o,s&&(o.face.materialIndex=c[a].materialIndex))}return l}intersectsGeometry(e,t){let r=!1,i=this._roots,n=this.indirect?fT:fd;for(let a=0,o=i.length;a<o&&!(r=n(this,a,e,t));a++);return r}shapecast(e){let t=dY.getPrimitive(),r=this.indirect?fx:fr,{boundsTraverseOrder:i,intersectsBounds:n,intersectsRange:a,intersectsTriangle:o}=e;if(a&&o){let e=a;a=(i,n,a,s,l)=>!!e(i,n,a,s,l)||r(i,n,this,o,a,s,t)}else a||(a=o?(e,i,n,a)=>r(e,i,this,o,n,a,t):(e,t,r)=>r);let s=!1,l=0,c=this._roots;for(let e=0,t=c.length;e<t;e++){let t=c[e];if(s=function(e,t,r,i,n,a){k=dX.getPrimitive(),G=dX.getPrimitive(),dq.push(k,G),dK.setBuffer(e._roots[t]);let o=function e(t,r,i,n,a=null,o=0,s=0){let{float32Array:l,uint16Array:c,uint32Array:u}=dK,h=2*t;if(dz(h,c)){let e=u[t+6],r=dL(h,c);return dI(t,l,k),n(e,r,!1,s,o+t,k)}{let h,f,m,p,g,y;let v=t+8,E=u[t+6],x=v,C=E;if(a&&(m=k,p=G,dI(x,l,m),dI(C,l,p),h=a(m),(f=a(p))<h)){x=E,C=v;let e=h;h=f,f=e,m=p}m||dI(x,l,m=k);let B=i(m,dz(2*x,c),h,s+1,o+x);if(2===B){let e=A(x);g=n(e,d(x)-e,!0,s+1,o+x,m)}else g=B&&e(x,r,i,n,a,o,s+1);if(g)return!0;dI(C,l,p=G);let w=i(p,dz(2*C,c),f,s+1,o+C);if(2===w){let e=A(C);y=n(e,d(C)-e,!0,s+1,o+C,p)}else y=w&&e(C,r,i,n,a,o,s+1);if(y)return!0;return!1;function A(e){let{uint16Array:t,uint32Array:r}=dK,i=2*e;for(;!dz(i,t);)e+=8,i=2*e;return r[e+6]}function d(e){let{uint16Array:t,uint32Array:r}=dK,i=2*e;for(;!dz(i,t);)i=2*(e=r[e+6]);return r[e+6]+dL(i,t)}}}(0,e.geometry,r,i,n,a);dK.clearBuffer(),dX.releasePrimitive(k),dX.releasePrimitive(G),dq.pop(),dq.pop();let s=dq.length;return s>0&&(G=dq[s-1],k=dq[s-2]),o}(this,e,n,a,i,l))break;l+=t.byteLength}return dY.releasePrimitive(t),s}bvhcast(e,t,r){let{intersectsRanges:i,intersectsTriangles:n}=r,a=dY.getPrimitive(),o=this.geometry.index,s=this.geometry.attributes.position,l=this.indirect?e=>{ft(a,3*this.resolveTriangleIndex(e),o,s)}:e=>{ft(a,3*e,o,s)},c=dY.getPrimitive(),u=e.geometry.index,h=e.geometry.attributes.position,A=e.indirect?t=>{ft(c,3*e.resolveTriangleIndex(t),u,h)}:e=>{ft(c,3*e,u,h)};if(n){let e=(e,r,i,o,s,u,h,d)=>{for(let f=i,m=i+o;f<m;f++){A(f),c.a.applyMatrix4(t),c.b.applyMatrix4(t),c.c.applyMatrix4(t),c.needsUpdate=!0;for(let t=e,i=e+r;t<i;t++)if(l(t),a.needsUpdate=!0,n(a,c,t,f,s,u,h,d))return!0}return!1};if(i){let t=i;i=function(r,i,n,a,o,s,l,c){return!!t(r,i,n,a,o,s,l,c)||e(r,i,n,a,o,s,l,c)}}else i=e}return function(e,t,r,i){let n;if(fJ)throw Error("MeshBVH: Recursive calls to bvhcast not supported.");fJ=!0;let a=e._roots,o=t._roots,s=0,l=0,c=new eT.Matrix4().copy(r).invert();for(let e=0,t=a.length;e<t;e++){fU.setBuffer(a[e]),l=0;let t=fG.getPrimitive();dI(0,fU.float32Array,t),t.applyMatrix4(c);for(let e=0,a=o.length;e<a&&(fk.setBuffer(o[e]),n=function e(t,r,i,n,a,o=0,s=0,l=0,c=0,u=null,h=!1){let A,d;h?(A=fk,d=fU):(A=fU,d=fk);let f=A.float32Array,m=A.uint32Array,p=A.uint16Array,g=d.float32Array,y=d.uint32Array,v=d.uint16Array,E=2*r,x=dz(2*t,p),C=dz(E,v),B=!1;if(C&&x)B=h?a(y[r+6],dL(2*r,v),m[t+6],dL(2*t,p),c,s+r,l,o+t):a(m[t+6],dL(2*t,p),y[r+6],dL(2*r,v),l,o+t,c,s+r);else if(C){let u=fG.getPrimitive();dI(r,g,u),u.applyMatrix4(i);let A=t+8,d=m[t+6];dI(A,f,fN),dI(d,f,fH);let p=u.intersectsBox(fN),y=u.intersectsBox(fH);B=p&&e(r,A,n,i,a,s,o,c,l+1,u,!h)||y&&e(r,d,n,i,a,s,o,c,l+1,u,!h),fG.releasePrimitive(u)}else{let A=r+8,d=y[r+6];dI(A,g,fV),dI(d,g,fj);let p=u.intersectsBox(fV),v=u.intersectsBox(fj);if(p&&v)B=e(t,A,i,n,a,o,s,l,c+1,u,h)||e(t,d,i,n,a,o,s,l,c+1,u,h);else if(p){if(x)B=e(t,A,i,n,a,o,s,l,c+1,u,h);else{let r=fG.getPrimitive();r.copy(fV).applyMatrix4(i);let u=t+8,d=m[t+6];dI(u,f,fN),dI(d,f,fH);let p=r.intersectsBox(fN),g=r.intersectsBox(fH);B=p&&e(A,u,n,i,a,s,o,c,l+1,r,!h)||g&&e(A,d,n,i,a,s,o,c,l+1,r,!h),fG.releasePrimitive(r)}}else if(v){if(x)B=e(t,d,i,n,a,o,s,l,c+1,u,h);else{let r=fG.getPrimitive();r.copy(fj).applyMatrix4(i);let u=t+8,A=m[t+6];dI(u,f,fN),dI(A,f,fH);let p=r.intersectsBox(fN),g=r.intersectsBox(fH);B=p&&e(d,u,n,i,a,s,o,c,l+1,r,!h)||g&&e(d,A,n,i,a,s,o,c,l+1,r,!h),fG.releasePrimitive(r)}}}return B}(0,0,r,c,i,s,l,0,0,t),fk.clearBuffer(),l+=o[e].length,!n);e++);if(fG.releasePrimitive(t),fU.clearBuffer(),s+=a[e].length,n)break}return fJ=!1,n}(this,e,t,i)}intersectsBox(e,t){return fY.set(e.min,e.max,t),fY.needsUpdate=!0,this.shapecast({intersectsBounds:e=>fY.intersectsBox(e),intersectsTriangle:e=>fY.intersectsTriangle(e)})}intersectsSphere(e){return this.shapecast({intersectsBounds:t=>e.intersectsBox(t),intersectsTriangle:t=>t.intersectsSphere(e)})}closestPointToGeometry(e,t,r={},i={},n=0,a=1/0){return(this.indirect?function(e,t,r,i={},n={},a=0,o=1/0){t.boundingBox||t.computeBoundingBox(),fF.set(t.boundingBox.min,t.boundingBox.max,r),fF.needsUpdate=!0;let s=e.geometry,l=s.attributes.position,c=s.index,u=t.attributes.position,h=t.index,A=dY.getPrimitive(),d=dY.getPrimitive(),f=null,m=null;n&&(f=fL,m=fO);let p=1/0,g=null,y=null;return(fR.copy(r).invert(),fP.matrix.copy(fR),e.shapecast({boundsTraverseOrder:e=>fF.distanceToBox(e),intersectsBounds:(e,t,r)=>r<p&&r<o&&(t&&(fP.min.copy(e.min),fP.max.copy(e.max),fP.needsUpdate=!0),!0),intersectsRange:(i,n)=>{if(t.boundsTree){let s=t.boundsTree;return s.shapecast({boundsTraverseOrder:e=>fP.distanceToBox(e),intersectsBounds:(e,t,r)=>r<p&&r<o,intersectsRange:(t,o)=>{for(let v=t,E=t+o;v<E;v++){ft(d,3*s.resolveTriangleIndex(v),h,u),d.a.applyMatrix4(r),d.b.applyMatrix4(r),d.c.applyMatrix4(r),d.needsUpdate=!0;for(let t=i,r=i+n;t<r;t++){ft(A,3*e.resolveTriangleIndex(t),c,l),A.needsUpdate=!0;let r=A.distanceToTriangle(d,fQ,f);if(r<p&&(fz.copy(fQ),m&&m.copy(f),p=r,g=t,y=v),r<a)return!0}}}})}{let o=dE(t);for(let t=0;t<o;t++){ft(d,3*t,h,u),d.a.applyMatrix4(r),d.b.applyMatrix4(r),d.c.applyMatrix4(r),d.needsUpdate=!0;for(let r=i,o=i+n;r<o;r++){ft(A,3*e.resolveTriangleIndex(r),c,l),A.needsUpdate=!0;let i=A.distanceToTriangle(d,fQ,f);if(i<p&&(fz.copy(fQ),m&&m.copy(f),p=i,g=r,y=t),i<a)return!0}}}}}),dY.releasePrimitive(A),dY.releasePrimitive(d),p===1/0)?null:(i.point?i.point.copy(fz):i.point=fz.clone(),i.distance=p,i.faceIndex=g,n&&(n.point?n.point.copy(m):n.point=m.clone(),n.point.applyMatrix4(fR),fz.applyMatrix4(fR),n.distance=fz.sub(n.point).length(),n.faceIndex=y),i)}:function(e,t,r,i={},n={},a=0,o=1/0){t.boundingBox||t.computeBoundingBox(),fm.set(t.boundingBox.min,t.boundingBox.max,r),fm.needsUpdate=!0;let s=e.geometry,l=s.attributes.position,c=s.index,u=t.attributes.position,h=t.index,A=dY.getPrimitive(),d=dY.getPrimitive(),f=null,m=null;n&&(f=fv,m=fE);let p=1/0,g=null,y=null;return(ff.copy(r).invert(),fp.matrix.copy(ff),e.shapecast({boundsTraverseOrder:e=>fm.distanceToBox(e),intersectsBounds:(e,t,r)=>r<p&&r<o&&(t&&(fp.min.copy(e.min),fp.max.copy(e.max),fp.needsUpdate=!0),!0),intersectsRange:(e,i)=>{if(t.boundsTree)return t.boundsTree.shapecast({boundsTraverseOrder:e=>fp.distanceToBox(e),intersectsBounds:(e,t,r)=>r<p&&r<o,intersectsRange:(t,n)=>{for(let o=t,s=t+n;o<s;o++){ft(d,3*o,h,u),d.a.applyMatrix4(r),d.b.applyMatrix4(r),d.c.applyMatrix4(r),d.needsUpdate=!0;for(let t=e,r=e+i;t<r;t++){ft(A,3*t,c,l),A.needsUpdate=!0;let e=A.distanceToTriangle(d,fg,f);if(e<p&&(fy.copy(fg),m&&m.copy(f),p=e,g=t,y=o),e<a)return!0}}}});{let n=dE(t);for(let t=0;t<n;t++){ft(d,3*t,h,u),d.a.applyMatrix4(r),d.b.applyMatrix4(r),d.c.applyMatrix4(r),d.needsUpdate=!0;for(let r=e,n=e+i;r<n;r++){ft(A,3*r,c,l),A.needsUpdate=!0;let e=A.distanceToTriangle(d,fg,f);if(e<p&&(fy.copy(fg),m&&m.copy(f),p=e,g=r,y=t),e<a)return!0}}}}}),dY.releasePrimitive(A),dY.releasePrimitive(d),p===1/0)?null:(i.point?i.point.copy(fy):i.point=fy.clone(),i.distance=p,i.faceIndex=g,n&&(n.point?n.point.copy(m):n.point=m.clone(),n.point.applyMatrix4(ff),fy.applyMatrix4(ff),n.distance=fy.sub(n.point).length(),n.faceIndex=y),i)})(this,e,t,r,i,n,a)}closestPointToPoint(e,t={},r=0,i=1/0){return function(e,t,r={},i=0,n=1/0){let a=i*i,o=n*n,s=1/0,l=null;if(e.shapecast({boundsTraverseOrder:e=>(dZ.copy(t).clamp(e.min,e.max),dZ.distanceToSquared(t)),intersectsBounds:(e,t,r)=>r<s&&r<o,intersectsTriangle:(e,r)=>{e.closestPointToPoint(t,dZ);let i=t.distanceToSquared(dZ);return i<s&&(d$.copy(dZ),s=i,l=r),i<a}}),s===1/0)return null;let c=Math.sqrt(s);return r.point?r.point.copy(d$):r.point=d$.clone(),r.distance=c,r.faceIndex=l,r}(this,e,t,r,i)}getBoundingBox(e){return e.makeEmpty(),this._roots.forEach(t=>{dI(0,new Float32Array(t),fW),e.union(fW)}),e}}let fX=eT.BatchedMesh||null;parseInt(eT.REVISION);let fZ=new eT.Ray,f$=new eT.Vector3,f1=new eT.Matrix4,f0=eT.Mesh.prototype.raycast,f2=null!==fX?fX.prototype.raycast:null,f3=new eT.Vector3,f4=new eT.Mesh,f5=[];function f6(e,t){this.isBatchedMesh?f8.call(this,e,t):f9.call(this,e,t)}function f8(e,t){if(this.boundsTrees){let r=this.boundsTrees,i=this._drawInfo,n=this._drawRanges,a=this.matrixWorld;f4.material=this.material,f4.geometry=this.geometry;let o=f4.geometry.boundsTree,s=f4.geometry.drawRange;null===f4.geometry.boundingSphere&&(f4.geometry.boundingSphere=new eT.Sphere);for(let o=0,s=i.length;o<s;o++){if(!this.getVisibleAt(o))continue;let s=i[o].geometryIndex;if(f4.geometry.boundsTree=r[s],this.getMatrixAt(o,f4.matrixWorld).premultiply(a),!f4.geometry.boundsTree){this.getBoundingBoxAt(s,f4.geometry.boundingBox),this.getBoundingSphereAt(s,f4.geometry.boundingSphere);let e=n[s];f4.geometry.setDrawRange(e.start,e.count)}f4.raycast(e,f5);for(let e=0,r=f5.length;e<r;e++){let r=f5[e];r.object=this,r.batchId=o,t.push(r)}f5.length=0}f4.geometry.boundsTree=o,f4.geometry.drawRange=s,f4.material=null,f4.geometry=null}else f2.call(this,e,t)}function f9(e,t){if(this.geometry.boundsTree){if(void 0===this.material)return;f1.copy(this.matrixWorld).invert(),fZ.copy(e.ray).applyMatrix4(f1),f3.setFromMatrixScale(this.matrixWorld),f$.copy(fZ.direction).multiply(f3);let r=f$.length(),i=e.near/r,n=e.far/r,a=this.geometry.boundsTree;if(!0===e.firstHitOnly){let r=dy(a.raycastFirst(fZ,this.material,i,n),this,e);r&&t.push(r)}else{let r=a.raycast(fZ,this.material,i,n);for(let i=0,n=r.length;i<n;i++){let n=dy(r[i],this,e);n&&t.push(n)}}}else f0.call(this,e,t)}function f7(e={}){return this.boundsTree=new fq(this,e),this.boundsTree}function me(){this.boundsTree=null}let mt=e=>e.isMesh;function mr(e,t){t={strategy:dp,verbose:!1,setBoundingBox:!0,maxDepth:40,maxLeafTris:10,indirect:!1,...t},eS.useEffect(()=>{if(e.current){e.current.raycast=f6;let r=e.current.geometry;return r.computeBoundsTree=f7,r.disposeBoundsTree=me,r.computeBoundsTree(t),()=>{r.boundsTree&&r.disposeBoundsTree()}}},[e,JSON.stringify(t)])}let mi=eS.forwardRef(({enabled:e=!0,firstHitOnly:t=!1,children:r,strategy:i=dp,verbose:n=!1,setBoundingBox:a=!0,maxDepth:o=40,maxLeafTris:s=10,indirect:l=!1,...c},u)=>{let h=eS.useRef(null),A=(0,eR.D)(e=>e.raycaster);return eS.useImperativeHandle(u,()=>h.current,[]),eS.useEffect(()=>{if(e){let e={strategy:i,verbose:n,setBoundingBox:a,maxDepth:o,maxLeafTris:s,indirect:l},r=h.current;return A.firstHitOnly=t,r.traverse(t=>{mt(t)&&!t.geometry.boundsTree&&t.raycast===eT.Mesh.prototype.raycast&&(t.raycast=f6,t.geometry.computeBoundsTree=f7,t.geometry.disposeBoundsTree=me,t.geometry.computeBoundsTree(e))}),()=>{delete A.firstHitOnly,r.traverse(e=>{mt(e)&&e.geometry.boundsTree&&(e.geometry.disposeBoundsTree(),e.raycast=eT.Mesh.prototype.raycast)})}}},[]),eS.createElement("group",j({ref:h},c),r)});function mn(...e){let t=eS.useRef([]);return t.current=e.map(e=>eS.useContext(e)),eS.useMemo(()=>({children:r})=>e.reduceRight((e,r,i)=>eS.createElement(r.Provider,{value:t.current[i],children:e}),r),[])}function ma(e,t){let r=eS.useRef(),[i]=eS.useState(()=>t?t instanceof eT.Object3D?{current:t}:t:r),[n]=eS.useState(()=>new eT.AnimationMixer(void 0));eS.useLayoutEffect(()=>{t&&(i.current=t instanceof eT.Object3D?t:t.current),n._root=i.current});let a=eS.useRef({}),o=eS.useMemo(()=>{let t={};return e.forEach(e=>Object.defineProperty(t,e.name,{enumerable:!0,get(){if(i.current)return a.current[e.name]||(a.current[e.name]=n.clipAction(e,i.current))},configurable:!0})),{ref:i,clips:e,actions:t,names:e.map(e=>e.name),mixer:n}},[e]);return(0,eR.F)((e,t)=>n.update(t)),eS.useEffect(()=>{let e=i.current;return()=>{a.current={},n.stopAllAction(),Object.values(o.actions).forEach(t=>{e&&n.uncacheAction(t,e)})}},[e]),o}function mo(e){let t=eS.useRef(null),r=eS.useRef(!1),i=eS.useRef(!1),n=eS.useRef(e);return eS.useLayoutEffect(()=>void(n.current=e),[e]),eS.useEffect(()=>{let e=t.current;if(e){let t=(0,eR.o)(()=>(r.current=!1,!0)),a=e.onBeforeRender;e.onBeforeRender=()=>r.current=!0;let o=(0,eR.p)(()=>(r.current!==i.current&&(null==n.current||n.current(i.current=r.current)),!0));return()=>{e.onBeforeRender=a,t(),o()}}},[]),t}let ms=`
#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP )
  vec4 worldPosition = modelMatrix * vec4( transformed, 1.0 );
  #ifdef BOX_PROJECTED_ENV_MAP
    vWorldPosition = worldPosition.xyz;
  #endif
#endif
`,ml=`
#ifdef BOX_PROJECTED_ENV_MAP
  uniform vec3 envMapSize;
  uniform vec3 envMapPosition;
  varying vec3 vWorldPosition;
    
  vec3 parallaxCorrectNormal( vec3 v, vec3 cubeSize, vec3 cubePos ) {
    vec3 nDir = normalize( v );
    vec3 rbmax = ( .5 * cubeSize + cubePos - vWorldPosition ) / nDir;
    vec3 rbmin = ( -.5 * cubeSize + cubePos - vWorldPosition ) / nDir;
    vec3 rbminmax;
    rbminmax.x = ( nDir.x > 0. ) ? rbmax.x : rbmin.x;
    rbminmax.y = ( nDir.y > 0. ) ? rbmax.y : rbmin.y;
    rbminmax.z = ( nDir.z > 0. ) ? rbmax.z : rbmin.z;
    float correction = min( min( rbminmax.x, rbminmax.y ), rbminmax.z );
    vec3 boxIntersection = vWorldPosition + nDir * correction;    
    return boxIntersection - cubePos;
  }
#endif
`,mc=`
#ifdef BOX_PROJECTED_ENV_MAP
  worldNormal = parallaxCorrectNormal( worldNormal, envMapSize, envMapPosition );
#endif
`,mu=`
#ifdef BOX_PROJECTED_ENV_MAP
  reflectVec = parallaxCorrectNormal( reflectVec, envMapSize, envMapPosition );
#endif
`;function mh(e=new eT.Vector3,t=new eT.Vector3){let[r]=eS.useState(()=>({position:new eT.Vector3,size:new eT.Vector3}));(0,eR.k)(r,{position:e,size:t});let i=eS.useRef(null),n=eS.useMemo(()=>({ref:i,onBeforeCompile:e=>{var t,i;return t=r.position,i=r.size,void(e.defines.BOX_PROJECTED_ENV_MAP=!0,e.uniforms.envMapPosition={value:t},e.uniforms.envMapSize={value:i},e.vertexShader=`
  varying vec3 vWorldPosition;
  ${e.vertexShader.replace("#include <worldpos_vertex>",ms)}`,e.fragmentShader=`
    ${ml}
    ${e.fragmentShader.replace("#include <envmap_physical_pars_fragment>",eT.ShaderChunk.envmap_physical_pars_fragment).replace("vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );",`vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
         ${mc}
         `).replace("reflectVec = inverseTransformDirection( reflectVec, viewMatrix );",`reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
         ${mu}
        `)}`)},customProgramCacheKey:()=>JSON.stringify(r.position.toArray())+JSON.stringify(r.size.toArray())}),[...r.position.toArray(),...r.size.toArray()]);return eS.useLayoutEffect(()=>void(i.current.needsUpdate=!0),[r]),n}let mA=new eT.Box3,md=new eT.Vector3,mf=({anchor:e,...t})=>{let r=eS.useRef(null),i=eS.useRef(null);return eS.useEffect(()=>{var e;null!=(e=r.current)&&null!=(e=e.parent)&&e.parent&&(i.current=r.current.parent,r.current.parent.parent.add(r.current))},[]),(0,eR.F)(()=>{i.current&&(mA.setFromObject(i.current),mA.getSize(md),r.current.position.set(i.current.position.x+md.x*(Array.isArray(e)?e[0]:e.x)/2,i.current.position.y+md.y*(Array.isArray(e)?e[1]:e.y)/2,i.current.position.z+md.z*(Array.isArray(e)?e[2]:e.z)/2))}),eS.createElement("group",j({ref:r},t))},mm=e=>Math.sqrt(1-Math.pow(e-1,2));class mp{constructor({size:e=256,maxAge:t=750,radius:r=.3,intensity:i=.2,interpolate:n=0,smoothing:a=0,minForce:o=.3,blend:s="screen",ease:l=mm}={}){this.size=e,this.maxAge=t,this.radius=r,this.intensity=i,this.ease=l,this.interpolate=n,this.smoothing=a,this.minForce=o,this.blend=s,this.trail=[],this.force=0,this.initTexture()}initTexture(){this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=this.size;let e=this.canvas.getContext("2d");if(null===e)throw Error("2D not available");this.ctx=e,this.ctx.fillStyle="black",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.texture=new eT.Texture(this.canvas),this.canvas.id="touchTexture",this.canvas.style.width=this.canvas.style.height=`${this.canvas.width}px`}update(e){this.clear(),this.trail.forEach((t,r)=>{t.age+=1e3*e,t.age>this.maxAge&&this.trail.splice(r,1)}),this.trail.length||(this.force=0),this.trail.forEach(e=>{this.drawTouch(e)}),this.texture.needsUpdate=!0}clear(){this.ctx.globalCompositeOperation="source-over",this.ctx.fillStyle="black",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height)}addTouch(e){let t=this.trail[this.trail.length-1];if(t){let r=t.x-e.x,i=t.y-e.y,n=r*r+i*i,a=Math.max(this.minForce,Math.min(1e4*n,1));if(this.force=function(e,t,r=.9){return t*r+e*(1-r)}(a,this.force,this.smoothing),this.interpolate){let e=Math.ceil(n/Math.pow(.5*this.radius/this.interpolate,2));if(e>1)for(let n=1;n<e;n++)this.trail.push({x:t.x-r/e*n,y:t.y-i/e*n,age:0,force:a})}}this.trail.push({x:e.x,y:e.y,age:0,force:this.force})}drawTouch(e){let t={x:e.x*this.size,y:(1-e.y)*this.size},r=1;r=(e.age<.3*this.maxAge?this.ease(e.age/(.3*this.maxAge)):this.ease(1-(e.age-.3*this.maxAge)/(.7*this.maxAge)))*e.force,this.ctx.globalCompositeOperation=this.blend;let i=this.size*this.radius*r,n=this.ctx.createRadialGradient(t.x,t.y,Math.max(0,.25*i),t.x,t.y,Math.max(0,i));n.addColorStop(0,`rgba(255, 255, 255, ${this.intensity})`),n.addColorStop(1,"rgba(0, 0, 0, 0.0)"),this.ctx.beginPath(),this.ctx.fillStyle=n,this.ctx.arc(t.x,t.y,Math.max(0,i),0,2*Math.PI),this.ctx.fill()}}function mg(e={}){let{size:t,maxAge:r,radius:i,intensity:n,interpolate:a,smoothing:o,minForce:s,blend:l,ease:c}=e,u=(0,eS.useMemo)(()=>new mp(e),[t,r,i,n,a,o,s,l,c]);(0,eR.F)((e,t)=>void u.update(t));let h=(0,eS.useCallback)(e=>u.addTouch(e.uv),[u]);return[u.texture,h]}let my=({children:e,...t})=>{let r=mg(t);return eS.createElement(eS.Fragment,null,null==e?void 0:e(r))},mv=eS.forwardRef(function({children:e,disable:t,disableX:r,disableY:i,disableZ:n,left:a,right:o,top:s,bottom:l,front:c,back:u,onCentered:h,precise:A=!0,cacheKey:d=0,...f},m){let p=eS.useRef(null),g=eS.useRef(null),y=eS.useRef(null);return eS.useLayoutEffect(()=>{g.current.matrixWorld.identity();let e=new eT.Box3().setFromObject(y.current,A),d=new eT.Vector3,f=new eT.Sphere,m=e.max.x-e.min.x,v=e.max.y-e.min.y,E=e.max.z-e.min.z;e.getCenter(d),e.getBoundingSphere(f);let x=s?v/2:l?-v/2:0,C=a?-m/2:o?m/2:0,B=c?E/2:u?-E/2:0;g.current.position.set(t||r?0:-d.x+C,t||i?0:-d.y+x,t||n?0:-d.z+B),void 0!==h&&h({parent:p.current.parent,container:p.current,width:m,height:v,depth:E,boundingBox:e,boundingSphere:f,center:d,verticalAlignment:x,horizontalAlignment:C,depthAlignment:B})},[d,h,s,a,c,t,r,i,n,A,o,l,u]),eS.useImperativeHandle(m,()=>p.current,[]),eS.createElement("group",j({ref:p},f),eS.createElement("group",{ref:g},eS.createElement("group",{ref:y},e)))}),mE=eS.forwardRef(({font:e,color:t="#cbcbcb",bevelSize:r=.04,debug:i=!1,children:n,...a},o)=>{let[s,l]=eS.useState(0),c=eS.useCallback((e=1)=>l(s+e),[s]),u=eS.useCallback((e=1)=>l(s-e),[s]),h=eS.useMemo(()=>({incr:c,decr:u}),[c,u]);return eS.useImperativeHandle(o,()=>h,[h]),eS.createElement("group",a,eS.createElement(eS.Suspense,{fallback:null},eS.createElement(mv,{top:!0,cacheKey:JSON.stringify({counter:s,font:e})},eS.createElement(o2,{bevelEnabled:!0,bevelSize:r,font:e},i?eS.createElement("meshNormalMaterial",{wireframe:!0}):eS.createElement("meshStandardMaterial",{color:t}),s))),n)});var mx=r(4275),mC=r.n(mx);function mB(e){return function e(t,r,i){if(i=i||[],!r[0])return t(i);function n(n){return e(t,r.slice(1),i.concat([n]))}return"function"==typeof r[0]?r[0]({results:i,render:n}):(0,eS.cloneElement)(r[0],{children:n})}(e.children,e.components)}mB.propTypes={children:mC().func.isRequired,components:mC().arrayOf(mC().oneOfType([mC().element,mC().func])).isRequired};let mw=(e,t)=>{"updateRanges"in e?e.updateRanges[0]=t:e.updateRange=t},mI=new eT.Matrix4,mb=new eT.Matrix4,m_=[],mM=new eT.Mesh;class mS extends eT.Group{constructor(){super(),this.color=new eT.Color("white"),this.instance={current:void 0},this.instanceKey={current:void 0}}get geometry(){var e;return null==(e=this.instance.current)?void 0:e.geometry}raycast(e,t){let r=this.instance.current;if(!r||!r.geometry||!r.material)return;mM.geometry=r.geometry;let i=r.matrixWorld,n=r.userData.instances.indexOf(this.instanceKey);if(-1!==n&&!(n>r.count)){r.getMatrixAt(n,mI),mb.multiplyMatrices(i,mI),mM.matrixWorld=mb,r.material instanceof eT.Material?mM.material.side=r.material.side:mM.material.side=r.material[0].side,mM.raycast(e,m_);for(let e=0,r=m_.length;e<r;e++){let r=m_[e];r.instanceId=n,r.object=this,t.push(r)}m_.length=0}}}let mD=eS.createContext(null),mT=new eT.Matrix4,mR=new eT.Matrix4,mF=new eT.Matrix4,mP=new eT.Vector3,mQ=new eT.Quaternion,mz=new eT.Vector3,mL=e=>e.isInstancedBufferAttribute,mO=eS.forwardRef(({context:e,children:t,...r},i)=>{eS.useMemo(()=>(0,eR.e)({PositionMesh:mS}),[]);let n=eS.useRef();eS.useImperativeHandle(i,()=>n.current,[]);let{subscribe:a,getParent:o}=eS.useContext(e||mD);return eS.useLayoutEffect(()=>a(n),[]),eS.createElement("positionMesh",j({instance:o(),instanceKey:n,ref:n},r),t)}),mU=eS.forwardRef(({context:e,children:t,range:r,limit:i=1e3,frames:n=1/0,...a},o)=>{let[{localContext:s,instance:l}]=eS.useState(()=>{let e=eS.createContext(null);return{localContext:e,instance:eS.forwardRef((t,r)=>eS.createElement(mO,j({context:e},t,{ref:r})))}}),c=eS.useRef(null);eS.useImperativeHandle(o,()=>c.current,[]);let[u,h]=eS.useState([]),[[A,d]]=eS.useState(()=>{let e=new Float32Array(16*i);for(let t=0;t<i;t++)mF.identity().toArray(e,16*t);return[e,new Float32Array([...Array(3*i)].map(()=>1))]});eS.useEffect(()=>{c.current.instanceMatrix.needsUpdate=!0});let f=0,m=0,p=eS.useRef([]);eS.useLayoutEffect(()=>{p.current=Object.entries(c.current.geometry.attributes).filter(([e,t])=>mL(t))}),(0,eR.F)(()=>{if(n===1/0||f<n){c.current.updateMatrix(),c.current.updateMatrixWorld(),mT.copy(c.current.matrixWorld).invert(),m=Math.min(i,void 0!==r?r:i,u.length),c.current.count=m,mw(c.current.instanceMatrix,{offset:0,count:16*m}),mw(c.current.instanceColor,{offset:0,count:3*m});for(let e=0;e<u.length;e++){let t=u[e].current;t.matrixWorld.decompose(mP,mQ,mz),mR.compose(mP,mQ,mz).premultiply(mT),mR.toArray(A,16*e),c.current.instanceMatrix.needsUpdate=!0,t.color.toArray(d,3*e),c.current.instanceColor.needsUpdate=!0}f++}});let g=eS.useMemo(()=>({getParent:()=>c,subscribe:e=>(h(t=>[...t,e]),()=>h(t=>t.filter(t=>t.current!==e.current)))}),[]);return eS.createElement("instancedMesh",j({userData:{instances:u,limit:i,frames:n},matrixAutoUpdate:!1,ref:c,args:[null,null,0],raycast:()=>null},a),eS.createElement("instancedBufferAttribute",{attach:"instanceMatrix",count:A.length/16,array:A,itemSize:16,usage:eT.DynamicDrawUsage}),eS.createElement("instancedBufferAttribute",{attach:"instanceColor",count:d.length/3,array:d,itemSize:3,usage:eT.DynamicDrawUsage}),"function"==typeof t?eS.createElement(s.Provider,{value:g},t(l)):e?eS.createElement(e.Provider,{value:g},t):eS.createElement(mD.Provider,{value:g},t))}),mk=eS.forwardRef(function({meshes:e,children:t,...r},i){let n=Array.isArray(e);if(!n)for(let t of Object.keys(e))e[t].isMesh||delete e[t];return eS.createElement("group",{ref:i},eS.createElement(mB,{components:(n?e:Object.values(e)).map(({geometry:e,material:t})=>eS.createElement(mU,j({key:e.uuid,geometry:e,material:t},r)))},r=>n?t(...r):t(Object.keys(e).filter(t=>e[t].isMesh).reduce((e,t,i)=>({...e,[t]:r[i]}),{}))))});function mG(){let e=eS.createContext(null);return[eS.forwardRef((t,r)=>eS.createElement(mU,j({ref:r,context:e},t))),eS.forwardRef((t,r)=>eS.createElement(mO,j({ref:r,context:e},t)))]}let mN=eS.forwardRef(({name:e,defaultValue:t,normalized:r,usage:i=eT.DynamicDrawUsage},n)=>{let a=eS.useRef(null);eS.useImperativeHandle(n,()=>a.current,[]),eS.useLayoutEffect(()=>{let r=a.current.__r3f.parent;r.geometry.attributes[e]=a.current;let i=Array.isArray(t)?t:[t],n=Array.from({length:r.userData.limit},()=>i).flat();return a.current.array=new Float32Array(n),a.current.itemSize=i.length,a.current.count=n.length/a.current.itemSize,()=>{delete r.geometry.attributes[e]}},[e]);let o=0;return(0,eR.F)(()=>{let t=a.current.__r3f.parent;if(t.userData.frames===1/0||o<t.userData.frames){for(let r=0;r<t.userData.instances.length;r++){let i=t.userData.instances[r].current[e];void 0!==i&&(a.current.set(Array.isArray(i)?i:"function"==typeof i.toArray?i.toArray():[i],r*a.current.itemSize),a.current.needsUpdate=!0)}o++}}),eS.createElement("instancedBufferAttribute",{ref:a,usage:i,normalized:r})}),mH=eS.createContext(null);function mV(){return eS.useContext(mH)}let mj=new eT.PlaneGeometry(1,1),mJ=eS.forwardRef(({startFrame:e=0,endFrame:t,fps:r=30,frameName:i="",textureDataURL:n,textureImageURL:a,loop:o=!1,numberOfFrames:s=1,autoPlay:l=!0,animationNames:c,onStart:u,onEnd:h,onLoopEnd:A,onFrame:d,play:f,pause:m=!1,flipX:p=!1,alphaTest:g=0,children:y,asSprite:v=!1,offset:E,playBackwards:x=!1,resetOnEnd:C=!1,maxItems:B=1,instanceItems:w=[[0,0,0]],spriteDataset:I,canvasRenderingContext2DSettings:b,roundFramePosition:_=!1,meshProps:M={},...S},D)=>{let T=eS.useRef(new eT.Group),R=eS.useRef(null),F=eS.useRef(null),P=eS.useRef(null),Q=eS.useRef(window.performance.now()),z=eS.useRef(e),L=eS.useRef(i),O=r>0?1e3/r:0,[U,k]=eS.useState(new eT.Texture),G=eS.useRef(0),[N,H]=eS.useState(new eT.Vector3(1,1,1)),V=p?-1:1,J=eS.useRef(m),Y=eS.useRef(E),W=eS.useRef(!1),{spriteObj:K,loadJsonAndTexture:q}=A1(null,null,c,s,void 0,b),X=eS.useRef(i),Z=eS.useCallback((e,t)=>{if(null===t)s&&(G.current=s,x&&(z.current=s-1),R.current=t);else{var r,i;R.current=t,R.current&&Array.isArray(R.current.frames)?G.current=R.current.frames.length:R.current&&"object"==typeof R.current&&X.current?G.current=R.current.frames[X.current].length:G.current=0,x&&(z.current=G.current-1);let{w:n,h:a}=AZ(null!==(r=null==(i=R.current)?void 0:i.frames)&&void 0!==r?r:[],X.current).sourceSize;H(et(n,a)),F.current&&(F.current.map=e)}k(e)},[s,x]),$=eS.useCallback(()=>{if(!R.current)return;let{meta:{size:e},frames:t}=R.current,{w:r,h:n}=Array.isArray(t)?t[0].sourceSize:i&&t[i]?t[i][0].sourceSize:{w:0,h:0};F.current&&F.current.map&&(F.current.map.wrapS=F.current.map.wrapT=eT.RepeatWrapping,F.current.map.center.set(0,0),F.current.map.repeat.set(1*V/(e.w/r),1/(e.h/n)));let a=(e.h-1)/n;F.current&&F.current.map&&(F.current.map.offset.x=0,F.current.map.offset.y=1-1/a),u&&u({currentFrameName:null!=i?i:"",currentFrame:z.current})},[V,i,u]),ee=eS.useMemo(()=>({current:Y.current,offset:Y.current,imageUrl:a,hasEnded:!1,ref:D}),[a,D]);eS.useImperativeHandle(D,()=>T.current,[]),eS.useLayoutEffect(()=>{Y.current=E},[E]);let et=(e,t)=>{var r;let i=new eT.Vector3;return i.set(1,t/e,1),null==(r=P.current)||r.scale.copy(i),i};eS.useEffect(()=>{if(I){var e;Z(null==I||null==(e=I.spriteTexture)?void 0:e.clone(),I.spriteData)}else a&&n&&q(a,n)},[q,I,n,a,Z]),eS.useEffect(()=>{if(K){var e;Z(null==K||null==(e=K.spriteTexture)?void 0:e.clone(),null==K?void 0:K.spriteData)}},[K,Z]),eS.useEffect(()=>{if(ee.hasEnded=!1,R.current&&!0===x){var e;z.current=(null!==(e=R.current.frames.length)&&void 0!==e?e:0)-1}else z.current=0},[x,ee]),eS.useLayoutEffect(()=>{$()},[U,p,$]),eS.useEffect(()=>{l&&(J.current=!1)},[l]),eS.useLayoutEffect(()=>{if(L.current!==i&&i&&(z.current=0,L.current=i,ee.hasEnded=!1,O<=0&&(z.current=t||e||0),R.current)){let{w:e,h:t}=AZ(R.current.frames,i).sourceSize;H(et(e,t))}},[i,O,ee,t,e]);let er=()=>{if(!(null!==(d=R.current)&&"meta"in d&&"frames"in d))return;let{meta:{size:r},frames:n}=R.current,{w:a,h:s}=AZ(n,i).sourceSize,l=Array.isArray(n)?n:i?n[i]:[],c=t||l.length-1;var d,f=void 0===E?ee.current:E;if(O<=0){z.current=t||e||0,ei(a,s,r,l);return}let m=window.performance.now(),p=m-Q.current;if(!(p<=O)){var g=x?z.current<0:z.current>c,y=x?z.current===c:0===z.current,v=x?z.current<0:z.current>=c;if(g){if(z.current=o&&null!=e?e:0,x&&(z.current=c),o?null==A||A({currentFrameName:null!=i?i:"",currentFrame:z.current}):(null==h||h({currentFrameName:null!=i?i:"",currentFrame:z.current}),ee.hasEnded=!C,C&&(J.current=!0)),!o)return}else y&&(null==u||u({currentFrameName:null!=i?i:"",currentFrame:z.current}));void 0!==f&&v?!1===W.current&&(null==h||h({currentFrameName:null!=i?i:"",currentFrame:z.current}),W.current=!0):W.current=!1,p<=O||(Q.current=m-p%O,ei(a,s,r,l))}},ei=(e,t,r,i)=>{var n=void 0===E?ee.current:E;let a=z.current,o=0,s=0;et(e,t);let l=_?Math.round((r.w-1)/e):(r.w-1)/e,c=_?Math.round((r.h-1)/t):(r.h-1)/t;if(!i[a])return;let{frame:{x:u,y:h},sourceSize:{w:A,h:d}}=i[a],f=1/l,m=1/c;if(F.current&&F.current.map&&(o=V>0?u/A*f:u/A*f-F.current.map.repeat.x,s=Math.abs(1-m)-h/d*m,F.current.map.offset.x=o,F.current.map.offset.y=s),null!=n){let e=Math.floor(n*i.length);isNaN(e=Math.max(0,Math.min(e,i.length-1)))&&(e=0),z.current=e}else x?z.current-=1:z.current+=1};return(0,eR.F)((e,t)=>{var r,i;null!=(r=R.current)&&r.frames&&null!=(i=F.current)&&i.map&&!J.current&&!ee.hasEnded&&(l||f)&&(er(),null==d||d({currentFrameName:L.current,currentFrame:z.current}))}),eS.createElement("group",j({},S,{ref:T,scale:function(e=new eT.Vector3(1,1,1),t=1){return"number"==typeof t?e.multiplyScalar(t):Array.isArray(t)?e.multiply(new eT.Vector3(...t)):t instanceof eT.Vector3?e.multiply(t):void 0}(N,S.scale)}),eS.createElement(mH.Provider,{value:ee},v&&eS.createElement(oe,null,eS.createElement("mesh",j({ref:P,scale:1,geometry:mj},M),eS.createElement("meshBasicMaterial",{premultipliedAlpha:!1,toneMapped:!1,side:eT.DoubleSide,ref:F,map:U,transparent:!0,alphaTest:null!=g?g:0}))),!v&&eS.createElement(mU,j({geometry:mj,limit:null!=B?B:1},M),eS.createElement("meshBasicMaterial",{premultipliedAlpha:!1,toneMapped:!1,side:eT.DoubleSide,ref:F,map:U,transparent:!0,alphaTest:null!=g?g:0}),(null!=w?w:[0]).map((e,t)=>eS.createElement(mO,j({key:t,ref:(null==w?void 0:w.length)===1?P:null,position:e,scale:1},M)))),y))});var mY=Object.defineProperty,mW=(e,t,r)=>t in e?mY(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,mK=(e,t,r)=>(mW(e,"symbol"!=typeof t?t+"":t,r),r);let mq=(e=1)=>{let t=new Float32Array(4096*e*4),r=new eT.DataTexture(t,1024,4*e,eT.RGBAFormat,eT.FloatType);return r.wrapS=eT.RepeatWrapping,r.wrapT=eT.RepeatWrapping,r.magFilter=eT.NearestFilter,r.needsUpdate=!0,r},mX=(e,t,r=0)=>{let i=Math.floor(1024);t.arcLengthDivisions=i/2,t.updateArcLengths();let n=t.getSpacedPoints(i),a=t.computeFrenetFrames(i,!0);for(let t=0;t<i;t++){let i=Math.floor(t/1024),o=t%1024,s=n[t];mZ(e,o,s.x,s.y,s.z,0+i+4*r),mZ(e,o,(s=a.tangents[t]).x,s.y,s.z,1+i+4*r),mZ(e,o,(s=a.normals[t]).x,s.y,s.z,2+i+4*r),mZ(e,o,(s=a.binormals[t]).x,s.y,s.z,3+i+4*r)}e.needsUpdate=!0},mZ=(e,t,r,i,n,a)=>{let{data:o}=e.image,s=4096*a;o[4*t+s+0]=r,o[4*t+s+1]=i,o[4*t+s+2]=n,o[4*t+s+3]=1},m$=e=>({spineTexture:{value:e},pathOffset:{type:"f",value:0},pathSegment:{type:"f",value:1},spineOffset:{type:"f",value:161},spineLength:{type:"f",value:400},flow:{type:"i",value:1}});class m1{constructor(e,t=1){mK(this,"curveArray"),mK(this,"curveLengthArray"),mK(this,"object3D"),mK(this,"splineTexure"),mK(this,"uniforms");let r=e.clone(),i=mq(t),n=m$(i);r.traverse(e=>{(e instanceof eT.Mesh||e instanceof eT.InstancedMesh)&&(e.material=e.material.clone(),function(e,t,r=1){e.__ok||(e.__ok=!0,e.onBeforeCompile=e=>{if(e.__modified)return;e.__modified=!0,Object.assign(e.uniforms,t);let i=`
		uniform sampler2D spineTexture;
		uniform float pathOffset;
		uniform float pathSegment;
		uniform float spineOffset;
		uniform float spineLength;
		uniform int flow;

		float textureLayers = ${4*r}.;
		float textureStacks = 1.;

		${e.vertexShader}
		`.replace("#include <beginnormal_vertex>","").replace("#include <defaultnormal_vertex>","").replace("#include <begin_vertex>","").replace(/void\s*main\s*\(\)\s*\{/,`
        void main() {
        #include <beginnormal_vertex>

        vec4 worldPos = modelMatrix * vec4(position, 1.);

        bool bend = flow > 0;
        float xWeight = bend ? 0. : 1.;

        #ifdef USE_INSTANCING
        float pathOffsetFromInstanceMatrix = instanceMatrix[3][2];
        float spineLengthFromInstanceMatrix = instanceMatrix[3][0];
        float spinePortion = bend ? (worldPos.x + spineOffset) / spineLengthFromInstanceMatrix : 0.;
        float mt = (spinePortion * pathSegment + pathOffset + pathOffsetFromInstanceMatrix)*textureStacks;
        #else
        float spinePortion = bend ? (worldPos.x + spineOffset) / spineLength : 0.;
        float mt = (spinePortion * pathSegment + pathOffset)*textureStacks;
        #endif

        mt = mod(mt, textureStacks);
        float rowOffset = floor(mt);

        #ifdef USE_INSTANCING
        rowOffset += instanceMatrix[3][1] * 4.;
        #endif

        vec3 spinePos = texture2D(spineTexture, vec2(mt, (0. + rowOffset + 0.5) / textureLayers)).xyz;
        vec3 a =        texture2D(spineTexture, vec2(mt, (1. + rowOffset + 0.5) / textureLayers)).xyz;
        vec3 b =        texture2D(spineTexture, vec2(mt, (2. + rowOffset + 0.5) / textureLayers)).xyz;
        vec3 c =        texture2D(spineTexture, vec2(mt, (3. + rowOffset + 0.5) / textureLayers)).xyz;
        mat3 basis = mat3(a, b, c);

        vec3 transformed = basis
          * vec3(worldPos.x * xWeight, worldPos.y * 1., worldPos.z * 1.)
          + spinePos;

        vec3 transformedNormal = normalMatrix * (basis * objectNormal);
			`).replace("#include <project_vertex>",`vec4 mvPosition = modelViewMatrix * vec4( transformed, 1.0 );
				gl_Position = projectionMatrix * mvPosition;`);e.vertexShader=i})}(e.material,n,t))}),this.curveArray=Array(t),this.curveLengthArray=Array(t),this.object3D=r,this.splineTexure=i,this.uniforms=n}updateCurve(e,t){if(e>=this.curveArray.length)throw Error("Index out of range for Flow");let r=t.getLength();this.uniforms.spineLength.value=r,this.curveLengthArray[e]=r,this.curveArray[e]=t,mX(this.splineTexure,t,e)}moveAlongCurve(e){this.uniforms.pathOffset.value+=e}}let m0=eS.forwardRef(({children:e,curve:t},r)=>{let[i]=eS.useState(()=>new eT.Scene),[n,a]=eS.useState(),o=eS.useRef(null);return eS.useLayoutEffect(()=>{o.current=new m1(i.children[0]),a(o.current.object3D)},[e]),eS.useEffect(()=>{var e;t&&(null==(e=o.current)||e.updateCurve(0,t))},[t]),eS.useImperativeHandle(r,()=>o.current),eS.createElement(eS.Fragment,null,(0,eR.h)(e,i),n&&eS.createElement("primitive",{object:n}))});class m2 extends eT.MeshPhysicalMaterial{constructor(e={}){super(e),this.setValues(e),this._time={value:0},this._distort={value:.4},this._radius={value:1}}onBeforeCompile(e){e.uniforms.time=this._time,e.uniforms.radius=this._radius,e.uniforms.distort=this._distort,e.vertexShader=`
      uniform float time;
      uniform float radius;
      uniform float distort;
      #define GLSLIFY 1
vec3 mod289(vec3 x){return x-floor(x*(1.0/289.0))*289.0;}vec4 mod289(vec4 x){return x-floor(x*(1.0/289.0))*289.0;}vec4 permute(vec4 x){return mod289(((x*34.0)+1.0)*x);}vec4 taylorInvSqrt(vec4 r){return 1.79284291400159-0.85373472095314*r;}float snoise(vec3 v){const vec2 C=vec2(1.0/6.0,1.0/3.0);const vec4 D=vec4(0.0,0.5,1.0,2.0);vec3 i=floor(v+dot(v,C.yyy));vec3 x0=v-i+dot(i,C.xxx);vec3 g=step(x0.yzx,x0.xyz);vec3 l=1.0-g;vec3 i1=min(g.xyz,l.zxy);vec3 i2=max(g.xyz,l.zxy);vec3 x1=x0-i1+C.xxx;vec3 x2=x0-i2+C.yyy;vec3 x3=x0-D.yyy;i=mod289(i);vec4 p=permute(permute(permute(i.z+vec4(0.0,i1.z,i2.z,1.0))+i.y+vec4(0.0,i1.y,i2.y,1.0))+i.x+vec4(0.0,i1.x,i2.x,1.0));float n_=0.142857142857;vec3 ns=n_*D.wyz-D.xzx;vec4 j=p-49.0*floor(p*ns.z*ns.z);vec4 x_=floor(j*ns.z);vec4 y_=floor(j-7.0*x_);vec4 x=x_*ns.x+ns.yyyy;vec4 y=y_*ns.x+ns.yyyy;vec4 h=1.0-abs(x)-abs(y);vec4 b0=vec4(x.xy,y.xy);vec4 b1=vec4(x.zw,y.zw);vec4 s0=floor(b0)*2.0+1.0;vec4 s1=floor(b1)*2.0+1.0;vec4 sh=-step(h,vec4(0.0));vec4 a0=b0.xzyw+s0.xzyw*sh.xxyy;vec4 a1=b1.xzyw+s1.xzyw*sh.zzww;vec3 p0=vec3(a0.xy,h.x);vec3 p1=vec3(a0.zw,h.y);vec3 p2=vec3(a1.xy,h.z);vec3 p3=vec3(a1.zw,h.w);vec4 norm=taylorInvSqrt(vec4(dot(p0,p0),dot(p1,p1),dot(p2,p2),dot(p3,p3)));p0*=norm.x;p1*=norm.y;p2*=norm.z;p3*=norm.w;vec4 m=max(0.6-vec4(dot(x0,x0),dot(x1,x1),dot(x2,x2),dot(x3,x3)),0.0);m=m*m;return 42.0*dot(m*m,vec4(dot(p0,x0),dot(p1,x1),dot(p2,x2),dot(p3,x3)));}
      ${e.vertexShader}
    `,e.vertexShader=e.vertexShader.replace("#include <begin_vertex>",`
        float updateTime = time / 50.0;
        float noise = snoise(vec3(position / 2.0 + updateTime * 5.0));
        vec3 transformed = vec3(position * (noise * pow(distort, 2.0) + radius));
        `)}get time(){return this._time.value}set time(e){this._time.value=e}get distort(){return this._distort.value}set distort(e){this._distort.value=e}get radius(){return this._radius.value}set radius(e){this._radius.value=e}}let m3=eS.forwardRef(({speed:e=1,...t},r)=>{let[i]=eS.useState(()=>new m2);return(0,eR.F)(t=>i&&(i.time=t.clock.elapsedTime*e)),eS.createElement("primitive",j({object:i,ref:r,attach:"material"},t))});class m4 extends eT.MeshStandardMaterial{constructor(e={}){super(e),this.setValues(e),this._time={value:0},this._factor={value:1}}onBeforeCompile(e){e.uniforms.time=this._time,e.uniforms.factor=this._factor,e.vertexShader=`
      uniform float time;
      uniform float factor;
      ${e.vertexShader}
    `,e.vertexShader=e.vertexShader.replace("#include <begin_vertex>",`float theta = sin( time + position.y ) / 2.0 * factor;
        float c = cos( theta );
        float s = sin( theta );
        mat3 m = mat3( c, 0, s, 0, 1, 0, -s, 0, c );
        vec3 transformed = vec3( position ) * m;
        vNormal = vNormal * m;`)}get time(){return this._time.value}set time(e){this._time.value=e}get factor(){return this._factor.value}set factor(e){this._factor.value=e}}let m5=eS.forwardRef(({speed:e=1,...t},r)=>{let[i]=eS.useState(()=>new m4);return(0,eR.F)(t=>i&&(i.time=t.clock.elapsedTime*e)),eS.createElement("primitive",j({object:i,ref:r,attach:"material"},t))});class m6 extends eT.ShaderMaterial{constructor(e=new eT.Vector2){super({uniforms:{inputBuffer:new eT.Uniform(null),depthBuffer:new eT.Uniform(null),resolution:new eT.Uniform(new eT.Vector2),texelSize:new eT.Uniform(new eT.Vector2),halfTexelSize:new eT.Uniform(new eT.Vector2),kernel:new eT.Uniform(0),scale:new eT.Uniform(1),cameraNear:new eT.Uniform(0),cameraFar:new eT.Uniform(1),minDepthThreshold:new eT.Uniform(0),maxDepthThreshold:new eT.Uniform(1),depthScale:new eT.Uniform(0),depthToBlurRatioBias:new eT.Uniform(.25)},fragmentShader:`#include <common>
        #include <dithering_pars_fragment>      
        uniform sampler2D inputBuffer;
        uniform sampler2D depthBuffer;
        uniform float cameraNear;
        uniform float cameraFar;
        uniform float minDepthThreshold;
        uniform float maxDepthThreshold;
        uniform float depthScale;
        uniform float depthToBlurRatioBias;
        varying vec2 vUv;
        varying vec2 vUv0;
        varying vec2 vUv1;
        varying vec2 vUv2;
        varying vec2 vUv3;

        void main() {
          float depthFactor = 0.0;
          
          #ifdef USE_DEPTH
            vec4 depth = texture2D(depthBuffer, vUv);
            depthFactor = smoothstep(minDepthThreshold, maxDepthThreshold, 1.0-(depth.r * depth.a));
            depthFactor *= depthScale;
            depthFactor = max(0.0, min(1.0, depthFactor + 0.25));
          #endif
          
          vec4 sum = texture2D(inputBuffer, mix(vUv0, vUv, depthFactor));
          sum += texture2D(inputBuffer, mix(vUv1, vUv, depthFactor));
          sum += texture2D(inputBuffer, mix(vUv2, vUv, depthFactor));
          sum += texture2D(inputBuffer, mix(vUv3, vUv, depthFactor));
          gl_FragColor = sum * 0.25 ;

          #include <dithering_fragment>
          #include <tonemapping_fragment>
          #include <${sI>=154?"colorspace_fragment":"encodings_fragment"}>
        }`,vertexShader:`uniform vec2 texelSize;
        uniform vec2 halfTexelSize;
        uniform float kernel;
        uniform float scale;
        varying vec2 vUv;
        varying vec2 vUv0;
        varying vec2 vUv1;
        varying vec2 vUv2;
        varying vec2 vUv3;

        void main() {
          vec2 uv = position.xy * 0.5 + 0.5;
          vUv = uv;

          vec2 dUv = (texelSize * vec2(kernel) + halfTexelSize) * scale;
          vUv0 = vec2(uv.x - dUv.x, uv.y + dUv.y);
          vUv1 = vec2(uv.x + dUv.x, uv.y + dUv.y);
          vUv2 = vec2(uv.x + dUv.x, uv.y - dUv.y);
          vUv3 = vec2(uv.x - dUv.x, uv.y - dUv.y);

          gl_Position = vec4(position.xy, 1.0, 1.0);
        }`,blending:eT.NoBlending,depthWrite:!1,depthTest:!1}),this.toneMapped=!1,this.setTexelSize(e.x,e.y),this.kernel=new Float32Array([0,1,2,2,3])}setTexelSize(e,t){this.uniforms.texelSize.value.set(e,t),this.uniforms.halfTexelSize.value.set(e,t).multiplyScalar(.5)}setResolution(e){this.uniforms.resolution.value.copy(e)}}class m8{constructor({gl:e,resolution:t,width:r=500,height:i=500,minDepthThreshold:n=0,maxDepthThreshold:a=1,depthScale:o=0,depthToBlurRatioBias:s=.25}){this.renderToScreen=!1,this.renderTargetA=new eT.WebGLRenderTarget(t,t,{minFilter:eT.LinearFilter,magFilter:eT.LinearFilter,stencilBuffer:!1,depthBuffer:!1,type:eT.HalfFloatType}),this.renderTargetB=this.renderTargetA.clone(),this.convolutionMaterial=new m6,this.convolutionMaterial.setTexelSize(1/r,1/i),this.convolutionMaterial.setResolution(new eT.Vector2(r,i)),this.scene=new eT.Scene,this.camera=new eT.Camera,this.convolutionMaterial.uniforms.minDepthThreshold.value=n,this.convolutionMaterial.uniforms.maxDepthThreshold.value=a,this.convolutionMaterial.uniforms.depthScale.value=o,this.convolutionMaterial.uniforms.depthToBlurRatioBias.value=s,this.convolutionMaterial.defines.USE_DEPTH=o>0;let l=new Float32Array([-1,-1,0,3,-1,0,-1,3,0]),c=new Float32Array([0,0,2,0,0,2]),u=new eT.BufferGeometry;u.setAttribute("position",new eT.BufferAttribute(l,3)),u.setAttribute("uv",new eT.BufferAttribute(c,2)),this.screen=new eT.Mesh(u,this.convolutionMaterial),this.screen.frustumCulled=!1,this.scene.add(this.screen)}render(e,t,r){let i,n,a;let o=this.scene,s=this.camera,l=this.renderTargetA,c=this.renderTargetB,u=this.convolutionMaterial,h=u.uniforms;h.depthBuffer.value=t.depthTexture;let A=u.kernel,d=t;for(n=0,a=A.length-1;n<a;++n)i=(1&n)==0?l:c,h.kernel.value=A[n],h.inputBuffer.value=d.texture,e.setRenderTarget(i),e.render(o,s),d=i;h.kernel.value=A[n],h.inputBuffer.value=d.texture,e.setRenderTarget(this.renderToScreen?null:r),e.render(o,s)}}class m9 extends eT.MeshStandardMaterial{constructor(e={}){super(e),this._tDepth={value:null},this._distortionMap={value:null},this._tDiffuse={value:null},this._tDiffuseBlur={value:null},this._textureMatrix={value:null},this._hasBlur={value:!1},this._mirror={value:0},this._mixBlur={value:0},this._blurStrength={value:.5},this._minDepthThreshold={value:.9},this._maxDepthThreshold={value:1},this._depthScale={value:0},this._depthToBlurRatioBias={value:.25},this._distortion={value:1},this._mixContrast={value:1},this.setValues(e)}onBeforeCompile(e){var t;null!=(t=e.defines)&&t.USE_UV||(e.defines.USE_UV=""),e.uniforms.hasBlur=this._hasBlur,e.uniforms.tDiffuse=this._tDiffuse,e.uniforms.tDepth=this._tDepth,e.uniforms.distortionMap=this._distortionMap,e.uniforms.tDiffuseBlur=this._tDiffuseBlur,e.uniforms.textureMatrix=this._textureMatrix,e.uniforms.mirror=this._mirror,e.uniforms.mixBlur=this._mixBlur,e.uniforms.mixStrength=this._blurStrength,e.uniforms.minDepthThreshold=this._minDepthThreshold,e.uniforms.maxDepthThreshold=this._maxDepthThreshold,e.uniforms.depthScale=this._depthScale,e.uniforms.depthToBlurRatioBias=this._depthToBlurRatioBias,e.uniforms.distortion=this._distortion,e.uniforms.mixContrast=this._mixContrast,e.vertexShader=`
        uniform mat4 textureMatrix;
        varying vec4 my_vUv;
      ${e.vertexShader}`,e.vertexShader=e.vertexShader.replace("#include <project_vertex>",`#include <project_vertex>
        my_vUv = textureMatrix * vec4( position, 1.0 );
        gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );`),e.fragmentShader=`
        uniform sampler2D tDiffuse;
        uniform sampler2D tDiffuseBlur;
        uniform sampler2D tDepth;
        uniform sampler2D distortionMap;
        uniform float distortion;
        uniform float cameraNear;
			  uniform float cameraFar;
        uniform bool hasBlur;
        uniform float mixBlur;
        uniform float mirror;
        uniform float mixStrength;
        uniform float minDepthThreshold;
        uniform float maxDepthThreshold;
        uniform float mixContrast;
        uniform float depthScale;
        uniform float depthToBlurRatioBias;
        varying vec4 my_vUv;
        ${e.fragmentShader}`,e.fragmentShader=e.fragmentShader.replace("#include <emissivemap_fragment>",`#include <emissivemap_fragment>

      float distortionFactor = 0.0;
      #ifdef USE_DISTORTION
        distortionFactor = texture2D(distortionMap, vUv).r * distortion;
      #endif

      vec4 new_vUv = my_vUv;
      new_vUv.x += distortionFactor;
      new_vUv.y += distortionFactor;

      vec4 base = texture2DProj(tDiffuse, new_vUv);
      vec4 blur = texture2DProj(tDiffuseBlur, new_vUv);

      vec4 merge = base;

      #ifdef USE_NORMALMAP
        vec2 normal_uv = vec2(0.0);
        vec4 normalColor = texture2D(normalMap, vUv * normalScale);
        vec3 my_normal = normalize( vec3( normalColor.r * 2.0 - 1.0, normalColor.b,  normalColor.g * 2.0 - 1.0 ) );
        vec3 coord = new_vUv.xyz / new_vUv.w;
        normal_uv = coord.xy + coord.z * my_normal.xz * 0.05;
        vec4 base_normal = texture2D(tDiffuse, normal_uv);
        vec4 blur_normal = texture2D(tDiffuseBlur, normal_uv);
        merge = base_normal;
        blur = blur_normal;
      #endif

      float depthFactor = 0.0001;
      float blurFactor = 0.0;

      #ifdef USE_DEPTH
        vec4 depth = texture2DProj(tDepth, new_vUv);
        depthFactor = smoothstep(minDepthThreshold, maxDepthThreshold, 1.0-(depth.r * depth.a));
        depthFactor *= depthScale;
        depthFactor = max(0.0001, min(1.0, depthFactor));

        #ifdef USE_BLUR
          blur = blur * min(1.0, depthFactor + depthToBlurRatioBias);
          merge = merge * min(1.0, depthFactor + 0.5);
        #else
          merge = merge * depthFactor;
        #endif

      #endif

      float reflectorRoughnessFactor = roughness;
      #ifdef USE_ROUGHNESSMAP
        vec4 reflectorTexelRoughness = texture2D( roughnessMap, vUv );
        reflectorRoughnessFactor *= reflectorTexelRoughness.g;
      #endif

      #ifdef USE_BLUR
        blurFactor = min(1.0, mixBlur * reflectorRoughnessFactor);
        merge = mix(merge, blur, blurFactor);
      #endif

      vec4 newMerge = vec4(0.0, 0.0, 0.0, 1.0);
      newMerge.r = (merge.r - 0.5) * mixContrast + 0.5;
      newMerge.g = (merge.g - 0.5) * mixContrast + 0.5;
      newMerge.b = (merge.b - 0.5) * mixContrast + 0.5;

      diffuseColor.rgb = diffuseColor.rgb * ((1.0 - min(1.0, mirror)) + newMerge.rgb * mixStrength);
      `)}get tDiffuse(){return this._tDiffuse.value}set tDiffuse(e){this._tDiffuse.value=e}get tDepth(){return this._tDepth.value}set tDepth(e){this._tDepth.value=e}get distortionMap(){return this._distortionMap.value}set distortionMap(e){this._distortionMap.value=e}get tDiffuseBlur(){return this._tDiffuseBlur.value}set tDiffuseBlur(e){this._tDiffuseBlur.value=e}get textureMatrix(){return this._textureMatrix.value}set textureMatrix(e){this._textureMatrix.value=e}get hasBlur(){return this._hasBlur.value}set hasBlur(e){this._hasBlur.value=e}get mirror(){return this._mirror.value}set mirror(e){this._mirror.value=e}get mixBlur(){return this._mixBlur.value}set mixBlur(e){this._mixBlur.value=e}get mixStrength(){return this._blurStrength.value}set mixStrength(e){this._blurStrength.value=e}get minDepthThreshold(){return this._minDepthThreshold.value}set minDepthThreshold(e){this._minDepthThreshold.value=e}get maxDepthThreshold(){return this._maxDepthThreshold.value}set maxDepthThreshold(e){this._maxDepthThreshold.value=e}get depthScale(){return this._depthScale.value}set depthScale(e){this._depthScale.value=e}get depthToBlurRatioBias(){return this._depthToBlurRatioBias.value}set depthToBlurRatioBias(e){this._depthToBlurRatioBias.value=e}get distortion(){return this._distortion.value}set distortion(e){this._distortion.value=e}get mixContrast(){return this._mixContrast.value}set mixContrast(e){this._mixContrast.value=e}}let m7=eS.forwardRef(({mixBlur:e=0,mixStrength:t=1,resolution:r=256,blur:i=[0,0],minDepthThreshold:n=.9,maxDepthThreshold:a=1,depthScale:o=0,depthToBlurRatioBias:s=.25,mirror:l=0,distortion:c=1,mixContrast:u=1,distortionMap:h,reflectorOffset:A=0,...d},f)=>{(0,eR.e)({MeshReflectorMaterialImpl:m9});let m=(0,eR.D)(({gl:e})=>e),p=(0,eR.D)(({camera:e})=>e),g=(0,eR.D)(({scene:e})=>e),y=(i=Array.isArray(i)?i:[i,i])[0]+i[1]>0,v=eS.useRef(null);eS.useImperativeHandle(f,()=>v.current,[]);let[E]=eS.useState(()=>new eT.Plane),[x]=eS.useState(()=>new eT.Vector3),[C]=eS.useState(()=>new eT.Vector3),[B]=eS.useState(()=>new eT.Vector3),[w]=eS.useState(()=>new eT.Matrix4),[I]=eS.useState(()=>new eT.Vector3(0,0,-1)),[b]=eS.useState(()=>new eT.Vector4),[_]=eS.useState(()=>new eT.Vector3),[M]=eS.useState(()=>new eT.Vector3),[S]=eS.useState(()=>new eT.Vector4),[D]=eS.useState(()=>new eT.Matrix4),[T]=eS.useState(()=>new eT.PerspectiveCamera),R=eS.useCallback(()=>{var e;let t=v.current.parent||(null==(e=v.current)?void 0:e.__r3f.parent);if(!t||(C.setFromMatrixPosition(t.matrixWorld),B.setFromMatrixPosition(p.matrixWorld),w.extractRotation(t.matrixWorld),x.set(0,0,1),x.applyMatrix4(w),C.addScaledVector(x,A),_.subVectors(C,B),_.dot(x)>0))return;_.reflect(x).negate(),_.add(C),w.extractRotation(p.matrixWorld),I.set(0,0,-1),I.applyMatrix4(w),I.add(B),M.subVectors(C,I),M.reflect(x).negate(),M.add(C),T.position.copy(_),T.up.set(0,1,0),T.up.applyMatrix4(w),T.up.reflect(x),T.lookAt(M),T.far=p.far,T.updateMatrixWorld(),T.projectionMatrix.copy(p.projectionMatrix),D.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),D.multiply(T.projectionMatrix),D.multiply(T.matrixWorldInverse),D.multiply(t.matrixWorld),E.setFromNormalAndCoplanarPoint(x,C),E.applyMatrix4(T.matrixWorldInverse),b.set(E.normal.x,E.normal.y,E.normal.z,E.constant);let r=T.projectionMatrix;S.x=(Math.sign(b.x)+r.elements[8])/r.elements[0],S.y=(Math.sign(b.y)+r.elements[9])/r.elements[5],S.z=-1,S.w=(1+r.elements[10])/r.elements[14],b.multiplyScalar(2/b.dot(S)),r.elements[2]=b.x,r.elements[6]=b.y,r.elements[10]=b.z+1,r.elements[14]=b.w},[p,A]),[F,P,Q,z]=eS.useMemo(()=>{let A={minFilter:eT.LinearFilter,magFilter:eT.LinearFilter,type:eT.HalfFloatType},d=new eT.WebGLRenderTarget(r,r,A);d.depthBuffer=!0,d.depthTexture=new eT.DepthTexture(r,r),d.depthTexture.format=eT.DepthFormat,d.depthTexture.type=eT.UnsignedShortType;let f=new eT.WebGLRenderTarget(r,r,A),p=new m8({gl:m,resolution:r,width:i[0],height:i[1],minDepthThreshold:n,maxDepthThreshold:a,depthScale:o,depthToBlurRatioBias:s}),g={mirror:l,textureMatrix:D,mixBlur:e,tDiffuse:d.texture,tDepth:d.depthTexture,tDiffuseBlur:f.texture,hasBlur:y,mixStrength:t,minDepthThreshold:n,maxDepthThreshold:a,depthScale:o,depthToBlurRatioBias:s,distortion:c,distortionMap:h,mixContrast:u,"defines-USE_BLUR":y?"":void 0,"defines-USE_DEPTH":o>0?"":void 0,"defines-USE_DISTORTION":h?"":void 0};return[d,f,p,g]},[m,i,D,r,l,y,e,t,n,a,o,s,c,h,u]);return(0,eR.F)(()=>{var e;let t=v.current.parent||(null==(e=v.current)?void 0:e.__r3f.parent);if(!t)return;t.visible=!1;let r=m.xr.enabled,i=m.shadowMap.autoUpdate;R(),m.xr.enabled=!1,m.shadowMap.autoUpdate=!1,m.setRenderTarget(F),m.state.buffers.depth.setMask(!0),m.autoClear||m.clear(),m.render(g,T),y&&Q.render(m,F,P),m.xr.enabled=r,m.shadowMap.autoUpdate=i,t.visible=!0,m.setRenderTarget(null)}),eS.createElement("meshReflectorMaterialImpl",j({attach:"material",key:"key"+z["defines-USE_BLUR"]+z["defines-USE_DEPTH"]+z["defines-USE_DISTORTION"],ref:v},z,d))});function pe(e){switch(e){case 1:return eT.RedIntegerFormat;case 2:return eT.RGIntegerFormat;case 3:case 4:return eT.RGBAIntegerFormat}}class pt extends eT.DataTexture{constructor(){super(),this.minFilter=eT.NearestFilter,this.magFilter=eT.NearestFilter,this.generateMipmaps=!1,this.overrideItemSize=null,this._forcedType=null}updateFrom(e){let t,r,i,n;let a=this.overrideItemSize,o=e.itemSize,s=e.count;if(null!==a){if(o*s%a!=0)throw Error("VertexAttributeTexture: overrideItemSize must divide evenly into buffer length.");e.itemSize=a,e.count=s*o/a}let l=e.itemSize,c=e.count,u=e.normalized,h=e.array.constructor,A=h.BYTES_PER_ELEMENT,d=this._forcedType,f=l;if(null===d)switch(h){case Float32Array:d=eT.FloatType;break;case Uint8Array:case Uint16Array:case Uint32Array:d=eT.UnsignedIntType;break;case Int8Array:case Int16Array:case Int32Array:d=eT.IntType}let m=function(e){switch(e){case 1:return"R";case 2:return"RG";case 3:case 4:return"RGBA"}throw Error()}(l);switch(d){case eT.FloatType:i=1,r=function(e){switch(e){case 1:return eT.RedFormat;case 2:return eT.RGFormat;case 3:case 4:return eT.RGBAFormat}}(l),u&&1===A?(n=h,m+="8",h===Uint8Array?t=eT.UnsignedByteType:(t=eT.ByteType,m+="_SNORM")):(n=Float32Array,m+="32F",t=eT.FloatType);break;case eT.IntType:m+=8*A+"I",i=u?Math.pow(2,8*h.BYTES_PER_ELEMENT-1):1,r=pe(l),1===A?(n=Int8Array,t=eT.ByteType):2===A?(n=Int16Array,t=eT.ShortType):(n=Int32Array,t=eT.IntType);break;case eT.UnsignedIntType:m+=8*A+"UI",i=u?Math.pow(2,8*h.BYTES_PER_ELEMENT-1):1,r=pe(l),1===A?(n=Uint8Array,t=eT.UnsignedByteType):2===A?(n=Uint16Array,t=eT.UnsignedShortType):(n=Uint32Array,t=eT.UnsignedIntType)}3===f&&(r===eT.RGBAFormat||r===eT.RGBAIntegerFormat)&&(f=4);let p=Math.ceil(Math.sqrt(c))||1,g=new n(f*p*p),y=e.normalized;e.normalized=!1;for(let t=0;t<c;t++){let r=f*t;g[r]=e.getX(t)/i,l>=2&&(g[r+1]=e.getY(t)/i),l>=3&&(g[r+2]=e.getZ(t)/i,4===f&&(g[r+3]=1)),l>=4&&(g[r+3]=e.getW(t)/i)}e.normalized=y,this.internalFormat=m,this.format=r,this.type=t,this.image.width=p,this.image.height=p,this.image.data=g,this.needsUpdate=!0,this.dispose(),e.itemSize=o,e.count=s}}class pr extends pt{constructor(){super(),this._forcedType=eT.UnsignedIntType}}class pi extends pt{constructor(){super(),this._forcedType=eT.FloatType}}class pn{constructor(){this.index=new pr,this.position=new pi,this.bvhBounds=new eT.DataTexture,this.bvhContents=new eT.DataTexture,this._cachedIndexAttr=null,this.index.overrideItemSize=3}updateFrom(e){let{geometry:t}=e;if(function(e,t,r){let i=e._roots;if(1!==i.length)throw Error("MeshBVHUniformStruct: Multi-root BVHs not supported.");let n=i[0],a=new Uint16Array(n),o=new Uint32Array(n),s=new Float32Array(n),l=n.byteLength/32,c=2*Math.ceil(Math.sqrt(l/2)),u=new Float32Array(4*c*c),h=Math.ceil(Math.sqrt(l)),A=new Uint32Array(2*h*h);for(let e=0;e<l;e++){let t=32*e/4,r=2*t;for(let r=0;r<3;r++)u[8*e+0+r]=s[t+0+r],u[8*e+4+r]=s[t+3+r];if(dz(r,a)){let i=dL(r,a),n=o[t+6],s=4294901760|i;A[2*e+0]=s,A[2*e+1]=n}else{let r=4*o[t+6]/32,i=o[t+7];A[2*e+0]=i,A[2*e+1]=r}}t.image.data=u,t.image.width=c,t.image.height=c,t.format=eT.RGBAFormat,t.type=eT.FloatType,t.internalFormat="RGBA32F",t.minFilter=eT.NearestFilter,t.magFilter=eT.NearestFilter,t.generateMipmaps=!1,t.needsUpdate=!0,t.dispose(),r.image.data=A,r.image.width=h,r.image.height=h,r.format=eT.RGIntegerFormat,r.type=eT.UnsignedIntType,r.internalFormat="RG32UI",r.minFilter=eT.NearestFilter,r.magFilter=eT.NearestFilter,r.generateMipmaps=!1,r.needsUpdate=!0,r.dispose()}(e,this.bvhBounds,this.bvhContents),this.position.updateFrom(t.attributes.position),e.indirect){let r=e._indirectBuffer;if(null===this._cachedIndexAttr||this._cachedIndexAttr.count!==r.length){if(t.index)this._cachedIndexAttr=t.index.clone();else{let e=dx(dv(t));this._cachedIndexAttr=new eT.BufferAttribute(e,1,!1)}}(function(e,t,r){let i=r.array,n=e.index?e.index.array:null;for(let e=0,r=t.length;e<r;e++){let r=3*e,a=3*t[e];for(let e=0;e<3;e++)i[r+e]=n?n[a+e]:a+e}})(t,r,this._cachedIndexAttr),this.index.updateFrom(this._cachedIndexAttr)}else this.index.updateFrom(t.index)}dispose(){let{index:e,position:t,bvhBounds:r,bvhContents:i}=this;e&&e.dispose(),t&&t.dispose(),r&&r.dispose(),i&&i.dispose()}}let pa=`
struct BVH {

	usampler2D index;
	sampler2D position;

	sampler2D bvhBounds;
	usampler2D bvhContents;

};
`,po=`

// A stack of uint32 indices can can store the indices for
// a perfectly balanced tree with a depth up to 31. Lower stack
// depth gets higher performance.
//
// However not all trees are balanced. Best value to set this to
// is the trees max depth.
#ifndef BVH_STACK_DEPTH
#define BVH_STACK_DEPTH 60
#endif

#ifndef INFINITY
#define INFINITY 1e20
#endif

// Utilities
uvec4 uTexelFetch1D( usampler2D tex, uint index ) {

	uint width = uint( textureSize( tex, 0 ).x );
	uvec2 uv;
	uv.x = index % width;
	uv.y = index / width;

	return texelFetch( tex, ivec2( uv ), 0 );

}

ivec4 iTexelFetch1D( isampler2D tex, uint index ) {

	uint width = uint( textureSize( tex, 0 ).x );
	uvec2 uv;
	uv.x = index % width;
	uv.y = index / width;

	return texelFetch( tex, ivec2( uv ), 0 );

}

vec4 texelFetch1D( sampler2D tex, uint index ) {

	uint width = uint( textureSize( tex, 0 ).x );
	uvec2 uv;
	uv.x = index % width;
	uv.y = index / width;

	return texelFetch( tex, ivec2( uv ), 0 );

}

vec4 textureSampleBarycoord( sampler2D tex, vec3 barycoord, uvec3 faceIndices ) {

	return
		barycoord.x * texelFetch1D( tex, faceIndices.x ) +
		barycoord.y * texelFetch1D( tex, faceIndices.y ) +
		barycoord.z * texelFetch1D( tex, faceIndices.z );

}

void ndcToCameraRay(
	vec2 coord, mat4 cameraWorld, mat4 invProjectionMatrix,
	out vec3 rayOrigin, out vec3 rayDirection
) {

	// get camera look direction and near plane for camera clipping
	vec4 lookDirection = cameraWorld * vec4( 0.0, 0.0, - 1.0, 0.0 );
	vec4 nearVector = invProjectionMatrix * vec4( 0.0, 0.0, - 1.0, 1.0 );
	float near = abs( nearVector.z / nearVector.w );

	// get the camera direction and position from camera matrices
	vec4 origin = cameraWorld * vec4( 0.0, 0.0, 0.0, 1.0 );
	vec4 direction = invProjectionMatrix * vec4( coord, 0.5, 1.0 );
	direction /= direction.w;
	direction = cameraWorld * direction - origin;

	// slide the origin along the ray until it sits at the near clip plane position
	origin.xyz += direction.xyz * near / dot( direction, lookDirection );

	rayOrigin = origin.xyz;
	rayDirection = direction.xyz;

}
`,ps=`

#ifndef TRI_INTERSECT_EPSILON
#define TRI_INTERSECT_EPSILON 1e-5
#endif

// Raycasting
bool intersectsBounds( vec3 rayOrigin, vec3 rayDirection, vec3 boundsMin, vec3 boundsMax, out float dist ) {

	// https://www.reddit.com/r/opengl/comments/8ntzz5/fast_glsl_ray_box_intersection/
	// https://tavianator.com/2011/ray_box.html
	vec3 invDir = 1.0 / rayDirection;

	// find intersection distances for each plane
	vec3 tMinPlane = invDir * ( boundsMin - rayOrigin );
	vec3 tMaxPlane = invDir * ( boundsMax - rayOrigin );

	// get the min and max distances from each intersection
	vec3 tMinHit = min( tMaxPlane, tMinPlane );
	vec3 tMaxHit = max( tMaxPlane, tMinPlane );

	// get the furthest hit distance
	vec2 t = max( tMinHit.xx, tMinHit.yz );
	float t0 = max( t.x, t.y );

	// get the minimum hit distance
	t = min( tMaxHit.xx, tMaxHit.yz );
	float t1 = min( t.x, t.y );

	// set distance to 0.0 if the ray starts inside the box
	dist = max( t0, 0.0 );

	return t1 >= dist;

}

bool intersectsTriangle(
	vec3 rayOrigin, vec3 rayDirection, vec3 a, vec3 b, vec3 c,
	out vec3 barycoord, out vec3 norm, out float dist, out float side
) {

	// https://stackoverflow.com/questions/42740765/intersection-between-line-and-triangle-in-3d
	vec3 edge1 = b - a;
	vec3 edge2 = c - a;
	norm = cross( edge1, edge2 );

	float det = - dot( rayDirection, norm );
	float invdet = 1.0 / det;

	vec3 AO = rayOrigin - a;
	vec3 DAO = cross( AO, rayDirection );

	vec4 uvt;
	uvt.x = dot( edge2, DAO ) * invdet;
	uvt.y = - dot( edge1, DAO ) * invdet;
	uvt.z = dot( AO, norm ) * invdet;
	uvt.w = 1.0 - uvt.x - uvt.y;

	// set the hit information
	barycoord = uvt.wxy; // arranged in A, B, C order
	dist = uvt.z;
	side = sign( det );
	norm = side * normalize( norm );

	// add an epsilon to avoid misses between triangles
	uvt += vec4( TRI_INTERSECT_EPSILON );

	return all( greaterThanEqual( uvt, vec4( 0.0 ) ) );

}

bool intersectTriangles(
	// geometry info and triangle range
	sampler2D positionAttr, usampler2D indexAttr, uint offset, uint count,

	// ray
	vec3 rayOrigin, vec3 rayDirection,

	// outputs
	inout float minDistance, inout uvec4 faceIndices, inout vec3 faceNormal, inout vec3 barycoord,
	inout float side, inout float dist
) {

	bool found = false;
	vec3 localBarycoord, localNormal;
	float localDist, localSide;
	for ( uint i = offset, l = offset + count; i < l; i ++ ) {

		uvec3 indices = uTexelFetch1D( indexAttr, i ).xyz;
		vec3 a = texelFetch1D( positionAttr, indices.x ).rgb;
		vec3 b = texelFetch1D( positionAttr, indices.y ).rgb;
		vec3 c = texelFetch1D( positionAttr, indices.z ).rgb;

		if (
			intersectsTriangle( rayOrigin, rayDirection, a, b, c, localBarycoord, localNormal, localDist, localSide )
			&& localDist < minDistance
		) {

			found = true;
			minDistance = localDist;

			faceIndices = uvec4( indices.xyz, i );
			faceNormal = localNormal;

			side = localSide;
			barycoord = localBarycoord;
			dist = localDist;

		}

	}

	return found;

}

bool intersectsBVHNodeBounds( vec3 rayOrigin, vec3 rayDirection, sampler2D bvhBounds, uint currNodeIndex, out float dist ) {

	uint cni2 = currNodeIndex * 2u;
	vec3 boundsMin = texelFetch1D( bvhBounds, cni2 ).xyz;
	vec3 boundsMax = texelFetch1D( bvhBounds, cni2 + 1u ).xyz;
	return intersectsBounds( rayOrigin, rayDirection, boundsMin, boundsMax, dist );

}

// use a macro to hide the fact that we need to expand the struct into separate fields
#define\
	bvhIntersectFirstHit(\
		bvh,\
		rayOrigin, rayDirection, faceIndices, faceNormal, barycoord, side, dist\
	)\
	_bvhIntersectFirstHit(\
		bvh.position, bvh.index, bvh.bvhBounds, bvh.bvhContents,\
		rayOrigin, rayDirection, faceIndices, faceNormal, barycoord, side, dist\
	)

bool _bvhIntersectFirstHit(
	// bvh info
	sampler2D bvh_position, usampler2D bvh_index, sampler2D bvh_bvhBounds, usampler2D bvh_bvhContents,

	// ray
	vec3 rayOrigin, vec3 rayDirection,

	// output variables split into separate variables due to output precision
	inout uvec4 faceIndices, inout vec3 faceNormal, inout vec3 barycoord,
	inout float side, inout float dist
) {

	// stack needs to be twice as long as the deepest tree we expect because
	// we push both the left and right child onto the stack every traversal
	int ptr = 0;
	uint stack[ BVH_STACK_DEPTH ];
	stack[ 0 ] = 0u;

	float triangleDistance = INFINITY;
	bool found = false;
	while ( ptr > - 1 && ptr < BVH_STACK_DEPTH ) {

		uint currNodeIndex = stack[ ptr ];
		ptr --;

		// check if we intersect the current bounds
		float boundsHitDistance;
		if (
			! intersectsBVHNodeBounds( rayOrigin, rayDirection, bvh_bvhBounds, currNodeIndex, boundsHitDistance )
			|| boundsHitDistance > triangleDistance
		) {

			continue;

		}

		uvec2 boundsInfo = uTexelFetch1D( bvh_bvhContents, currNodeIndex ).xy;
		bool isLeaf = bool( boundsInfo.x & 0xffff0000u );

		if ( isLeaf ) {

			uint count = boundsInfo.x & 0x0000ffffu;
			uint offset = boundsInfo.y;

			found = intersectTriangles(
				bvh_position, bvh_index, offset, count,
				rayOrigin, rayDirection, triangleDistance,
				faceIndices, faceNormal, barycoord, side, dist
			) || found;

		} else {

			uint leftIndex = currNodeIndex + 1u;
			uint splitAxis = boundsInfo.x & 0x0000ffffu;
			uint rightIndex = boundsInfo.y;

			bool leftToRight = rayDirection[ splitAxis ] >= 0.0;
			uint c1 = leftToRight ? leftIndex : rightIndex;
			uint c2 = leftToRight ? rightIndex : leftIndex;

			// set c2 in the stack so we traverse it later. We need to keep track of a pointer in
			// the stack while we traverse. The second pointer added is the one that will be
			// traversed first
			ptr ++;
			stack[ ptr ] = c2;

			ptr ++;
			stack[ ptr ] = c1;

		}

	}

	return found;

}
`,pl=`
	${po}
	${ps}
`,pc=sx({envMap:null,bounces:3,ior:2.4,correctMips:!0,aberrationStrength:.01,fresnel:0,bvh:new pn,color:new eT.Color("white"),opacity:1,resolution:new eT.Vector2,viewMatrixInverse:new eT.Matrix4,projectionMatrixInverse:new eT.Matrix4},`
  uniform mat4 viewMatrixInverse;

  varying vec3 vWorldPosition;
  varying vec3 vNormal;
  varying mat4 vModelMatrixInverse;

  #include <color_pars_vertex>

  void main() {
    #include <color_vertex>

    vec4 transformedNormal = vec4(normal, 0.0);
    vec4 transformedPosition = vec4(position, 1.0);
    #ifdef USE_INSTANCING
      transformedNormal = instanceMatrix * transformedNormal;
      transformedPosition = instanceMatrix * transformedPosition;
    #endif

    #ifdef USE_INSTANCING
      vModelMatrixInverse = inverse(modelMatrix * instanceMatrix);
    #else
      vModelMatrixInverse = inverse(modelMatrix);
    #endif

    vWorldPosition = (modelMatrix * transformedPosition).xyz;
    vNormal = normalize((viewMatrixInverse * vec4(normalMatrix * transformedNormal.xyz, 0.0)).xyz);
    gl_Position = projectionMatrix * viewMatrix * modelMatrix * transformedPosition;
  }`,`
  #define ENVMAP_TYPE_CUBE_UV
  precision highp isampler2D;
  precision highp usampler2D;
  varying vec3 vWorldPosition;
  varying vec3 vNormal;
  varying mat4 vModelMatrixInverse;

  #include <color_pars_fragment>

  #ifdef ENVMAP_TYPE_CUBEM
    uniform samplerCube envMap;
  #else
    uniform sampler2D envMap;
  #endif

  uniform float bounces;
  ${pa}
  ${pl}
  uniform BVH bvh;
  uniform float ior;
  uniform bool correctMips;
  uniform vec2 resolution;
  uniform float fresnel;
  uniform mat4 modelMatrix;
  uniform mat4 projectionMatrixInverse;
  uniform mat4 viewMatrixInverse;
  uniform float aberrationStrength;
  uniform vec3 color;
  uniform float opacity;

  float fresnelFunc(vec3 viewDirection, vec3 worldNormal) {
    return pow( 1.0 + dot( viewDirection, worldNormal), 10.0 );
  }

  vec3 totalInternalReflection(vec3 ro, vec3 rd, vec3 normal, float ior, mat4 modelMatrixInverse) {
    vec3 rayOrigin = ro;
    vec3 rayDirection = rd;
    rayDirection = refract(rayDirection, normal, 1.0 / ior);
    rayOrigin = vWorldPosition + rayDirection * 0.001;
    rayOrigin = (modelMatrixInverse * vec4(rayOrigin, 1.0)).xyz;
    rayDirection = normalize((modelMatrixInverse * vec4(rayDirection, 0.0)).xyz);
    for(float i = 0.0; i < bounces; i++) {
      uvec4 faceIndices = uvec4( 0u );
      vec3 faceNormal = vec3( 0.0, 0.0, 1.0 );
      vec3 barycoord = vec3( 0.0 );
      float side = 1.0;
      float dist = 0.0;
      bvhIntersectFirstHit( bvh, rayOrigin, rayDirection, faceIndices, faceNormal, barycoord, side, dist );
      vec3 hitPos = rayOrigin + rayDirection * max(dist - 0.001, 0.0);
      vec3 tempDir = refract(rayDirection, faceNormal, ior);
      if (length(tempDir) != 0.0) {
        rayDirection = tempDir;
        break;
      }
      rayDirection = reflect(rayDirection, faceNormal);
      rayOrigin = hitPos + rayDirection * 0.01;
    }
    rayDirection = normalize((modelMatrix * vec4(rayDirection, 0.0)).xyz);
    return rayDirection;
  }

  #include <common>
  #include <cube_uv_reflection_fragment>

  #ifdef ENVMAP_TYPE_CUBEM
    vec4 textureGradient(samplerCube envMap, vec3 rayDirection, vec3 directionCamPerfect) {
      return textureGrad(envMap, rayDirection, dFdx(correctMips ? directionCamPerfect: rayDirection), dFdy(correctMips ? directionCamPerfect: rayDirection));
    }
  #else
    vec4 textureGradient(sampler2D envMap, vec3 rayDirection, vec3 directionCamPerfect) {
      vec2 uvv = equirectUv( rayDirection );
      vec2 smoothUv = equirectUv( directionCamPerfect );
      return textureGrad(envMap, uvv, dFdx(correctMips ? smoothUv : uvv), dFdy(correctMips ? smoothUv : uvv));
    }
  #endif

  void main() {
    vec2 uv = gl_FragCoord.xy / resolution;
    vec3 directionCamPerfect = (projectionMatrixInverse * vec4(uv * 2.0 - 1.0, 0.0, 1.0)).xyz;
    directionCamPerfect = (viewMatrixInverse * vec4(directionCamPerfect, 0.0)).xyz;
    directionCamPerfect = normalize(directionCamPerfect);
    vec3 normal = vNormal;
    vec3 rayOrigin = cameraPosition;
    vec3 rayDirection = normalize(vWorldPosition - cameraPosition);

    vec4 diffuseColor = vec4(color, opacity);
    #include <color_fragment>

    #ifdef CHROMATIC_ABERRATIONS
      vec3 rayDirectionG = totalInternalReflection(rayOrigin, rayDirection, normal, max(ior, 1.0), vModelMatrixInverse);
      #ifdef FAST_CHROMA
        vec3 rayDirectionR = normalize(rayDirectionG + 1.0 * vec3(aberrationStrength / 2.0));
        vec3 rayDirectionB = normalize(rayDirectionG - 1.0 * vec3(aberrationStrength / 2.0));
      #else
        vec3 rayDirectionR = totalInternalReflection(rayOrigin, rayDirection, normal, max(ior * (1.0 - aberrationStrength), 1.0), vModelMatrixInverse);
        vec3 rayDirectionB = totalInternalReflection(rayOrigin, rayDirection, normal, max(ior * (1.0 + aberrationStrength), 1.0), vModelMatrixInverse);
      #endif
      float finalColorR = textureGradient(envMap, rayDirectionR, directionCamPerfect).r;
      float finalColorG = textureGradient(envMap, rayDirectionG, directionCamPerfect).g;
      float finalColorB = textureGradient(envMap, rayDirectionB, directionCamPerfect).b;
      diffuseColor.rgb *= vec3(finalColorR, finalColorG, finalColorB);
    #else
      rayDirection = totalInternalReflection(rayOrigin, rayDirection, normal, max(ior, 1.0), vModelMatrixInverse);
      diffuseColor.rgb *= textureGradient(envMap, rayDirection, directionCamPerfect).rgb;
    #endif

    vec3 viewDirection = normalize(vWorldPosition - cameraPosition);
    float nFresnel = fresnelFunc(viewDirection, normal) * fresnel;
    gl_FragColor = vec4(mix(diffuseColor.rgb, vec3(1.0), nFresnel), diffuseColor.a);

    #include <tonemapping_fragment>
    #include <${sI>=154?"colorspace_fragment":"encodings_fragment"}>
  }`),pu=e=>e&&e.isCubeTexture;function ph({aberrationStrength:e=0,fastChroma:t=!0,envMap:r,...i}){(0,eR.e)({MeshRefractionMaterial:pc});let n=(0,eS.useRef)(),{size:a}=(0,eR.D)(),o=(0,eS.useMemo)(()=>{var i,n;let a={},o=pu(r),s=Math.floor(Math.log2((null!==(i=o?null==(n=r.image[0])?void 0:n.width:r.image.width)&&void 0!==i?i:1024)/4)),l=Math.pow(2,s);return o&&(a.ENVMAP_TYPE_CUBEM=""),a.CUBEUV_TEXEL_WIDTH=`${1/(3*Math.max(l,112))}`,a.CUBEUV_TEXEL_HEIGHT=`${1/(4*l)}`,a.CUBEUV_MAX_MIP=`${s}.0`,e>0&&(a.CHROMATIC_ABERRATIONS=""),t&&(a.FAST_CHROMA=""),a},[e,t]);return(0,eS.useLayoutEffect)(()=>{var e;let t=null==(e=n.current)||null==(e=e.__r3f)||null==(e=e.parent)?void 0:e.geometry;t&&(n.current.bvh=new pn,n.current.bvh.updateFrom(new fq(t.clone().toNonIndexed(),{strategy:dp})))},[]),(0,eR.F)(({camera:e})=>{n.current.viewMatrixInverse=e.matrixWorld,n.current.projectionMatrixInverse=e.projectionMatrixInverse}),eS.createElement("meshRefractionMaterial",j({key:JSON.stringify(o),defines:o,ref:n,resolution:[a.width,a.height],aberrationStrength:e,envMap:r},i))}let pA=sx({},"void main() { }","void main() { gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0); discard;  }");class pd extends eT.MeshPhysicalMaterial{constructor(e=6,t=!1){super(),this.uniforms={chromaticAberration:{value:.05},transmission:{value:0},_transmission:{value:1},transmissionMap:{value:null},roughness:{value:0},thickness:{value:0},thicknessMap:{value:null},attenuationDistance:{value:1/0},attenuationColor:{value:new eT.Color("white")},anisotropicBlur:{value:.1},time:{value:0},distortion:{value:0},distortionScale:{value:.5},temporalDistortion:{value:0},buffer:{value:null}},this.onBeforeCompile=r=>{r.uniforms={...r.uniforms,...this.uniforms},this.anisotropy>0&&(r.defines.USE_ANISOTROPY=""),t?r.defines.USE_SAMPLER="":r.defines.USE_TRANSMISSION="",r.fragmentShader=`
      uniform float chromaticAberration;         
      uniform float anisotropicBlur;      
      uniform float time;
      uniform float distortion;
      uniform float distortionScale;
      uniform float temporalDistortion;
      uniform sampler2D buffer;

      vec3 random3(vec3 c) {
        float j = 4096.0*sin(dot(c,vec3(17.0, 59.4, 15.0)));
        vec3 r;
        r.z = fract(512.0*j);
        j *= .125;
        r.x = fract(512.0*j);
        j *= .125;
        r.y = fract(512.0*j);
        return r-0.5;
      }

      uint hash( uint x ) {
        x += ( x << 10u );
        x ^= ( x >>  6u );
        x += ( x <<  3u );
        x ^= ( x >> 11u );
        x += ( x << 15u );
        return x;
      }

      // Compound versions of the hashing algorithm I whipped together.
      uint hash( uvec2 v ) { return hash( v.x ^ hash(v.y)                         ); }
      uint hash( uvec3 v ) { return hash( v.x ^ hash(v.y) ^ hash(v.z)             ); }
      uint hash( uvec4 v ) { return hash( v.x ^ hash(v.y) ^ hash(v.z) ^ hash(v.w) ); }

      // Construct a float with half-open range [0:1] using low 23 bits.
      // All zeroes yields 0.0, all ones yields the next smallest representable value below 1.0.
      float floatConstruct( uint m ) {
        const uint ieeeMantissa = 0x007FFFFFu; // binary32 mantissa bitmask
        const uint ieeeOne      = 0x3F800000u; // 1.0 in IEEE binary32
        m &= ieeeMantissa;                     // Keep only mantissa bits (fractional part)
        m |= ieeeOne;                          // Add fractional part to 1.0
        float  f = uintBitsToFloat( m );       // Range [1:2]
        return f - 1.0;                        // Range [0:1]
      }

      // Pseudo-random value in half-open range [0:1].
      float randomBase( float x ) { return floatConstruct(hash(floatBitsToUint(x))); }
      float randomBase( vec2  v ) { return floatConstruct(hash(floatBitsToUint(v))); }
      float randomBase( vec3  v ) { return floatConstruct(hash(floatBitsToUint(v))); }
      float randomBase( vec4  v ) { return floatConstruct(hash(floatBitsToUint(v))); }
      float rand(float seed) {
        float result = randomBase(vec3(gl_FragCoord.xy, seed));
        return result;
      }

      const float F3 =  0.3333333;
      const float G3 =  0.1666667;

      float snoise(vec3 p) {
        vec3 s = floor(p + dot(p, vec3(F3)));
        vec3 x = p - s + dot(s, vec3(G3));
        vec3 e = step(vec3(0.0), x - x.yzx);
        vec3 i1 = e*(1.0 - e.zxy);
        vec3 i2 = 1.0 - e.zxy*(1.0 - e);
        vec3 x1 = x - i1 + G3;
        vec3 x2 = x - i2 + 2.0*G3;
        vec3 x3 = x - 1.0 + 3.0*G3;
        vec4 w, d;
        w.x = dot(x, x);
        w.y = dot(x1, x1);
        w.z = dot(x2, x2);
        w.w = dot(x3, x3);
        w = max(0.6 - w, 0.0);
        d.x = dot(random3(s), x);
        d.y = dot(random3(s + i1), x1);
        d.z = dot(random3(s + i2), x2);
        d.w = dot(random3(s + 1.0), x3);
        w *= w;
        w *= w;
        d *= w;
        return dot(d, vec4(52.0));
      }

      float snoiseFractal(vec3 m) {
        return 0.5333333* snoise(m)
              +0.2666667* snoise(2.0*m)
              +0.1333333* snoise(4.0*m)
              +0.0666667* snoise(8.0*m);
      }
`+r.fragmentShader,r.fragmentShader=r.fragmentShader.replace("#include <transmission_pars_fragment>",`
        #ifdef USE_TRANSMISSION
          // Transmission code is based on glTF-Sampler-Viewer
          // https://github.com/KhronosGroup/glTF-Sample-Viewer
          uniform float _transmission;
          uniform float thickness;
          uniform float attenuationDistance;
          uniform vec3 attenuationColor;
          #ifdef USE_TRANSMISSIONMAP
            uniform sampler2D transmissionMap;
          #endif
          #ifdef USE_THICKNESSMAP
            uniform sampler2D thicknessMap;
          #endif
          uniform vec2 transmissionSamplerSize;
          uniform sampler2D transmissionSamplerMap;
          uniform mat4 modelMatrix;
          uniform mat4 projectionMatrix;
          varying vec3 vWorldPosition;
          vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {
            // Direction of refracted light.
            vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
            // Compute rotation-independant scaling of the model matrix.
            vec3 modelScale;
            modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
            modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
            modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
            // The thickness is specified in local space.
            return normalize( refractionVector ) * thickness * modelScale;
          }
          float applyIorToRoughness( const in float roughness, const in float ior ) {
            // Scale roughness with IOR so that an IOR of 1.0 results in no microfacet refraction and
            // an IOR of 1.5 results in the default amount of microfacet refraction.
            return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
          }
          vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {
            float framebufferLod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );            
            #ifdef USE_SAMPLER
              #ifdef texture2DLodEXT
                return texture2DLodEXT(transmissionSamplerMap, fragCoord.xy, framebufferLod);
              #else
                return texture2D(transmissionSamplerMap, fragCoord.xy, framebufferLod);
              #endif
            #else
              return texture2D(buffer, fragCoord.xy);
            #endif
          }
          vec3 applyVolumeAttenuation( const in vec3 radiance, const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {
            if ( isinf( attenuationDistance ) ) {
              // Attenuation distance is +∞, i.e. the transmitted color is not attenuated at all.
              return radiance;
            } else {
              // Compute light attenuation using Beer's law.
              vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
              vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance ); // Beer's law
              return transmittance * radiance;
            }
          }
          vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
            const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
            const in mat4 viewMatrix, const in mat4 projMatrix, const in float ior, const in float thickness,
            const in vec3 attenuationColor, const in float attenuationDistance ) {
            vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
            vec3 refractedRayExit = position + transmissionRay;
            // Project refracted vector on the framebuffer, while mapping to normalized device coordinates.
            vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
            vec2 refractionCoords = ndcPos.xy / ndcPos.w;
            refractionCoords += 1.0;
            refractionCoords /= 2.0;
            // Sample framebuffer to get pixel the refracted ray hits.
            vec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
            vec3 attenuatedColor = applyVolumeAttenuation( transmittedLight.rgb, length( transmissionRay ), attenuationColor, attenuationDistance );
            // Get the specular component.
            vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
            return vec4( ( 1.0 - F ) * attenuatedColor * diffuseColor, transmittedLight.a );
          }
        #endif
`),r.fragmentShader=r.fragmentShader.replace("#include <transmission_fragment>",`  
        // Improve the refraction to use the world pos
        material.transmission = _transmission;
        material.transmissionAlpha = 1.0;
        material.thickness = thickness;
        material.attenuationDistance = attenuationDistance;
        material.attenuationColor = attenuationColor;
        #ifdef USE_TRANSMISSIONMAP
          material.transmission *= texture2D( transmissionMap, vUv ).r;
        #endif
        #ifdef USE_THICKNESSMAP
          material.thickness *= texture2D( thicknessMap, vUv ).g;
        #endif
        
        vec3 pos = vWorldPosition;
        float runningSeed = 0.0;
        vec3 v = normalize( cameraPosition - pos );
        vec3 n = inverseTransformDirection( normal, viewMatrix );
        vec3 transmission = vec3(0.0);
        float transmissionR, transmissionB, transmissionG;
        float randomCoords = rand(runningSeed++);
        float thickness_smear = thickness * max(pow(roughnessFactor, 0.33), anisotropicBlur);
        vec3 distortionNormal = vec3(0.0);
        vec3 temporalOffset = vec3(time, -time, -time) * temporalDistortion;
        if (distortion > 0.0) {
          distortionNormal = distortion * vec3(snoiseFractal(vec3((pos * distortionScale + temporalOffset))), snoiseFractal(vec3(pos.zxy * distortionScale - temporalOffset)), snoiseFractal(vec3(pos.yxz * distortionScale + temporalOffset)));
        }
        for (float i = 0.0; i < ${e}.0; i ++) {
          vec3 sampleNorm = normalize(n + roughnessFactor * roughnessFactor * 2.0 * normalize(vec3(rand(runningSeed++) - 0.5, rand(runningSeed++) - 0.5, rand(runningSeed++) - 0.5)) * pow(rand(runningSeed++), 0.33) + distortionNormal);
          transmissionR = getIBLVolumeRefraction(
            sampleNorm, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,
            pos, modelMatrix, viewMatrix, projectionMatrix, material.ior, material.thickness  + thickness_smear * (i + randomCoords) / float(${e}),
            material.attenuationColor, material.attenuationDistance
          ).r;
          transmissionG = getIBLVolumeRefraction(
            sampleNorm, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,
            pos, modelMatrix, viewMatrix, projectionMatrix, material.ior  * (1.0 + chromaticAberration * (i + randomCoords) / float(${e})) , material.thickness + thickness_smear * (i + randomCoords) / float(${e}),
            material.attenuationColor, material.attenuationDistance
          ).g;
          transmissionB = getIBLVolumeRefraction(
            sampleNorm, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,
            pos, modelMatrix, viewMatrix, projectionMatrix, material.ior * (1.0 + 2.0 * chromaticAberration * (i + randomCoords) / float(${e})), material.thickness + thickness_smear * (i + randomCoords) / float(${e}),
            material.attenuationColor, material.attenuationDistance
          ).b;
          transmission.r += transmissionR;
          transmission.g += transmissionG;
          transmission.b += transmissionB;
        }
        transmission /= ${e}.0;
        totalDiffuse = mix( totalDiffuse, transmission.rgb, material.transmission );
`)},Object.keys(this.uniforms).forEach(e=>Object.defineProperty(this,e,{get:()=>this.uniforms[e].value,set:t=>this.uniforms[e].value=t}))}}let pf=eS.forwardRef(({buffer:e,transmissionSampler:t=!1,backside:r=!1,side:i=eT.FrontSide,transmission:n=1,thickness:a=0,backsideThickness:o=0,backsideEnvMapIntensity:s=1,samples:l=10,resolution:c,backsideResolution:u,background:h,anisotropy:A,anisotropicBlur:d,...f},m)=>{let p,g,y,v;(0,eR.e)({MeshTransmissionMaterial:pd});let E=eS.useRef(null),[x]=eS.useState(()=>new pA),C=cu(u||c),B=cu(c);return(0,eR.F)(e=>{E.current.time=e.clock.elapsedTime,E.current.buffer===B.texture&&!t&&(v=E.current.__r3f.parent)&&(y=e.gl.toneMapping,p=e.scene.background,g=E.current.envMapIntensity,e.gl.toneMapping=eT.NoToneMapping,h&&(e.scene.background=h),v.material=x,r&&(e.gl.setRenderTarget(C),e.gl.render(e.scene,e.camera),v.material=E.current,v.material.buffer=C.texture,v.material.thickness=o,v.material.side=eT.BackSide,v.material.envMapIntensity=s),e.gl.setRenderTarget(B),e.gl.render(e.scene,e.camera),v.material=E.current,v.material.thickness=a,v.material.side=i,v.material.buffer=B.texture,v.material.envMapIntensity=g,e.scene.background=p,e.gl.setRenderTarget(null),e.gl.toneMapping=y)}),eS.useImperativeHandle(m,()=>E.current,[]),eS.createElement("meshTransmissionMaterial",j({args:[l,t],ref:E},f,{buffer:e||B.texture,_transmission:n,anisotropicBlur:null!=d?d:A,transmission:t?n:0,thickness:a,side:i}))}),pm=eS.forwardRef((e,t)=>((0,eR.e)({DiscardMaterialImpl:pA}),eS.createElement("discardMaterialImpl",j({ref:t},e))));function pp(e){let t=eS.useRef(null);return eS.useLayoutEffect(()=>{var e;let r=null==(e=t.current)?void 0:e.parent,i=null==r?void 0:r.geometry;if(i){let e=r.material;r.material=t.current.__r3f.objects;let n=[...i.groups];return i.clearGroups(),r.material.forEach((e,t)=>{t<r.material.length-1&&(e.depthWrite=!1),i.addGroup(0,1/0,t)}),()=>{r.material=e,i.groups=n}}}),eS.createElement("group",j({ref:t},e))}let pg=sI>=154?"opaque_fragment":"output_fragment";class py extends eT.PointsMaterial{constructor(e){super(e),this.onBeforeCompile=(e,t)=>{let{isWebGL2:r}=t.capabilities;e.fragmentShader=e.fragmentShader.replace(`#include <${pg}>`,`
        ${r?`#include <${pg}>`:`#extension GL_OES_standard_derivatives : enable
#include <${pg}>`}
      vec2 cxy = 2.0 * gl_PointCoord - 1.0;
      float r = dot(cxy, cxy);
      float delta = fwidth(r);     
      float mask = 1.0 - smoothstep(1.0 - delta, 1.0 + delta, r);
      gl_FragColor = vec4(gl_FragColor.rgb, mask * gl_FragColor.a );
      #include <tonemapping_fragment>
      #include <${sI>=154?"colorspace_fragment":"encodings_fragment"}>
      `)}}}let pv=eS.forwardRef((e,t)=>{let[r]=eS.useState(()=>new py(null));return eS.createElement("primitive",j({},e,{object:r,ref:t,attach:"material"}))}),pE=({focus:e=0,size:t=25,samples:r=10}={})=>`
#define PENUMBRA_FILTER_SIZE float(${t})
#define RGB_NOISE_FUNCTION(uv) (randRGB(uv))
vec3 randRGB(vec2 uv) {
  return vec3(
    fract(sin(dot(uv, vec2(12.75613, 38.12123))) * 13234.76575),
    fract(sin(dot(uv, vec2(19.45531, 58.46547))) * 43678.23431),
    fract(sin(dot(uv, vec2(23.67817, 78.23121))) * 93567.23423)
  );
}

vec3 lowPassRandRGB(vec2 uv) {
  // 3x3 convolution (average)
  // can be implemented as separable with an extra buffer for a total of 6 samples instead of 9
  vec3 result = vec3(0);
  result += RGB_NOISE_FUNCTION(uv + vec2(-1.0, -1.0));
  result += RGB_NOISE_FUNCTION(uv + vec2(-1.0,  0.0));
  result += RGB_NOISE_FUNCTION(uv + vec2(-1.0, +1.0));
  result += RGB_NOISE_FUNCTION(uv + vec2( 0.0, -1.0));
  result += RGB_NOISE_FUNCTION(uv + vec2( 0.0,  0.0));
  result += RGB_NOISE_FUNCTION(uv + vec2( 0.0, +1.0));
  result += RGB_NOISE_FUNCTION(uv + vec2(+1.0, -1.0));
  result += RGB_NOISE_FUNCTION(uv + vec2(+1.0,  0.0));
  result += RGB_NOISE_FUNCTION(uv + vec2(+1.0, +1.0));
  result *= 0.111111111; // 1.0 / 9.0
  return result;
}
vec3 highPassRandRGB(vec2 uv) {
  // by subtracting the low-pass signal from the original signal, we're being left with the high-pass signal
  // hp(x) = x - lp(x)
  return RGB_NOISE_FUNCTION(uv) - lowPassRandRGB(uv) + 0.5;
}


vec2 vogelDiskSample(int sampleIndex, int sampleCount, float angle) {
  const float goldenAngle = 2.399963f; // radians
  float r = sqrt(float(sampleIndex) + 0.5f) / sqrt(float(sampleCount));
  float theta = float(sampleIndex) * goldenAngle + angle;
  float sine = sin(theta);
  float cosine = cos(theta);
  return vec2(cosine, sine) * r;
}
float penumbraSize( const in float zReceiver, const in float zBlocker ) { // Parallel plane estimation
  return (zReceiver - zBlocker) / zBlocker;
}
float findBlocker(sampler2D shadowMap, vec2 uv, float compare, float angle) {
  float texelSize = 1.0 / float(textureSize(shadowMap, 0).x);
  float blockerDepthSum = float(${e});
  float blockers = 0.0;

  int j = 0;
  vec2 offset = vec2(0.);
  float depth = 0.;

  #pragma unroll_loop_start
  for(int i = 0; i < ${r}; i ++) {
    offset = (vogelDiskSample(j, ${r}, angle) * texelSize) * 2.0 * PENUMBRA_FILTER_SIZE;
    depth = unpackRGBAToDepth( texture2D( shadowMap, uv + offset));
    if (depth < compare) {
      blockerDepthSum += depth;
      blockers++;
    }
    j++;
  }
  #pragma unroll_loop_end

  if (blockers > 0.0) {
    return blockerDepthSum / blockers;
  }
  return -1.0;
}

        
float vogelFilter(sampler2D shadowMap, vec2 uv, float zReceiver, float filterRadius, float angle) {
  float texelSize = 1.0 / float(textureSize(shadowMap, 0).x);
  float shadow = 0.0f;
  int j = 0;
  vec2 vogelSample = vec2(0.0);
  vec2 offset = vec2(0.0);
  #pragma unroll_loop_start
  for (int i = 0; i < ${r}; i++) {
    vogelSample = vogelDiskSample(j, ${r}, angle) * texelSize;
    offset = vogelSample * (1.0 + filterRadius * float(${t}));
    shadow += step( zReceiver, unpackRGBAToDepth( texture2D( shadowMap, uv + offset ) ) );
    j++;
  }
  #pragma unroll_loop_end
  return shadow * 1.0 / ${r}.0;
}

float PCSS (sampler2D shadowMap, vec4 coords) {
  vec2 uv = coords.xy;
  float zReceiver = coords.z; // Assumed to be eye-space z in this code
  float angle = highPassRandRGB(gl_FragCoord.xy).r * PI2;
  float avgBlockerDepth = findBlocker(shadowMap, uv, zReceiver, angle);
  if (avgBlockerDepth == -1.0) {
    return 1.0;
  }
  float penumbraRatio = penumbraSize(zReceiver, avgBlockerDepth);
  return vogelFilter(shadowMap, uv, zReceiver, 1.25 * penumbraRatio, angle);
}`;function px(e,t,r){t.traverse(t=>{t.material&&(e.properties.remove(t.material),null==t.material.dispose||t.material.dispose())}),e.info.programs.length=0,e.compile(t,r)}function pC({focus:e=0,samples:t=10,size:r=25}){let i=(0,eR.D)(e=>e.gl),n=(0,eR.D)(e=>e.scene),a=(0,eR.D)(e=>e.camera);return eS.useEffect(()=>{let o=eT.ShaderChunk.shadowmap_pars_fragment;return eT.ShaderChunk.shadowmap_pars_fragment=eT.ShaderChunk.shadowmap_pars_fragment.replace("#ifdef USE_SHADOWMAP","#ifdef USE_SHADOWMAP\n"+pE({size:r,samples:t,focus:e})).replace("#if defined( SHADOWMAP_TYPE_PCF )","\nreturn PCSS(shadowMap, shadowCoord);\n#if defined( SHADOWMAP_TYPE_PCF )"),px(i,n,a),()=>{eT.ShaderChunk.shadowmap_pars_fragment=o,px(i,n,a)}},[e,r,t]),null}function pB(e,t){let r=e+"Geometry";return eS.forwardRef(({args:e,children:i,...n},a)=>{let o=eS.useRef(null);return eS.useImperativeHandle(a,()=>o.current),eS.useLayoutEffect(()=>void(null==t||t(o.current))),eS.createElement("mesh",j({ref:o},n),eS.createElement(r,{attach:"geometry",args:e}),i)})}let pw=pB("box"),pI=pB("circle"),pb=pB("cone"),p_=pB("cylinder"),pM=pB("sphere"),pS=pB("plane"),pD=pB("tube"),pT=pB("torus"),pR=pB("torusKnot"),pF=pB("tetrahedron"),pP=pB("ring"),pQ=pB("polyhedron"),pz=pB("icosahedron"),pL=pB("octahedron"),pO=pB("dodecahedron"),pU=pB("extrude"),pk=pB("lathe"),pG=pB("capsule"),pN=pB("shape",({geometry:e})=>{let t=e.attributes.position,r=new eT.Box3().setFromBufferAttribute(t),i=new eT.Vector3;r.getSize(i);let n=[],a=0,o=0,s=0,l=0;for(let e=0;e<t.count;e++)a=t.getX(e),o=t.getY(e),s=(a-r.min.x)/i.x,l=(o-r.min.y)/i.y,n.push(s,l);e.setAttribute("uv",new eT.Float32BufferAttribute(n,2))}),pH=eS.forwardRef(function({args:[e=1,t=1,r=1]=[],radius:i=.05,steps:n=1,smoothness:a=4,bevelSegments:o=4,creaseAngle:s=.4,children:l,...c},u){let h=eS.useMemo(()=>(function(e,t,r){let i=new eT.Shape,n=r-1e-5;return i.absarc(1e-5,1e-5,1e-5,-Math.PI/2,-Math.PI,!0),i.absarc(1e-5,t-2*n,1e-5,Math.PI,Math.PI/2,!0),i.absarc(e-2*n,t-2*n,1e-5,Math.PI/2,0,!0),i.absarc(e-2*n,1e-5,1e-5,0,-Math.PI/2,!0),i})(e,t,i),[e,t,i]),A=eS.useMemo(()=>({depth:r-2*i,bevelEnabled:!0,bevelSegments:2*o,steps:n,bevelSize:i-1e-5,bevelThickness:i,curveSegments:a}),[r,i,a]),d=eS.useRef(null);return eS.useLayoutEffect(()=>{d.current&&(d.current.center(),oV(d.current,s))},[h,A]),eS.createElement("mesh",j({ref:u},c),eS.createElement("extrudeGeometry",{ref:d,args:[h,A]}),l)});function pV(){let e=new eT.BufferGeometry,t=new Float32Array([-1,-1,3,-1,-1,3]);return e.boundingSphere=new eT.Sphere,e.boundingSphere.set(new eT.Vector3,1/0),e.setAttribute("position",new eT.BufferAttribute(t,2)),e}let pj=eS.forwardRef(function({children:e,...t},r){let i=eS.useMemo(pV,[]);return eS.createElement("mesh",j({ref:r,geometry:i,frustumCulled:!1},t),e)}),pJ=eS.forwardRef(({children:e,width:t,height:r,depth:i,box3:n,precise:a=!0,...o},s)=>{let l=eS.useRef(null),c=eS.useRef(null),u=eS.useRef(null);return eS.useLayoutEffect(()=>{c.current.matrixWorld.identity();let e=n||new eT.Box3().setFromObject(u.current,a),o=e.max.x-e.min.x,s=e.max.y-e.min.y,l=e.max.z-e.min.z,h=Math.max(o,s,l);t&&(h=o),r&&(h=s),i&&(h=l),c.current.scale.setScalar(1/h)},[t,r,i,n,a]),eS.useImperativeHandle(s,()=>l.current,[]),eS.createElement("group",j({ref:l},o),eS.createElement("group",{ref:c},eS.createElement("group",{ref:u},e)))});var pY=((X=pY||{})[X.NONE=0]="NONE",X[X.START=1]="START",X[X.ACTIVE=2]="ACTIVE",X);let pW=e=>e&&e.isOrthographicCamera,pK=e=>e&&e.isBox3,pq=e=>1-Math.exp(-5*e)+.007*e,pX=eS.createContext(null);function pZ({children:e,maxDuration:t=1,margin:r=1.2,observe:i,fit:n,clip:a,interpolateFunc:o=pq,onFit:s}){let l=eS.useRef(null),{camera:c,size:u,invalidate:h}=(0,eR.D)(),A=(0,eR.D)(e=>e.controls),d=eS.useRef(s);d.current=s;let f=eS.useRef({camPos:new eT.Vector3,camRot:new eT.Quaternion,camZoom:1}),m=eS.useRef({camPos:void 0,camRot:void 0,camZoom:void 0,camUp:void 0,target:void 0}),p=eS.useRef(pY.NONE),g=eS.useRef(0),[y]=eS.useState(()=>new eT.Box3),v=eS.useMemo(()=>{function e(){let e=y.getSize(new eT.Vector3),t=y.getCenter(new eT.Vector3),i=Math.max(e.x,e.y,e.z),n=pW(c)?4*i:i/(2*Math.atan(Math.PI*c.fov/360)),a=pW(c)?4*i:n/c.aspect;return{box:y,size:e,center:t,distance:r*Math.max(n,a)}}return{getSize:e,refresh(e){if(pK(e))y.copy(e);else{let t=e||l.current;if(!t)return this;t.updateWorldMatrix(!0,!0),y.setFromObject(t)}if(y.isEmpty()){let e=c.position.length()||10;y.setFromCenterAndSize(new eT.Vector3,new eT.Vector3(e,e,e))}return f.current.camPos.copy(c.position),f.current.camRot.copy(c.quaternion),pW(c)&&(f.current.camZoom=c.zoom),m.current.camPos=void 0,m.current.camRot=void 0,m.current.camZoom=void 0,m.current.camUp=void 0,m.current.target=void 0,this},reset(){let{center:t,distance:r}=e(),i=c.position.clone().sub(t).normalize();m.current.camPos=t.clone().addScaledVector(i,r),m.current.target=t.clone();let n=new eT.Matrix4().lookAt(m.current.camPos,m.current.target,c.up);return m.current.camRot=new eT.Quaternion().setFromRotationMatrix(n),p.current=pY.START,g.current=0,this},moveTo(e){return m.current.camPos=Array.isArray(e)?new eT.Vector3(...e):e.clone(),p.current=pY.START,g.current=0,this},lookAt({target:e,up:t}){m.current.target=Array.isArray(e)?new eT.Vector3(...e):e.clone(),t?m.current.camUp=Array.isArray(t)?new eT.Vector3(...t):t.clone():m.current.camUp=c.up.clone();let r=new eT.Matrix4().lookAt(m.current.camPos||c.position,m.current.target,m.current.camUp);return m.current.camRot=new eT.Quaternion().setFromRotationMatrix(r),p.current=pY.START,g.current=0,this},to({position:e,target:t}){return this.moveTo(e).lookAt({target:t})},fit(){if(!pW(c))return this.reset();let e=0,t=0,i=[new eT.Vector3(y.min.x,y.min.y,y.min.z),new eT.Vector3(y.min.x,y.max.y,y.min.z),new eT.Vector3(y.min.x,y.min.y,y.max.z),new eT.Vector3(y.min.x,y.max.y,y.max.z),new eT.Vector3(y.max.x,y.max.y,y.max.z),new eT.Vector3(y.max.x,y.max.y,y.min.z),new eT.Vector3(y.max.x,y.min.y,y.max.z),new eT.Vector3(y.max.x,y.min.y,y.min.z)],n=m.current.camPos||c.position,a=m.current.target||(null==A?void 0:A.target),o=m.current.camUp||c.up,s=a?new eT.Matrix4().lookAt(n,a,o).setPosition(n).invert():c.matrixWorldInverse;for(let r of i)r.applyMatrix4(s),e=Math.max(e,Math.abs(r.y)),t=Math.max(t,Math.abs(r.x));e*=2,t*=2;let l=(c.top-c.bottom)/e,u=(c.right-c.left)/t;return m.current.camZoom=Math.min(l,u)/r,p.current=pY.START,g.current=0,d.current&&d.current(this.getSize()),this},clip(){let{distance:t}=e();return c.near=t/100,c.far=100*t,c.updateProjectionMatrix(),A&&(A.maxDistance=10*t,A.update()),h(),this}}},[y,c,A,r,h]);eS.useLayoutEffect(()=>{if(A){let e=()=>{if(A&&m.current.target&&p.current!==pY.NONE){let e=new eT.Vector3().setFromMatrixColumn(c.matrix,2),t=f.current.camPos.distanceTo(A.target),r=(m.current.camPos||f.current.camPos).distanceTo(m.current.target),i=(1-g.current)*t+g.current*r;A.target.copy(c.position).addScaledVector(e,-i),A.update()}p.current=pY.NONE};return A.addEventListener("start",e),()=>A.removeEventListener("start",e)}},[A]);let E=eS.useRef(0);return eS.useLayoutEffect(()=>{(i||0==E.current++)&&(v.refresh(),n&&v.reset().fit(),a&&v.clip())},[u,a,n,i,c,A]),(0,eR.F)((e,r)=>{if(p.current===pY.START)p.current=pY.ACTIVE,h();else if(p.current===pY.ACTIVE){if(g.current+=r/t,g.current>=1)m.current.camPos&&c.position.copy(m.current.camPos),m.current.camRot&&c.quaternion.copy(m.current.camRot),m.current.camUp&&c.up.copy(m.current.camUp),m.current.camZoom&&pW(c)&&(c.zoom=m.current.camZoom),c.updateMatrixWorld(),c.updateProjectionMatrix(),A&&m.current.target&&(A.target.copy(m.current.target),A.update()),p.current=pY.NONE;else{let e=o(g.current);m.current.camPos&&c.position.lerpVectors(f.current.camPos,m.current.camPos,e),m.current.camRot&&c.quaternion.slerpQuaternions(f.current.camRot,m.current.camRot,e),m.current.camUp&&c.up.set(0,1,0).applyQuaternion(c.quaternion),m.current.camZoom&&pW(c)&&(c.zoom=(1-e)*f.current.camZoom+e*m.current.camZoom),c.updateMatrixWorld(),c.updateProjectionMatrix()}h()}}),eS.createElement("group",{ref:l},eS.createElement(pX.Provider,{value:v},e))}function p$(){return eS.useContext(pX)}var p1=Object.defineProperty,p0=(e,t,r)=>t in e?p1(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,p2=(e,t,r)=>(p0(e,"symbol"!=typeof t?t+"":t,r),r);class p3{constructor(e=Math){p2(this,"grad3",[[1,1,0],[-1,1,0],[1,-1,0],[-1,-1,0],[1,0,1],[-1,0,1],[1,0,-1],[-1,0,-1],[0,1,1],[0,-1,1],[0,1,-1],[0,-1,-1]]),p2(this,"grad4",[[0,1,1,1],[0,1,1,-1],[0,1,-1,1],[0,1,-1,-1],[0,-1,1,1],[0,-1,1,-1],[0,-1,-1,1],[0,-1,-1,-1],[1,0,1,1],[1,0,1,-1],[1,0,-1,1],[1,0,-1,-1],[-1,0,1,1],[-1,0,1,-1],[-1,0,-1,1],[-1,0,-1,-1],[1,1,0,1],[1,1,0,-1],[1,-1,0,1],[1,-1,0,-1],[-1,1,0,1],[-1,1,0,-1],[-1,-1,0,1],[-1,-1,0,-1],[1,1,1,0],[1,1,-1,0],[1,-1,1,0],[1,-1,-1,0],[-1,1,1,0],[-1,1,-1,0],[-1,-1,1,0],[-1,-1,-1,0]]),p2(this,"p",[]),p2(this,"perm",[]),p2(this,"simplex",[[0,1,2,3],[0,1,3,2],[0,0,0,0],[0,2,3,1],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,2,3,0],[0,2,1,3],[0,0,0,0],[0,3,1,2],[0,3,2,1],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,3,2,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,2,0,3],[0,0,0,0],[1,3,0,2],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,3,0,1],[2,3,1,0],[1,0,2,3],[1,0,3,2],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,0,3,1],[0,0,0,0],[2,1,3,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,0,1,3],[0,0,0,0],[0,0,0,0],[0,0,0,0],[3,0,1,2],[3,0,2,1],[0,0,0,0],[3,1,2,0],[2,1,0,3],[0,0,0,0],[0,0,0,0],[0,0,0,0],[3,1,0,2],[0,0,0,0],[3,2,0,1],[3,2,1,0]]),p2(this,"dot",(e,t,r)=>e[0]*t+e[1]*r),p2(this,"dot3",(e,t,r,i)=>e[0]*t+e[1]*r+e[2]*i),p2(this,"dot4",(e,t,r,i,n)=>e[0]*t+e[1]*r+e[2]*i+e[3]*n),p2(this,"noise",(e,t)=>{let r,i,n;let a=.5*(Math.sqrt(3)-1)*(e+t),o=Math.floor(e+a),s=Math.floor(t+a),l=(3-Math.sqrt(3))/6,c=(o+s)*l,u=e-(o-c),h=t-(s-c),A=0,d=1;u>h&&(A=1,d=0);let f=u-A+l,m=h-d+l,p=u-1+2*l,g=h-1+2*l,y=255&o,v=255&s,E=this.perm[y+this.perm[v]]%12,x=this.perm[y+A+this.perm[v+d]]%12,C=this.perm[y+1+this.perm[v+1]]%12,B=.5-u*u-h*h;B<0?r=0:(B*=B,r=B*B*this.dot(this.grad3[E],u,h));let w=.5-f*f-m*m;w<0?i=0:(w*=w,i=w*w*this.dot(this.grad3[x],f,m));let I=.5-p*p-g*g;return I<0?n=0:(I*=I,n=I*I*this.dot(this.grad3[C],p,g)),70*(r+i+n)}),p2(this,"noise3d",(e,t,r)=>{let i,n,a,o,s,l,c,u,h,A;let d=1/3*(e+t+r),f=Math.floor(e+d),m=Math.floor(t+d),p=Math.floor(r+d),g=1/6*(f+m+p),y=e-(f-g),v=t-(m-g),E=r-(p-g);y>=v?v>=E?(s=1,l=0,c=0,u=1,h=1,A=0):(y>=E?(s=1,l=0,c=0):(s=0,l=0,c=1),u=1,h=0,A=1):v<E?(s=0,l=0,c=1,u=0,h=1,A=1):y<E?(s=0,l=1,c=0,u=0,h=1,A=1):(s=0,l=1,c=0,u=1,h=1,A=0);let x=y-s+1/6,C=v-l+1/6,B=E-c+1/6,w=y-u+1/6*2,I=v-h+1/6*2,b=E-A+1/6*2,_=y-1+1/6*3,M=v-1+1/6*3,S=E-1+1/6*3,D=255&f,T=255&m,R=255&p,F=this.perm[D+this.perm[T+this.perm[R]]]%12,P=this.perm[D+s+this.perm[T+l+this.perm[R+c]]]%12,Q=this.perm[D+u+this.perm[T+h+this.perm[R+A]]]%12,z=this.perm[D+1+this.perm[T+1+this.perm[R+1]]]%12,L=.6-y*y-v*v-E*E;L<0?i=0:(L*=L,i=L*L*this.dot3(this.grad3[F],y,v,E));let O=.6-x*x-C*C-B*B;O<0?n=0:(O*=O,n=O*O*this.dot3(this.grad3[P],x,C,B));let U=.6-w*w-I*I-b*b;U<0?a=0:(U*=U,a=U*U*this.dot3(this.grad3[Q],w,I,b));let k=.6-_*_-M*M-S*S;return k<0?o=0:(k*=k,o=k*k*this.dot3(this.grad3[z],_,M,S)),32*(i+n+a+o)}),p2(this,"noise4d",(e,t,r,i)=>{let n,a,o,s,l,c,u,h,A,d,f,m,p,g,y,v,E;let x=this.grad4,C=this.simplex,B=this.perm,w=(5-Math.sqrt(5))/20,I=(Math.sqrt(5)-1)/4*(e+t+r+i),b=Math.floor(e+I),_=Math.floor(t+I),M=Math.floor(r+I),S=Math.floor(i+I),D=(b+_+M+S)*w,T=e-(b-D),R=t-(_-D),F=r-(M-D),P=i-(S-D),Q=(T>R?32:0)+(T>F?16:0)+(R>F?8:0)+(T>P?4:0)+(R>P?2:0)+(F>P?1:0);c=C[Q][0]>=3?1:0,u=C[Q][1]>=3?1:0,h=C[Q][2]>=3?1:0,A=C[Q][3]>=3?1:0,d=C[Q][0]>=2?1:0,f=C[Q][1]>=2?1:0,m=C[Q][2]>=2?1:0,p=C[Q][3]>=2?1:0,g=C[Q][0]>=1?1:0,y=C[Q][1]>=1?1:0,v=C[Q][2]>=1?1:0,E=C[Q][3]>=1?1:0;let z=T-c+w,L=R-u+w,O=F-h+w,U=P-A+w,k=T-d+2*w,G=R-f+2*w,N=F-m+2*w,H=P-p+2*w,V=T-g+3*w,j=R-y+3*w,J=F-v+3*w,Y=P-E+3*w,W=T-1+4*w,K=R-1+4*w,q=F-1+4*w,X=P-1+4*w,Z=255&b,$=255&_,ee=255&M,et=255&S,er=B[Z+B[$+B[ee+B[et]]]]%32,ei=B[Z+c+B[$+u+B[ee+h+B[et+A]]]]%32,en=B[Z+d+B[$+f+B[ee+m+B[et+p]]]]%32,ea=B[Z+g+B[$+y+B[ee+v+B[et+E]]]]%32,eo=B[Z+1+B[$+1+B[ee+1+B[et+1]]]]%32,es=.6-T*T-R*R-F*F-P*P;es<0?n=0:(es*=es,n=es*es*this.dot4(x[er],T,R,F,P));let el=.6-z*z-L*L-O*O-U*U;el<0?a=0:(el*=el,a=el*el*this.dot4(x[ei],z,L,O,U));let ec=.6-k*k-G*G-N*N-H*H;ec<0?o=0:(ec*=ec,o=ec*ec*this.dot4(x[en],k,G,N,H));let eu=.6-V*V-j*j-J*J-Y*Y;eu<0?s=0:(eu*=eu,s=eu*eu*this.dot4(x[ea],V,j,J,Y));let eh=.6-W*W-K*K-q*q-X*X;return eh<0?l=0:(eh*=eh,l=eh*eh*this.dot4(x[eo],W,K,q,X)),27*(n+a+o+s+l)});for(let t=0;t<256;t++)this.p[t]=Math.floor(256*e.random());for(let e=0;e<512;e++)this.perm[e]=this.p[255&e]}}let p4=eS.forwardRef(({intensity:e=1,decay:t,decayRate:r=.65,maxYaw:i=.1,maxPitch:n=.1,maxRoll:a=.1,yawFrequency:o=.1,pitchFrequency:s=.1,rollFrequency:l=.1},c)=>{let u=(0,eR.D)(e=>e.camera),h=(0,eR.D)(e=>e.controls),A=eS.useRef(e),d=eS.useRef(u.rotation.clone()),[f]=eS.useState(()=>new p3),[m]=eS.useState(()=>new p3),[p]=eS.useState(()=>new p3),g=()=>{(A.current<0||A.current>1)&&(A.current=A.current<0?0:1)};return eS.useImperativeHandle(c,()=>({getIntensity:()=>A.current,setIntensity:e=>{A.current=e,g()}}),[]),eS.useEffect(()=>{if(h){let e=()=>void(d.current=u.rotation.clone());return h.addEventListener("change",e),e(),()=>void h.removeEventListener("change",e)}},[u,h]),(0,eR.F)((e,c)=>{let h=Math.pow(A.current,2),y=i*h*f.noise(e.clock.elapsedTime*o,1),v=n*h*m.noise(e.clock.elapsedTime*s,1),E=a*h*p.noise(e.clock.elapsedTime*l,1);u.rotation.set(d.current.x+v,d.current.y+y,d.current.z+E),t&&A.current>0&&(A.current-=r*c,g())}),null}),p5=eS.forwardRef(({children:e,enabled:t=!0,speed:r=1,rotationIntensity:i=1,floatIntensity:n=1,floatingRange:a=[-.1,.1],autoInvalidate:o=!1,...s},l)=>{let c=eS.useRef(null);eS.useImperativeHandle(l,()=>c.current,[]);let u=eS.useRef(1e4*Math.random());return(0,eR.F)(e=>{var s,l;if(!t||0===r)return;o&&e.invalidate();let h=u.current+e.clock.elapsedTime;c.current.rotation.x=Math.cos(h/4*r)/8*i,c.current.rotation.y=Math.sin(h/4*r)/8*i,c.current.rotation.z=Math.sin(h/4*r)/20*i;let A=Math.sin(h/4*r)/10;A=eT.MathUtils.mapLinear(A,-.1,.1,null!==(s=null==a?void 0:a[0])&&void 0!==s?s:-.1,null!==(l=null==a?void 0:a[1])&&void 0!==l?l:.1),c.current.position.y=A*n,c.current.updateMatrix()}),eS.createElement("group",s,eS.createElement("group",{ref:c,matrixAutoUpdate:!1},e))}),p6=e=>e&&e.isCubeTexture;class p8 extends eT.Mesh{constructor(e,t){var r,i;let n=p6(e),a=Math.floor(Math.log2((null!=(i=n?null==(r=e.image[0])?void 0:r.width:e.image.width)?i:1024)/4)),o=Math.pow(2,a),s=`
        varying vec3 vWorldPosition;
        void main() 
        {
            vec4 worldPosition = ( modelMatrix * vec4( position, 1.0 ) );
            vWorldPosition = worldPosition.xyz;
            
            gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
        }
        `,l=[n?"#define ENVMAP_TYPE_CUBE":"",`#define CUBEUV_TEXEL_WIDTH ${1/(3*Math.max(o,112))}`,`#define CUBEUV_TEXEL_HEIGHT ${1/(4*o)}`,`#define CUBEUV_MAX_MIP ${a}.0`].join("\n")+`
        #define ENVMAP_TYPE_CUBE_UV
        varying vec3 vWorldPosition;
        uniform float radius;
        uniform float height;
        uniform float angle;
        #ifdef ENVMAP_TYPE_CUBE
            uniform samplerCube map;
        #else
            uniform sampler2D map;
        #endif
        // From: https://www.shadertoy.com/view/4tsBD7
        float diskIntersectWithBackFaceCulling( vec3 ro, vec3 rd, vec3 c, vec3 n, float r ) 
        {
            float d = dot ( rd, n );
            
            if( d > 0.0 ) { return 1e6; }
            
            vec3  o = ro - c;
            float t = - dot( n, o ) / d;
            vec3  q = o + rd * t;
            
            return ( dot( q, q ) < r * r ) ? t : 1e6;
        }
        // From: https://www.iquilezles.org/www/articles/intersectors/intersectors.htm
        float sphereIntersect( vec3 ro, vec3 rd, vec3 ce, float ra ) 
        {
            vec3 oc = ro - ce;
            float b = dot( oc, rd );
            float c = dot( oc, oc ) - ra * ra;
            float h = b * b - c;
            
            if( h < 0.0 ) { return -1.0; }
            
            h = sqrt( h );
            
            return - b + h;
        }
        vec3 project() 
        {
            vec3 p = normalize( vWorldPosition );
            vec3 camPos = cameraPosition;
            camPos.y -= height;
            float intersection = sphereIntersect( camPos, p, vec3( 0.0 ), radius );
            if( intersection > 0.0 ) {
                
                vec3 h = vec3( 0.0, - height, 0.0 );
                float intersection2 = diskIntersectWithBackFaceCulling( camPos, p, h, vec3( 0.0, 1.0, 0.0 ), radius );
                p = ( camPos + min( intersection, intersection2 ) * p ) / radius;
            } else {
                p = vec3( 0.0, 1.0, 0.0 );
            }
            return p;
        }
        #include <common>
        #include <cube_uv_reflection_fragment>
        void main() 
        {
            vec3 projectedWorldPosition = project();
            
            #ifdef ENVMAP_TYPE_CUBE
                vec3 outcolor = textureCube( map, projectedWorldPosition ).rgb;
            #else
                vec3 direction = normalize( projectedWorldPosition );
                vec2 uv = equirectUv( direction );
                vec3 outcolor = texture2D( map, uv ).rgb;
            #endif
            gl_FragColor = vec4( outcolor, 1.0 );
            #include <tonemapping_fragment>
            #include <${od>=154?"colorspace_fragment":"encodings_fragment"}>
        }
        `;super(new eT.IcosahedronGeometry(1,16),new eT.ShaderMaterial({uniforms:{map:{value:e},height:{value:(null==t?void 0:t.height)||15},radius:{value:(null==t?void 0:t.radius)||100}},fragmentShader:l,vertexShader:s,side:eT.DoubleSide}))}set radius(e){this.material.uniforms.radius.value=e}get radius(){return this.material.uniforms.radius.value}set height(e){this.material.uniforms.height.value=e}get height(){return this.material.uniforms.height.value}}class p9 extends eT.DataTextureLoader{constructor(e){super(e),this.type=eT.HalfFloatType}parse(e){let t,r,i;let n=function(e,t){switch(e){case 1:throw Error("THREE.RGBELoader: Read Error: "+(t||""));case 2:throw Error("THREE.RGBELoader: Write Error: "+(t||""));case 3:throw Error("THREE.RGBELoader: Bad File Format: "+(t||""));default:throw Error("THREE.RGBELoader: Memory Error: "+(t||""))}},a=function(e,t,r){t=t||1024;let i=e.pos,n=-1,a=0,o="",s=String.fromCharCode.apply(null,new Uint16Array(e.subarray(i,i+128)));for(;0>(n=s.indexOf("\n"))&&a<t&&i<e.byteLength;)o+=s,a+=s.length,i+=128,s+=String.fromCharCode.apply(null,new Uint16Array(e.subarray(i,i+128)));return -1<n&&(!1!==r&&(e.pos+=a+n+1),o+s.slice(0,n))},o=new Uint8Array(e);o.pos=0;let s=function(e){let t,r;let i=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,o=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,s=/^\s*FORMAT=(\S+)\s*$/,l=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,c={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};for(!(e.pos>=e.byteLength)&&(t=a(e))||n(1,"no header found"),(r=t.match(/^#\?(\S+)/))||n(3,"bad initial token"),c.valid|=1,c.programtype=r[1],c.string+=t+"\n";!1!==(t=a(e));){if(c.string+=t+"\n","#"===t.charAt(0)){c.comments+=t+"\n";continue}if((r=t.match(i))&&(c.gamma=parseFloat(r[1])),(r=t.match(o))&&(c.exposure=parseFloat(r[1])),(r=t.match(s))&&(c.valid|=2,c.format=r[1]),(r=t.match(l))&&(c.valid|=4,c.height=parseInt(r[1],10),c.width=parseInt(r[2],10)),2&c.valid&&4&c.valid)break}return 2&c.valid||n(3,"missing format specifier"),4&c.valid||n(3,"missing image size specifier"),c}(o),l=s.width,c=s.height,u=function(e,t,r){if(t<8||t>32767||2!==e[0]||2!==e[1]||128&e[2])return new Uint8Array(e);t!==(e[2]<<8|e[3])&&n(3,"wrong scanline width");let i=new Uint8Array(4*t*r);i.length||n(4,"unable to allocate buffer space");let a=0,o=0,s=4*t,l=new Uint8Array(4),c=new Uint8Array(s),u=r;for(;u>0&&o<e.byteLength;){o+4>e.byteLength&&n(1),l[0]=e[o++],l[1]=e[o++],l[2]=e[o++],l[3]=e[o++],(2!=l[0]||2!=l[1]||(l[2]<<8|l[3])!=t)&&n(3,"bad rgbe scanline format");let r=0,h;for(;r<s&&o<e.byteLength;){let t=(h=e[o++])>128;if(t&&(h-=128),(0===h||r+h>s)&&n(3,"bad scanline data"),t){let t=e[o++];for(let e=0;e<h;e++)c[r++]=t}else c.set(e.subarray(o,o+h),r),r+=h,o+=h}for(let e=0;e<t;e++){let r=0;i[a]=c[e+r],r+=t,i[a+1]=c[e+r],r+=t,i[a+2]=c[e+r],r+=t,i[a+3]=c[e+r],a+=4}u--}return i}(o.subarray(o.pos),l,c);switch(this.type){case eT.FloatType:i=u.length/4;let h=new Float32Array(4*i);for(let e=0;e<i;e++)!function(e,t,r,i){let n=Math.pow(2,e[t+3]-128)/255;r[i+0]=e[t+0]*n,r[i+1]=e[t+1]*n,r[i+2]=e[t+2]*n,r[i+3]=1}(u,4*e,h,4*e);t=h,r=eT.FloatType;break;case eT.HalfFloatType:i=u.length/4;let A=new Uint16Array(4*i);for(let e=0;e<i;e++)!function(e,t,r,i){let n=Math.pow(2,e[t+3]-128)/255;r[i+0]=eT.DataUtils.toHalfFloat(Math.min(e[t+0]*n,65504)),r[i+1]=eT.DataUtils.toHalfFloat(Math.min(e[t+1]*n,65504)),r[i+2]=eT.DataUtils.toHalfFloat(Math.min(e[t+2]*n,65504)),r[i+3]=eT.DataUtils.toHalfFloat(1)}(u,4*e,A,4*e);t=A,r=eT.HalfFloatType;break;default:throw Error("THREE.RGBELoader: Unsupported type: "+this.type)}return{width:l,height:c,data:t,header:s.string,gamma:s.gamma,exposure:s.exposure,type:r}}setDataType(e){return this.type=e,this}load(e,t,r,i){return super.load(e,function(e,r){switch(e.type){case eT.FloatType:case eT.HalfFloatType:"colorSpace"in e?e.colorSpace="srgb-linear":e.encoding=3e3,e.minFilter=eT.LinearFilter,e.magFilter=eT.LinearFilter,e.generateMipmaps=!1,e.flipY=!0}t&&t(e,r)},r,i)}}let p7=od>=152;class ge extends eT.DataTextureLoader{constructor(e){super(e),this.type=eT.HalfFloatType}parse(e){let t={l:0,c:0,lc:0};function r(e,r,i,n,a){for(;i<e;)r=r<<8|I(n,a),i+=8;i-=e,t.l=r>>i&(1<<e)-1,t.c=r,t.lc=i}let i=Array(59),n={c:0,lc:0};function a(e,t,r,i){e=e<<8|I(r,i),t+=8,n.c=e,n.lc=t}let o={c:0,lc:0};function s(e,t,r,i,s,l,c,u,h,A){if(e==t){i<8&&(a(r,i,s,c),r=n.c,i=n.lc);var d=r>>(i-=8),d=new Uint8Array([d])[0];if(h.value+d>A)return!1;for(var f=u[h.value-1];d-- >0;)u[h.value++]=f}else{if(!(h.value<A))return!1;u[h.value++]=e}o.c=r,o.lc=i}function l(e){var t=65535&e;return t>32767?t-65536:t}let c={a:0,b:0};function u(e,t){var r=l(e),i=l(t),n=r+(1&i)+(i>>1),a=n-i;c.a=n,c.b=a}function h(e,t){var r=65535&t,i=(65535&e)-(r>>1)&65535;c.a=r+i-32768&65535,c.b=i}function A(e,l,c,u,h,A){var d=c.value,f=w(l,c),m=w(l,c);c.value+=4;var p=w(l,c);if(c.value+=4,f<0||f>=65537||m<0||m>=65537)throw"Something wrong with HUF_ENCSIZE";var g=Array(65537),y=Array(16384);!function(e){for(var t=0;t<16384;t++)e[t]={},e[t].len=0,e[t].lit=0,e[t].p=null}(y);var v=u-(c.value-d);if(!function(e,n,a,o,s,l,c){for(var u=0,h=0;s<=l;s++){if(a.value-a.value>o)return!1;r(6,u,h,e,a);var A=t.l;if(u=t.c,h=t.lc,c[s]=A,63==A){if(a.value-a.value>o)throw"Something wrong with hufUnpackEncTable";r(8,u,h,e,a);var d=t.l+6;if(u=t.c,h=t.lc,s+d>l+1)throw"Something wrong with hufUnpackEncTable";for(;d--;)c[s++]=0;s--}else if(A>=59){var d=A-59+2;if(s+d>l+1)throw"Something wrong with hufUnpackEncTable";for(;d--;)c[s++]=0;s--}}!function(e){for(var t=0;t<=58;++t)i[t]=0;for(var t=0;t<65537;++t)i[e[t]]+=1;for(var r=0,t=58;t>0;--t){var n=r+i[t]>>1;i[t]=r,r=n}for(var t=0;t<65537;++t){var a=e[t];a>0&&(e[t]=a|i[a]++<<6)}}(c)}(e,0,c,v,f,m,g),p>8*(u-(c.value-d)))throw"Something wrong with hufUncompress";!function(e,t,r,i){for(;t<=r;t++){var n=e[t]>>6,a=63&e[t];if(n>>a)throw"Invalid table entry";if(a>14){var o=i[n>>a-14];if(o.len)throw"Invalid table entry";if(o.lit++,o.p){var s=o.p;o.p=Array(o.lit);for(var l=0;l<o.lit-1;++l)o.p[l]=s[l]}else o.p=[,];o.p[o.lit-1]=t}else if(a)for(var c=0,l=1<<14-a;l>0;l--){var o=i[(n<<14-a)+c];if(o.len||o.p)throw"Invalid table entry";o.len=a,o.lit=t,c++}}}(g,f,m,y),function(e,t,r,i,l,c,u,h,A,d){for(var f=0,m=0,p=Math.trunc(l.value+(c+7)/8);l.value<p;)for(a(f,m,r,l),f=n.c,m=n.lc;m>=14;){var g=t[f>>m-14&16383];if(g.len)m-=g.len,s(g.lit,u,f,m,r,i,l,A,d,h),f=o.c,m=o.lc;else{if(!g.p)throw"hufDecode issues";for(y=0;y<g.lit;y++){for(var y,v=63&e[g.p[y]];m<v&&l.value<p;)a(f,m,r,l),f=n.c,m=n.lc;if(m>=v&&e[g.p[y]]>>6==(f>>m-v&(1<<v)-1)){m-=v,s(g.p[y],u,f,m,r,i,l,A,d,h),f=o.c,m=o.lc;break}}if(y==g.lit)throw"hufDecode issues"}}var E=8-c&7;for(f>>=E,m-=E;m>0;){var g=t[f<<14-m&16383];if(g.len)m-=g.len,s(g.lit,u,f,m,r,i,l,A,d,h),f=o.c,m=o.lc;else throw"hufDecode issues"}}(g,y,e,l,c,p,m,A,h,{value:0})}function d(e){for(var t=1;t<e.length;t++){var r=e[t-1]+e[t]-128;e[t]=r}}function f(e,t){for(var r=0,i=Math.floor((e.length+1)/2),n=0,a=e.length-1;!(n>a)&&(t[n++]=e[r++],!(n>a));)t[n++]=e[i++]}function m(e){for(var t=e.byteLength,r=[],i=0,n=new DataView(e);t>0;){var a=n.getInt8(i++);if(a<0){var o=-a;t-=o+1;for(var s=0;s<o;s++)r.push(n.getUint8(i++))}else{var o=a;t-=2;for(var l=n.getUint8(i++),s=0;s<o+1;s++)r.push(l)}}return r}function p(e){return new DataView(e.array.buffer,e.offset.value,e.size)}function g(e){var t=e.viewer.buffer.slice(e.offset.value,e.offset.value+e.size),r=new Uint8Array(m(t)),i=new Uint8Array(r.length);return d(r),f(r,i),new DataView(i.buffer)}function y(e){var t=h2(e.array.slice(e.offset.value,e.offset.value+e.size)),r=new Uint8Array(t.length);return d(t),f(t,r),new DataView(r.buffer)}function v(e){for(var t=e.viewer,r={value:e.offset.value},i=new Uint16Array(e.width*e.scanlineBlockSize*(e.channels*e.type)),n=new Uint8Array(8192),a=0,o=Array(e.channels),s=0;s<e.channels;s++)o[s]={},o[s].start=a,o[s].end=o[s].start,o[s].nx=e.width,o[s].ny=e.lines,o[s].size=e.type,a+=o[s].nx*o[s].ny*o[s].size;var l=T(t,r),d=T(t,r);if(d>=8192)throw"Something is wrong with PIZ_COMPRESSION BITMAP_SIZE";if(l<=d)for(var s=0;s<d-l+1;s++)n[s+l]=b(t,r);var f=new Uint16Array(65536),m=function(e,t){for(var r=0,i=0;i<65536;++i)(0==i||e[i>>3]&1<<(7&i))&&(t[r++]=i);for(var n=r-1;r<65536;)t[r++]=0;return n}(n,f),p=w(t,r);A(e.array,t,r,p,i,a);for(var s=0;s<e.channels;++s)for(var g=o[s],y=0;y<o[s].size;++y)!function(e,t,r,i,n,a,o){for(var s=o<16384,l=r>n?n:r,A=1;A<=l;)A<<=1;for(A>>=1,d=A,A>>=1;A>=1;){for(var d,f,m,p,g,y=0,v=0+a*(n-d),E=a*A,x=a*d,C=i*A,B=i*d;y<=v;y+=x){for(var w=y,I=y+i*(r-d);w<=I;w+=B){var b=w+C,_=w+E,M=_+C;s?(u(e[w+t],e[_+t]),f=c.a,p=c.b,u(e[b+t],e[M+t]),m=c.a,g=c.b,u(f,m),e[w+t]=c.a,e[b+t]=c.b,u(p,g)):(h(e[w+t],e[_+t]),f=c.a,p=c.b,h(e[b+t],e[M+t]),m=c.a,g=c.b,h(f,m),e[w+t]=c.a,e[b+t]=c.b,h(p,g)),e[_+t]=c.a,e[M+t]=c.b}if(r&A){var _=w+E;s?u(e[w+t],e[_+t]):h(e[w+t],e[_+t]),f=c.a,e[_+t]=c.b,e[w+t]=f}}if(n&A)for(var w=y,I=y+i*(r-d);w<=I;w+=B){var b=w+C;s?u(e[w+t],e[b+t]):h(e[w+t],e[b+t]),f=c.a,e[b+t]=c.b,e[w+t]=f}d=A,A>>=1}}(i,g.start+y,g.nx,g.size,g.ny,g.nx*g.size,m);!function(e,t,r){for(var i=0;i<r;++i)t[i]=e[t[i]]}(f,i,a);for(var v=0,E=new Uint8Array(i.buffer.byteLength),x=0;x<e.lines;x++)for(var C=0;C<e.channels;C++){var g=o[C],B=g.nx*g.size,I=new Uint8Array(i.buffer,2*g.end,2*B);E.set(I,v),v+=2*B,g.end+=B}return new DataView(E.buffer)}function E(e){var t=h2(e.array.slice(e.offset.value,e.offset.value+e.size));let r=e.lines*e.channels*e.width,i=1==e.type?new Uint16Array(r):new Uint32Array(r),n=0,a=0,o=[,,,,];for(let r=0;r<e.lines;r++)for(let r=0;r<e.channels;r++){let r=0;switch(e.type){case 1:o[0]=n,o[1]=o[0]+e.width,n=o[1]+e.width;for(let n=0;n<e.width;++n)r+=t[o[0]++]<<8|t[o[1]++],i[a]=r,a++;break;case 2:o[0]=n,o[1]=o[0]+e.width,o[2]=o[1]+e.width,n=o[2]+e.width;for(let n=0;n<e.width;++n)r+=t[o[0]++]<<24|t[o[1]++]<<16|t[o[2]++]<<8,i[a]=r,a++}}return new DataView(i.buffer)}function x(e){var t=e.viewer,r={value:e.offset.value},i=new Uint8Array(e.width*e.lines*(e.channels*e.type*2)),n={version:_(t,r),unknownUncompressedSize:_(t,r),unknownCompressedSize:_(t,r),acCompressedSize:_(t,r),dcCompressedSize:_(t,r),rleCompressedSize:_(t,r),rleUncompressedSize:_(t,r),rleRawSize:_(t,r),totalAcUncompressedCount:_(t,r),totalDcUncompressedCount:_(t,r),acCompression:_(t,r)};if(n.version<2)throw"EXRLoader.parse: "+z.compression+" version "+n.version+" is unsupported";for(var a=[],o=T(t,r)-2;o>0;){var s=C(t.buffer,r),l=b(t,r),c=l>>2&3,u=(l>>4)-1,h=new Int8Array([u])[0],d=b(t,r);a.push({name:s,index:h,type:d,compression:c}),o-=s.length+3}for(var f=z.channels,p=Array(e.channels),g=0;g<e.channels;++g){var v=p[g]={},E=f[g];v.name=E.name,v.compression=0,v.decoded=!1,v.type=E.pixelType,v.pLinear=E.pLinear,v.width=e.width,v.height=e.lines}for(var x={idx:[,,,]},B=0;B<e.channels;++B)for(var v=p[B],g=0;g<a.length;++g){var w=a[g];v.name==w.name&&(v.compression=w.compression,w.index>=0&&(x.idx[w.index]=B),v.offset=B)}if(n.acCompressedSize>0)switch(n.acCompression){case 0:var I=new Uint16Array(n.totalAcUncompressedCount);A(e.array,t,r,n.acCompressedSize,I,n.totalAcUncompressedCount);break;case 1:var M=e.array.slice(r.value,r.value+n.totalAcUncompressedCount),S=h2(M),I=new Uint16Array(S.buffer);r.value+=n.totalAcUncompressedCount}if(n.dcCompressedSize>0){var R={array:e.array,offset:r,size:n.dcCompressedSize},F=new Uint16Array(y(R).buffer);r.value+=n.dcCompressedSize}if(n.rleRawSize>0){var M=e.array.slice(r.value,r.value+n.rleCompressedSize),S=h2(M),P=m(S.buffer);r.value+=n.rleCompressedSize}for(var Q=0,L=Array(p.length),g=0;g<L.length;++g)L[g]=[];for(var O=0;O<e.lines;++O)for(var U=0;U<p.length;++U)L[U].push(Q),Q+=p[U].width*e.type*2;!function(e,t,r,i,n,a){var o=new DataView(a.buffer),s=r[e.idx[0]].width,l=r[e.idx[0]].height,c=Math.floor(s/8),u=Math.ceil(s/8),h=Math.ceil(l/8),A=s-(u-1)*8,d=l-(h-1)*8,f={value:0},m=[,,,],p=[,,,],g=[,,,],y=[,,,],v=[,,,];for(let r=0;r<3;++r)v[r]=t[e.idx[r]],m[r]=r<1?0:m[r-1]+u*h,p[r]=new Float32Array(64),g[r]=new Uint16Array(64),y[r]=new Uint16Array(64*u);for(let t=0;t<h;++t){var E,x,C=8;t==h-1&&(C=d);var B=8;for(let e=0;e<u;++e){e==u-1&&(B=A);for(let e=0;e<3;++e)g[e].fill(0),g[e][0]=n[m[e]++],function(e,t,r){for(var i,n=1;n<64;)65280==(i=t[e.value])?n=64:i>>8==255?n+=255&i:(r[n]=i,n++),e.value++}(f,i,g[e]),E=g[e],(x=p[e])[0]=D(E[0]),x[1]=D(E[1]),x[2]=D(E[5]),x[3]=D(E[6]),x[4]=D(E[14]),x[5]=D(E[15]),x[6]=D(E[27]),x[7]=D(E[28]),x[8]=D(E[2]),x[9]=D(E[4]),x[10]=D(E[7]),x[11]=D(E[13]),x[12]=D(E[16]),x[13]=D(E[26]),x[14]=D(E[29]),x[15]=D(E[42]),x[16]=D(E[3]),x[17]=D(E[8]),x[18]=D(E[12]),x[19]=D(E[17]),x[20]=D(E[25]),x[21]=D(E[30]),x[22]=D(E[41]),x[23]=D(E[43]),x[24]=D(E[9]),x[25]=D(E[11]),x[26]=D(E[18]),x[27]=D(E[24]),x[28]=D(E[31]),x[29]=D(E[40]),x[30]=D(E[44]),x[31]=D(E[53]),x[32]=D(E[10]),x[33]=D(E[19]),x[34]=D(E[23]),x[35]=D(E[32]),x[36]=D(E[39]),x[37]=D(E[45]),x[38]=D(E[52]),x[39]=D(E[54]),x[40]=D(E[20]),x[41]=D(E[22]),x[42]=D(E[33]),x[43]=D(E[38]),x[44]=D(E[46]),x[45]=D(E[51]),x[46]=D(E[55]),x[47]=D(E[60]),x[48]=D(E[21]),x[49]=D(E[34]),x[50]=D(E[37]),x[51]=D(E[47]),x[52]=D(E[50]),x[53]=D(E[56]),x[54]=D(E[59]),x[55]=D(E[61]),x[56]=D(E[35]),x[57]=D(E[36]),x[58]=D(E[48]),x[59]=D(E[49]),x[60]=D(E[57]),x[61]=D(E[58]),x[62]=D(E[62]),x[63]=D(E[63]),function(e){let t=.5*Math.cos(3.14159/16),r=.5*Math.cos(3.14159/8),i=.5*Math.cos(3*3.14159/16),n=.5*Math.cos(3*3.14159/8);for(var a=[,,,,],o=[,,,,],s=[,,,,],l=[,,,,],c=0;c<8;++c){var u=8*c;a[0]=r*e[u+2],a[1]=n*e[u+2],a[2]=r*e[u+6],a[3]=n*e[u+6],o[0]=t*e[u+1]+i*e[u+3]+.2777854612564676*e[u+5]+.09754573032714427*e[u+7],o[1]=i*e[u+1]-.09754573032714427*e[u+3]-t*e[u+5]-.2777854612564676*e[u+7],o[2]=.2777854612564676*e[u+1]-t*e[u+3]+.09754573032714427*e[u+5]+i*e[u+7],o[3]=.09754573032714427*e[u+1]-.2777854612564676*e[u+3]+i*e[u+5]-t*e[u+7],s[0]=.35355362513961314*(e[u+0]+e[u+4]),s[3]=.35355362513961314*(e[u+0]-e[u+4]),s[1]=a[0]+a[3],s[2]=a[1]-a[2],l[0]=s[0]+s[1],l[1]=s[3]+s[2],l[2]=s[3]-s[2],l[3]=s[0]-s[1],e[u+0]=l[0]+o[0],e[u+1]=l[1]+o[1],e[u+2]=l[2]+o[2],e[u+3]=l[3]+o[3],e[u+4]=l[3]-o[3],e[u+5]=l[2]-o[2],e[u+6]=l[1]-o[1],e[u+7]=l[0]-o[0]}for(var h=0;h<8;++h)a[0]=r*e[16+h],a[1]=n*e[16+h],a[2]=r*e[48+h],a[3]=n*e[48+h],o[0]=t*e[8+h]+i*e[24+h]+.2777854612564676*e[40+h]+.09754573032714427*e[56+h],o[1]=i*e[8+h]-.09754573032714427*e[24+h]-t*e[40+h]-.2777854612564676*e[56+h],o[2]=.2777854612564676*e[8+h]-t*e[24+h]+.09754573032714427*e[40+h]+i*e[56+h],o[3]=.09754573032714427*e[8+h]-.2777854612564676*e[24+h]+i*e[40+h]-t*e[56+h],s[0]=.35355362513961314*(e[h]+e[32+h]),s[3]=.35355362513961314*(e[h]-e[32+h]),s[1]=a[0]+a[3],s[2]=a[1]-a[2],l[0]=s[0]+s[1],l[1]=s[3]+s[2],l[2]=s[3]-s[2],l[3]=s[0]-s[1],e[0+h]=l[0]+o[0],e[8+h]=l[1]+o[1],e[16+h]=l[2]+o[2],e[24+h]=l[3]+o[3],e[32+h]=l[3]-o[3],e[40+h]=l[2]-o[2],e[48+h]=l[1]-o[1],e[56+h]=l[0]-o[0]}(p[e]);!function(e){for(var t=0;t<64;++t){var r=e[0][t],i=e[1][t],n=e[2][t];e[0][t]=r+1.5747*n,e[1][t]=r-.1873*i-.4682*n,e[2][t]=r+1.8556*i}}(p);for(let t=0;t<3;++t)!function(e,t,r){for(var i,n=0;n<64;++n)t[r+n]=eT.DataUtils.toHalfFloat((i=e[n])<=1?Math.sign(i)*Math.pow(Math.abs(i),2.2):Math.sign(i)*Math.pow(9.025013291561939,Math.abs(i)-1))}(p[t],y[t],64*e)}let a=0;for(let i=0;i<3;++i){let n=r[e.idx[i]].type;for(let e=8*t;e<8*t+C;++e){a=v[i][e];for(let t=0;t<c;++t){let r=64*t+(7&e)*8;o.setUint16(a+0*n,y[i][r+0],!0),o.setUint16(a+2*n,y[i][r+1],!0),o.setUint16(a+4*n,y[i][r+2],!0),o.setUint16(a+6*n,y[i][r+3],!0),o.setUint16(a+8*n,y[i][r+4],!0),o.setUint16(a+10*n,y[i][r+5],!0),o.setUint16(a+12*n,y[i][r+6],!0),o.setUint16(a+14*n,y[i][r+7],!0),a+=16*n}}if(c!=u)for(let e=8*t;e<8*t+C;++e){let t=v[i][e]+8*c*2*n,r=64*c+(7&e)*8;for(let e=0;e<B;++e)o.setUint16(t+2*e*n,y[i][r+e],!0)}}}for(var w=new Uint16Array(s),o=new DataView(a.buffer),I=0;I<3;++I){r[e.idx[I]].decoded=!0;var b=r[e.idx[I]].type;if(2==r[I].type)for(var _=0;_<l;++_){let e=v[I][_];for(var M=0;M<s;++M)w[M]=o.getUint16(e+2*M*b,!0);for(var M=0;M<s;++M)o.setFloat32(e+2*M*b,D(w[M]),!0)}}}(x,L,p,I,F,i);for(var g=0;g<p.length;++g){var v=p[g];if(!v.decoded){if(2===v.compression)for(var k=0,G=0,O=0;O<e.lines;++O){for(var N=L[g][k],H=0;H<v.width;++H){for(var V=0;V<2*v.type;++V)i[N++]=P[G+V*v.width*v.height];G++}k++}else throw"EXRLoader.parse: unsupported channel compression"}}return new DataView(i.buffer)}function C(e,t){for(var r=new Uint8Array(e),i=0;0!=r[t.value+i];)i+=1;var n=new TextDecoder().decode(r.slice(t.value,t.value+i));return t.value=t.value+i+1,n}function B(e,t){var r=e.getInt32(t.value,!0);return t.value=t.value+4,r}function w(e,t){var r=e.getUint32(t.value,!0);return t.value=t.value+4,r}function I(e,t){var r=e[t.value];return t.value=t.value+1,r}function b(e,t){var r=e.getUint8(t.value);return t.value=t.value+1,r}let _=function(e,t){let r;return r="getBigInt64"in DataView.prototype?Number(e.getBigInt64(t.value,!0)):e.getUint32(t.value+4,!0)+Number(e.getUint32(t.value,!0)<<32),t.value+=8,r};function M(e,t){var r=e.getFloat32(t.value,!0);return t.value+=4,r}function S(e,t){return eT.DataUtils.toHalfFloat(M(e,t))}function D(e){var t=(31744&e)>>10,r=1023&e;return(e>>15?-1:1)*(t?31===t?r?NaN:1/0:Math.pow(2,t-15)*(1+r/1024):r/1024*6103515625e-14)}function T(e,t){var r=e.getUint16(t.value,!0);return t.value+=2,r}function R(e,t){return D(T(e,t))}let F=new DataView(e),P=new Uint8Array(e),Q={value:0},z=function(e,t,r){let i={};if(20000630!=e.getUint32(0,!0))throw"THREE.EXRLoader: provided file doesn't appear to be in OpenEXR format.";i.version=e.getUint8(4);let n=e.getUint8(5);i.spec={singleTile:!!(2&n),longName:!!(4&n),deepFormat:!!(8&n),multiPart:!!(16&n)},r.value=8;for(var a=!0;a;){var o=C(t,r);if(0==o)a=!1;else{var s=C(t,r),l=w(e,r),c=function(e,t,r,i,n){var a,o,s,l,c;if("string"===i||"stringvector"===i||"iccProfile"===i)return a=new TextDecoder().decode(new Uint8Array(t).slice(r.value,r.value+n)),r.value=r.value+n,a;if("chlist"===i)return function(e,t,r,i){for(var n=r.value,a=[];r.value<n+i-1;){var o=C(t,r),s=B(e,r),l=b(e,r);r.value+=3;var c=B(e,r),u=B(e,r);a.push({name:o,pixelType:s,pLinear:l,xSampling:c,ySampling:u})}return r.value+=1,a}(e,t,r,n);if("chromaticities"===i)return o=M(e,r),s=M(e,r),l=M(e,r),c=M(e,r),{redX:o,redY:s,greenX:l,greenY:c,blueX:M(e,r),blueY:M(e,r),whiteX:M(e,r),whiteY:M(e,r)};if("compression"===i)return["NO_COMPRESSION","RLE_COMPRESSION","ZIPS_COMPRESSION","ZIP_COMPRESSION","PIZ_COMPRESSION","PXR24_COMPRESSION","B44_COMPRESSION","B44A_COMPRESSION","DWAA_COMPRESSION","DWAB_COMPRESSION"][b(e,r)];if("box2i"===i)return{xMin:w(e,r),yMin:w(e,r),xMax:w(e,r),yMax:w(e,r)};if("lineOrder"===i)return["INCREASING_Y"][b(e,r)];if("float"===i)return M(e,r);else if("v2f"===i)return[M(e,r),M(e,r)];else if("v3f"===i)return[M(e,r),M(e,r),M(e,r)];else if("int"===i)return B(e,r);else if("rational"===i)return[B(e,r),w(e,r)];else if("timecode"===i)return[w(e,r),w(e,r)];else return"preview"===i?(r.value+=n,"skipped"):void(r.value+=n)}(e,t,r,s,l);void 0===c?console.warn(`EXRLoader.parse: skipped unknown header attribute type '${s}'.`):i[o]=c}}if((-5&n)!=0)throw console.error("EXRHeader:",i),"THREE.EXRLoader: provided file is currently unsupported.";return i}(F,e,Q),L=function(e,t,r,i,n){let a={size:0,viewer:t,array:r,offset:i,width:e.dataWindow.xMax-e.dataWindow.xMin+1,height:e.dataWindow.yMax-e.dataWindow.yMin+1,channels:e.channels.length,bytesPerLine:null,lines:null,inputSize:null,type:e.channels[0].pixelType,uncompress:null,getter:null,format:null,[p7?"colorSpace":"encoding"]:null};switch(e.compression){case"NO_COMPRESSION":a.lines=1,a.uncompress=p;break;case"RLE_COMPRESSION":a.lines=1,a.uncompress=g;break;case"ZIPS_COMPRESSION":a.lines=1,a.uncompress=y;break;case"ZIP_COMPRESSION":a.lines=16,a.uncompress=y;break;case"PIZ_COMPRESSION":a.lines=32,a.uncompress=v;break;case"PXR24_COMPRESSION":a.lines=16,a.uncompress=E;break;case"DWAA_COMPRESSION":a.lines=32,a.uncompress=x;break;case"DWAB_COMPRESSION":a.lines=256,a.uncompress=x;break;default:throw"EXRLoader.parse: "+e.compression+" is unsupported"}if(a.scanlineBlockSize=a.lines,1==a.type)switch(n){case eT.FloatType:a.getter=R,a.inputSize=2;break;case eT.HalfFloatType:a.getter=T,a.inputSize=2}else if(2==a.type)switch(n){case eT.FloatType:a.getter=M,a.inputSize=4;break;case eT.HalfFloatType:a.getter=S,a.inputSize=4}else throw"EXRLoader.parse: unsupported pixelType "+a.type+" for "+e.compression+".";a.blockCount=(e.dataWindow.yMax+1)/a.scanlineBlockSize;for(var o=0;o<a.blockCount;o++)_(t,i);a.outputChannels=3==a.channels?4:a.channels;let s=a.width*a.height*a.outputChannels;switch(n){case eT.FloatType:a.byteArray=new Float32Array(s),a.channels<a.outputChannels&&a.byteArray.fill(1,0,s);break;case eT.HalfFloatType:a.byteArray=new Uint16Array(s),a.channels<a.outputChannels&&a.byteArray.fill(15360,0,s);break;default:console.error("THREE.EXRLoader: unsupported type: ",n)}return a.bytesPerLine=a.width*a.inputSize*a.channels,4==a.outputChannels?a.format=eT.RGBAFormat:a.format=eT.RedFormat,p7?a.colorSpace="srgb-linear":a.encoding=3e3,a}(z,F,P,Q,this.type),O={value:0},U={R:0,G:1,B:2,A:3,Y:0};for(let e=0;e<L.height/L.scanlineBlockSize;e++){let t=w(F,Q);L.size=w(F,Q),L.lines=t+L.scanlineBlockSize>L.height?L.height-t:L.scanlineBlockSize;let r=L.size<L.lines*L.bytesPerLine?L.uncompress(L):p(L);Q.value+=L.size;for(let t=0;t<L.scanlineBlockSize;t++){let i=t+e*L.scanlineBlockSize;if(i>=L.height)break;for(let e=0;e<L.channels;e++){let n=U[z.channels[e].name];for(let a=0;a<L.width;a++){O.value=(L.channels*L.width*t+e*L.width+a)*L.inputSize;let o=(L.height-1-i)*(L.width*L.outputChannels)+a*L.outputChannels+n;L.byteArray[o]=L.getter(r,O)}}}}return{header:z,width:L.width,height:L.height,data:L.byteArray,format:L.format,[p7?"colorSpace":"encoding"]:L[p7?"colorSpace":"encoding"],type:this.type}}setDataType(e){return this.type=e,this}load(e,t,r,i){return super.load(e,function(e,r){p7?e.colorSpace=r.colorSpace:e.encoding=r.encoding,e.minFilter=eT.LinearFilter,e.magFilter=eT.LinearFilter,e.generateMipmaps=!1,e.flipY=!1,t&&t(e,r)},r,i)}}let gt=(e,t,r)=>{let i;switch(e){case eT.UnsignedByteType:i=new Uint8ClampedArray(t*r*4);break;case eT.HalfFloatType:i=new Uint16Array(t*r*4);break;case eT.UnsignedIntType:i=new Uint32Array(t*r*4);break;case eT.ByteType:i=new Int8Array(t*r*4);break;case eT.ShortType:i=new Int16Array(t*r*4);break;case eT.IntType:i=new Int32Array(t*r*4);break;case eT.FloatType:i=new Float32Array(t*r*4);break;default:throw Error("Unsupported data type")}return i},gr=(e,t,r,i)=>{if(void 0!==N)return N;let n=new eT.WebGLRenderTarget(1,1,i);t.setRenderTarget(n);let a=new eT.Mesh(new eT.PlaneGeometry,new eT.MeshBasicMaterial({color:16777215}));t.render(a,r),t.setRenderTarget(null);let o=gt(e,n.width,n.height);return t.readRenderTargetPixels(n,0,0,n.width,n.height,o),n.dispose(),a.geometry.dispose(),a.material.dispose(),N=0!==o[0]};class gi{constructor(e){var t,r,i,n,a,o,s,l,c,u,h,A,d,f,m,p;this._rendererIsDisposable=!1,this._supportsReadPixels=!0,this.render=()=>{this._renderer.setRenderTarget(this._renderTarget);try{this._renderer.render(this._scene,this._camera)}catch(e){throw this._renderer.setRenderTarget(null),e}this._renderer.setRenderTarget(null)},this._width=e.width,this._height=e.height,this._type=e.type,this._colorSpace=e.colorSpace;let g={format:eT.RGBAFormat,depthBuffer:!1,stencilBuffer:!1,type:this._type,colorSpace:this._colorSpace,anisotropy:(null===(t=e.renderTargetOptions)||void 0===t?void 0:t.anisotropy)!==void 0?null===(r=e.renderTargetOptions)||void 0===r?void 0:r.anisotropy:1,generateMipmaps:(null===(i=e.renderTargetOptions)||void 0===i?void 0:i.generateMipmaps)!==void 0&&(null===(n=e.renderTargetOptions)||void 0===n?void 0:n.generateMipmaps),magFilter:(null===(a=e.renderTargetOptions)||void 0===a?void 0:a.magFilter)!==void 0?null===(o=e.renderTargetOptions)||void 0===o?void 0:o.magFilter:eT.LinearFilter,minFilter:(null===(s=e.renderTargetOptions)||void 0===s?void 0:s.minFilter)!==void 0?null===(l=e.renderTargetOptions)||void 0===l?void 0:l.minFilter:eT.LinearFilter,samples:(null===(c=e.renderTargetOptions)||void 0===c?void 0:c.samples)!==void 0?null===(u=e.renderTargetOptions)||void 0===u?void 0:u.samples:void 0,wrapS:(null===(h=e.renderTargetOptions)||void 0===h?void 0:h.wrapS)!==void 0?null===(A=e.renderTargetOptions)||void 0===A?void 0:A.wrapS:eT.ClampToEdgeWrapping,wrapT:(null===(d=e.renderTargetOptions)||void 0===d?void 0:d.wrapT)!==void 0?null===(f=e.renderTargetOptions)||void 0===f?void 0:f.wrapT:eT.ClampToEdgeWrapping};if(this._material=e.material,e.renderer?this._renderer=e.renderer:(this._renderer=gi.instantiateRenderer(),this._rendererIsDisposable=!0),this._scene=new eT.Scene,this._camera=new eT.OrthographicCamera,this._camera.position.set(0,0,10),this._camera.left=-.5,this._camera.right=.5,this._camera.top=.5,this._camera.bottom=-.5,this._camera.updateProjectionMatrix(),!gr(this._type,this._renderer,this._camera,g)){let e;this._type===eT.HalfFloatType&&(e=this._renderer.extensions.has("EXT_color_buffer_float")?eT.FloatType:void 0),void 0!==e?(console.warn(`This browser does not support reading pixels from ${this._type} RenderTargets, switching to ${eT.FloatType}`),this._type=e):(this._supportsReadPixels=!1,console.warn("This browser dos not support toArray or toDataTexture, calls to those methods will result in an error thrown"))}this._quad=new eT.Mesh(new eT.PlaneGeometry,this._material),this._quad.geometry.computeBoundingBox(),this._scene.add(this._quad),this._renderTarget=new eT.WebGLRenderTarget(this.width,this.height,g),this._renderTarget.texture.mapping=(null===(m=e.renderTargetOptions)||void 0===m?void 0:m.mapping)!==void 0?null===(p=e.renderTargetOptions)||void 0===p?void 0:p.mapping:eT.UVMapping}static instantiateRenderer(){let e=new eT.WebGLRenderer;return e.setSize(128,128),e}toArray(){if(!this._supportsReadPixels)throw Error("Can't read pixels in this browser");let e=gt(this._type,this._width,this._height);return this._renderer.readRenderTargetPixels(this._renderTarget,0,0,this._width,this._height,e),e}toDataTexture(e){let t=new eT.DataTexture(this.toArray(),this.width,this.height,eT.RGBAFormat,this._type,(null==e?void 0:e.mapping)||eT.UVMapping,(null==e?void 0:e.wrapS)||eT.ClampToEdgeWrapping,(null==e?void 0:e.wrapT)||eT.ClampToEdgeWrapping,(null==e?void 0:e.magFilter)||eT.LinearFilter,(null==e?void 0:e.minFilter)||eT.LinearFilter,(null==e?void 0:e.anisotropy)||1,eT.LinearSRGBColorSpace);return t.generateMipmaps=(null==e?void 0:e.generateMipmaps)!==void 0&&(null==e?void 0:e.generateMipmaps),t}disposeOnDemandRenderer(){this._renderer.setRenderTarget(null),this._rendererIsDisposable&&(this._renderer.dispose(),this._renderer.forceContextLoss())}dispose(e){this.disposeOnDemandRenderer(),e&&this.renderTarget.dispose(),this.material instanceof eT.ShaderMaterial&&Object.values(this.material.uniforms).forEach(e=>{e.value instanceof eT.Texture&&e.value.dispose()}),Object.values(this.material).forEach(e=>{e instanceof eT.Texture&&e.dispose()}),this.material.dispose(),this._quad.geometry.dispose()}get width(){return this._width}set width(e){this._width=e,this._renderTarget.setSize(this._width,this._height)}get height(){return this._height}set height(e){this._height=e,this._renderTarget.setSize(this._width,this._height)}get renderer(){return this._renderer}get renderTarget(){return this._renderTarget}set renderTarget(e){this._renderTarget=e,this._width=e.width,this._height=e.height}get material(){return this._material}get type(){return this._type}get colorSpace(){return this._colorSpace}}let gn=`
varying vec2 vUv;

void main() {
  vUv = uv;
  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
}
`,ga=`
// min half float value
#define HALF_FLOAT_MIN vec3( -65504, -65504, -65504 )
// max half float value
#define HALF_FLOAT_MAX vec3( 65504, 65504, 65504 )

uniform sampler2D sdr;
uniform sampler2D gainMap;
uniform vec3 gamma;
uniform vec3 offsetHdr;
uniform vec3 offsetSdr;
uniform vec3 gainMapMin;
uniform vec3 gainMapMax;
uniform float weightFactor;

varying vec2 vUv;

void main() {
  vec3 rgb = texture2D( sdr, vUv ).rgb;
  vec3 recovery = texture2D( gainMap, vUv ).rgb;
  vec3 logRecovery = pow( recovery, gamma );
  vec3 logBoost = gainMapMin * ( 1.0 - logRecovery ) + gainMapMax * logRecovery;
  vec3 hdrColor = (rgb + offsetSdr) * exp2( logBoost * weightFactor ) - offsetHdr;
  vec3 clampedHdrColor = max( HALF_FLOAT_MIN, min( HALF_FLOAT_MAX, hdrColor ));
  gl_FragColor = vec4( clampedHdrColor , 1.0 );
}
`;class go extends eT.ShaderMaterial{constructor({gamma:e,offsetHdr:t,offsetSdr:r,gainMapMin:i,gainMapMax:n,maxDisplayBoost:a,hdrCapacityMin:o,hdrCapacityMax:s,sdr:l,gainMap:c}){super({name:"GainMapDecoderMaterial",vertexShader:gn,fragmentShader:ga,uniforms:{sdr:{value:l},gainMap:{value:c},gamma:{value:new eT.Vector3(1/e[0],1/e[1],1/e[2])},offsetHdr:{value:new eT.Vector3().fromArray(t)},offsetSdr:{value:new eT.Vector3().fromArray(r)},gainMapMin:{value:new eT.Vector3().fromArray(i)},gainMapMax:{value:new eT.Vector3().fromArray(n)},weightFactor:{value:(Math.log2(a)-o)/(s-o)}},blending:eT.NoBlending,depthTest:!1,depthWrite:!1}),this._maxDisplayBoost=a,this._hdrCapacityMin=o,this._hdrCapacityMax=s,this.needsUpdate=!0,this.uniformsNeedUpdate=!0}get sdr(){return this.uniforms.sdr.value}set sdr(e){this.uniforms.sdr.value=e}get gainMap(){return this.uniforms.gainMap.value}set gainMap(e){this.uniforms.gainMap.value=e}get offsetHdr(){return this.uniforms.offsetHdr.value.toArray()}set offsetHdr(e){this.uniforms.offsetHdr.value.fromArray(e)}get offsetSdr(){return this.uniforms.offsetSdr.value.toArray()}set offsetSdr(e){this.uniforms.offsetSdr.value.fromArray(e)}get gainMapMin(){return this.uniforms.gainMapMin.value.toArray()}set gainMapMin(e){this.uniforms.gainMapMin.value.fromArray(e)}get gainMapMax(){return this.uniforms.gainMapMax.value.toArray()}set gainMapMax(e){this.uniforms.gainMapMax.value.fromArray(e)}get gamma(){let e=this.uniforms.gamma.value;return[1/e.x,1/e.y,1/e.z]}set gamma(e){let t=this.uniforms.gamma.value;t.x=1/e[0],t.y=1/e[1],t.z=1/e[2]}get hdrCapacityMin(){return this._hdrCapacityMin}set hdrCapacityMin(e){this._hdrCapacityMin=e,this.calculateWeight()}get hdrCapacityMax(){return this._hdrCapacityMax}set hdrCapacityMax(e){this._hdrCapacityMax=e,this.calculateWeight()}get maxDisplayBoost(){return this._maxDisplayBoost}set maxDisplayBoost(e){this._maxDisplayBoost=Math.max(1,Math.min(65504,e)),this.calculateWeight()}calculateWeight(){let e=(Math.log2(this._maxDisplayBoost)-this._hdrCapacityMin)/(this._hdrCapacityMax-this._hdrCapacityMin);this.uniforms.weightFactor.value=Math.max(0,Math.min(1,e))}}class gs extends Error{}class gl extends Error{}let gc=(e,t,r)=>{let i=RegExp(`${t}="([^"]*)"`,"i").exec(e);if(i)return i[1];let n=RegExp(`<${t}[^>]*>([\\s\\S]*?)</${t}>`,"i").exec(e);if(n){let e=n[1].match(/<rdf:li>([^<]*)<\/rdf:li>/g);return e&&3===e.length?e.map(e=>e.replace(/<\/?rdf:li>/g,"")):n[1].trim()}if(void 0!==r)return r;throw Error(`Can't find ${t} in gainmap metadata`)},gu=e=>{let t;let r=(t="undefined"!=typeof TextDecoder?new TextDecoder().decode(e):e.toString()).indexOf("<x:xmpmeta");for(;-1!==r;){let e=t.indexOf("x:xmpmeta>",r),i=t.slice(r,e+10);try{let e=gc(i,"hdrgm:GainMapMin","0"),t=gc(i,"hdrgm:GainMapMax"),r=gc(i,"hdrgm:Gamma","1"),n=gc(i,"hdrgm:OffsetSDR","0.015625"),a=gc(i,"hdrgm:OffsetHDR","0.015625"),o=/hdrgm:HDRCapacityMin="([^"]*)"/.exec(i),s=o?o[1]:"0",l=/hdrgm:HDRCapacityMax="([^"]*)"/.exec(i);if(!l)throw Error("Incomplete gainmap metadata");let c=l[1];return{gainMapMin:Array.isArray(e)?e.map(e=>parseFloat(e)):[parseFloat(e),parseFloat(e),parseFloat(e)],gainMapMax:Array.isArray(t)?t.map(e=>parseFloat(e)):[parseFloat(t),parseFloat(t),parseFloat(t)],gamma:Array.isArray(r)?r.map(e=>parseFloat(e)):[parseFloat(r),parseFloat(r),parseFloat(r)],offsetSdr:Array.isArray(n)?n.map(e=>parseFloat(e)):[parseFloat(n),parseFloat(n),parseFloat(n)],offsetHdr:Array.isArray(a)?a.map(e=>parseFloat(e)):[parseFloat(a),parseFloat(a),parseFloat(a)],hdrCapacityMin:parseFloat(s),hdrCapacityMax:parseFloat(c)}}catch(e){}r=t.indexOf("<x:xmpmeta",e)}};class gh{constructor(e){this.options={debug:!!e&&void 0!==e.debug&&e.debug,extractFII:!e||void 0===e.extractFII||e.extractFII,extractNonFII:!e||void 0===e.extractNonFII||e.extractNonFII}}extract(e){return new Promise((t,r)=>{let i;let n=this.options.debug,a=new DataView(e.buffer);if(65496!==a.getUint16(0)){r(Error("Not a valid jpeg"));return}let o=a.byteLength,s=2,l=0;for(;s<o;){if(++l>250){r(Error(`Found no marker after ${l} loops 😵`));return}if(255!==a.getUint8(s)){r(Error(`Not a valid marker at offset 0x${s.toString(16)}, found: 0x${a.getUint8(s).toString(16)}`));return}if(i=a.getUint8(s+1),n&&console.log(`Marker: ${i.toString(16)}`),226===i){n&&console.log("Found APP2 marker (0xffe2)");let e=s+4;if(1297106432===a.getUint32(e)){let i;let n=e+4;if(18761===a.getUint16(n))i=!1;else if(19789===a.getUint16(n))i=!0;else{r(Error("No valid endianness marker found in TIFF header"));return}if(42!==a.getUint16(n+2,!i)){r(Error("Not valid TIFF data! (no 0x002A marker)"));return}let o=a.getUint32(n+4,!i);if(o<8){r(Error("Not valid TIFF data! (First offset less than 8)"));return}let s=n+o,l=a.getUint16(s,!i),c=s+2,u=0;for(let e=c;e<c+12*l;e+=12)45057===a.getUint16(e,!i)&&(u=a.getUint32(e+8,!i));let h=s+2+12*l+4,A=[];for(let e=h;e<h+16*u;e+=16){let t={MPType:a.getUint32(e,!i),size:a.getUint32(e+4,!i),dataOffset:a.getUint32(e+8,!i),dependantImages:a.getUint32(e+12,!i),start:-1,end:-1,isFII:!1};t.dataOffset?(t.start=n+t.dataOffset,t.isFII=!1):(t.start=0,t.isFII=!0),t.end=t.start+t.size,A.push(t)}if(this.options.extractNonFII&&A.length){let e=new Blob([a]),r=[];for(let t of A){if(t.isFII&&!this.options.extractFII)continue;let i=e.slice(t.start,t.end+1,"image/jpeg");r.push(i)}t(r)}}}s+=2+a.getUint16(s+2)}})}}let gA=async e=>{let t=gu(e);if(!t)throw new gl("Gain map XMP metadata not found");let r=new gh({extractFII:!0,extractNonFII:!0}),i=await r.extract(e);if(2!==i.length)throw new gs("Gain map recovery image not found");return{sdr:new Uint8Array(await i[0].arrayBuffer()),gainMap:new Uint8Array(await i[1].arrayBuffer()),metadata:t}},gd=e=>new Promise((t,r)=>{let i=document.createElement("img");i.onload=()=>{t(i)},i.onerror=e=>{r(e)},i.src=URL.createObjectURL(e)});class gf extends eT.Loader{constructor(e,t){super(t),e&&(this._renderer=e),this._internalLoadingManager=new eT.LoadingManager}setRenderer(e){return this._renderer=e,this}setRenderTargetOptions(e){return this._renderTargetOptions=e,this}prepareQuadRenderer(){this._renderer||console.warn("WARNING: An existing WebGL Renderer was not passed to this Loader constructor or in setRenderer, the result of this Loader will need to be converted to a Data Texture with toDataTexture() before you can use it in your renderer.");let e=new go({gainMapMax:[1,1,1],gainMapMin:[0,0,0],gamma:[1,1,1],offsetHdr:[1,1,1],offsetSdr:[1,1,1],hdrCapacityMax:1,hdrCapacityMin:0,maxDisplayBoost:1,gainMap:new eT.Texture,sdr:new eT.Texture});return new gi({width:16,height:16,type:eT.HalfFloatType,colorSpace:eT.LinearSRGBColorSpace,material:e,renderer:this._renderer,renderTargetOptions:this._renderTargetOptions})}async render(e,t,r,i){let n,a;let o=i?new Blob([i],{type:"image/jpeg"}):void 0,s=new Blob([r],{type:"image/jpeg"}),l=!1;if("undefined"==typeof createImageBitmap){let e=await Promise.all([o?gd(o):Promise.resolve(void 0),gd(s)]);a=e[0],n=e[1],l=!0}else{let e=await Promise.all([o?createImageBitmap(o,{imageOrientation:"flipY"}):Promise.resolve(void 0),createImageBitmap(s,{imageOrientation:"flipY"})]);a=e[0],n=e[1]}let c=new eT.Texture(a||new ImageData(2,2),eT.UVMapping,eT.ClampToEdgeWrapping,eT.ClampToEdgeWrapping,eT.LinearFilter,eT.LinearMipMapLinearFilter,eT.RGBAFormat,eT.UnsignedByteType,1,eT.LinearSRGBColorSpace);c.flipY=l,c.needsUpdate=!0;let u=new eT.Texture(n,eT.UVMapping,eT.ClampToEdgeWrapping,eT.ClampToEdgeWrapping,eT.LinearFilter,eT.LinearMipMapLinearFilter,eT.RGBAFormat,eT.UnsignedByteType,1,eT.SRGBColorSpace);u.flipY=l,u.needsUpdate=!0,e.width=n.width,e.height=n.height,e.material.gainMap=c,e.material.sdr=u,e.material.gainMapMin=t.gainMapMin,e.material.gainMapMax=t.gainMapMax,e.material.offsetHdr=t.offsetHdr,e.material.offsetSdr=t.offsetSdr,e.material.gamma=t.gamma,e.material.hdrCapacityMin=t.hdrCapacityMin,e.material.hdrCapacityMax=t.hdrCapacityMax,e.material.maxDisplayBoost=Math.pow(2,t.hdrCapacityMax),e.material.needsUpdate=!0,e.render()}}class gm extends gf{load([e,t,r],i,n,a){let o,s,l;let c=this.prepareQuadRenderer(),u=async()=>{if(o&&s&&l){try{await this.render(c,l,o,s)}catch(i){this.manager.itemError(e),this.manager.itemError(t),this.manager.itemError(r),"function"==typeof a&&a(i),c.disposeOnDemandRenderer();return}"function"==typeof i&&i(c),this.manager.itemEnd(e),this.manager.itemEnd(t),this.manager.itemEnd(r),c.disposeOnDemandRenderer()}},h=!0,A=0,d=0,f=!0,m=0,p=0,g=!0,y=0,v=0,E=()=>{if("function"==typeof n){let e=A+m+y,t=d+p+v,r=h&&f&&g;n(new ProgressEvent("progress",{lengthComputable:r,loaded:t,total:e}))}};this.manager.itemStart(e),this.manager.itemStart(t),this.manager.itemStart(r);let x=new eT.FileLoader(this._internalLoadingManager);x.setResponseType("arraybuffer"),x.setRequestHeader(this.requestHeader),x.setPath(this.path),x.setWithCredentials(this.withCredentials),x.load(e,async e=>{if("string"==typeof e)throw Error("Invalid sdr buffer");o=e,await u()},e=>{h=e.lengthComputable,d=e.loaded,A=e.total,E()},t=>{this.manager.itemError(e),"function"==typeof a&&a(t)});let C=new eT.FileLoader(this._internalLoadingManager);C.setResponseType("arraybuffer"),C.setRequestHeader(this.requestHeader),C.setPath(this.path),C.setWithCredentials(this.withCredentials),C.load(t,async e=>{if("string"==typeof e)throw Error("Invalid gainmap buffer");s=e,await u()},e=>{f=e.lengthComputable,p=e.loaded,m=e.total,E()},e=>{this.manager.itemError(t),"function"==typeof a&&a(e)});let B=new eT.FileLoader(this._internalLoadingManager);return B.setRequestHeader(this.requestHeader),B.setPath(this.path),B.setWithCredentials(this.withCredentials),B.load(r,async e=>{if("string"!=typeof e)throw Error("Invalid metadata string");l=JSON.parse(e),await u()},e=>{g=e.lengthComputable,v=e.loaded,y=e.total,E()},e=>{this.manager.itemError(r),"function"==typeof a&&a(e)}),c}}class gp extends gf{load(e,t,r,i){let n=this.prepareQuadRenderer(),a=new eT.FileLoader(this._internalLoadingManager);return a.setResponseType("arraybuffer"),a.setRequestHeader(this.requestHeader),a.setPath(this.path),a.setWithCredentials(this.withCredentials),this.manager.itemStart(e),a.load(e,async r=>{let a,o,s;if("string"==typeof r)throw Error("Invalid buffer, received [string], was expecting [ArrayBuffer]");let l=new Uint8Array(r);try{let e=await gA(l);a=e.sdr,o=e.gainMap,s=e.metadata}catch(t){if(t instanceof gl||t instanceof gs)console.warn(`Failure to reconstruct an HDR image from ${e}: Gain map metadata not found in the file, HDRJPGLoader will render the SDR jpeg`),s={gainMapMin:[0,0,0],gainMapMax:[1,1,1],gamma:[1,1,1],hdrCapacityMin:0,hdrCapacityMax:1,offsetHdr:[0,0,0],offsetSdr:[0,0,0]},a=l;else throw t}try{await this.render(n,s,a,o)}catch(t){this.manager.itemError(e),"function"==typeof i&&i(t),n.disposeOnDemandRenderer();return}"function"==typeof t&&t(n),this.manager.itemEnd(e),n.disposeOnDemandRenderer()},r,t=>{this.manager.itemError(e),"function"==typeof i&&i(t)}),n}}let gg={apartment:"lebombo_1k.hdr",city:"potsdamer_platz_1k.hdr",dawn:"kiara_1_dawn_1k.hdr",forest:"forest_slope_1k.hdr",lobby:"st_fagans_interior_1k.hdr",night:"dikhololo_night_1k.hdr",park:"rooitou_park_1k.hdr",studio:"studio_small_03_1k.hdr",sunset:"venice_sunset_1k.hdr",warehouse:"empty_warehouse_01_1k.hdr"},gy="https://raw.githack.com/pmndrs/drei-assets/456060a26bbeb8fdf79326f224b6d99b8bcce736/hdri/",gv=e=>Array.isArray(e),gE=["/px.png","/nx.png","/py.png","/ny.png","/pz.png","/nz.png"];function gx({files:e=gE,path:t="",preset:r,encoding:i,extensions:n}={}){let a=null,o=!1;r&&(gw(r),e=gg[r],t=gy),o=gv(e);let{extension:s,isCubemap:l}=gI(e);if(!(a=gb(s)))throw Error("useEnvironment: Unrecognized file extension: "+e);let c=(0,eR.D)(e=>e.gl);(0,eS.useLayoutEffect)(()=>{("webp"===s||"jpg"===s||"jpeg"===s)&&c.domElement.addEventListener("webglcontextlost",function(){eR.H.clear(a,o?[e]:e)},{once:!0})},[e,c.domElement]);let u=(0,eR.H)(a,o?[e]:e,e=>{("webp"===s||"jpg"===s||"jpeg"===s)&&e.setRenderer(c),null==e.setPath||e.setPath(t),n&&n(e)}),h=o?u[0]:u;if("jpg"===s||"jpeg"===s||"webp"===s){var A;h=null==(A=h.renderTarget)?void 0:A.texture}return h.mapping=l?eT.CubeReflectionMapping:eT.EquirectangularReflectionMapping,"colorSpace"in h?h.colorSpace=(null!=i?i:l)?"srgb":"srgb-linear":h.encoding=(null!=i?i:l)?3001:3e3,h}let gC={files:gE,path:"",preset:void 0,extensions:void 0};gx.preload=e=>{let t={...gC,...e},{files:r,path:i=""}=t,{preset:n,extensions:a}=t;n&&(gw(n),r=gg[n],i=gy);let{extension:o}=gI(r);if("webp"===o||"jpg"===o||"jpeg"===o)throw Error("useEnvironment: Preloading gainmaps is not supported");let s=gb(o);if(!s)throw Error("useEnvironment: Unrecognized file extension: "+r);eR.H.preload(s,gv(r)?[r]:r,e=>{null==e.setPath||e.setPath(i),a&&a(e)})};let gB={files:gE,preset:void 0};function gw(e){if(!(e in gg))throw Error("Preset must be one of: "+Object.keys(gg).join(", "))}function gI(e){var t;let r=gv(e)&&6===e.length,i=gv(e)&&3===e.length&&e.some(e=>e.endsWith("json")),n=gv(e)?e[0]:e;return{extension:r?"cube":i?"webp":n.startsWith("data:application/exr")?"exr":n.startsWith("data:application/hdr")?"hdr":n.startsWith("data:image/jpeg")?"jpg":null==(t=n.split(".").pop())||null==(t=t.split("?"))||null==(t=t.shift())?void 0:t.toLowerCase(),isCubemap:r,isGainmap:i}}function gb(e){return"cube"===e?eT.CubeTextureLoader:"hdr"===e?p9:"exr"===e?ge:"jpg"===e||"jpeg"===e?gp:"webp"===e?gm:null}gx.clear=e=>{let t={...gB,...e},{files:r}=t,{preset:i}=t;i&&(gw(i),r=gg[i]);let{extension:n}=gI(r),a=gb(n);if(!a)throw Error("useEnvironment: Unrecognized file extension: "+r);eR.H.clear(a,gv(r)?[r]:r)};let g_=e=>e.current&&e.current.isScene,gM=e=>g_(e)?e.current:e;function gS(e,t,r,i,n={}){var a,o,s,l;n={backgroundBlurriness:0,backgroundIntensity:1,backgroundRotation:[0,0,0],environmentIntensity:1,environmentRotation:[0,0,0],...n};let c=gM(t||r),u=c.background,h=c.environment,A={backgroundBlurriness:c.backgroundBlurriness,backgroundIntensity:c.backgroundIntensity,backgroundRotation:null!==(a=null==(o=c.backgroundRotation)||null==o.clone?void 0:o.clone())&&void 0!==a?a:[0,0,0],environmentIntensity:c.environmentIntensity,environmentRotation:null!==(s=null==(l=c.environmentRotation)||null==l.clone?void 0:l.clone())&&void 0!==s?s:[0,0,0]};return"only"!==e&&(c.environment=i),e&&(c.background=i),(0,eR.k)(c,n),()=>{"only"!==e&&(c.environment=h),e&&(c.background=u),(0,eR.k)(c,A)}}function gD({scene:e,background:t=!1,map:r,...i}){let n=(0,eR.D)(e=>e.scene);return eS.useLayoutEffect(()=>{if(r)return gS(t,e,n,r,i)}),null}function gT({background:e=!1,scene:t,blur:r,backgroundBlurriness:i,backgroundIntensity:n,backgroundRotation:a,environmentIntensity:o,environmentRotation:s,...l}){let c=gx(l),u=(0,eR.D)(e=>e.scene);return eS.useLayoutEffect(()=>gS(e,t,u,c,{backgroundBlurriness:null!=r?r:i,backgroundIntensity:n,backgroundRotation:a,environmentIntensity:o,environmentRotation:s})),eS.useEffect(()=>()=>{c.dispose()},[c]),null}function gR({children:e,near:t=.1,far:r=1e3,resolution:i=256,frames:n=1,map:a,background:o=!1,blur:s,backgroundBlurriness:l,backgroundIntensity:c,backgroundRotation:u,environmentIntensity:h,environmentRotation:A,scene:d,files:f,path:m,preset:p,extensions:g}){let y=(0,eR.D)(e=>e.gl),v=(0,eR.D)(e=>e.scene),E=eS.useRef(null),[x]=eS.useState(()=>new eT.Scene),C=eS.useMemo(()=>{let e=new eT.WebGLCubeRenderTarget(i);return e.texture.type=eT.HalfFloatType,e},[i]);eS.useEffect(()=>()=>{C.dispose()},[C]),eS.useLayoutEffect(()=>{if(1===n){let e=y.autoClear;y.autoClear=!0,E.current.update(y,x),y.autoClear=e}return gS(o,d,v,C.texture,{backgroundBlurriness:null!=s?s:l,backgroundIntensity:c,backgroundRotation:u,environmentIntensity:h,environmentRotation:A})},[e,x,C.texture,d,v,o,n,y]);let B=1;return(0,eR.F)(()=>{if(n===1/0||B<n){let e=y.autoClear;y.autoClear=!0,E.current.update(y,x),y.autoClear=e,B++}}),eS.createElement(eS.Fragment,null,(0,eR.h)(eS.createElement(eS.Fragment,null,e,eS.createElement("cubeCamera",{ref:E,args:[t,r,C]}),f||p?eS.createElement(gT,{background:!0,files:f,preset:p,path:m,extensions:g}):a?eS.createElement(gD,{background:!0,map:a,extensions:g}):null),x))}function gF(e){var t,r,i,n;let a=gx(e),o=e.map||a;eS.useMemo(()=>(0,eR.e)({GroundProjectedEnvImpl:p8}),[]),eS.useEffect(()=>()=>{a.dispose()},[a]);let s=eS.useMemo(()=>[o],[o]),l=null==(t=e.ground)?void 0:t.height,c=null==(r=e.ground)?void 0:r.radius,u=null!==(i=null==(n=e.ground)?void 0:n.scale)&&void 0!==i?i:1e3;return eS.createElement(eS.Fragment,null,eS.createElement(gD,j({},e,{map:o})),eS.createElement("groundProjectedEnvImpl",{args:s,scale:u,height:l,radius:c}))}function gP(e){return e.ground?eS.createElement(gF,e):e.map?eS.createElement(gD,e):e.children?eS.createElement(gR,e):eS.createElement(gT,e)}let gQ={uniforms:{tDiffuse:{value:null},h:{value:1/512}},vertexShader:`
      varying vec2 vUv;

      void main() {

        vUv = uv;
        gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

      }
  `,fragmentShader:`
    uniform sampler2D tDiffuse;
    uniform float h;

    varying vec2 vUv;

    void main() {

    	vec4 sum = vec4( 0.0 );

    	sum += texture2D( tDiffuse, vec2( vUv.x - 4.0 * h, vUv.y ) ) * 0.051;
    	sum += texture2D( tDiffuse, vec2( vUv.x - 3.0 * h, vUv.y ) ) * 0.0918;
    	sum += texture2D( tDiffuse, vec2( vUv.x - 2.0 * h, vUv.y ) ) * 0.12245;
    	sum += texture2D( tDiffuse, vec2( vUv.x - 1.0 * h, vUv.y ) ) * 0.1531;
    	sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;
    	sum += texture2D( tDiffuse, vec2( vUv.x + 1.0 * h, vUv.y ) ) * 0.1531;
    	sum += texture2D( tDiffuse, vec2( vUv.x + 2.0 * h, vUv.y ) ) * 0.12245;
    	sum += texture2D( tDiffuse, vec2( vUv.x + 3.0 * h, vUv.y ) ) * 0.0918;
    	sum += texture2D( tDiffuse, vec2( vUv.x + 4.0 * h, vUv.y ) ) * 0.051;

    	gl_FragColor = sum;

    }
  `},gz={uniforms:{tDiffuse:{value:null},v:{value:1/512}},vertexShader:`
    varying vec2 vUv;

    void main() {

      vUv = uv;
      gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

    }
  `,fragmentShader:`

  uniform sampler2D tDiffuse;
  uniform float v;

  varying vec2 vUv;

  void main() {

    vec4 sum = vec4( 0.0 );

    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 4.0 * v ) ) * 0.051;
    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 3.0 * v ) ) * 0.0918;
    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 2.0 * v ) ) * 0.12245;
    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 1.0 * v ) ) * 0.1531;
    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;
    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 1.0 * v ) ) * 0.1531;
    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 2.0 * v ) ) * 0.12245;
    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 3.0 * v ) ) * 0.0918;
    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 4.0 * v ) ) * 0.051;

    gl_FragColor = sum;

  }
  `},gL=eS.forwardRef(({scale:e=10,frames:t=1/0,opacity:r=1,width:i=1,height:n=1,blur:a=1,near:o=0,far:s=10,resolution:l=512,smooth:c=!0,color:u="#000000",depthWrite:h=!1,renderOrder:A,...d},f)=>{let m,p;let g=eS.useRef(null),y=(0,eR.D)(e=>e.scene),v=(0,eR.D)(e=>e.gl),E=eS.useRef(null);i*=Array.isArray(e)?e[0]:e||1,n*=Array.isArray(e)?e[1]:e||1;let[x,C,B,w,I,b,_]=eS.useMemo(()=>{let e=new eT.WebGLRenderTarget(l,l),t=new eT.WebGLRenderTarget(l,l);t.texture.generateMipmaps=e.texture.generateMipmaps=!1;let r=new eT.PlaneGeometry(i,n).rotateX(Math.PI/2),a=new eT.Mesh(r),o=new eT.MeshDepthMaterial;o.depthTest=o.depthWrite=!1,o.onBeforeCompile=e=>{e.uniforms={...e.uniforms,ucolor:{value:new eT.Color(u)}},e.fragmentShader=e.fragmentShader.replace("void main() {",`uniform vec3 ucolor;
           void main() {
          `),e.fragmentShader=e.fragmentShader.replace("vec4( vec3( 1.0 - fragCoordZ ), opacity );","vec4( ucolor * fragCoordZ * 2.0, ( 1.0 - fragCoordZ ) * 1.0 );")};let s=new eT.ShaderMaterial(gQ),c=new eT.ShaderMaterial(gz);return c.depthTest=s.depthTest=!1,[e,r,o,a,s,c,t]},[l,i,n,e,u]),M=e=>{w.visible=!0,w.material=I,I.uniforms.tDiffuse.value=x.texture,I.uniforms.h.value=1*e/256,v.setRenderTarget(_),v.render(w,E.current),w.material=b,b.uniforms.tDiffuse.value=_.texture,b.uniforms.v.value=1*e/256,v.setRenderTarget(x),v.render(w,E.current),w.visible=!1},S=0;return(0,eR.F)(()=>{E.current&&(t===1/0||S<t)&&(S++,m=y.background,p=y.overrideMaterial,g.current.visible=!1,y.background=null,y.overrideMaterial=B,v.setRenderTarget(x),v.render(y,E.current),M(a),c&&M(.4*a),v.setRenderTarget(null),g.current.visible=!0,y.overrideMaterial=p,y.background=m)}),eS.useImperativeHandle(f,()=>g.current,[]),eS.createElement("group",j({"rotation-x":Math.PI/2},d,{ref:g}),eS.createElement("mesh",{renderOrder:A,geometry:C,scale:[1,-1,1],rotation:[-Math.PI/2,0,0]},eS.createElement("meshBasicMaterial",{transparent:!0,map:x.texture,opacity:r,depthWrite:h})),eS.createElement("orthographicCamera",{ref:E,args:[-i/2,i/2,n/2,-n/2,o,s]}))}),gO=eS.createContext(null),gU=sx({color:new eT.Color,blend:2,alphaTest:.75,opacity:0,map:null},`varying vec2 vUv;
   void main() {
     gl_Position = projectionMatrix * viewMatrix * modelMatrix * vec4(position, 1.);
     vUv = uv;
   }`,`varying vec2 vUv;
   uniform sampler2D map;
   uniform vec3 color;
   uniform float opacity;
   uniform float alphaTest;
   uniform float blend;
   void main() {
     vec4 sampledDiffuseColor = texture2D(map, vUv);
     gl_FragColor = vec4(color * sampledDiffuseColor.r * blend, max(0.0, (1.0 - (sampledDiffuseColor.r + sampledDiffuseColor.g + sampledDiffuseColor.b) / alphaTest)) * opacity);
     #include <tonemapping_fragment>
     #include <${sI>=154?"colorspace_fragment":"encodings_fragment"}>
   }`),gk=eS.forwardRef(({children:e,temporal:t,frames:r=40,limit:i=1/0,blend:n=20,scale:a=10,opacity:o=1,alphaTest:s=.75,color:l="black",colorBlend:c=2,resolution:u=1024,toneMapped:h=!0,...A},d)=>{(0,eR.e)({SoftShadowMaterial:gU});let f=(0,eR.D)(e=>e.gl),m=(0,eR.D)(e=>e.scene),p=(0,eR.D)(e=>e.camera),g=(0,eR.D)(e=>e.invalidate),y=eS.useRef(null),v=eS.useRef(null),[E]=eS.useState(()=>new gN(f,m,u));eS.useLayoutEffect(()=>{E.configure(y.current)},[]);let x=eS.useMemo(()=>({lights:new Map,temporal:!!t,frames:Math.max(2,r),blend:Math.max(2,r===1/0?n:r),count:0,getMesh:()=>y.current,reset:()=>{E.clear();let e=y.current.material;e.opacity=0,e.alphaTest=0,x.count=0},update:(e=1)=>{let t=y.current.material;x.temporal?(t.opacity=Math.min(o,t.opacity+o/x.blend),t.alphaTest=Math.min(s,t.alphaTest+s/x.blend)):(t.opacity=o,t.alphaTest=s),v.current.visible=!0,E.prepare();for(let t=0;t<e;t++)x.lights.forEach(e=>e.update()),E.update(p,x.blend);v.current.visible=!1,E.finish()}}),[E,p,m,t,r,n,o,s]);return eS.useLayoutEffect(()=>{x.reset(),x.temporal||x.frames===1/0||x.update(x.blend)}),eS.useImperativeHandle(d,()=>x,[x]),(0,eR.F)(()=>{(x.temporal||x.frames===1/0)&&x.count<x.frames&&x.count<i&&(g(),x.update(),x.count++)}),eS.createElement("group",A,eS.createElement("group",{traverse:()=>null,ref:v},eS.createElement(gO.Provider,{value:x},e)),eS.createElement("mesh",{receiveShadow:!0,ref:y,scale:a,rotation:[-Math.PI/2,0,0]},eS.createElement("planeGeometry",null),eS.createElement("softShadowMaterial",{transparent:!0,depthWrite:!1,toneMapped:h,color:l,blend:c,map:E.progressiveLightMap2.texture})))}),gG=eS.forwardRef(({castShadow:e=!0,bias:t=.001,mapSize:r=512,size:i=5,near:n=.5,far:a=500,frames:o=1,position:s=[0,0,0],radius:l=1,amount:c=8,intensity:u=sI>=155?Math.PI:1,ambient:h=.5,...A},d)=>{let f=eS.useRef(null),m=new eT.Vector3(...s).length(),p=eS.useContext(gO),g=eS.useCallback(()=>{let e;if(f.current)for(let t=0;t<f.current.children.length;t++)if(e=f.current.children[t],Math.random()>h)e.position.set(s[0]+eT.MathUtils.randFloatSpread(l),s[1]+eT.MathUtils.randFloatSpread(l),s[2]+eT.MathUtils.randFloatSpread(l));else{let t=Math.acos(2*Math.random()-1)-Math.PI/2,r=2*Math.PI*Math.random();e.position.set(Math.cos(t)*Math.cos(r)*m,Math.abs(Math.cos(t)*Math.sin(r)*m),Math.sin(t)*m)}},[l,h,m,...s]),y=eS.useMemo(()=>({update:g}),[g]);return eS.useImperativeHandle(d,()=>y,[y]),eS.useLayoutEffect(()=>{var e;let t=f.current;return p&&(null==(e=p.lights)||e.set(t.uuid,y)),()=>{var e;null==p||null==(e=p.lights)||e.delete(t.uuid)}},[p,y]),eS.createElement("group",j({ref:f},A),Array.from({length:c},(o,s)=>eS.createElement("directionalLight",{key:s,castShadow:e,"shadow-bias":t,"shadow-mapSize":[r,r],intensity:u/c},eS.createElement("orthographicCamera",{attach:"shadow-camera",args:[-i,i,i,-i,n,a]}))))});class gN{constructor(e,t,r=1024){this.renderer=e,this.res=r,this.scene=t,this.buffer1Active=!1,this.lights=[],this.meshes=[],this.object=null,this.clearColor=new eT.Color,this.clearAlpha=0;let i={type:eT.HalfFloatType,magFilter:eT.NearestFilter,minFilter:eT.NearestFilter};this.progressiveLightMap1=new eT.WebGLRenderTarget(this.res,this.res,i),this.progressiveLightMap2=new eT.WebGLRenderTarget(this.res,this.res,i),this.discardMat=new pA,this.targetMat=new eT.MeshLambertMaterial({fog:!1}),this.previousShadowMap={value:this.progressiveLightMap1.texture},this.averagingWindow={value:100},this.targetMat.onBeforeCompile=e=>{e.vertexShader="varying vec2 vUv;\n"+e.vertexShader.slice(0,-1)+"vUv = uv; gl_Position = vec4((uv - 0.5) * 2.0, 1.0, 1.0); }";let t=e.fragmentShader.indexOf("void main() {");e.fragmentShader="varying vec2 vUv;\n"+e.fragmentShader.slice(0,t)+"uniform sampler2D previousShadowMap;\n	uniform float averagingWindow;\n"+e.fragmentShader.slice(t-1,-1)+`
vec3 texelOld = texture2D(previousShadowMap, vUv).rgb;
        gl_FragColor.rgb = mix(texelOld, gl_FragColor.rgb, 1.0/ averagingWindow);
      }`,e.uniforms.previousShadowMap=this.previousShadowMap,e.uniforms.averagingWindow=this.averagingWindow}}clear(){this.renderer.getClearColor(this.clearColor),this.clearAlpha=this.renderer.getClearAlpha(),this.renderer.setClearColor("black",1),this.renderer.setRenderTarget(this.progressiveLightMap1),this.renderer.clear(),this.renderer.setRenderTarget(this.progressiveLightMap2),this.renderer.clear(),this.renderer.setRenderTarget(null),this.renderer.setClearColor(this.clearColor,this.clearAlpha),this.lights=[],this.meshes=[],this.scene.traverse(e=>{e.geometry?this.meshes.push({object:e,material:e.material}):e.isLight&&this.lights.push({object:e,intensity:e.intensity})})}prepare(){this.lights.forEach(e=>e.object.intensity=0),this.meshes.forEach(e=>e.object.material=this.discardMat)}finish(){this.lights.forEach(e=>e.object.intensity=e.intensity),this.meshes.forEach(e=>e.object.material=e.material)}configure(e){this.object=e}update(e,t=100){if(!this.object)return;this.averagingWindow.value=t,this.object.material=this.targetMat;let r=this.buffer1Active?this.progressiveLightMap1:this.progressiveLightMap2,i=this.buffer1Active?this.progressiveLightMap2:this.progressiveLightMap1,n=this.scene.background;this.scene.background=null,this.renderer.setRenderTarget(r),this.previousShadowMap.value=i.texture,this.buffer1Active=!this.buffer1Active,this.renderer.render(this.scene,e),this.renderer.setRenderTarget(null),this.scene.background=n}}let gH={rembrandt:{main:[1,2,1],fill:[-2,-.5,-2]},portrait:{main:[-1,2,.5],fill:[-1,.5,-1.5]},upfront:{main:[0,2,1],fill:[-1,.5,-1.5]},soft:{main:[-2,4,4],fill:[-1,.5,-1.5]}};function gV({radius:e,adjustCamera:t}){let r=p$();return eS.useEffect(()=>{t&&r.refresh().clip().fit()},[e,t]),null}function gj({children:e,center:t,adjustCamera:r=!0,intensity:i=.5,shadows:n="contact",environment:a="city",preset:o="rembrandt",...s}){var l,c,u,h,A,d,f,m;let p="string"==typeof o?gH[o]:o,[{radius:g,height:y},v]=eS.useState({radius:0,width:0,height:0,depth:0}),E=null!==(l=null==n?void 0:n.bias)&&void 0!==l?l:-.0001,x=null!==(c=null==n?void 0:n.normalBias)&&void 0!==c?c:0,C=null!==(u=null==n?void 0:n.size)&&void 0!==u?u:1024,B=null!==(h=null==n?void 0:n.offset)&&void 0!==h?h:0,w="contact"===n||(null==n?void 0:n.type)==="contact",I="accumulative"===n||(null==n?void 0:n.type)==="accumulative",b={..."object"==typeof n?n:{}},_=a?"string"==typeof a?{preset:a}:a:null,M=eS.useCallback(e=>{let{width:r,height:i,depth:n,boundingSphere:a}=e;v({radius:a.radius,width:r,height:i,depth:n}),null!=t&&t.onCentered&&t.onCentered(e)},[]);return eS.createElement(eS.Fragment,null,eS.createElement("ambientLight",{intensity:i/3}),eS.createElement("spotLight",{penumbra:1,position:[p.main[0]*g,p.main[1]*g,p.main[2]*g],intensity:2*i,castShadow:!!n,"shadow-bias":E,"shadow-normalBias":x,"shadow-mapSize":C}),eS.createElement("pointLight",{position:[p.fill[0]*g,p.fill[1]*g,p.fill[2]*g],intensity:i}),eS.createElement(pZ,j({fit:!!r,clip:!!r,margin:Number(r),observe:!0},s),eS.createElement(gV,{radius:g,adjustCamera:r}),eS.createElement(mv,j({},t,{position:[0,B/2,0],onCentered:M}),e)),eS.createElement("group",{position:[0,-y/2-B/2,0]},w&&eS.createElement(gL,j({scale:4*g,far:g,blur:2},b)),I&&eS.createElement(gk,j({temporal:!0,frames:100,alphaTest:.9,toneMapped:!0,scale:4*g},b),eS.createElement(gG,{amount:null!==(A=b.amount)&&void 0!==A?A:8,radius:null!==(d=b.radius)&&void 0!==d?d:g,ambient:null!==(f=b.ambient)&&void 0!==f?f:.5,intensity:null!==(m=b.intensity)&&void 0!==m?m:1,position:[p.main[0]*g,p.main[1]*g,p.main[2]*g],size:4*g,bias:-E,mapSize:C}))),a&&eS.createElement(gP,_))}let gJ=e=>0===e?0:Math.pow(2,10*e-10);function gY({children:e,floor:t=.25,segments:r=20,receiveShadow:i,...n}){let a=eS.useRef(null);return eS.useLayoutEffect(()=>{let e=0,i=r/r/2,n=a.current.attributes.position;for(let a=0;a<r+1;a++)for(let o=0;o<r+1;o++)n.setXYZ(e++,a/r-i+(0===a?-t:0),o/r-i,gJ(a/r));n.needsUpdate=!0,a.current.computeVertexNormals()},[r,t]),eS.createElement("group",n,eS.createElement("mesh",{receiveShadow:i,rotation:[-Math.PI/2,0,Math.PI/2]},eS.createElement("planeGeometry",{ref:a,args:[1,1,r,r]}),e))}let gW=eS.forwardRef(({fog:e=!1,renderOrder:t,depthWrite:r=!1,colorStop:i=0,color:n="black",opacity:a=.5,...o},s)=>{let l=eS.useMemo(()=>{let e=document.createElement("canvas");e.width=128,e.height=128;let t=e.getContext("2d"),r=t.createRadialGradient(e.width/2,e.height/2,0,e.width/2,e.height/2,e.width/2);return r.addColorStop(i,new eT.Color(n).getStyle()),r.addColorStop(1,"rgba(0,0,0,0)"),t.fillStyle=r,t.fillRect(0,0,e.width,e.height),e},[n,i]);return eS.createElement("mesh",j({renderOrder:t,ref:s,"rotation-x":-Math.PI/2},o),eS.createElement("planeGeometry",null),eS.createElement("meshBasicMaterial",{transparent:!0,opacity:a,fog:e,depthWrite:r,side:eT.DoubleSide},eS.createElement("canvasTexture",{attach:"map",args:[l]})))});function gK(e=eT.FrontSide){let t={value:new eT.Matrix4};return Object.assign(new eT.MeshNormalMaterial({side:e}),{viewMatrix:t,onBeforeCompile:e=>{e.uniforms.viewMatrix=t,e.fragmentShader=`vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
           return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
         }
`+e.fragmentShader.replace("#include <normal_fragment_maps>",`#include <normal_fragment_maps>
           normal = inverseTransformDirection( normal, viewMatrix );
`)}})}let gq=sx({causticsTexture:null,causticsTextureB:null,color:new eT.Color,lightProjMatrix:new eT.Matrix4,lightViewMatrix:new eT.Matrix4},`varying vec3 vWorldPosition;
   void main() {
     gl_Position = projectionMatrix * viewMatrix * modelMatrix * vec4(position, 1.);
     vec4 worldPosition = modelMatrix * vec4(position, 1.);
     vWorldPosition = worldPosition.xyz;
   }`,`varying vec3 vWorldPosition;
  uniform vec3 color;
  uniform sampler2D causticsTexture;
  uniform sampler2D causticsTextureB;
  uniform mat4 lightProjMatrix;
  uniform mat4 lightViewMatrix;
   void main() {
    // Apply caustics
    vec4 lightSpacePos = lightProjMatrix * lightViewMatrix * vec4(vWorldPosition, 1.0);
    lightSpacePos.xyz /= lightSpacePos.w;
    lightSpacePos.xyz = lightSpacePos.xyz * 0.5 + 0.5;
    vec3 front = texture2D(causticsTexture, lightSpacePos.xy).rgb;
    vec3 back = texture2D(causticsTextureB, lightSpacePos.xy).rgb;
    gl_FragColor = vec4((front + back) * color, 1.0);
    #include <tonemapping_fragment>
    #include <${sI>=154?"colorspace_fragment":"encodings_fragment"}>
   }`),gX=sx({cameraMatrixWorld:new eT.Matrix4,cameraProjectionMatrixInv:new eT.Matrix4,normalTexture:null,depthTexture:null,lightDir:new eT.Vector3(0,1,0),lightPlaneNormal:new eT.Vector3(0,1,0),lightPlaneConstant:0,near:.1,far:100,modelMatrix:new eT.Matrix4,worldRadius:1/40,ior:1.1,bounces:0,resolution:1024,size:10,intensity:.5},`
  varying vec2 vUv;
  void main() {
      vUv = uv;
      gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
  }`,`
  uniform mat4 cameraMatrixWorld;
  uniform mat4 cameraProjectionMatrixInv;
  uniform vec3 lightDir;
  uniform vec3 lightPlaneNormal;
  uniform float lightPlaneConstant;
  uniform float near;
  uniform float far;
  uniform float time;
  uniform float worldRadius;
  uniform float resolution;
  uniform float size;
  uniform float intensity;
  uniform float ior;
  precision highp isampler2D;
  precision highp usampler2D;
  uniform sampler2D normalTexture;
  uniform sampler2D depthTexture;
  uniform float bounces;
  varying vec2 vUv;
  vec3 WorldPosFromDepth(float depth, vec2 coord) {
    float z = depth * 2.0 - 1.0;
    vec4 clipSpacePosition = vec4(coord * 2.0 - 1.0, z, 1.0);
    vec4 viewSpacePosition = cameraProjectionMatrixInv * clipSpacePosition;
    // Perspective division
    viewSpacePosition /= viewSpacePosition.w;
    vec4 worldSpacePosition = cameraMatrixWorld * viewSpacePosition;
    return worldSpacePosition.xyz;
  }
  float sdPlane( vec3 p, vec3 n, float h ) {
    // n must be normalized
    return dot(p,n) + h;
  }
  float planeIntersect( vec3 ro, vec3 rd, vec4 p ) {
    return -(dot(ro,p.xyz)+p.w)/dot(rd,p.xyz);
  }
  vec3 totalInternalReflection(vec3 ro, vec3 rd, vec3 pos, vec3 normal, float ior, out vec3 rayOrigin, out vec3 rayDirection) {
    rayOrigin = ro;
    rayDirection = rd;
    rayDirection = refract(rayDirection, normal, 1.0 / ior);
    rayOrigin = pos + rayDirection * 0.1;
    return rayDirection;
  }
  void main() {
    // Each sample consists of random offset in the x and y direction
    float caustic = 0.0;
    float causticTexelSize = (1.0 / resolution) * size * 2.0;
    float texelsNeeded = worldRadius / causticTexelSize;
    float sampleRadius = texelsNeeded / resolution;
    float sum = 0.0;
    if (texture2D(depthTexture, vUv).x == 1.0) {
      gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);
      return;
    }
    vec2 offset1 = vec2(-0.5, -0.5);//vec2(rand() - 0.5, rand() - 0.5);
    vec2 offset2 = vec2(-0.5, 0.5);//vec2(rand() - 0.5, rand() - 0.5);
    vec2 offset3 = vec2(0.5, 0.5);//vec2(rand() - 0.5, rand() - 0.5);
    vec2 offset4 = vec2(0.5, -0.5);//vec2(rand() - 0.5, rand() - 0.5);
    vec2 uv1 = vUv + offset1 * sampleRadius;
    vec2 uv2 = vUv + offset2 * sampleRadius;
    vec2 uv3 = vUv + offset3 * sampleRadius;
    vec2 uv4 = vUv + offset4 * sampleRadius;
    vec3 normal1 = texture2D(normalTexture, uv1, -10.0).rgb * 2.0 - 1.0;
    vec3 normal2 = texture2D(normalTexture, uv2, -10.0).rgb * 2.0 - 1.0;
    vec3 normal3 = texture2D(normalTexture, uv3, -10.0).rgb * 2.0 - 1.0;
    vec3 normal4 = texture2D(normalTexture, uv4, -10.0).rgb * 2.0 - 1.0;
    float depth1 = texture2D(depthTexture, uv1, -10.0).x;
    float depth2 = texture2D(depthTexture, uv2, -10.0).x;
    float depth3 = texture2D(depthTexture, uv3, -10.0).x;
    float depth4 = texture2D(depthTexture, uv4, -10.0).x;
    // Sanity check the depths
    if (depth1 == 1.0 || depth2 == 1.0 || depth3 == 1.0 || depth4 == 1.0) {
      gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);
      return;
    }
    vec3 pos1 = WorldPosFromDepth(depth1, uv1);
    vec3 pos2 = WorldPosFromDepth(depth2, uv2);
    vec3 pos3 = WorldPosFromDepth(depth3, uv3);
    vec3 pos4 = WorldPosFromDepth(depth4, uv4);
    vec3 originPos1 = WorldPosFromDepth(0.0, uv1);
    vec3 originPos2 = WorldPosFromDepth(0.0, uv2);
    vec3 originPos3 = WorldPosFromDepth(0.0, uv3);
    vec3 originPos4 = WorldPosFromDepth(0.0, uv4);
    vec3 endPos1, endPos2, endPos3, endPos4;
    vec3 endDir1, endDir2, endDir3, endDir4;
    totalInternalReflection(originPos1, lightDir, pos1, normal1, ior, endPos1, endDir1);
    totalInternalReflection(originPos2, lightDir, pos2, normal2, ior, endPos2, endDir2);
    totalInternalReflection(originPos3, lightDir, pos3, normal3, ior, endPos3, endDir3);
    totalInternalReflection(originPos4, lightDir, pos4, normal4, ior, endPos4, endDir4);
    float lightPosArea = length(cross(originPos2 - originPos1, originPos3 - originPos1)) + length(cross(originPos3 - originPos1, originPos4 - originPos1));
    float t1 = planeIntersect(endPos1, endDir1, vec4(lightPlaneNormal, lightPlaneConstant));
    float t2 = planeIntersect(endPos2, endDir2, vec4(lightPlaneNormal, lightPlaneConstant));
    float t3 = planeIntersect(endPos3, endDir3, vec4(lightPlaneNormal, lightPlaneConstant));
    float t4 = planeIntersect(endPos4, endDir4, vec4(lightPlaneNormal, lightPlaneConstant));
    vec3 finalPos1 = endPos1 + endDir1 * t1;
    vec3 finalPos2 = endPos2 + endDir2 * t2;
    vec3 finalPos3 = endPos3 + endDir3 * t3;
    vec3 finalPos4 = endPos4 + endDir4 * t4;
    float finalArea = length(cross(finalPos2 - finalPos1, finalPos3 - finalPos1)) + length(cross(finalPos3 - finalPos1, finalPos4 - finalPos1));
    caustic += intensity * (lightPosArea / finalArea);
    // Calculate the area of the triangle in light spaces
    gl_FragColor = vec4(vec3(max(caustic, 0.0)), 1.0);
  }`),gZ={depth:!0,minFilter:eT.LinearFilter,magFilter:eT.LinearFilter,type:eT.UnsignedByteType},g$={minFilter:eT.LinearMipmapLinearFilter,magFilter:eT.LinearFilter,type:eT.FloatType,generateMipmaps:!0},g1=eS.forwardRef(({debug:e,children:t,frames:r=1,ior:i=1.1,color:n="white",causticsOnly:a=!1,backside:o=!1,backsideIOR:s=1.1,worldRadius:l=.3125,intensity:c=.05,resolution:u=2024,lightSource:h=[5,5,5],...A},d)=>{(0,eR.e)({CausticsProjectionMaterial:gq});let f=eS.useRef(null),m=eS.useRef(null),p=eS.useRef(null),g=eS.useRef(null),y=(0,eR.D)(e=>e.gl),v=A0(e&&m,eT.CameraHelper),E=cu(u,u,gZ),x=cu(u,u,gZ),C=cu(u,u,g$),B=cu(u,u,g$),[w]=eS.useState(()=>gK()),[I]=eS.useState(()=>gK(eT.BackSide)),[b]=eS.useState(()=>new gX),[_]=eS.useState(()=>new o9(b));eS.useLayoutEffect(()=>{f.current.updateWorldMatrix(!1,!0)});let M=0,S=new eT.Vector3,D=new eT.Frustum,T=new eT.Matrix4,R=new eT.Plane,F=new eT.Vector3,P=new eT.Vector3,Q=new eT.Box3,z=new eT.Vector3,L=[],O=[],U=[],k=[],G=new eT.Vector3;for(let e=0;e<8;e++)L.push(new eT.Vector3),O.push(new eT.Vector3),U.push(new eT.Vector3),k.push(new eT.Vector3);return(0,eR.F)(()=>{if(r===1/0||M++<r){var t,n;Array.isArray(h)?F.fromArray(h).normalize():F.copy(f.current.worldToLocal(h.current.getWorldPosition(S)).normalize()),P.copy(F).multiplyScalar(-1),null==(t=p.current.parent)||t.matrixWorld.identity(),Q.setFromObject(p.current,!0),L[0].set(Q.min.x,Q.min.y,Q.min.z),L[1].set(Q.min.x,Q.min.y,Q.max.z),L[2].set(Q.min.x,Q.max.y,Q.min.z),L[3].set(Q.min.x,Q.max.y,Q.max.z),L[4].set(Q.max.x,Q.min.y,Q.min.z),L[5].set(Q.max.x,Q.min.y,Q.max.z),L[6].set(Q.max.x,Q.max.y,Q.min.z),L[7].set(Q.max.x,Q.max.y,Q.max.z);for(let e=0;e<8;e++)O[e].copy(L[e]);Q.getCenter(z),L.map(e=>e.sub(z));let r=R.set(P,0);L.map((e,t)=>r.projectPoint(e,U[t]));let A=U.reduce((e,t)=>e.add(t),S.set(0,0,0)).divideScalar(U.length),d=U.map(e=>e.distanceTo(A)).reduce((e,t)=>Math.max(e,t)),M=L.map(e=>e.dot(F)).reduce((e,t)=>Math.max(e,t));m.current.position.copy(G.copy(F).multiplyScalar(M).add(z)),m.current.lookAt(p.current.localToWorld(z));let N=T.lookAt(m.current.position,z,S.set(0,1,0));m.current.left=-d,m.current.right=d,m.current.top=d,m.current.bottom=-d;let H=S.set(0,d,0).applyMatrix4(N),V=(m.current.position.y+H.y)/F.y;m.current.near=.1,m.current.far=V,m.current.updateProjectionMatrix(),m.current.updateMatrixWorld();let j=O.map((e,t)=>e.add(k[t].copy(F).multiplyScalar(-e.y/F.y))),J=j.reduce((e,t)=>e.add(t),S.set(0,0,0)).divideScalar(j.length),Y=2*j.map(e=>Math.hypot(e.x-J.x,e.z-J.z)).reduce((e,t)=>Math.max(e,t));g.current.scale.setScalar(Y),g.current.position.copy(J),e&&(null==(n=v.current)||n.update()),I.viewMatrix.value=w.viewMatrix.value=m.current.matrixWorldInverse;let W=D.setFromProjectionMatrix(T.multiplyMatrices(m.current.projectionMatrix,m.current.matrixWorldInverse)).planes[4];b.cameraMatrixWorld=m.current.matrixWorld,b.cameraProjectionMatrixInv=m.current.projectionMatrixInverse,b.lightDir=P,b.lightPlaneNormal=W.normal,b.lightPlaneConstant=W.constant,b.near=m.current.near,b.far=m.current.far,b.resolution=u,b.size=d,b.intensity=c,b.worldRadius=l,p.current.visible=!0,y.setRenderTarget(E),y.clear(),p.current.overrideMaterial=w,y.render(p.current,m.current),y.setRenderTarget(x),y.clear(),o&&(p.current.overrideMaterial=I,y.render(p.current,m.current)),p.current.overrideMaterial=null,b.ior=i,g.current.material.lightProjMatrix=m.current.projectionMatrix,g.current.material.lightViewMatrix=m.current.matrixWorldInverse,b.normalTexture=E.texture,b.depthTexture=E.depthTexture,y.setRenderTarget(C),y.clear(),_.render(y),b.ior=s,b.normalTexture=x.texture,b.depthTexture=x.depthTexture,y.setRenderTarget(B),y.clear(),o&&_.render(y),y.setRenderTarget(null),a&&(p.current.visible=!1)}}),eS.useImperativeHandle(d,()=>f.current,[]),eS.createElement("group",j({ref:f},A),eS.createElement("scene",{ref:p},eS.createElement("orthographicCamera",{ref:m,up:[0,1,0]}),t),eS.createElement("mesh",{renderOrder:2,ref:g,"rotation-x":-Math.PI/2},eS.createElement("planeGeometry",null),eS.createElement("causticsProjectionMaterial",{transparent:!0,color:n,causticsTexture:C.texture,causticsTextureB:B.texture,blending:eT.CustomBlending,blendSrc:eT.OneFactor,blendDst:eT.SrcAlphaFactor,depthWrite:!1}),e&&eS.createElement(sT,null,eS.createElement("lineBasicMaterial",{color:"#ffff00",toneMapped:!1}))))}),g0=eS.forwardRef(({mixBlur:e=0,mixStrength:t=.5,resolution:r=256,blur:i=[0,0],args:n=[1,1],minDepthThreshold:a=.9,maxDepthThreshold:o=1,depthScale:s=0,depthToBlurRatioBias:l=.25,mirror:c=0,children:u,debug:h=0,distortion:A=1,mixContrast:d=1,distortionMap:f,...m},p)=>{(0,eR.e)({MeshReflectorMaterial:m9}),eS.useEffect(()=>{console.warn("Reflector has been deprecated and will be removed next major. Replace it with <MeshReflectorMaterial />!")},[]);let g=(0,eR.D)(({gl:e})=>e),y=(0,eR.D)(({camera:e})=>e),v=(0,eR.D)(({scene:e})=>e),E=(i=Array.isArray(i)?i:[i,i])[0]+i[1]>0,x=eS.useRef(null);eS.useImperativeHandle(p,()=>x.current,[]);let[C]=eS.useState(()=>new eT.Plane),[B]=eS.useState(()=>new eT.Vector3),[w]=eS.useState(()=>new eT.Vector3),[I]=eS.useState(()=>new eT.Vector3),[b]=eS.useState(()=>new eT.Matrix4),[_]=eS.useState(()=>new eT.Vector3(0,0,-1)),[M]=eS.useState(()=>new eT.Vector4),[S]=eS.useState(()=>new eT.Vector3),[D]=eS.useState(()=>new eT.Vector3),[T]=eS.useState(()=>new eT.Vector4),[R]=eS.useState(()=>new eT.Matrix4),[F]=eS.useState(()=>new eT.PerspectiveCamera),P=eS.useCallback(()=>{if(w.setFromMatrixPosition(x.current.matrixWorld),I.setFromMatrixPosition(y.matrixWorld),b.extractRotation(x.current.matrixWorld),B.set(0,0,1),B.applyMatrix4(b),S.subVectors(w,I),S.dot(B)>0)return;S.reflect(B).negate(),S.add(w),b.extractRotation(y.matrixWorld),_.set(0,0,-1),_.applyMatrix4(b),_.add(I),D.subVectors(w,_),D.reflect(B).negate(),D.add(w),F.position.copy(S),F.up.set(0,1,0),F.up.applyMatrix4(b),F.up.reflect(B),F.lookAt(D),F.far=y.far,F.updateMatrixWorld(),F.projectionMatrix.copy(y.projectionMatrix),R.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),R.multiply(F.projectionMatrix),R.multiply(F.matrixWorldInverse),R.multiply(x.current.matrixWorld),C.setFromNormalAndCoplanarPoint(B,w),C.applyMatrix4(F.matrixWorldInverse),M.set(C.normal.x,C.normal.y,C.normal.z,C.constant);let e=F.projectionMatrix;T.x=(Math.sign(M.x)+e.elements[8])/e.elements[0],T.y=(Math.sign(M.y)+e.elements[9])/e.elements[5],T.z=-1,T.w=(1+e.elements[10])/e.elements[14],M.multiplyScalar(2/M.dot(T)),e.elements[2]=M.x,e.elements[6]=M.y,e.elements[10]=M.z+1,e.elements[14]=M.w},[]),[Q,z,L,O]=eS.useMemo(()=>{let n={type:eT.HalfFloatType,minFilter:eT.LinearFilter,magFilter:eT.LinearFilter},u=new eT.WebGLRenderTarget(r,r,n);u.depthBuffer=!0,u.depthTexture=new eT.DepthTexture(r,r),u.depthTexture.format=eT.DepthFormat,u.depthTexture.type=eT.UnsignedShortType;let m=new eT.WebGLRenderTarget(r,r,n),p=new m8({gl:g,resolution:r,width:i[0],height:i[1],minDepthThreshold:a,maxDepthThreshold:o,depthScale:s,depthToBlurRatioBias:l}),y={mirror:c,textureMatrix:R,mixBlur:e,tDiffuse:u.texture,tDepth:u.depthTexture,tDiffuseBlur:m.texture,hasBlur:E,mixStrength:t,minDepthThreshold:a,maxDepthThreshold:o,depthScale:s,depthToBlurRatioBias:l,transparent:!0,debug:h,distortion:A,distortionMap:f,mixContrast:d,"defines-USE_BLUR":E?"":void 0,"defines-USE_DEPTH":s>0?"":void 0,"defines-USE_DISTORTION":f?"":void 0};return[u,m,p,y]},[g,i,R,r,c,E,e,t,a,o,s,l,h,A,f,d]);return(0,eR.F)(()=>{if(!(null!=x&&x.current))return;x.current.visible=!1;let e=g.xr.enabled,t=g.shadowMap.autoUpdate;P(),g.xr.enabled=!1,g.shadowMap.autoUpdate=!1,g.setRenderTarget(Q),g.state.buffers.depth.setMask(!0),g.autoClear||g.clear(),g.render(v,F),E&&L.render(g,Q,z),g.xr.enabled=e,g.shadowMap.autoUpdate=t,x.current.visible=!0,g.setRenderTarget(null)}),eS.createElement("mesh",j({ref:x},m),eS.createElement("planeGeometry",{args:n}),u?u("meshReflectorMaterial",O):eS.createElement("meshReflectorMaterial",O))});class g2 extends eT.ShaderMaterial{constructor(){super({uniforms:{depth:{value:null},opacity:{value:1},attenuation:{value:2.5},anglePower:{value:12},spotPosition:{value:new eT.Vector3(0,0,0)},lightColor:{value:new eT.Color("white")},cameraNear:{value:0},cameraFar:{value:1},resolution:{value:new eT.Vector2(0,0)}},transparent:!0,depthWrite:!1,vertexShader:`
        varying vec3 vNormal;
        varying float vViewZ;
        varying float vIntensity;
        uniform vec3 spotPosition;
        uniform float attenuation;

        #include <common>
        #include <logdepthbuf_pars_vertex>

        void main() {
          // compute intensity
          vNormal = normalize(normalMatrix * normal);
          vec4 worldPosition = modelMatrix * vec4(position, 1);
          vec4 viewPosition = viewMatrix * worldPosition;
          vViewZ = viewPosition.z;

          vIntensity = 1.0 - saturate(distance(worldPosition.xyz, spotPosition) / attenuation);

          gl_Position = projectionMatrix * viewPosition;

          #include <logdepthbuf_vertex>
        }
      `,fragmentShader:`
        varying vec3 vNormal;
        varying float vViewZ;
        varying float vIntensity;

        uniform vec3 lightColor;
        uniform float anglePower;
        uniform sampler2D depth;
        uniform vec2 resolution;
        uniform float cameraNear;
        uniform float cameraFar;
        uniform float opacity;

        #include <packing>
        #include <logdepthbuf_pars_fragment>

        float readDepth(sampler2D depthSampler, vec2 uv) {
          float fragCoordZ = texture(depthSampler, uv).r;

          // https://github.com/mrdoob/three.js/issues/23072
          #ifdef USE_LOGDEPTHBUF
            float viewZ = 1.0 - exp2(fragCoordZ * log(cameraFar + 1.0) / log(2.0));
          #else
            float viewZ = perspectiveDepthToViewZ(fragCoordZ, cameraNear, cameraFar);
          #endif

          return viewZ;
        }

        void main() {
          #include <logdepthbuf_fragment>

          vec3 normal = vec3(vNormal.x, vNormal.y, abs(vNormal.z));
          float angleIntensity = pow(dot(normal, vec3(0, 0, 1)), anglePower);
          float intensity = vIntensity * angleIntensity;

          // fades when z is close to sampled depth, meaning the cone is intersecting existing geometry
          bool isSoft = resolution[0] > 0.0 && resolution[1] > 0.0;
          if (isSoft) {
            vec2 uv = gl_FragCoord.xy / resolution;
            intensity *= smoothstep(0.0, 1.0, vViewZ - readDepth(depth, uv));
          }

          gl_FragColor = vec4(lightColor, intensity * opacity);

          #include <tonemapping_fragment>
          #include <${sI>=154?"colorspace_fragment":"encodings_fragment"}>
        }
      `})}}let g3=e=>null==e?void 0:e.isSpotLight;function g4({opacity:e=1,radiusTop:t,radiusBottom:r,depthBuffer:i,color:n="white",distance:a=5,angle:o=.15,attenuation:s=5,anglePower:l=5}){let c=eS.useRef(null),u=(0,eR.D)(e=>e.size),h=(0,eR.D)(e=>e.camera),A=(0,eR.D)(e=>e.viewport.dpr),[d]=eS.useState(()=>new g2),[f]=eS.useState(()=>new eT.Vector3);t=void 0===t?.1:t,r=void 0===r?7*o:r,(0,eR.F)(()=>{d.uniforms.spotPosition.value.copy(c.current.getWorldPosition(f)),c.current.lookAt(c.current.parent.target.getWorldPosition(f))});let m=eS.useMemo(()=>{let e=new eT.CylinderGeometry(t,r,a,128,64,!0);return e.applyMatrix4(new eT.Matrix4().makeTranslation(0,-a/2,0)),e.applyMatrix4(new eT.Matrix4().makeRotationX(-Math.PI/2)),e},[a,t,r]);return eS.createElement(eS.Fragment,null,eS.createElement("mesh",{ref:c,geometry:m,raycast:()=>null},eS.createElement("primitive",{object:d,attach:"material","uniforms-opacity-value":e,"uniforms-lightColor-value":n,"uniforms-attenuation-value":s,"uniforms-anglePower-value":l,"uniforms-depth-value":i,"uniforms-cameraNear-value":h.near,"uniforms-cameraFar-value":h.far,"uniforms-resolution-value":i?[u.width*A,u.height*A]:[0,0]})))}function g5(e,t,r,i,n){let[[a,o]]=eS.useState(()=>[new eT.Vector3,new eT.Vector3]);eS.useLayoutEffect(()=>{if(g3(e.current))e.current.shadow.mapSize.set(r,i),e.current.shadow.needsUpdate=!0;else throw Error("SpotlightShadow must be a child of a SpotLight")},[e,r,i]),(0,eR.F)(()=>{if(!e.current)return;let r=e.current.position,i=e.current.target.position;o.copy(i).sub(r);var s=o.length();o.normalize().multiplyScalar(s*n),a.copy(r).add(o),t.current.position.copy(a),t.current.lookAt(e.current.target.position)})}function g6({distance:e=.4,alphaTest:t=.5,map:r,shader:i="#define GLSLIFY 1\nvarying vec2 vUv;uniform sampler2D uShadowMap;uniform float uTime;void main(){vec3 color=texture2D(uShadowMap,vUv).xyz;gl_FragColor=vec4(color,1.);}",width:n=512,height:a=512,scale:o=1,children:s,...l}){let c=eS.useRef(null),u=l.spotlightRef,h=l.debug;g5(u,c,n,a,e);let A=eS.useMemo(()=>new eT.WebGLRenderTarget(n,a,{format:eT.RGBAFormat,stencilBuffer:!1}),[n,a]),d=eS.useRef({uShadowMap:{value:r},uTime:{value:0}});eS.useEffect(()=>void(d.current.uShadowMap.value=r),[r]);let f=eS.useMemo(()=>new o9(new eT.ShaderMaterial({uniforms:d.current,vertexShader:`
          varying vec2 vUv;

          void main() {
            vUv = uv;
            gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
          }
          `,fragmentShader:i})),[i]);return eS.useEffect(()=>()=>{f.material.dispose(),f.dispose()},[f]),eS.useEffect(()=>()=>A.dispose(),[A]),(0,eR.F)(({gl:e},t)=>{d.current.uTime.value+=t,e.setRenderTarget(A),f.render(e),e.setRenderTarget(null)}),eS.createElement(eS.Fragment,null,eS.createElement("mesh",{ref:c,scale:o,castShadow:!0},eS.createElement("planeGeometry",null),eS.createElement("meshBasicMaterial",{transparent:!0,side:eT.DoubleSide,alphaTest:t,alphaMap:A.texture,"alphaMap-wrapS":eT.RepeatWrapping,"alphaMap-wrapT":eT.RepeatWrapping,opacity:h?1:0},s)))}function g8({distance:e=.4,alphaTest:t=.5,map:r,width:i=512,height:n=512,scale:a,children:o,...s}){let l=eS.useRef(null),c=s.spotlightRef,u=s.debug;return g5(c,l,i,n,e),eS.createElement(eS.Fragment,null,eS.createElement("mesh",{ref:l,scale:a,castShadow:!0},eS.createElement("planeGeometry",null),eS.createElement("meshBasicMaterial",{transparent:!0,side:eT.DoubleSide,alphaTest:t,alphaMap:r,"alphaMap-wrapS":eT.RepeatWrapping,"alphaMap-wrapT":eT.RepeatWrapping,opacity:u?1:0},o)))}function g9(e){return e.shader?eS.createElement(g6,e):eS.createElement(g8,e)}let g7=eS.forwardRef(({opacity:e=1,radiusTop:t,radiusBottom:r,depthBuffer:i,color:n="white",distance:a=5,angle:o=.15,attenuation:s=5,anglePower:l=5,volumetric:c=!0,debug:u=!1,children:h,...A},d)=>{let f=eS.useRef(null);return eS.useImperativeHandle(d,()=>f.current,[]),eS.createElement("group",null,u&&f.current&&eS.createElement("spotLightHelper",{args:[f.current]}),eS.createElement("spotLight",j({ref:f,angle:o,color:n,distance:a,castShadow:!0},A),c&&eS.createElement(g4,{debug:u,opacity:e,radiusTop:t,radiusBottom:r,depthBuffer:i,color:n,distance:a,angle:o,attenuation:s,anglePower:l})),h&&eS.cloneElement(h,{spotlightRef:f,debug:u}))}),ye=eS.forwardRef(({light:e,args:t,map:r,toneMapped:i=!1,color:n="white",form:a="rect",intensity:o=1,scale:s=1,target:l=[0,0,0],children:c,...u},h)=>{let A=eS.useRef(null);return eS.useImperativeHandle(h,()=>A.current,[]),eS.useLayoutEffect(()=>{c||u.material||((0,eR.k)(A.current.material,{color:n}),A.current.material.color.multiplyScalar(o))},[n,o,c,u.material]),eS.useLayoutEffect(()=>{u.rotation||A.current.quaternion.identity(),l&&!u.rotation&&("boolean"==typeof l?A.current.lookAt(0,0,0):A.current.lookAt(Array.isArray(l)?new eT.Vector3(...l):l))},[l,u.rotation]),s=Array.isArray(s)&&2===s.length?[s[0],s[1],1]:s,eS.createElement("mesh",j({ref:A,scale:s},u),"circle"===a?eS.createElement("ringGeometry",{args:t||[0,.5,64]}):"ring"===a?eS.createElement("ringGeometry",{args:t||[.25,.5,64]}):"rect"===a||"plane"===a?eS.createElement("planeGeometry",{args:t||[1,1]}):"box"===a?eS.createElement("boxGeometry",{args:t||[1,1,1]}):eS.createElement(a,{args:t}),c||eS.createElement("meshBasicMaterial",{toneMapped:i,map:r,side:eT.DoubleSide}),e&&eS.createElement("pointLight",j({castShadow:!0},e)))});var yt=Object.defineProperty,yr=(e,t,r)=>t in e?yt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,yi=(e,t,r)=>(yr(e,"symbol"!=typeof t?t+"":t,r),r);let yn=(()=>{let e={uniforms:{turbidity:{value:2},rayleigh:{value:1},mieCoefficient:{value:.005},mieDirectionalG:{value:.8},sunPosition:{value:new eT.Vector3},up:{value:new eT.Vector3(0,1,0)}},vertexShader:`
      uniform vec3 sunPosition;
      uniform float rayleigh;
      uniform float turbidity;
      uniform float mieCoefficient;
      uniform vec3 up;

      varying vec3 vWorldPosition;
      varying vec3 vSunDirection;
      varying float vSunfade;
      varying vec3 vBetaR;
      varying vec3 vBetaM;
      varying float vSunE;

      // constants for atmospheric scattering
      const float e = 2.71828182845904523536028747135266249775724709369995957;
      const float pi = 3.141592653589793238462643383279502884197169;

      // wavelength of used primaries, according to preetham
      const vec3 lambda = vec3( 680E-9, 550E-9, 450E-9 );
      // this pre-calcuation replaces older TotalRayleigh(vec3 lambda) function:
      // (8.0 * pow(pi, 3.0) * pow(pow(n, 2.0) - 1.0, 2.0) * (6.0 + 3.0 * pn)) / (3.0 * N * pow(lambda, vec3(4.0)) * (6.0 - 7.0 * pn))
      const vec3 totalRayleigh = vec3( 5.804542996261093E-6, 1.3562911419845635E-5, 3.0265902468824876E-5 );

      // mie stuff
      // K coefficient for the primaries
      const float v = 4.0;
      const vec3 K = vec3( 0.686, 0.678, 0.666 );
      // MieConst = pi * pow( ( 2.0 * pi ) / lambda, vec3( v - 2.0 ) ) * K
      const vec3 MieConst = vec3( 1.8399918514433978E14, 2.7798023919660528E14, 4.0790479543861094E14 );

      // earth shadow hack
      // cutoffAngle = pi / 1.95;
      const float cutoffAngle = 1.6110731556870734;
      const float steepness = 1.5;
      const float EE = 1000.0;

      float sunIntensity( float zenithAngleCos ) {
        zenithAngleCos = clamp( zenithAngleCos, -1.0, 1.0 );
        return EE * max( 0.0, 1.0 - pow( e, -( ( cutoffAngle - acos( zenithAngleCos ) ) / steepness ) ) );
      }

      vec3 totalMie( float T ) {
        float c = ( 0.2 * T ) * 10E-18;
        return 0.434 * c * MieConst;
      }

      void main() {

        vec4 worldPosition = modelMatrix * vec4( position, 1.0 );
        vWorldPosition = worldPosition.xyz;

        gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
        gl_Position.z = gl_Position.w; // set z to camera.far

        vSunDirection = normalize( sunPosition );

        vSunE = sunIntensity( dot( vSunDirection, up ) );

        vSunfade = 1.0 - clamp( 1.0 - exp( ( sunPosition.y / 450000.0 ) ), 0.0, 1.0 );

        float rayleighCoefficient = rayleigh - ( 1.0 * ( 1.0 - vSunfade ) );

      // extinction (absorbtion + out scattering)
      // rayleigh coefficients
        vBetaR = totalRayleigh * rayleighCoefficient;

      // mie coefficients
        vBetaM = totalMie( turbidity ) * mieCoefficient;

      }
    `,fragmentShader:`
      varying vec3 vWorldPosition;
      varying vec3 vSunDirection;
      varying float vSunfade;
      varying vec3 vBetaR;
      varying vec3 vBetaM;
      varying float vSunE;

      uniform float mieDirectionalG;
      uniform vec3 up;

      const vec3 cameraPos = vec3( 0.0, 0.0, 0.0 );

      // constants for atmospheric scattering
      const float pi = 3.141592653589793238462643383279502884197169;

      const float n = 1.0003; // refractive index of air
      const float N = 2.545E25; // number of molecules per unit volume for air at 288.15K and 1013mb (sea level -45 celsius)

      // optical length at zenith for molecules
      const float rayleighZenithLength = 8.4E3;
      const float mieZenithLength = 1.25E3;
      // 66 arc seconds -> degrees, and the cosine of that
      const float sunAngularDiameterCos = 0.999956676946448443553574619906976478926848692873900859324;

      // 3.0 / ( 16.0 * pi )
      const float THREE_OVER_SIXTEENPI = 0.05968310365946075;
      // 1.0 / ( 4.0 * pi )
      const float ONE_OVER_FOURPI = 0.07957747154594767;

      float rayleighPhase( float cosTheta ) {
        return THREE_OVER_SIXTEENPI * ( 1.0 + pow( cosTheta, 2.0 ) );
      }

      float hgPhase( float cosTheta, float g ) {
        float g2 = pow( g, 2.0 );
        float inverse = 1.0 / pow( 1.0 - 2.0 * g * cosTheta + g2, 1.5 );
        return ONE_OVER_FOURPI * ( ( 1.0 - g2 ) * inverse );
      }

      void main() {

        vec3 direction = normalize( vWorldPosition - cameraPos );

      // optical length
      // cutoff angle at 90 to avoid singularity in next formula.
        float zenithAngle = acos( max( 0.0, dot( up, direction ) ) );
        float inverse = 1.0 / ( cos( zenithAngle ) + 0.15 * pow( 93.885 - ( ( zenithAngle * 180.0 ) / pi ), -1.253 ) );
        float sR = rayleighZenithLength * inverse;
        float sM = mieZenithLength * inverse;

      // combined extinction factor
        vec3 Fex = exp( -( vBetaR * sR + vBetaM * sM ) );

      // in scattering
        float cosTheta = dot( direction, vSunDirection );

        float rPhase = rayleighPhase( cosTheta * 0.5 + 0.5 );
        vec3 betaRTheta = vBetaR * rPhase;

        float mPhase = hgPhase( cosTheta, mieDirectionalG );
        vec3 betaMTheta = vBetaM * mPhase;

        vec3 Lin = pow( vSunE * ( ( betaRTheta + betaMTheta ) / ( vBetaR + vBetaM ) ) * ( 1.0 - Fex ), vec3( 1.5 ) );
        Lin *= mix( vec3( 1.0 ), pow( vSunE * ( ( betaRTheta + betaMTheta ) / ( vBetaR + vBetaM ) ) * Fex, vec3( 1.0 / 2.0 ) ), clamp( pow( 1.0 - dot( up, vSunDirection ), 5.0 ), 0.0, 1.0 ) );

      // nightsky
        float theta = acos( direction.y ); // elevation --> y-axis, [-pi/2, pi/2]
        float phi = atan( direction.z, direction.x ); // azimuth --> x-axis [-pi/2, pi/2]
        vec2 uv = vec2( phi, theta ) / vec2( 2.0 * pi, pi ) + vec2( 0.5, 0.0 );
        vec3 L0 = vec3( 0.1 ) * Fex;

      // composition + solar disc
        float sundisk = smoothstep( sunAngularDiameterCos, sunAngularDiameterCos + 0.00002, cosTheta );
        L0 += ( vSunE * 19000.0 * Fex ) * sundisk;

        vec3 texColor = ( Lin + L0 ) * 0.04 + vec3( 0.0, 0.0003, 0.00075 );

        vec3 retColor = pow( texColor, vec3( 1.0 / ( 1.2 + ( 1.2 * vSunfade ) ) ) );

        gl_FragColor = vec4( retColor, 1.0 );

      #include <tonemapping_fragment>
      #include <${od>=154?"colorspace_fragment":"encodings_fragment"}>

      }
    `},t=new eT.ShaderMaterial({name:"SkyShader",fragmentShader:e.fragmentShader,vertexShader:e.vertexShader,uniforms:eT.UniformsUtils.clone(e.uniforms),side:eT.BackSide,depthWrite:!1});class r extends eT.Mesh{constructor(){super(new eT.BoxGeometry(1,1,1),t)}}return yi(r,"SkyShader",e),yi(r,"material",t),r})();function ya(e,t,r=new eT.Vector3){let i=2*Math.PI*(t-.5);return r.x=Math.cos(i),r.y=Math.sin(Math.PI*(e-.5)),r.z=Math.sin(i),r}let yo=eS.forwardRef(({inclination:e=.6,azimuth:t=.1,distance:r=1e3,mieCoefficient:i=.005,mieDirectionalG:n=.8,rayleigh:a=.5,turbidity:o=10,sunPosition:s=ya(e,t),...l},c)=>{let u=eS.useMemo(()=>new eT.Vector3().setScalar(r),[r]),[h]=eS.useState(()=>new yn);return eS.createElement("primitive",j({object:h,ref:c,"material-uniforms-mieCoefficient-value":i,"material-uniforms-mieDirectionalG-value":n,"material-uniforms-rayleigh-value":a,"material-uniforms-sunPosition-value":s,"material-uniforms-turbidity-value":o,scale:u},l))});class ys extends eT.ShaderMaterial{constructor(){super({uniforms:{time:{value:0},fade:{value:1}},vertexShader:`
      uniform float time;
      attribute float size;
      varying vec3 vColor;
      void main() {
        vColor = color;
        vec4 mvPosition = modelViewMatrix * vec4(position, 0.5);
        gl_PointSize = size * (30.0 / -mvPosition.z) * (3.0 + sin(time + 100.0));
        gl_Position = projectionMatrix * mvPosition;
      }`,fragmentShader:`
      uniform sampler2D pointTexture;
      uniform float fade;
      varying vec3 vColor;
      void main() {
        float opacity = 1.0;
        if (fade == 1.0) {
          float d = distance(gl_PointCoord, vec2(0.5, 0.5));
          opacity = 1.0 / (1.0 + exp(16.0 * (d - 0.25)));
        }
        gl_FragColor = vec4(vColor, opacity);

        #include <tonemapping_fragment>
	      #include <${sI>=154?"colorspace_fragment":"encodings_fragment"}>
      }`})}}let yl=e=>new eT.Vector3().setFromSpherical(new eT.Spherical(e,Math.acos(1-2*Math.random()),2*Math.random()*Math.PI)),yc=eS.forwardRef(({radius:e=100,depth:t=50,count:r=5e3,saturation:i=0,factor:n=4,fade:a=!1,speed:o=1},s)=>{let l=eS.useRef(),[c,u,h]=eS.useMemo(()=>{let a=[],o=[],s=Array.from({length:r},()=>(.5+.5*Math.random())*n),l=new eT.Color,c=e+t,u=t/r;for(let e=0;e<r;e++)c-=u*Math.random(),a.push(...yl(c).toArray()),l.setHSL(e/r,i,.9),o.push(l.r,l.g,l.b);return[new Float32Array(a),new Float32Array(o),new Float32Array(s)]},[r,t,n,e,i]);(0,eR.F)(e=>l.current&&(l.current.uniforms.time.value=e.clock.elapsedTime*o));let[A]=eS.useState(()=>new ys);return eS.createElement("points",{ref:s},eS.createElement("bufferGeometry",null,eS.createElement("bufferAttribute",{attach:"attributes-position",args:[c,3]}),eS.createElement("bufferAttribute",{attach:"attributes-color",args:[u,3]}),eS.createElement("bufferAttribute",{attach:"attributes-size",args:[h,1]})),eS.createElement("primitive",{ref:l,object:A,attach:"material",blending:eT.AdditiveBlending,"uniforms-fade-value":a,depthWrite:!1,transparent:!0,vertexColors:!0}))}),yu="https://rawcdn.githack.com/pmndrs/drei-assets/9225a9f1fbd449d9411125c2f419b843d0308c9f/cloud.png",yh=new eT.Matrix4,yA=new eT.Vector3,yd=new eT.Quaternion,yf=new eT.Vector3,ym=new eT.Quaternion,yp=new eT.Vector3,yg=eS.createContext(null),yy=eS.forwardRef(({children:e,material:t=eT.MeshLambertMaterial,texture:r=yu,range:i,limit:n=200,frustumCulled:a,...o},s)=>{var l,c;let u;let h=eS.useMemo(()=>class extends t{constructor(){super();let e=parseInt(eT.REVISION.replace(/\D+/g,""))>=154?"opaque_fragment":"output_fragment";this.onBeforeCompile=t=>{t.vertexShader=`attribute float cloudOpacity;
               varying float vOpacity;
              `+t.vertexShader.replace("#include <fog_vertex>",`#include <fog_vertex>
                 vOpacity = cloudOpacity;
                `),t.fragmentShader=`varying float vOpacity;
              `+t.fragmentShader.replace(`#include <${e}>`,`#include <${e}>
                 gl_FragColor = vec4(outgoingLight, diffuseColor.a * vOpacity);
                `)}}},[t]);(0,eR.e)({CloudMaterial:h});let A=eS.useRef(null),d=eS.useRef([]),f=eS.useMemo(()=>new Float32Array(Array.from({length:n},()=>1)),[n]),m=eS.useMemo(()=>new Float32Array(Array.from({length:n},()=>[1,1,1]).flat()),[n]),p=sB(r),g=0,y=0,v=new eT.Quaternion,E=new eT.Vector3(0,0,1),x=new eT.Vector3;(0,eR.F)((e,t)=>{for(g=e.clock.elapsedTime,yh.copy(A.current.matrixWorld).invert(),e.camera.matrixWorld.decompose(yf,ym,yp),y=0;y<d.current.length;y++)(u=d.current[y]).ref.current.matrixWorld.decompose(yA,yd,yp),yA.add(x.copy(u.position).applyQuaternion(yd).multiply(yp)),yd.copy(ym).multiply(v.setFromAxisAngle(E,u.rotation+=t*u.rotationFactor)),yp.multiplyScalar(u.volume+(1+Math.sin(g*u.density*u.speed))/2*u.growth),u.matrix.compose(yA,yd,yp).premultiply(yh),u.dist=yA.distanceTo(yf);for(d.current.sort((e,t)=>t.dist-e.dist),y=0;y<d.current.length;y++)u=d.current[y],f[y]=u.opacity*(u.dist<u.fade-1?u.dist/u.fade:1),A.current.setMatrixAt(y,u.matrix),A.current.setColorAt(y,u.color);A.current.geometry.attributes.cloudOpacity.needsUpdate=!0,A.current.instanceMatrix.needsUpdate=!0,A.current.instanceColor&&(A.current.instanceColor.needsUpdate=!0)}),eS.useLayoutEffect(()=>{let e=Math.min(n,void 0!==i?i:n,d.current.length);A.current.count=e,mw(A.current.instanceMatrix,{offset:0,count:16*e}),A.current.instanceColor&&mw(A.current.instanceColor,{offset:0,count:3*e}),mw(A.current.geometry.attributes.cloudOpacity,{offset:0,count:e})});let C=[null!==(l=p.image.width)&&void 0!==l?l:1,null!==(c=p.image.height)&&void 0!==c?c:1],B=Math.max(C[0],C[1]);return C=[C[0]/B,C[1]/B],eS.createElement("group",j({ref:s},o),eS.createElement(yg.Provider,{value:d},e,eS.createElement("instancedMesh",{matrixAutoUpdate:!1,ref:A,args:[null,null,n],frustumCulled:a},eS.createElement("instancedBufferAttribute",{usage:eT.DynamicDrawUsage,attach:"instanceColor",args:[m,3]}),eS.createElement("planeGeometry",{args:[...C]},eS.createElement("instancedBufferAttribute",{usage:eT.DynamicDrawUsage,attach:"attributes-cloudOpacity",args:[f,1]})),eS.createElement("cloudMaterial",{key:t.name,map:p,transparent:!0,depthWrite:!1}))))}),yv=eS.forwardRef(({opacity:e=1,speed:t=0,bounds:r=[5,1,1],segments:i=20,color:n="#ffffff",fade:a=10,volume:o=6,smallestVolume:s=.25,distribute:l=null,growth:c=4,concentrate:u="inside",seed:h=Math.random(),...A},d)=>{function f(){let e=1e4*Math.sin(h++);return e-Math.floor(e)}let m=eS.useContext(yg),p=eS.useRef(null),g=eS.useId(),y=eS.useMemo(()=>[...Array(i)].map((e,t)=>({segments:i,bounds:new eT.Vector3(1,1,1),position:new eT.Vector3,uuid:g,index:t,ref:p,dist:0,matrix:new eT.Matrix4,color:new eT.Color,rotation:Math.PI/i*t})),[i,g]);return eS.useLayoutEffect(()=>{y.forEach((h,A)=>{(0,eR.k)(h,{volume:o,color:n,speed:t,growth:c,opacity:e,fade:a,bounds:r,density:Math.max(.5,f()),rotationFactor:Math.max(.2,.5*f())*t});let d=null==l?void 0:l(h,A);if(d||i>1){var m;h.position.copy(h.bounds).multiply(null!==(m=null==d?void 0:d.point)&&void 0!==m?m:{x:2*f()-1,y:2*f()-1,z:2*f()-1})}let p=Math.abs(h.position.x),g=Math.abs(h.position.y),y=Math.abs(h.position.z),v=Math.max(p,g,y);h.length=1,p===v&&(h.length-=p/h.bounds.x),g===v&&(h.length-=g/h.bounds.y),y===v&&(h.length-=y/h.bounds.z),h.volume=((null==d?void 0:d.volume)!==void 0?d.volume:Math.max(Math.max(0,s),"random"===u?f():"inside"===u?h.length:1-h.length))*o})},[u,r,a,n,e,c,o,h,i,t]),eS.useLayoutEffect(()=>(m.current=[...m.current,...y],()=>{m.current=m.current.filter(e=>e.uuid!==g)}),[y]),eS.useImperativeHandle(d,()=>p.current,[]),eS.createElement("group",j({ref:p},A))}),yE=eS.forwardRef((e,t)=>eS.useContext(yg)?eS.createElement(yv,j({ref:t},e)):eS.createElement(yy,null,eS.createElement(yv,j({ref:t},e))));class yx extends eT.ShaderMaterial{constructor(){super({uniforms:{time:{value:0},pixelRatio:{value:1}},vertexShader:`
        uniform float pixelRatio;
        uniform float time;
        attribute float size;  
        attribute float speed;  
        attribute float opacity;
        attribute vec3 noise;
        attribute vec3 color;
        varying vec3 vColor;
        varying float vOpacity;

        void main() {
          vec4 modelPosition = modelMatrix * vec4(position, 1.0);
          modelPosition.y += sin(time * speed + modelPosition.x * noise.x * 100.0) * 0.2;
          modelPosition.z += cos(time * speed + modelPosition.x * noise.y * 100.0) * 0.2;
          modelPosition.x += cos(time * speed + modelPosition.x * noise.z * 100.0) * 0.2;
          vec4 viewPosition = viewMatrix * modelPosition;
          vec4 projectionPostion = projectionMatrix * viewPosition;
          gl_Position = projectionPostion;
          gl_PointSize = size * 25. * pixelRatio;
          gl_PointSize *= (1.0 / - viewPosition.z);
          vColor = color;
          vOpacity = opacity;
        }
      `,fragmentShader:`
        varying vec3 vColor;
        varying float vOpacity;
        void main() {
          float distanceToCenter = distance(gl_PointCoord, vec2(0.5));
          float strength = 0.05 / distanceToCenter - 0.1;
          gl_FragColor = vec4(vColor, strength * vOpacity);
          #include <tonemapping_fragment>
          #include <${sI>=154?"colorspace_fragment":"encodings_fragment"}>
        }
      `})}get time(){return this.uniforms.time.value}set time(e){this.uniforms.time.value=e}get pixelRatio(){return this.uniforms.pixelRatio.value}set pixelRatio(e){this.uniforms.pixelRatio.value=e}}let yC=e=>e&&e.constructor===Float32Array,yB=e=>[e.r,e.g,e.b],yw=e=>e instanceof eT.Vector2||e instanceof eT.Vector3||e instanceof eT.Vector4,yI=e=>Array.isArray(e)?e:yw(e)?e.toArray():[e,e,e];function yb(e,t,r){return eS.useMemo(()=>{if(void 0!==t){if(yC(t))return t;if(t instanceof eT.Color){let r=Array.from({length:3*e},()=>yB(t)).flat();return Float32Array.from(r)}if(yw(t)||Array.isArray(t)){let r=Array.from({length:3*e},()=>yI(t)).flat();return Float32Array.from(r)}return Float32Array.from({length:e},()=>t)}return Float32Array.from({length:e},r)},[t])}let y_=eS.forwardRef(({noise:e=1,count:t=100,speed:r=1,opacity:i=1,scale:n=1,size:a,color:o,children:s,...l},c)=>{eS.useMemo(()=>(0,eR.e)({SparklesImplMaterial:yx}),[]);let u=eS.useRef(null),h=(0,eR.D)(e=>e.viewport.dpr),A=yI(n),d=eS.useMemo(()=>Float32Array.from(Array.from({length:t},()=>A.map(eT.MathUtils.randFloatSpread)).flat()),[t,...A]),f=yb(t,a,Math.random),m=yb(t,i),p=yb(t,r),g=yb(3*t,e),y=yb(void 0===o?3*t:t,yC(o)?o:new eT.Color(o),()=>1);return(0,eR.F)(e=>{u.current&&u.current.material&&(u.current.material.time=e.clock.elapsedTime)}),eS.useImperativeHandle(c,()=>u.current,[]),eS.createElement("points",j({key:`particle-${t}-${JSON.stringify(n)}`},l,{ref:u}),eS.createElement("bufferGeometry",null,eS.createElement("bufferAttribute",{attach:"attributes-position",args:[d,3]}),eS.createElement("bufferAttribute",{attach:"attributes-size",args:[f,1]}),eS.createElement("bufferAttribute",{attach:"attributes-opacity",args:[m,1]}),eS.createElement("bufferAttribute",{attach:"attributes-speed",args:[p,1]}),eS.createElement("bufferAttribute",{attach:"attributes-color",args:[y,3]}),eS.createElement("bufferAttribute",{attach:"attributes-noise",args:[g,3]})),s||eS.createElement("sparklesImplMaterial",{transparent:!0,pixelRatio:h,depthWrite:!1}))});function yM(e=0,t=1024,r){let i=(0,ok.Rq)(()=>fetch("https://cdn.jsdelivr.net/gh/pmndrs/drei-assets@master/matcaps.json").then(e=>e.json()),["matcapList"]),n=i[0],a=eS.useMemo(()=>Object.keys(i).length,[]),o=eS.useMemo(()=>"string"==typeof e?e:"number"==typeof e?i[e]:null,[e]),s=`${o||n}${function(e){switch(e){case 64:return"-64px";case 128:return"-128px";case 256:return"-256px";case 512:return"-512px";default:return""}}(t)}.png`,l=`https://rawcdn.githack.com/emmelleppi/matcaps/9b36ccaaf0a24881a39062d05566c9e92be4aa0d/${t}/${s}`;return[sB(l,r),l,a]}let yS=({children:e,id:t,format:r,onLoad:i})=>{let n=yM(t,r,i);return eS.createElement(eS.Fragment,null,null==e?void 0:e(n))};function yD(e=0,t={},r){let{repeat:i=[1,1],anisotropy:n=1,offset:a=[0,0]}=t,o=(0,ok.Rq)(()=>fetch("https://cdn.jsdelivr.net/gh/pmndrs/drei-assets@master/normals/normals.json").then(e=>e.json()),["normalsList"]),s=eS.useMemo(()=>Object.keys(o).length,[]),l=o[0],c=o[e]||l,u=`https://rawcdn.githack.com/pmndrs/drei-assets/7a3104997e1576f83472829815b00880d88b32fb/normals/${c}`,h=sB(u,r);return eS.useLayoutEffect(()=>{h&&(h.wrapS=h.wrapT=eT.RepeatWrapping,h.repeat=new eT.Vector2(i[0],i[1]),h.offset=new eT.Vector2(a[0],a[1]),h.anisotropy=n)},[h,n,i,a]),[h,u,s]}let yT=({children:e,id:t,onLoad:r,...i})=>{let n=yD(t,i,r);return eS.createElement(eS.Fragment,null,null==e?void 0:e(n))},yR={uniforms:{strokeOpacity:1,fillOpacity:.25,fillMix:0,thickness:.05,colorBackfaces:!1,dashInvert:!0,dash:!1,dashRepeats:4,dashLength:.5,squeeze:!1,squeezeMin:.2,squeezeMax:1,stroke:new eT.Color("#ff0000"),backfaceStroke:new eT.Color("#0000ff"),fill:new eT.Color("#00ff00")},vertex:`
	  attribute vec3 barycentric;
	
		varying vec3 v_edges_Barycentric;
		varying vec3 v_edges_Position;

		void initWireframe() {
			v_edges_Barycentric = barycentric;
			v_edges_Position = position.xyz;
		}
	  `,fragment:`
		#ifndef PI
	  	#define PI 3.1415926535897932384626433832795
		#endif
  
	  varying vec3 v_edges_Barycentric;
	  varying vec3 v_edges_Position;
  
	  uniform float strokeOpacity;
	  uniform float fillOpacity;
	  uniform float fillMix;
	  uniform float thickness;
	  uniform bool colorBackfaces;
  
	  // Dash
	  uniform bool dashInvert;
	  uniform bool dash;
	  uniform bool dashOnly;
	  uniform float dashRepeats;
	  uniform float dashLength;
  
	  // Squeeze
	  uniform bool squeeze;
	  uniform float squeezeMin;
	  uniform float squeezeMax;
  
	  // Colors
	  uniform vec3 stroke;
	  uniform vec3 backfaceStroke;
	  uniform vec3 fill;
  
	  // This is like
	  float wireframe_aastep(float threshold, float dist) {
		  float afwidth = fwidth(dist) * 0.5;
		  return smoothstep(threshold - afwidth, threshold + afwidth, dist);
	  }
  
	  float wireframe_map(float value, float min1, float max1, float min2, float max2) {
		  return min2 + (value - min1) * (max2 - min2) / (max1 - min1);
	  }
  
	  float getWireframe() {
			vec3 barycentric = v_edges_Barycentric;
		
			// Distance from center of each triangle to its edges.
			float d = min(min(barycentric.x, barycentric.y), barycentric.z);

			// for dashed rendering, we can use this to get the 0 .. 1 value of the line length
			float positionAlong = max(barycentric.x, barycentric.y);
			if (barycentric.y < barycentric.x && barycentric.y < barycentric.z) {
				positionAlong = 1.0 - positionAlong;
			}

			// the thickness of the stroke
			float computedThickness = wireframe_map(thickness, 0.0, 1.0, 0.0, 0.34);

			// if we want to shrink the thickness toward the center of the line segment
			if (squeeze) {
				computedThickness *= mix(squeezeMin, squeezeMax, (1.0 - sin(positionAlong * PI)));
			}

			// Create dash pattern
			if (dash) {
				// here we offset the stroke position depending on whether it
				// should overlap or not
				float offset = 1.0 / dashRepeats * dashLength / 2.0;
				if (!dashInvert) {
					offset += 1.0 / dashRepeats / 2.0;
				}

				// if we should animate the dash or not
				// if (dashAnimate) {
				// 	offset += time * 0.22;
				// }

				// create the repeating dash pattern
				float pattern = fract((positionAlong + offset) * dashRepeats);
				computedThickness *= 1.0 - wireframe_aastep(dashLength, pattern);
			}

			// compute the anti-aliased stroke edge  
			float edge = 1.0 - wireframe_aastep(computedThickness, d);

			return edge;
	  }
	  `},yF=sx(yR.uniforms,yR.vertex+`
  	void main() {
		initWireframe();
		gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
	}
  `,yR.fragment+`
  void main () {
		// Compute color

		float edge = getWireframe();
		vec4 colorStroke = vec4(stroke, edge);

		#ifdef FLIP_SIDED
			colorStroke.rgb = backfaceStroke;
		#endif
    
		vec4 colorFill = vec4(fill, fillOpacity);
		vec4 outColor = mix(colorFill, colorStroke, edge * strokeOpacity);

		gl_FragColor = outColor;
	}
  `);function yP(e){return(null==e?void 0:e.current)!==void 0}function yQ(e){return"WireframeGeometry"===e.type}function yz(e){let t=null!=e&&e.current?e.current:e;if(null!=t&&t.isBufferGeometry)return t;{if(yQ(t))throw Error("Wireframe: WireframeGeometry is not supported.");let e=t.parent;if(null!=e&&e.geometry){if(yQ(e.geometry))throw Error("Wireframe: WireframeGeometry is not supported.");return e.geometry}}}function yL(e,t){if(e.index){console.warn("Wireframe: Requires non-indexed geometry, converting to non-indexed geometry.");let t=e.toNonIndexed();e.copy(t),e.setIndex(null)}let r=function(e,t){let r=e.getAttribute("position").count,i=[];for(let e=0;e<r;e++){let r=t?1:0;e%2==0?i.push(0,0,1,0,1,0,1,0,r):i.push(0,1,0,0,0,1,1,0,r)}return new eT.BufferAttribute(Float32Array.from(i),3)}(e,t);e.setAttribute("barycentric",r)}function yO({geometry:e,simplify:t=!1,...r}){(0,eR.e)({MeshWireframeMaterial:yF});let[i,n]=eS.useState(null);eS.useLayoutEffect(()=>{let r=yz(e);if(!r)throw Error("Wireframe: geometry prop must be a BufferGeometry or a ref to a BufferGeometry.");yL(r,t),yP(e)&&n(r)},[t,e]);let a=yP(e)?i:e;return eS.createElement(eS.Fragment,null,a&&eS.createElement("mesh",{geometry:a},eS.createElement("meshWireframeMaterial",j({attach:"material",transparent:!0,side:eT.DoubleSide,polygonOffset:!0,polygonOffsetFactor:-4},r,{extensions:{derivatives:!0,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1}}))))}function yU({simplify:e=!1,...t}){let r=eS.useRef(null),i=eS.useMemo(()=>(function(){let e={};for(let t in yR.uniforms)e[t]={value:yR.uniforms[t]};return e})(),[yR.uniforms]);return eS.useEffect(()=>{var e;i.fillOpacity.value=null!==(e=t.fillOpacity)&&void 0!==e?e:i.fillOpacity.value},[t.fillOpacity]),eS.useEffect(()=>{var e;i.fillMix.value=null!==(e=t.fillMix)&&void 0!==e?e:i.fillMix.value},[t.fillMix]),eS.useEffect(()=>{var e;i.strokeOpacity.value=null!==(e=t.strokeOpacity)&&void 0!==e?e:i.strokeOpacity.value},[t.strokeOpacity]),eS.useEffect(()=>{var e;i.thickness.value=null!==(e=t.thickness)&&void 0!==e?e:i.thickness.value},[t.thickness]),eS.useEffect(()=>void(i.colorBackfaces.value=!!t.colorBackfaces),[t.colorBackfaces]),eS.useEffect(()=>void(i.dash.value=!!t.dash),[t.dash]),eS.useEffect(()=>void(i.dashInvert.value=!!t.dashInvert),[t.dashInvert]),eS.useEffect(()=>{var e;i.dashRepeats.value=null!==(e=t.dashRepeats)&&void 0!==e?e:i.dashRepeats.value},[t.dashRepeats]),eS.useEffect(()=>{var e;i.dashLength.value=null!==(e=t.dashLength)&&void 0!==e?e:i.dashLength.value},[t.dashLength]),eS.useEffect(()=>void(i.squeeze.value=!!t.squeeze),[t.squeeze]),eS.useEffect(()=>{var e;i.squeezeMin.value=null!==(e=t.squeezeMin)&&void 0!==e?e:i.squeezeMin.value},[t.squeezeMin]),eS.useEffect(()=>{var e;i.squeezeMax.value=null!==(e=t.squeezeMax)&&void 0!==e?e:i.squeezeMax.value},[t.squeezeMax]),eS.useEffect(()=>void(i.stroke.value=t.stroke?new eT.Color(t.stroke):i.stroke.value),[t.stroke]),eS.useEffect(()=>void(i.fill.value=t.fill?new eT.Color(t.fill):i.fill.value),[t.fill]),eS.useEffect(()=>void(i.backfaceStroke.value=t.backfaceStroke?new eT.Color(t.backfaceStroke):i.backfaceStroke.value),[t.backfaceStroke]),eS.useLayoutEffect(()=>{let t=yz(r);if(!t)throw Error("Wireframe: Must be a child of a Mesh, Line or Points object or specify a geometry prop.");let i=t.clone();return yL(t,e),()=>{t.copy(i),i.dispose()}},[e]),eS.useLayoutEffect(()=>{var e;let t=r.current.parent,n=t.material.clone();return(e=t.material).onBeforeCompile=e=>{e.uniforms={...e.uniforms,...i},e.vertexShader=e.vertexShader.replace("void main() {",`
		  ${yR.vertex}
		  void main() {
			initWireframe();
		`),e.fragmentShader=e.fragmentShader.replace("void main() {",`
		  ${yR.fragment}
		  void main() {
		`),e.fragmentShader=e.fragmentShader.replace("#include <color_fragment>",`
		  #include <color_fragment>
			  float edge = getWireframe();
		  vec4 colorStroke = vec4(stroke, edge);
		  #ifdef FLIP_SIDED
			colorStroke.rgb = backfaceStroke;
		  #endif
		  vec4 colorFill = vec4(mix(diffuseColor.rgb, fill, fillMix), mix(diffuseColor.a, fillOpacity, fillMix));
		  vec4 outColor = mix(colorFill, colorStroke, edge * strokeOpacity);

		  diffuseColor.rgb = outColor.rgb;
		  diffuseColor.a *= outColor.a;
		`)},e.side=eT.DoubleSide,e.transparent=!0,()=>{t.material.dispose(),t.material=n}},[]),eS.createElement("object3D",{ref:r})}function yk({geometry:e,...t}){return e?eS.createElement(yO,j({geometry:e},t)):eS.createElement(yU,t)}function yG({opacity:e,alphaMap:t}){let r=eS.useRef(null),i=eS.useRef(null),n=eS.useRef({value:1}),a=eS.useRef({value:null}),o=eS.useRef({value:!1});return eS.useLayoutEffect(()=>{r.current.onBeforeCompile=i.current.onBeforeCompile=e=>{let t;let r=e.fragmentShader.indexOf("void main"),i="",s=r;for(;"\n"!==t&&s<r+100;)i+=t=e.fragmentShader.charAt(s),s++;i=i.trim(),e.vertexShader=e.vertexShader.replace("void main() {",`
        varying vec2 custom_vUv;

        void main() {
          custom_vUv = uv;
          
        `),e.fragmentShader=e.fragmentShader.replace(i,`
          uniform float uShadowOpacity;
          uniform sampler2D uAlphaMap;
          uniform bool uHasAlphaMap;

          varying vec2 custom_vUv;
  
          float bayerDither2x2( vec2 v ) {
            return mod( 3.0 * v.y + 2.0 * v.x, 4.0 );
          }
    
          float bayerDither4x4( vec2 v ) {
            vec2 P1 = mod( v, 2.0 );
            vec2 P2 = mod( floor( 0.5  * v ), 2.0 );
            return 4.0 * bayerDither2x2( P1 ) + bayerDither2x2( P2 );
          }
  
          void main() {
            float alpha = 
              uHasAlphaMap ? 
                uShadowOpacity * texture2D(uAlphaMap, custom_vUv).x
              : uShadowOpacity;

            if( ( bayerDither4x4( floor( mod( gl_FragCoord.xy, 4.0 ) ) ) ) / 16.0 >= alpha ) discard;
            
          `),e.uniforms.uShadowOpacity=n.current,e.uniforms.uAlphaMap=a.current,e.uniforms.uHasAlphaMap=o.current}},[]),(0,eR.F)(()=>{var i;let s=null==(i=r.current.__r3f)?void 0:i.parent;if(s){let r=s.material;r&&(n.current.value=null!=e?e:r.opacity,!1===t?(a.current.value=null,o.current.value=!1):(a.current.value=t||r.alphaMap,o.current.value=!!a.current.value))}}),eS.createElement(eS.Fragment,null,eS.createElement("meshDepthMaterial",{ref:r,attach:"customDepthMaterial",depthPacking:eT.RGBADepthPacking}),eS.createElement("meshDistanceMaterial",{ref:i,attach:"customDistanceMaterial"}))}let yN=new eT.Matrix4,yH=new eT.Ray,yV=new eT.Sphere,yj=new eT.Vector3;class yJ extends eT.Group{constructor(){super(),this.size=0,this.color=new eT.Color("white"),this.instance={current:void 0},this.instanceKey={current:void 0}}get geometry(){var e;return null==(e=this.instance.current)?void 0:e.geometry}raycast(e,t){var r,i;let n=this.instance.current;if(!n||!n.geometry)return;let a=n.userData.instances.indexOf(this.instanceKey);if(-1===a||a>n.geometry.drawRange.count)return;let o=null!==(r=null==(i=e.params.Points)?void 0:i.threshold)&&void 0!==r?r:1;if(yV.set(this.getWorldPosition(yj),o),!1===e.ray.intersectsSphere(yV))return;yN.copy(n.matrixWorld).invert(),yH.copy(e.ray).applyMatrix4(yN);let s=o/((this.scale.x+this.scale.y+this.scale.z)/3),l=yH.distanceSqToPoint(this.position);if(l<s*s){let r=new eT.Vector3;yH.closestPointToPoint(this.position,r),r.applyMatrix4(this.matrixWorld);let i=e.ray.origin.distanceTo(r);if(i<e.near||i>e.far)return;t.push({distance:i,distanceToRay:Math.sqrt(l),point:r,index:a,face:null,object:this})}}}let yY=eS.createContext(null),yW=new eT.Matrix4,yK=new eT.Vector3,yq=eS.forwardRef(({children:e,range:t,limit:r=1e3,...i},n)=>{let a=eS.useRef(null);eS.useImperativeHandle(n,()=>a.current,[]);let[o,s]=eS.useState([]),[[l,c,u]]=eS.useState(()=>[new Float32Array(3*r),Float32Array.from({length:3*r},()=>1),Float32Array.from({length:r},()=>1)]);eS.useEffect(()=>{a.current.geometry.attributes.position.needsUpdate=!0}),(0,eR.F)(()=>{for(a.current.updateMatrix(),a.current.updateMatrixWorld(),yW.copy(a.current.matrixWorld).invert(),a.current.geometry.drawRange.count=Math.min(r,void 0!==t?t:r,o.length),H=0;H<o.length;H++)(V=o[H].current).getWorldPosition(yK).applyMatrix4(yW),yK.toArray(l,3*H),a.current.geometry.attributes.position.needsUpdate=!0,V.matrixWorldNeedsUpdate=!0,V.color.toArray(c,3*H),a.current.geometry.attributes.color.needsUpdate=!0,u.set([V.size],H),a.current.geometry.attributes.size.needsUpdate=!0});let h=eS.useMemo(()=>({getParent:()=>a,subscribe:e=>(s(t=>[...t,e]),()=>s(t=>t.filter(t=>t.current!==e.current)))}),[]);return eS.createElement("points",j({userData:{instances:o},matrixAutoUpdate:!1,ref:a,raycast:()=>null},i),eS.createElement("bufferGeometry",null,eS.createElement("bufferAttribute",{attach:"attributes-position",count:l.length/3,array:l,itemSize:3,usage:eT.DynamicDrawUsage}),eS.createElement("bufferAttribute",{attach:"attributes-color",count:c.length/3,array:c,itemSize:3,usage:eT.DynamicDrawUsage}),eS.createElement("bufferAttribute",{attach:"attributes-size",count:u.length,array:u,itemSize:1,usage:eT.DynamicDrawUsage})),eS.createElement(yY.Provider,{value:h},e))}),yX=eS.forwardRef(({children:e,...t},r)=>{eS.useMemo(()=>(0,eR.e)({PositionPoint:yJ}),[]);let i=eS.useRef(null);eS.useImperativeHandle(r,()=>i.current,[]);let{subscribe:n,getParent:a}=eS.useContext(yY);return eS.useLayoutEffect(()=>n(i),[]),eS.createElement("positionPoint",j({instance:a(),instanceKey:i,ref:i},t),e)}),yZ=eS.forwardRef(({children:e,positions:t,colors:r,sizes:i,stride:n=3,...a},o)=>{let s=eS.useRef(null);return eS.useImperativeHandle(o,()=>s.current,[]),(0,eR.F)(()=>{let e=s.current.geometry.attributes;e.position.needsUpdate=!0,r&&(e.color.needsUpdate=!0),i&&(e.size.needsUpdate=!0)}),eS.createElement("points",j({ref:s},a),eS.createElement("bufferGeometry",null,eS.createElement("bufferAttribute",{attach:"attributes-position",count:t.length/n,array:t,itemSize:n,usage:eT.DynamicDrawUsage}),r&&eS.createElement("bufferAttribute",{attach:"attributes-color",count:r.length/n,array:r,itemSize:3,usage:eT.DynamicDrawUsage}),i&&eS.createElement("bufferAttribute",{attach:"attributes-size",count:i.length/n,array:i,itemSize:1,usage:eT.DynamicDrawUsage})),e)}),y$=eS.forwardRef((e,t)=>e.positions instanceof Float32Array?eS.createElement(yZ,j({},e,{ref:t})):eS.createElement(yq,j({},e,{ref:t}))),y1=eS.createContext(null),y0=eS.forwardRef((e,t)=>{eS.useMemo(()=>(0,eR.e)({SegmentObject:y2}),[]);let{limit:r=1e3,lineWidth:i=1,children:n,...a}=e,[o,s]=eS.useState([]),[l]=eS.useState(()=>new oR),[c]=eS.useState(()=>new of),[u]=eS.useState(()=>new oA),[h]=eS.useState(()=>new eT.Vector2(512,512)),[A]=eS.useState(()=>Array(6*r).fill(0)),[d]=eS.useState(()=>Array(6*r).fill(0)),f=eS.useMemo(()=>({subscribe:e=>(s(t=>[...t,e]),()=>s(t=>t.filter(t=>t.current!==e.current)))}),[]);return(0,eR.F)(()=>{for(let t=0;t<r;t++){var e;let r=null==(e=o[t])?void 0:e.current;r&&(A[6*t+0]=r.start.x,A[6*t+1]=r.start.y,A[6*t+2]=r.start.z,A[6*t+3]=r.end.x,A[6*t+4]=r.end.y,A[6*t+5]=r.end.z,d[6*t+0]=r.color.r,d[6*t+1]=r.color.g,d[6*t+2]=r.color.b,d[6*t+3]=r.color.r,d[6*t+4]=r.color.g,d[6*t+5]=r.color.b)}u.setColors(d),u.setPositions(A),l.computeLineDistances()}),eS.createElement("primitive",{object:l,ref:t},eS.createElement("primitive",{object:u,attach:"geometry"}),eS.createElement("primitive",j({object:c,attach:"material",vertexColors:!0,resolution:h,linewidth:i},a)),eS.createElement(y1.Provider,{value:f},n))});class y2{constructor(){this.color=new eT.Color("white"),this.start=new eT.Vector3(0,0,0),this.end=new eT.Vector3(0,0,0)}}let y3=e=>e instanceof eT.Vector3?e:new eT.Vector3(..."number"==typeof e?[e,e,e]:e),y4=eS.forwardRef(({color:e,start:t,end:r},i)=>{let n=eS.useContext(y1);if(!n)throw"Segment must used inside Segments component.";let a=eS.useRef(null);return eS.useImperativeHandle(i,()=>a.current,[]),eS.useLayoutEffect(()=>n.subscribe(a),[]),eS.createElement("segmentObject",{ref:a,color:e,start:y3(t),end:y3(r)})}),y5=eS.forwardRef(({children:e,hysteresis:t=0,distances:r,...i},n)=>{let a=eS.useRef(null);return eS.useImperativeHandle(n,()=>a.current,[]),eS.useLayoutEffect(()=>{let{current:e}=a;e.levels.length=0,e.children.forEach((i,n)=>e.levels.push({object:i,hysteresis:t,distance:r[n]}))}),(0,eR.F)(e=>{var t;return null==(t=a.current)?void 0:t.update(e.camera)}),eS.createElement("lOD",j({ref:a},i),e)});function y6({all:e,scene:t,camera:r}){let i=(0,eR.D)(({gl:e})=>e),n=(0,eR.D)(({camera:e})=>e),a=(0,eR.D)(({scene:e})=>e);return eS.useLayoutEffect(()=>{let o=[];e&&(t||a).traverse(e=>{!1===e.visible&&(o.push(e),e.visible=!0)}),i.compile(t||a,r||n);let s=new eT.WebGLCubeRenderTarget(128);new eT.CubeCamera(.01,1e5,s).update(i,t||a),s.dispose(),o.forEach(e=>e.visible=!1)},[]),null}function y8(){let e=(0,eR.D)(e=>e.gl);return(0,eS.useEffect)(()=>(e.shadowMap.autoUpdate=!1,e.shadowMap.needsUpdate=!0,()=>{e.shadowMap.autoUpdate=e.shadowMap.needsUpdate=!0}),[e.shadowMap]),null}let y9=new eT.Matrix4,y7=new eT.Ray,ve=new eT.Sphere,vt=new eT.Vector3;function vr(e,t){let r=this.geometry,i=this.material,n=this.matrixWorld;void 0!==i&&(null===r.boundingSphere&&r.computeBoundingSphere(),ve.copy(r.boundingSphere),ve.applyMatrix4(n),!1!==e.ray.intersectsSphere(ve)&&(y9.copy(n).invert(),y7.copy(e.ray).applyMatrix4(y9),(null===r.boundingBox||null!==y7.intersectBox(r.boundingBox,vt))&&t.push({distance:vt.distanceTo(e.ray.origin),point:vt.clone(),object:this})))}function vi({pixelated:e}){let t=(0,eR.D)(e=>e.gl),r=(0,eR.D)(e=>e.internal.active),i=(0,eR.D)(e=>e.performance.current),n=(0,eR.D)(e=>e.viewport.initialDpr),a=(0,eR.D)(e=>e.setDpr);return eS.useEffect(()=>{let i=t.domElement;return()=>{r&&a(n),e&&i&&(i.style.imageRendering="auto")}},[]),eS.useEffect(()=>{a(i*n),e&&t.domElement&&(t.domElement.style.imageRendering=1===i?"auto":"pixelated")},[i]),null}function vn(){let e=(0,eR.D)(e=>e.get),t=(0,eR.D)(e=>e.setEvents),r=(0,eR.D)(e=>e.performance.current);return eS.useEffect(()=>{let r=e().events.enabled;return()=>t({enabled:r})},[]),eS.useEffect(()=>t({enabled:1===r}),[r]),null}let va=(0,eS.createContext)(null);function vo({iterations:e=10,ms:t=250,threshold:r=.75,step:i=.1,factor:n=.5,flipflops:a=1/0,bounds:o=e=>e>100?[60,100]:[40,60],onIncline:s,onDecline:l,onChange:c,onFallback:u,children:h}){let[A,d]=(0,eS.useState)(()=>({fps:0,index:0,factor:n,flipped:0,refreshrate:0,fallback:!1,frames:[],averages:[],subscriptions:new Map,subscribe:e=>{let t=Symbol();return A.subscriptions.set(t,e.current),()=>void A.subscriptions.delete(t)}})),f=0;return(0,eR.F)(()=>{let{frames:n,averages:h}=A;if(!A.fallback&&h.length<e){n.push(performance.now());let d=n[n.length-1]-n[0];if(d>=t){if(A.fps=Math.round(n.length/d*1e3)/1,A.refreshrate=Math.max(A.refreshrate,A.fps),h[A.index++%e]=A.fps,h.length===e){let[t,n]=o(A.refreshrate),d=h.filter(e=>e>=n),m=h.filter(e=>e<t);d.length>e*r&&(A.factor=Math.min(1,A.factor+i),A.flipped++,s&&s(A),A.subscriptions.forEach(e=>e.onIncline&&e.onIncline(A))),m.length>e*r&&(A.factor=Math.max(0,A.factor-i),A.flipped++,l&&l(A),A.subscriptions.forEach(e=>e.onDecline&&e.onDecline(A))),f!==A.factor&&(f=A.factor,c&&c(A),A.subscriptions.forEach(e=>e.onChange&&e.onChange(A))),A.flipped>a&&!A.fallback&&(A.fallback=!0,u&&u(A),A.subscriptions.forEach(e=>e.onFallback&&e.onFallback(A))),A.averages=[]}A.frames=[]}}}),eS.createElement(va.Provider,{value:A},h)}function vs({onIncline:e,onDecline:t,onChange:r,onFallback:i}){let n=(0,eS.useContext)(va),a=(0,eS.useRef)({onIncline:e,onDecline:t,onChange:r,onFallback:i});(0,eS.useLayoutEffect)(()=>{a.current.onIncline=e,a.current.onDecline=t,a.current.onChange=r,a.current.onFallback=i},[e,t,r,i]),(0,eS.useLayoutEffect)(()=>n.subscribe(a),[n])}let vl=eS.forwardRef(({children:e,compute:t,width:r,height:i,samples:n=8,renderPriority:a=0,eventPriority:o=0,frames:s=1/0,stencilBuffer:l=!1,depthBuffer:c=!0,generateMipmaps:u=!1,...h},A)=>{let{size:d,viewport:f}=(0,eR.D)(),m=cu((r||d.width)*f.dpr,(i||d.height)*f.dpr,{samples:n,stencilBuffer:l,depthBuffer:c,generateMipmaps:u}),[p]=eS.useState(()=>new eT.Scene),g=eS.useCallback((e,t,r)=>{var i,n;let a=null==(i=m.texture)?void 0:i.__r3f.parent;for(;a&&!(a instanceof eT.Object3D);)a=a.__r3f.parent;if(!a)return!1;r.raycaster.camera||r.events.compute(e,r,null==(n=r.previousRoot)?void 0:n.getState());let[o]=r.raycaster.intersectObject(a);if(!o)return!1;let s=o.uv;if(!s)return!1;t.raycaster.setFromCamera(t.pointer.set(2*s.x-1,2*s.y-1),t.camera)},[]);return eS.useImperativeHandle(A,()=>m.texture,[m]),eS.createElement(eS.Fragment,null,(0,eR.h)(eS.createElement(vc,{renderPriority:a,frames:s,fbo:m},e,eS.createElement("group",{onPointerOver:()=>null})),p,{events:{compute:t||g,priority:o}}),eS.createElement("primitive",j({object:m.texture},h)))});function vc({frames:e,renderPriority:t,children:r,fbo:i}){let n,a,o,s,l=0;return(0,eR.F)(t=>{(e===1/0||l<e)&&(n=t.gl.autoClear,a=t.gl.xr.enabled,o=t.gl.getRenderTarget(),s=t.gl.xr.isPresenting,t.gl.autoClear=!0,t.gl.xr.enabled=!1,t.gl.xr.isPresenting=!1,t.gl.setRenderTarget(i),t.gl.render(t.scene,t.camera),t.gl.setRenderTarget(o),t.gl.autoClear=n,t.gl.xr.enabled=a,t.gl.xr.isPresenting=s,l++)},t),eS.createElement(eS.Fragment,null,r)}let vu=eS.forwardRef(({children:e,compute:t,renderPriority:r=-1,eventPriority:i=0,frames:n=1/0,stencilBuffer:a=!1,depthBuffer:o=!0,generateMipmaps:s=!1,resolution:l=896,near:c=.1,far:u=1e3,flip:h=!1,position:A,rotation:d,scale:f,quaternion:m,matrix:p,matrixAutoUpdate:g,...y},v)=>{let{size:E,viewport:x}=(0,eR.D)(),C=eS.useRef(null),B=eS.useMemo(()=>{let e=new eT.WebGLCubeRenderTarget(Math.max((l||E.width)*x.dpr,(l||E.height)*x.dpr),{stencilBuffer:a,depthBuffer:o,generateMipmaps:s});return e.texture.isRenderTargetTexture=!h,e.texture.flipY=!0,e.texture.type=eT.HalfFloatType,e},[l,h]);eS.useEffect(()=>()=>B.dispose(),[B]);let[w]=eS.useState(()=>new eT.Scene);return eS.useImperativeHandle(v,()=>({scene:w,fbo:B,camera:C.current}),[B]),eS.createElement(eS.Fragment,null,(0,eR.h)(eS.createElement(vh,{renderPriority:r,frames:n,camera:C},e,eS.createElement("group",{onPointerOver:()=>null})),w,{events:{compute:t,priority:i}}),eS.createElement("primitive",j({object:B.texture},y)),eS.createElement("cubeCamera",{ref:C,args:[c,u,B],position:A,rotation:d,scale:f,quaternion:m,matrix:p,matrixAutoUpdate:g}))});function vh({frames:e,renderPriority:t,children:r,camera:i}){let n=0;return(0,eR.F)(t=>{(e===1/0||n<e)&&(i.current.update(t.gl,t.scene),n++)},t),eS.createElement(eS.Fragment,null,r)}let vA=eS.forwardRef(({id:e=1,colorWrite:t=!1,depthWrite:r=!1,...i},n)=>{let a=eS.useRef(null),o=eS.useMemo(()=>({colorWrite:t,depthWrite:r,stencilWrite:!0,stencilRef:e,stencilFunc:eT.AlwaysStencilFunc,stencilFail:eT.ReplaceStencilOp,stencilZFail:eT.ReplaceStencilOp,stencilZPass:eT.ReplaceStencilOp}),[e,t,r]);return eS.useLayoutEffect(()=>{Object.assign(a.current.material,o)}),eS.useImperativeHandle(n,()=>a.current,[]),eS.createElement("mesh",j({ref:a,renderOrder:-e},i))});function vd(e,t=!1){return{stencilWrite:!0,stencilRef:e,stencilFunc:t?eT.NotEqualStencilFunc:eT.EqualStencilFunc,stencilFail:eT.KeepStencilOp,stencilZFail:eT.KeepStencilOp,stencilZPass:eT.KeepStencilOp}}function vf({renderPriority:e=1,zoom:t=0,segments:r=64,children:i,resolution:n=896,...a}){let o=eS.useRef(null),s=eS.useRef(null),{width:l,height:c}=(0,eR.D)(e=>e.size),[u]=eS.useState(()=>new eT.OrthographicCamera);eS.useLayoutEffect(()=>{u.position.set(0,0,100),u.zoom=100,u.left=-(l/2),u.right=l/2,u.top=c/2,u.bottom=-(c/2),u.updateProjectionMatrix()},[l,c]);let h=Math.sqrt(l*l+c*c)/100*(.5+t/2),A=new eT.Vector3,d=new eT.Sphere(new eT.Vector3,h),f=new eT.Matrix3,m=eS.useCallback((e,t,r)=>{t.pointer.set(e.offsetX/t.size.width*2-1,-(e.offsetY/t.size.height*2)+1),t.raycaster.setFromCamera(t.pointer,u),t.raycaster.ray.intersectSphere(d,A)&&(A.normalize(),f.getNormalMatrix(s.current.camera.matrixWorld),s.current.camera.getWorldPosition(t.raycaster.ray.origin),t.raycaster.ray.direction.set(0,0,1).reflect(A),t.raycaster.ray.direction.x*=-1,t.raycaster.ray.direction.applyNormalMatrix(f).multiplyScalar(-1))},[]);return(0,eR.F)(t=>{e&&t.gl.render(o.current,u)},e),eS.createElement(eS.Fragment,null,eS.createElement("mesh",j({ref:o},a,{scale:h}),eS.createElement("sphereGeometry",{args:[1,r,r]}),eS.createElement("meshBasicMaterial",null,eS.createElement(vu,{compute:m,attach:"envMap",flip:!0,resolution:n,ref:s},i,eS.createElement(vm,{api:s})))))}function vm({api:e}){let t=new eT.Vector3,r=new eT.Quaternion,i=new eT.Vector3,n=new eT.Euler(0,Math.PI,0);return(0,eR.F)(a=>{a.camera.matrixWorld.decompose(t,r,i),e.current.camera.position.copy(t),e.current.camera.quaternion.setFromEuler(n).premultiply(r)}),null}let vp=sx({blur:0,map:null,sdf:null,blend:0,size:0,resolution:new eT.Vector2},`varying vec2 vUv;
   void main() {
     gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
     vUv = uv;
   }`,`uniform sampler2D sdf;
   uniform sampler2D map;
   uniform float blur;
   uniform float size;
   uniform float time;
   uniform vec2 resolution;
   varying vec2 vUv;
   #include <packing>
   void main() {
     vec2 uv = gl_FragCoord.xy / resolution.xy;
     vec4 t = texture2D(map, uv);
     float k = blur;
     float d = texture2D(sdf, vUv).r/size;
     float alpha = 1.0 - smoothstep(0.0, 1.0, clamp(d/k + 1.0, 0.0, 1.0));
     gl_FragColor = vec4(t.rgb, blur == 0.0 ? t.a : t.a * alpha);
     #include <tonemapping_fragment>
     #include <${sI>=154?"colorspace_fragment":"encodings_fragment"}>
   }`),vg=eS.forwardRef(({children:e,events:t,blur:r=0,eventPriority:i=0,renderPriority:n=0,worldUnits:a=!1,resolution:o=512,...s},l)=>{(0,eR.e)({PortalMaterialImpl:vp});let c=eS.useRef(null),{scene:u,gl:h,size:A,viewport:d,setEvents:f}=(0,eR.D)(),m=cu(o,o),[p,g]=eS.useState(0);(0,eR.F)(()=>{let e=c.current.blend>0?Math.max(1,n):0;p!==e&&g(e)}),eS.useEffect(()=>{void 0!==t&&f({enabled:!t})},[t]);let[y,v]=eS.useState(!0),E=mo(v);eS.useLayoutEffect(()=>{var e;E.current=null==(e=c.current)?void 0:e.__r3f.parent},[]),eS.useLayoutEffect(()=>{if(E.current&&r&&null===c.current.sdf){let e=new eT.Mesh(E.current.geometry,new eT.MeshBasicMaterial),t=new eT.Box3().setFromBufferAttribute(e.geometry.attributes.position),r=new eT.OrthographicCamera(t.min.x*(1+2/o),t.max.x*(1+2/o),t.max.y*(1+2/o),t.min.y*(1+2/o),.1,1e3);r.position.set(0,0,1),r.lookAt(0,0,0),h.setRenderTarget(m),h.render(e,r);let i=vv(o,o,h)(m.texture),n=new Float32Array(o*o);h.readRenderTargetPixels(i,0,0,o,o,n);let a=1/0;for(let e=0;e<n.length;e++)n[e]<a&&(a=n[e]);a=-a,c.current.size=a,c.current.sdf=i.texture,h.setRenderTarget(null)}},[o,r]),eS.useImperativeHandle(l,()=>c.current);let x=eS.useCallback((e,t,r)=>{var i;if(!E.current)return!1;if(t.pointer.set(e.offsetX/t.size.width*2-1,-(e.offsetY/t.size.height*2)+1),t.raycaster.setFromCamera(t.pointer,t.camera),(null==(i=c.current)?void 0:i.blend)===0){let[e]=t.raycaster.intersectObject(E.current);if(!e)return t.raycaster.camera=void 0,!1}},[]);return eS.createElement("portalMaterialImpl",j({ref:c,blur:r,blend:0,resolution:[A.width*d.dpr,A.height*d.dpr],attach:"material"},s),eS.createElement(vl,{attach:"map",frames:y?1/0:0,eventPriority:i,renderPriority:n,compute:x},e,eS.createElement(vy,{events:t,rootScene:u,priority:p,material:c,worldUnits:a})))});function vy({events:e,rootScene:t,material:r,priority:i,worldUnits:n}){let a=(0,eR.D)(e=>e.scene),o=(0,eR.D)(e=>e.setEvents),s=cu(),l=cu();eS.useLayoutEffect(()=>{a.matrixAutoUpdate=!1},[]),eS.useEffect(()=>{void 0!==e&&o({enabled:e})},[e]);let[c,u]=eS.useMemo(()=>{let e={value:0};return[new o9(new eT.ShaderMaterial({uniforms:{a:{value:s.texture},b:{value:l.texture},blend:e},vertexShader:`
          varying vec2 vUv;
          void main() {
            vUv = uv;
            gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
          }`,fragmentShader:`
          uniform sampler2D a;
          uniform sampler2D b;
          uniform float blend;
          varying vec2 vUv;
          #include <packing>
          void main() {
            vec4 ta = texture2D(a, vUv);
            vec4 tb = texture2D(b, vUv);
            gl_FragColor = mix(tb, ta, blend);
            #include <tonemapping_fragment>
            #include <${sI>=154?"colorspace_fragment":"encodings_fragment"}>
          }`})),e]},[]);return(0,eR.F)(e=>{var o,h,A,d,f;let m=null==r||null==(o=r.current)?void 0:o.__r3f.parent;m&&(n?a.matrixWorld.identity():(i&&(null==(h=r.current)?void 0:h.blend)===1&&m.updateWorldMatrix(!0,!1),a.matrixWorld.copy(m.matrixWorld)),i&&((null==(A=r.current)?void 0:A.blend)>0&&(null==(d=r.current)?void 0:d.blend)<1?(u.value=r.current.blend,e.gl.setRenderTarget(s),e.gl.render(a,e.camera),e.gl.setRenderTarget(l),e.gl.render(t,e.camera),e.gl.setRenderTarget(null),c.render(e.gl)):(null==(f=r.current)?void 0:f.blend)===1&&e.gl.render(a,e.camera)))},i),eS.createElement(eS.Fragment,null)}let vv=(e,t,r)=>{let i=new eT.WebGLRenderTarget(e,t,{minFilter:eT.LinearMipmapLinearFilter,magFilter:eT.LinearFilter,type:eT.FloatType,format:eT.RedFormat,generateMipmaps:!0}),n=new eT.WebGLRenderTarget(e,t,{minFilter:eT.NearestFilter,magFilter:eT.NearestFilter}),a=new eT.WebGLRenderTarget(e,t,{minFilter:eT.NearestFilter,magFilter:eT.NearestFilter}),o=new eT.WebGLRenderTarget(e,t,{minFilter:eT.NearestFilter,magFilter:eT.NearestFilter}),s=new eT.WebGLRenderTarget(e,t,{minFilter:eT.NearestFilter,magFilter:eT.NearestFilter}),l=new eT.WebGLRenderTarget(e,t,{minFilter:eT.NearestFilter,magFilter:eT.NearestFilter,type:eT.FloatType,format:eT.RedFormat}),c=new eT.WebGLRenderTarget(e,t,{minFilter:eT.NearestFilter,magFilter:eT.NearestFilter,type:eT.FloatType,format:eT.RedFormat}),u=new o9(new eT.ShaderMaterial({uniforms:{tex:{value:null}},vertexShader:`
        varying vec2 vUv;
        void main() {
          vUv = uv;
          gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
        }`,fragmentShader:`
        uniform sampler2D tex;
        varying vec2 vUv;
        #include <packing>
        void main() {
          gl_FragColor = pack2HalfToRGBA(vUv * (round(texture2D(tex, vUv).x)));
        }`})),h=new o9(new eT.ShaderMaterial({uniforms:{tex:{value:null}},vertexShader:`
        varying vec2 vUv;
        void main() {
          vUv = uv;
          gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
        }`,fragmentShader:`
        uniform sampler2D tex;
        varying vec2 vUv;
        #include <packing>
        void main() {
          gl_FragColor = pack2HalfToRGBA(vUv * (1.0 - round(texture2D(tex, vUv).x)));
        }`})),A=new o9(new eT.ShaderMaterial({uniforms:{tex:{value:null},offset:{value:0},level:{value:0},maxSteps:{value:0}},vertexShader:`
        varying vec2 vUv;
        void main() {
          vUv = uv;
          gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
        }`,fragmentShader:`
        varying vec2 vUv;
        uniform sampler2D tex;
        uniform float offset;
        uniform float level;
        uniform float maxSteps;
        #include <packing>
        void main() {
          float closestDist = 9999999.9;
          vec2 closestPos = vec2(0.0);
          for (float x = -1.0; x <= 1.0; x += 1.0) {
            for (float y = -1.0; y <= 1.0; y += 1.0) {
              vec2 voffset = vUv;
              voffset += vec2(x, y) * vec2(${1/e}, ${1/t}) * offset;
              vec2 pos = unpackRGBATo2Half(texture2D(tex, voffset));
              float dist = distance(pos.xy, vUv);
              if(pos.x != 0.0 && pos.y != 0.0 && dist < closestDist) {
                closestDist = dist;
                closestPos = pos;
              }
            }
          }
          gl_FragColor = pack2HalfToRGBA(closestPos);
        }`})),d=new o9(new eT.ShaderMaterial({uniforms:{tex:{value:null},size:{value:new eT.Vector2(e,t)}},vertexShader:`
        varying vec2 vUv;
        void main() {
          vUv = uv;
          gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
        }`,fragmentShader:`
        varying vec2 vUv;
        uniform sampler2D tex;
        uniform vec2 size;
        #include <packing>
        void main() {
          gl_FragColor = vec4(distance(size * unpackRGBATo2Half(texture2D(tex, vUv)), size * vUv), 0.0, 0.0, 0.0);
        }`})),f=new o9(new eT.ShaderMaterial({uniforms:{inside:{value:c.texture},outside:{value:l.texture},tex:{value:null}},vertexShader:`
        varying vec2 vUv;
        void main() {
          vUv = uv;
          gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
        }`,fragmentShader:`
        varying vec2 vUv;
        uniform sampler2D inside;
        uniform sampler2D outside;
        uniform sampler2D tex;
        #include <packing>
        void main() {
          float i = texture2D(inside, vUv).x;
          float o =texture2D(outside, vUv).x;
          if (texture2D(tex, vUv).x == 0.0) {
            gl_FragColor = vec4(o, 0.0, 0.0, 0.0);
          } else {
            gl_FragColor = vec4(-i, 0.0, 0.0, 0.0);
          }
        }`}));return m=>{m.minFilter=eT.NearestFilter,m.magFilter=eT.NearestFilter,u.material.uniforms.tex.value=m,r.setRenderTarget(n),u.render(r);let p=Math.ceil(Math.log(Math.max(e,t))/Math.log(2)),g=n,y=null;for(let e=0;e<p;e++){let t=Math.pow(2,p-e-1);y=g===n?o:n,A.material.uniforms.level.value=e,A.material.uniforms.maxSteps.value=p,A.material.uniforms.offset.value=t,A.material.uniforms.tex.value=g.texture,r.setRenderTarget(y),A.render(r),g=y}r.setRenderTarget(l),d.material.uniforms.tex.value=y.texture,d.render(r),h.material.uniforms.tex.value=m,r.setRenderTarget(a),h.render(r),g=a;for(let e=0;e<p;e++){let t=Math.pow(2,p-e-1);y=g===a?s:a,A.material.uniforms.level.value=e,A.material.uniforms.maxSteps.value=p,A.material.uniforms.offset.value=t,A.material.uniforms.tex.value=g.texture,r.setRenderTarget(y),A.render(r),g=y}return r.setRenderTarget(c),d.material.uniforms.tex.value=y.texture,d.render(r),r.setRenderTarget(i),f.material.uniforms.tex.value=m,f.render(r),r.setRenderTarget(null),i}},vE=e=>{let t;let r=new Set,i=(e,i)=>{let n="function"==typeof e?e(t):e;if(!Object.is(n,t)){let e=t;t=(null!=i?i:"object"!=typeof n||null===n)?n:Object.assign({},t,n),r.forEach(r=>r(t,e))}},n=()=>t,a={setState:i,getState:n,getInitialState:()=>o,subscribe:e=>(r.add(e),()=>r.delete(e)),destroy:()=>{console.warn("[DEPRECATED] The `destroy` method will be unsupported in a future version. Instead use unsubscribe function returned by subscribe. Everything will be garbage-collected if store is garbage-collected."),r.clear()}},o=t=e(i,n,a);return a},vx=e=>e?vE(e):vE;var vC=r(5401);let{useDebugValue:vB}=eS,{useSyncExternalStoreWithSelector:vw}=vC,vI=!1,vb=e=>e,v_=e=>{"function"!=typeof e&&console.warn("[DEPRECATED] Passing a vanilla store will be unsupported in a future version. Instead use `import { useStore } from 'zustand'`.");let t="function"==typeof e?vx(e):e,r=(e,r)=>(function(e,t=vb,r){r&&!vI&&(console.warn("[DEPRECATED] Use `createWithEqualityFn` instead of `create` or use `useStoreWithEqualityFn` instead of `useStore`. They can be imported from 'zustand/traditional'. https://github.com/pmndrs/zustand/discussions/1937"),vI=!0);let i=vw(e.subscribe,e.getState,e.getServerState||e.getInitialState,t,r);return vB(i),i})(t,e,r);return Object.assign(r,t),r},vM=e=>e?v_(e):v_,vS="undefined"!=typeof window&&(null!=(e_=window.document)&&e_.createElement||(null==(eM=window.navigator)?void 0:eM.product)==="ReactNative")?eS.useLayoutEffect:eS.useEffect,vD=e=>e&&e.isOrthographicCamera,vT=new eT.Color,vR=function(){let e=vM(e=>({current:[],version:0,set:e}));return{In:({children:t})=>{let r=e(e=>e.set),i=e(e=>e.version);return vS(()=>{r(e=>({version:e.version+1}))},[]),vS(()=>(r(({current:e})=>({current:[...e,t]})),()=>r(({current:e})=>({current:e.filter(e=>e!==t)}))),[t,i]),null},Out:()=>{let t=e(e=>e.current);return eS.createElement(eS.Fragment,null,t)}}}();function vF(e,t){let{right:r,top:i,left:n,bottom:a,width:o,height:s}=t,l=t.bottom<0||i>e.height||r<0||t.left>e.width;if("top"in e){let t=e.top+e.height;return{position:{width:o,height:s,left:n-e.left,top:i,bottom:t-a,right:r},isOffscreen:l}}return{position:{width:o,height:s,top:i,left:n,bottom:e.height-a,right:r},isOffscreen:l}}function vP(e,{left:t,bottom:r,width:i,height:n}){let a;let o=i/n;return vD(e.camera)?e.camera.manual?e.camera.updateProjectionMatrix():(e.camera.left!==-(i/2)||e.camera.right!==i/2||e.camera.top!==n/2||e.camera.bottom!==-(n/2))&&(Object.assign(e.camera,{left:-(i/2),right:i/2,top:n/2,bottom:-(n/2)}),e.camera.updateProjectionMatrix()):e.camera.aspect!==o&&(e.camera.aspect=o,e.camera.updateProjectionMatrix()),a=e.gl.autoClear,e.gl.autoClear=!1,e.gl.setViewport(t,r,i,n),e.gl.setScissor(t,r,i,n),e.gl.setScissorTest(!0),a}function vQ(e,t){e.gl.setScissorTest(!1),e.gl.autoClear=t}function vz(e){e.gl.getClearColor(vT),e.gl.setClearColor(vT,e.gl.getClearAlpha()),e.gl.clear(!0,!0)}function vL({visible:e=!0,canvasSize:t,scene:r,index:i,children:n,frames:a,rect:o,track:s}){let l=(0,eR.D)(),[c,u]=eS.useState(!1),h=0;return(0,eR.F)(i=>{if(a===1/0||h<=a){var l;s&&(o.current=null==(l=s.current)?void 0:l.getBoundingClientRect()),h++}if(o.current){let{position:a,isOffscreen:s}=vF(t,o.current);if(c!==s&&u(s),e&&!c&&o.current){let e=vP(i,a);i.gl.render(n?i.scene:r,i.camera),vQ(i,e)}}},i),eS.useLayoutEffect(()=>{let r=o.current;if(r&&(!e||!c)){let{position:e}=vF(t,r),i=vP(l,e);vz(l),vQ(l,i)}},[e,c]),eS.useEffect(()=>{if(!s)return;let e=o.current,r=l.get().events.connected;return l.setEvents({connected:s.current}),()=>{if(e){let{position:r}=vF(t,e),i=vP(l,r);vz(l),vQ(l,i)}l.setEvents({connected:r})}},[s]),eS.useEffect(()=>{"top"in t||console.warn("Detected @react-three/fiber canvas size does not include position information. <View /> may not work as expected. Upgrade to @react-three/fiber ^8.1.0 for support.\n See https://github.com/pmndrs/drei/issues/944")},[]),eS.createElement(eS.Fragment,null,n,eS.createElement("group",{onPointerOver:()=>null}))}let vO=eS.forwardRef(({track:e,visible:t=!0,index:r=1,id:i,style:n,className:a,frames:o=1/0,children:s,...l},c)=>{var u,h,A,d;let f=eS.useRef(null),{size:m,scene:p}=(0,eR.D)(),[g]=eS.useState(()=>new eT.Scene),[y,v]=eS.useReducer(()=>!0,!1),E=eS.useCallback((t,r)=>{if(f.current&&e&&e.current&&t.target===e.current){let{width:e,height:i,left:n,top:a}=f.current,o=t.clientX-n,s=t.clientY-a;r.pointer.set(o/e*2-1,-(s/i*2)+1),r.raycaster.setFromCamera(r.pointer,r.camera)}},[f,e]);return eS.useEffect(()=>{var t;e&&(f.current=null==(t=e.current)?void 0:t.getBoundingClientRect()),v()},[e]),eS.createElement("group",j({ref:c},l),y&&(0,eR.h)(eS.createElement(vL,{visible:t,canvasSize:m,frames:o,scene:p,track:e,rect:f,index:r},s),g,{events:{compute:E,priority:r},size:{width:null==(u=f.current)?void 0:u.width,height:null==(h=f.current)?void 0:h.height,top:null==(A=f.current)?void 0:A.top,left:null==(d=f.current)?void 0:d.left}}))}),vU=eS.forwardRef(({as:e="div",id:t,visible:r,className:i,style:n,index:a=1,track:o,frames:s=1/0,children:l,...c},u)=>{let h=eS.useId(),A=eS.useRef(null);return eS.useImperativeHandle(u,()=>A.current),eS.createElement(eS.Fragment,null,eS.createElement(e,j({ref:A,id:t,className:i,style:n},c)),eS.createElement(vR.In,null,eS.createElement(vO,{visible:r,key:h,track:A,frames:s,index:a},l)))}),vk=(()=>{let e=eS.forwardRef((e,t)=>eS.useContext(eR.g)?eS.createElement(vO,j({ref:t},e)):eS.createElement(vU,j({ref:t},e)));return e.Port=()=>eS.createElement(vR.Out,null),e})(),vG=eS.createContext(null),vN=new eT.Vector3,vH=new eT.Vector3,vV=(e,t,r,i)=>{let n=t.dot(t),a=t.dot(e)-t.dot(r),o=t.dot(i);return 0===o?-a/n:(vN.copy(i).multiplyScalar(n/o).sub(t),vH.copy(i).multiplyScalar(a/o).add(r).sub(e),-vN.dot(vH)/vN.dot(vN))},vj=new eT.Vector3(0,1,0),vJ=new eT.Matrix4,vY=({direction:e,axis:t})=>{let{translation:r,translationLimits:i,annotations:n,annotationsClass:a,depthTest:o,scale:s,lineWidth:l,fixed:c,axisColors:u,hoveredColor:h,opacity:A,onDragStart:d,onDrag:f,onDragEnd:m,userData:p}=eS.useContext(vG),g=(0,eR.D)(e=>e.controls),y=eS.useRef(null),v=eS.useRef(null),E=eS.useRef(null),x=eS.useRef(0),[C,B]=eS.useState(!1),w=eS.useCallback(i=>{n&&(y.current.innerText=`${r.current[t].toFixed(2)}`,y.current.style.display="block"),i.stopPropagation();let a=new eT.Matrix4().extractRotation(v.current.matrixWorld),o=i.point.clone(),s=new eT.Vector3().setFromMatrixPosition(v.current.matrixWorld),l=e.clone().applyMatrix4(a).normalize();E.current={clickPoint:o,dir:l},x.current=r.current[t],d({component:"Arrow",axis:t,origin:s,directions:[l]}),g&&(g.enabled=!1),i.target.setPointerCapture(i.pointerId)},[n,e,g,d,r,t]),I=eS.useCallback(e=>{if(e.stopPropagation(),C||B(!0),E.current){let{clickPoint:a,dir:o}=E.current,[s,l]=(null==i?void 0:i[t])||[void 0,void 0],c=vV(a,o,e.ray.origin,e.ray.direction);void 0!==s&&(c=Math.max(c,s-x.current)),void 0!==l&&(c=Math.min(c,l-x.current)),r.current[t]=x.current+c,n&&(y.current.innerText=`${r.current[t].toFixed(2)}`),vJ.makeTranslation(o.x*c,o.y*c,o.z*c),f(vJ)}},[n,f,C,r,i,t]),b=eS.useCallback(e=>{n&&(y.current.style.display="none"),e.stopPropagation(),E.current=null,m(),g&&(g.enabled=!0),e.target.releasePointerCapture(e.pointerId)},[n,g,m]),_=eS.useCallback(e=>{e.stopPropagation(),B(!1)},[]),{cylinderLength:M,coneWidth:S,coneLength:D,matrixL:T}=eS.useMemo(()=>{let t=c?l/s*1.6:s/20,r=c?.2:s/5,i=c?1-r:s-r,n=new eT.Quaternion().setFromUnitVectors(vj,e.clone().normalize());return{cylinderLength:i,coneWidth:t,coneLength:r,matrixL:new eT.Matrix4().makeRotationFromQuaternion(n)}},[e,s,l,c]),R=C?h:u[t];return eS.createElement("group",{ref:v},eS.createElement("group",{matrix:T,matrixAutoUpdate:!1,onPointerDown:w,onPointerMove:I,onPointerUp:b,onPointerOut:_},n&&eS.createElement(eN,{position:[0,-D,0]},eS.createElement("div",{style:{display:"none",background:"#151520",color:"white",padding:"6px 8px",borderRadius:7,whiteSpace:"nowrap"},className:a,ref:y})),eS.createElement("mesh",{visible:!1,position:[0,(M+D)/2,0],userData:p},eS.createElement("cylinderGeometry",{args:[1.4*S,1.4*S,M+D,8,1]})),eS.createElement(oF,{transparent:!0,raycast:()=>null,depthTest:o,points:[0,0,0,0,M,0],lineWidth:l,side:eT.DoubleSide,color:R,opacity:A,polygonOffset:!0,renderOrder:1,polygonOffsetFactor:-10,fog:!1}),eS.createElement("mesh",{raycast:()=>null,position:[0,M+D/2,0],renderOrder:500},eS.createElement("coneGeometry",{args:[S,D,24,1]}),eS.createElement("meshBasicMaterial",{transparent:!0,depthTest:o,color:R,opacity:A,polygonOffset:!0,polygonOffsetFactor:-10,fog:!1}))))},vW=new eT.Vector3,vK=new eT.Vector3,vq=e=>180*e/Math.PI,vX=e=>e*Math.PI/180,vZ=(e,t,r,i,n)=>{vW.copy(e).sub(r),vK.copy(t).sub(r);let a=i.dot(i),o=n.dot(n),s=vW.dot(i)/a,l=vW.dot(n)/o,c=vK.dot(i)/a;return Math.atan2(vK.dot(n)/o,c)-Math.atan2(l,s)},v$=(e,t)=>{let r=Math.floor(e/t);return e-(r=r<0?r+1:r)*t},v1=e=>{let t=v$(e,2*Math.PI);return 1e-6>Math.abs(t)?0:(t<0&&(t+=2*Math.PI),t)},v0=new eT.Matrix4,v2=new eT.Vector3,v3=new eT.Ray,v4=new eT.Vector3,v5=({dir1:e,dir2:t,axis:r})=>{let{rotationLimits:i,annotations:n,annotationsClass:a,depthTest:o,scale:s,lineWidth:l,fixed:c,axisColors:u,hoveredColor:h,opacity:A,onDragStart:d,onDrag:f,onDragEnd:m,userData:p}=eS.useContext(vG),g=(0,eR.D)(e=>e.controls),y=eS.useRef(null),v=eS.useRef(null),E=eS.useRef(0),x=eS.useRef(0),C=eS.useRef(null),[B,w]=eS.useState(!1),I=eS.useCallback(e=>{n&&(y.current.innerText=`${vq(x.current).toFixed(0)}\xba`,y.current.style.display="block"),e.stopPropagation();let t=e.point.clone(),i=new eT.Vector3().setFromMatrixPosition(v.current.matrixWorld),a=new eT.Vector3().setFromMatrixColumn(v.current.matrixWorld,0).normalize(),o=new eT.Vector3().setFromMatrixColumn(v.current.matrixWorld,1).normalize(),s=new eT.Vector3().setFromMatrixColumn(v.current.matrixWorld,2).normalize(),l=new eT.Plane().setFromNormalAndCoplanarPoint(s,i);C.current={clickPoint:t,origin:i,e1:a,e2:o,normal:s,plane:l},d({component:"Rotator",axis:r,origin:i,directions:[a,o,s]}),g&&(g.enabled=!1),e.target.setPointerCapture(e.pointerId)},[n,g,d,r]),b=eS.useCallback(e=>{if(e.stopPropagation(),B||w(!0),C.current){let{clickPoint:t,origin:a,e1:o,e2:s,normal:l,plane:c}=C.current,[u,h]=(null==i?void 0:i[r])||[void 0,void 0];v3.copy(e.ray),v3.intersectPlane(c,v4),v3.direction.negate(),v3.intersectPlane(c,v4);let A=vZ(t,v4,a,o,s),d=vq(A);e.shiftKey&&(A=vX(d=10*Math.round(d/10))),void 0!==u&&void 0!==h&&h-u<2*Math.PI?(A=(A=v1(A))>Math.PI?A-2*Math.PI:A,A=eT.MathUtils.clamp(A,u-E.current,h-E.current),x.current=E.current+A):(x.current=v1(E.current+A),x.current=x.current>Math.PI?x.current-2*Math.PI:x.current),n&&(d=vq(x.current),y.current.innerText=`${d.toFixed(0)}\xba`),v0.makeRotationAxis(l,A),v2.copy(a).applyMatrix4(v0).sub(a).negate(),v0.setPosition(v2),f(v0)}},[n,f,B,i,r]),_=eS.useCallback(e=>{n&&(y.current.style.display="none"),e.stopPropagation(),E.current=x.current,C.current=null,m(),g&&(g.enabled=!0),e.target.releasePointerCapture(e.pointerId)},[n,g,m]),M=eS.useCallback(e=>{e.stopPropagation(),w(!1)},[]),S=eS.useMemo(()=>{let r=e.clone().normalize(),i=t.clone().normalize();return new eT.Matrix4().makeBasis(r,i,r.clone().cross(i))},[e,t]),D=c?.65:.65*s,T=eS.useMemo(()=>{let e=[];for(let t=0;t<=32;t++){let r=Math.PI/2*t/32;e.push(new eT.Vector3(Math.cos(r)*D,Math.sin(r)*D,0))}return e},[D]);return eS.createElement("group",{ref:v,onPointerDown:I,onPointerMove:b,onPointerUp:_,onPointerOut:M,matrix:S,matrixAutoUpdate:!1},n&&eS.createElement(eN,{position:[D,D,0]},eS.createElement("div",{style:{display:"none",background:"#151520",color:"white",padding:"6px 8px",borderRadius:7,whiteSpace:"nowrap"},className:a,ref:y})),eS.createElement(oF,{points:T,lineWidth:4*l,visible:!1,userData:p}),eS.createElement(oF,{transparent:!0,raycast:()=>null,depthTest:o,points:T,lineWidth:l,side:eT.DoubleSide,color:B?h:u[r],opacity:A,polygonOffset:!0,polygonOffsetFactor:-10,fog:!1}))},v6=(e,t,r)=>{let i=Math.abs(e.x)>=Math.abs(e.y)&&Math.abs(e.x)>=Math.abs(e.z)?0:Math.abs(e.y)>=Math.abs(e.x)&&Math.abs(e.y)>=Math.abs(e.z)?1:2,n=[0,1,2].sort((e,r)=>Math.abs(t.getComponent(r))-Math.abs(t.getComponent(e))),a=i===n[0]?n[1]:n[0],o=e.getComponent(i),s=e.getComponent(a),l=t.getComponent(i),c=t.getComponent(a),u=r.getComponent(i),h=(r.getComponent(a)-s/o*u)/(c-s/o*l);return[(u-h*l)/o,h]},v8=new eT.Ray,v9=new eT.Vector3,v7=new eT.Matrix4,Ee=({dir1:e,dir2:t,axis:r})=>{let{translation:i,translationLimits:n,annotations:a,annotationsClass:o,depthTest:s,scale:l,lineWidth:c,fixed:u,axisColors:h,hoveredColor:A,opacity:d,onDragStart:f,onDrag:m,onDragEnd:p,userData:g}=eS.useContext(vG),y=(0,eR.D)(e=>e.controls),v=eS.useRef(null),E=eS.useRef(null),x=eS.useRef(null),C=eS.useRef(0),B=eS.useRef(0),[w,I]=eS.useState(!1),b=eS.useCallback(e=>{a&&(v.current.innerText=`${i.current[(r+1)%3].toFixed(2)}, ${i.current[(r+2)%3].toFixed(2)}`,v.current.style.display="block"),e.stopPropagation();let t=e.point.clone(),n=new eT.Vector3().setFromMatrixPosition(E.current.matrixWorld),o=new eT.Vector3().setFromMatrixColumn(E.current.matrixWorld,0).normalize(),s=new eT.Vector3().setFromMatrixColumn(E.current.matrixWorld,1).normalize(),l=new eT.Vector3().setFromMatrixColumn(E.current.matrixWorld,2).normalize(),c=new eT.Plane().setFromNormalAndCoplanarPoint(l,n);x.current={clickPoint:t,e1:o,e2:s,plane:c},C.current=i.current[(r+1)%3],B.current=i.current[(r+2)%3],f({component:"Slider",axis:r,origin:n,directions:[o,s,l]}),y&&(y.enabled=!1),e.target.setPointerCapture(e.pointerId)},[a,y,f,r]),_=eS.useCallback(e=>{if(e.stopPropagation(),w||I(!0),x.current){let{clickPoint:t,e1:o,e2:s,plane:l}=x.current,[c,u]=(null==n?void 0:n[(r+1)%3])||[void 0,void 0],[h,A]=(null==n?void 0:n[(r+2)%3])||[void 0,void 0];v8.copy(e.ray),v8.intersectPlane(l,v9),v8.direction.negate(),v8.intersectPlane(l,v9),v9.sub(t);let[d,f]=v6(o,s,v9);void 0!==c&&(d=Math.max(d,c-C.current)),void 0!==u&&(d=Math.min(d,u-C.current)),void 0!==h&&(f=Math.max(f,h-B.current)),void 0!==A&&(f=Math.min(f,A-B.current)),i.current[(r+1)%3]=C.current+d,i.current[(r+2)%3]=B.current+f,a&&(v.current.innerText=`${i.current[(r+1)%3].toFixed(2)}, ${i.current[(r+2)%3].toFixed(2)}`),v7.makeTranslation(d*o.x+f*s.x,d*o.y+f*s.y,d*o.z+f*s.z),m(v7)}},[a,m,w,i,n,r]),M=eS.useCallback(e=>{a&&(v.current.style.display="none"),e.stopPropagation(),x.current=null,p(),y&&(y.enabled=!0),e.target.releasePointerCapture(e.pointerId)},[a,y,p]),S=eS.useCallback(e=>{e.stopPropagation(),I(!1)},[]),D=eS.useMemo(()=>{let r=e.clone().normalize(),i=t.clone().normalize();return new eT.Matrix4().makeBasis(r,i,r.clone().cross(i))},[e,t]),T=u?1/7:l/7,R=u?.225:.225*l,F=w?A:h[r],P=eS.useMemo(()=>[new eT.Vector3(0,0,0),new eT.Vector3(0,R,0),new eT.Vector3(R,R,0),new eT.Vector3(R,0,0),new eT.Vector3(0,0,0)],[R]);return eS.createElement("group",{ref:E,matrix:D,matrixAutoUpdate:!1},a&&eS.createElement(eN,{position:[0,0,0]},eS.createElement("div",{style:{display:"none",background:"#151520",color:"white",padding:"6px 8px",borderRadius:7,whiteSpace:"nowrap"},className:o,ref:v})),eS.createElement("group",{position:[1.7*T,1.7*T,0]},eS.createElement("mesh",{visible:!0,onPointerDown:b,onPointerMove:_,onPointerUp:M,onPointerOut:S,scale:R,userData:g},eS.createElement("planeGeometry",null),eS.createElement("meshBasicMaterial",{transparent:!0,depthTest:s,color:F,polygonOffset:!0,polygonOffsetFactor:-10,side:eT.DoubleSide,fog:!1})),eS.createElement(oF,{position:[-R/2,-R/2,0],transparent:!0,depthTest:s,points:P,lineWidth:c,color:F,opacity:d,polygonOffset:!0,polygonOffsetFactor:-10,userData:g,fog:!1})))},Et=new eT.Vector3,Er=new eT.Vector3,Ei=(e,t,r,i)=>{let n=t.dot(t),a=t.dot(e)-t.dot(r),o=t.dot(i);return 0===o?-a/n:(Et.copy(i).multiplyScalar(n/o).sub(t),Er.copy(i).multiplyScalar(a/o).add(r).sub(e),-Et.dot(Er)/Et.dot(Et))},En=new eT.Vector3(0,1,0),Ea=new eT.Vector3,Eo=new eT.Matrix4,Es=({direction:e,axis:t})=>{let{scaleLimits:r,annotations:i,annotationsClass:n,depthTest:a,scale:o,lineWidth:s,fixed:l,axisColors:c,hoveredColor:u,opacity:h,onDragStart:A,onDrag:d,onDragEnd:f,userData:m}=eS.useContext(vG),p=(0,eR.D)(e=>e.size),g=(0,eR.D)(e=>e.controls),y=eS.useRef(null),v=eS.useRef(null),E=eS.useRef(null),x=eS.useRef(1),C=eS.useRef(1),B=eS.useRef(null),[w,I]=eS.useState(!1),b=l?1.2:1.2*o,_=eS.useCallback(r=>{i&&(y.current.innerText=`${C.current.toFixed(2)}`,y.current.style.display="block"),r.stopPropagation();let n=new eT.Matrix4().extractRotation(v.current.matrixWorld),a=r.point.clone(),s=new eT.Vector3().setFromMatrixPosition(v.current.matrixWorld),c=e.clone().applyMatrix4(n).normalize(),u=v.current.matrixWorld.clone(),h=u.clone().invert(),d=l?1/os(v.current.getWorldPosition(Et),o,r.camera,p):1;B.current={clickPoint:a,dir:c,mPLG:u,mPLGInv:h,offsetMultiplier:d},A({component:"Sphere",axis:t,origin:s,directions:[c]}),g&&(g.enabled=!1),r.target.setPointerCapture(r.pointerId)},[i,g,e,A,t,l,o,p]),M=eS.useCallback(e=>{if(e.stopPropagation(),w||I(!0),B.current){let{clickPoint:n,dir:a,mPLG:s,mPLGInv:c,offsetMultiplier:u}=B.current,[h,A]=(null==r?void 0:r[t])||[1e-5,void 0],f=Ei(n,a,e.ray.origin,e.ray.direction)*u,m=Math.pow(2,.2*(l?f:f/o));e.shiftKey&&(m=Math.round(10*m)/10),m=Math.max(m,h/x.current),void 0!==A&&(m=Math.min(m,A/x.current)),C.current=x.current*m,E.current.position.set(0,b+f,0),i&&(y.current.innerText=`${C.current.toFixed(2)}`),Ea.set(1,1,1),Ea.setComponent(t,m),Eo.makeScale(Ea.x,Ea.y,Ea.z).premultiply(s).multiply(c),d(Eo)}},[i,b,d,w,r,t]),S=eS.useCallback(e=>{i&&(y.current.style.display="none"),e.stopPropagation(),x.current=C.current,B.current=null,E.current.position.set(0,b,0),f(),g&&(g.enabled=!0),e.target.releasePointerCapture(e.pointerId)},[i,g,f,b]),D=eS.useCallback(e=>{e.stopPropagation(),I(!1)},[]),{radius:T,matrixL:R}=eS.useMemo(()=>{let t=l?s/o*1.8:o/22.5,r=new eT.Quaternion().setFromUnitVectors(En,e.clone().normalize());return{radius:t,matrixL:new eT.Matrix4().makeRotationFromQuaternion(r)}},[e,o,s,l]),F=w?u:c[t];return eS.createElement("group",{ref:v},eS.createElement("group",{matrix:R,matrixAutoUpdate:!1,onPointerDown:_,onPointerMove:M,onPointerUp:S,onPointerOut:D},i&&eS.createElement(eN,{position:[0,b/2,0]},eS.createElement("div",{style:{display:"none",background:"#151520",color:"white",padding:"6px 8px",borderRadius:7,whiteSpace:"nowrap"},className:n,ref:y})),eS.createElement("mesh",{ref:E,position:[0,b,0],renderOrder:500,userData:m},eS.createElement("sphereGeometry",{args:[T,12,12]}),eS.createElement("meshBasicMaterial",{transparent:!0,depthTest:a,color:F,opacity:h,polygonOffset:!0,polygonOffsetFactor:-10}))))},El=new eT.Matrix4,Ec=new eT.Matrix4,Eu=new eT.Matrix4,Eh=new eT.Matrix4,EA=new eT.Matrix4,Ed=new eT.Matrix4,Ef=new eT.Matrix4,Em=new eT.Matrix4,Ep=new eT.Matrix4,Eg=new eT.Box3,Ey=new eT.Box3,Ev=new eT.Vector3,EE=new eT.Vector3,Ex=new eT.Vector3,EC=new eT.Vector3,EB=new eT.Vector3,Ew=new eT.Vector3(1,0,0),EI=new eT.Vector3(0,1,0),Eb=new eT.Vector3(0,0,1),E_=eS.forwardRef(({enabled:e=!0,matrix:t,onDragStart:r,onDrag:i,onDragEnd:n,autoTransform:a=!0,anchor:o,disableAxes:s=!1,disableSliders:l=!1,disableRotations:c=!1,disableScaling:u=!1,activeAxes:h=[!0,!0,!0],offset:A=[0,0,0],rotation:d=[0,0,0],scale:f=1,lineWidth:m=4,fixed:p=!1,translationLimits:g,rotationLimits:y,scaleLimits:v,depthTest:E=!0,axisColors:x=["#ff2060","#20df80","#2080ff"],hoveredColor:C="#ffff40",annotations:B=!1,annotationsClass:w,opacity:I=1,visible:b=!0,userData:_,children:M,...S},D)=>{let T=(0,eR.D)(e=>e.invalidate),R=eS.useRef(null),F=eS.useRef(null),P=eS.useRef(null),Q=eS.useRef(null),z=eS.useRef([0,0,0]),L=eS.useRef(new eT.Vector3(1,1,1)),O=eS.useRef(new eT.Vector3(1,1,1));eS.useLayoutEffect(()=>{o&&(Q.current.updateWorldMatrix(!0,!0),Eh.copy(Q.current.matrixWorld).invert(),Eg.makeEmpty(),Q.current.traverse(e=>{e.geometry&&(e.geometry.boundingBox||e.geometry.computeBoundingBox(),Ed.copy(e.matrixWorld).premultiply(Eh),Ey.copy(e.geometry.boundingBox),Ey.applyMatrix4(Ed),Eg.union(Ey))}),Ev.copy(Eg.max).add(Eg.min).multiplyScalar(.5),EE.copy(Eg.max).sub(Eg.min).multiplyScalar(.5),Ex.copy(EE).multiply(new eT.Vector3(...o)).add(Ev),EC.set(...A).add(Ex),P.current.position.copy(EC),T())});let U=eS.useMemo(()=>({onDragStart:e=>{El.copy(F.current.matrix),Ec.copy(F.current.matrixWorld),r&&r(e),T()},onDrag:e=>{Eu.copy(R.current.matrixWorld),Eh.copy(Eu).invert(),EA.copy(Ec).premultiply(e),Ed.copy(EA).premultiply(Eh),Ef.copy(El).invert(),Em.copy(Ed).multiply(Ef),a&&F.current.matrix.copy(Ed),i&&i(Ed,Em,EA,e),T()},onDragEnd:()=>{n&&n(),T()},translation:z,translationLimits:g,rotationLimits:y,axisColors:x,hoveredColor:C,opacity:I,scale:f,lineWidth:m,fixed:p,depthTest:E,userData:_,annotations:B,annotationsClass:w}),[r,i,n,z,g,y,v,E,f,m,p,...x,C,I,_,a,B,w]),k=new eT.Vector3;return(0,eR.F)(e=>{if(p){let t=os(P.current.getWorldPosition(k),f,e.camera,e.size);L.current.setScalar(t)}t&&t instanceof eT.Matrix4&&(F.current.matrix=t),F.current.updateWorldMatrix(!0,!0),Ep.makeRotationFromEuler(P.current.rotation).setPosition(P.current.position).premultiply(F.current.matrixWorld),O.current.setFromMatrixScale(Ep),EB.copy(L.current).divide(O.current),(Math.abs(P.current.scale.x-EB.x)>1e-4||Math.abs(P.current.scale.y-EB.y)>1e-4||Math.abs(P.current.scale.z-EB.z)>1e-4)&&(P.current.scale.copy(EB),e.invalidate())}),eS.useImperativeHandle(D,()=>F.current,[]),eS.createElement(vG.Provider,{value:U},eS.createElement("group",{ref:R},eS.createElement("group",j({ref:F,matrix:t,matrixAutoUpdate:!1},S),eS.createElement("group",{visible:b,ref:P,position:A,rotation:d},e&&eS.createElement(eS.Fragment,null,!s&&h[0]&&eS.createElement(vY,{axis:0,direction:Ew}),!s&&h[1]&&eS.createElement(vY,{axis:1,direction:EI}),!s&&h[2]&&eS.createElement(vY,{axis:2,direction:Eb}),!l&&h[0]&&h[1]&&eS.createElement(Ee,{axis:2,dir1:Ew,dir2:EI}),!l&&h[0]&&h[2]&&eS.createElement(Ee,{axis:1,dir1:Eb,dir2:Ew}),!l&&h[2]&&h[1]&&eS.createElement(Ee,{axis:0,dir1:EI,dir2:Eb}),!c&&h[0]&&h[1]&&eS.createElement(v5,{axis:2,dir1:Ew,dir2:EI}),!c&&h[0]&&h[2]&&eS.createElement(v5,{axis:1,dir1:Eb,dir2:Ew}),!c&&h[2]&&h[1]&&eS.createElement(v5,{axis:0,dir1:EI,dir2:Eb}),!u&&h[0]&&eS.createElement(Es,{axis:0,direction:Ew}),!u&&h[1]&&eS.createElement(Es,{axis:1,direction:EI}),!u&&h[2]&&eS.createElement(Es,{axis:2,direction:Eb}))),eS.createElement("group",{ref:Q},M))))}),EM=(0,eS.forwardRef)(({options:e={video:!0},...t},r)=>{let i=(0,ok.Rq)(()=>navigator.mediaDevices.getDisplayMedia(e),[]);return(0,eS.useEffect)(()=>()=>{null==i||i.getTracks().forEach(e=>e.stop()),(0,ok.ZH)([])},[i]),eS.createElement(Aq,j({ref:r},t,{src:i}))}),ES=(0,eS.forwardRef)(({constraints:e={audio:!1,video:{facingMode:"user"}},...t},r)=>{let i=(0,ok.Rq)(()=>navigator.mediaDevices.getUserMedia(e),[]);return(0,eS.useEffect)(()=>()=>{null==i||i.getTracks().forEach(e=>e.stop()),(0,ok.ZH)([])},[i]),eS.createElement(Aq,j({ref:r},t,{src:i}))}),ED=new eT.Vector3(0,0,-1),ET=function(){let e=new eT.Vector3,t=new eT.Vector3,r=new eT.Vector3,i=new eT.Vector3,n=new eT.Vector3;return function(a,o,s,l){return e.copy(a),t.copy(o),r.copy(s),i.copy(t).sub(e),n.copy(r).sub(e),l.crossVectors(n,i).normalize()}}(),ER=eS.forwardRef(({points:e=EQ.SAMPLE_FACELANDMARKER_RESULT.faceLandmarks[0],face:t,facialTransformationMatrix:r,faceBlendshapes:i,offset:n,offsetScalar:a=80,width:o,height:s,depth:l=1,verticalTri:c=[159,386,152],origin:u,eyes:h=!0,eyesAsOrigin:A=!1,debug:d=!1,children:f,...m},p)=>{var g;t&&(e=t.keypoints,console.warn("Facemesh `face` prop is deprecated: use `points` instead"));let y=eS.useRef(null),v=eS.useRef(null),E=eS.useRef(null),x=eS.useRef(null),C=eS.useRef(null),B=eS.useRef(null),w=eS.useRef(null),[I]=eS.useState(()=>new eT.Vector3),[b]=eS.useState(()=>new eT.Object3D),[_]=eS.useState(()=>new eT.Quaternion),[M]=eS.useState(()=>new eT.Vector3),{invalidate:S}=(0,eR.D)();eS.useEffect(()=>{var e;null==(e=C.current)||e.geometry.setIndex(EQ.TRIANGULATION)},[]);let[D]=eS.useState(()=>new eT.Vector3);eS.useEffect(()=>{var t,f,m,p,g,T;let R=null==(t=C.current)?void 0:t.geometry;if(!R)return;R.setFromPoints(e),R.setDrawRange(0,EQ.TRIANGULATION.length),r?(b.matrix.fromArray(r.data),b.matrix.decompose(b.position,b.quaternion,b.scale),b.rotation.y*=-1,b.rotation.z*=-1,_.setFromEuler(b.rotation),n?(b.position.y*=-1,b.position.z*=-1,null==(m=y.current)||m.position.copy(b.position.divideScalar(a))):null==(p=y.current)||p.position.set(0,0,0)):(ET(e[c[0]],e[c[1]],e[c[2]],I),_.setFromUnitVectors(ED,I));let F=_.clone().invert();if(R.computeBoundingBox(),d&&S(),R.center(),R.applyQuaternion(F),null==(f=x.current)||f.setRotationFromQuaternion(_),h){if(i){if(B.current&&w.current&&E.current){if(A){let e=B.current._computeSphere(R),t=w.current._computeSphere(R);u=(g=e.center,T=t.center,g.clone().add(T).multiplyScalar(.5)).negate(),B.current._update(R,i,e),w.current._update(R,i,t)}else B.current._update(R,i),w.current._update(R,i)}}else console.warn("Facemesh `eyes` option only works if `faceBlendshapes` is provided: skipping.")}if(E.current){if(void 0!==u){if("number"==typeof u){let e=R.getAttribute("position");M.set(-e.getX(u),-e.getY(u),-e.getZ(u))}else u.isVector3&&M.copy(u)}else M.setScalar(0);E.current.position.copy(M)}if(v.current){let e=1;(o||s||l)&&(R.boundingBox.getSize(D),o&&(e=o/D.x),s&&(e=s/D.y),l&&(e=l/D.z)),v.current.scale.setScalar(1!==e?e:1)}R.computeVertexNormals(),R.attributes.position.needsUpdate=!0},[e,r,i,b,n,a,o,s,l,c,u,h,d,S,I,_,D,M]);let T=eS.useMemo(()=>({outerRef:x,meshRef:C,eyeRightRef:B,eyeLeftRef:w}),[]);eS.useImperativeHandle(p,()=>T,[T]);let[R]=eS.useState(()=>new eT.Vector3),F=null==(g=C.current)?void 0:g.geometry.boundingBox,P=(null==F?void 0:F.getSize(R).z)||1;return eS.createElement("group",m,eS.createElement("group",{ref:y},eS.createElement("group",{ref:x},eS.createElement("group",{ref:v},d?eS.createElement(eS.Fragment,null,eS.createElement("axesHelper",{args:[P]}),eS.createElement(oF,{points:[[0,0,0],[0,0,-P]],color:65535})):null,eS.createElement("group",{ref:E},h&&i&&eS.createElement("group",{name:"eyes"},eS.createElement(EP,{side:"left",ref:B,debug:d}),eS.createElement(EP,{side:"right",ref:w,debug:d})),eS.createElement("mesh",{ref:C,name:"face"},f,d?eS.createElement(eS.Fragment,null,F&&eS.createElement("box3Helper",{args:[F]})):null))))))}),EF={contourLandmarks:{right:[33,133,159,145,153],left:[263,362,386,374,380]},blendshapes:{right:[14,16,18,12],left:[13,15,17,11]},color:{right:"red",left:"#00ff00"},fov:{horizontal:100,vertical:90}},EP=eS.forwardRef(({side:e,debug:t=!0},r)=>{let i=eS.useRef(null),n=eS.useRef(null),[a]=eS.useState(()=>new eT.Sphere),o=eS.useCallback(t=>{let r=t.getAttribute("position"),i=EF.contourLandmarks[e].map(e=>new eT.Vector3(r.getX(e),r.getY(e),r.getZ(e)));return a.center.set(0,0,0),i.forEach(e=>a.center.add(e)),a.center.divideScalar(i.length),a.radius=i[0].sub(i[1]).length()/2,a},[a,e]),[s]=eS.useState(()=>new eT.Euler),l=eS.useCallback((t,r,a)=>{if(i.current){var l;null!==(l=a)&&void 0!==l||(a=o(t)),i.current.position.copy(a.center),i.current.scale.setScalar(a.radius)}if(r&&n.current){let t=EF.blendshapes[e],i=r.categories[t[0]].score,a=r.categories[t[1]].score,o=r.categories[t[2]].score,l=r.categories[t[3]].score,c=EF.fov.horizontal*eT.MathUtils.DEG2RAD,u=EF.fov.vertical*eT.MathUtils.DEG2RAD*.5*(i-a)*("left"===e?1:-1);s.set(.5*c*(l-o),u,0),n.current.setRotationFromEuler(s)}},[o,e,s]),c=eS.useMemo(()=>({eyeMeshRef:i,irisDirRef:n,_computeSphere:o,_update:l}),[o,l]);eS.useImperativeHandle(r,()=>c,[c]);let u=EF.color[e];return eS.createElement("group",null,eS.createElement("group",{ref:i},t&&eS.createElement("axesHelper",null),eS.createElement("group",{ref:n},eS.createElement(eS.Fragment,null,t&&eS.createElement(oF,{points:[[0,0,0],[0,0,-2]],lineWidth:1,color:u})))))}),EQ={TRIANGULATION:[127,34,139,11,0,37,232,231,120,72,37,39,128,121,47,232,121,128,104,69,67,175,171,148,157,154,155,118,50,101,73,39,40,9,151,108,48,115,131,194,204,211,74,40,185,80,42,183,40,92,186,230,229,118,202,212,214,83,18,17,76,61,146,160,29,30,56,157,173,106,204,194,135,214,192,203,165,98,21,71,68,51,45,4,144,24,23,77,146,91,205,50,187,201,200,18,91,106,182,90,91,181,85,84,17,206,203,36,148,171,140,92,40,39,193,189,244,159,158,28,247,246,161,236,3,196,54,68,104,193,168,8,117,228,31,189,193,55,98,97,99,126,47,100,166,79,218,155,154,26,209,49,131,135,136,150,47,126,217,223,52,53,45,51,134,211,170,140,67,69,108,43,106,91,230,119,120,226,130,247,63,53,52,238,20,242,46,70,156,78,62,96,46,53,63,143,34,227,173,155,133,123,117,111,44,125,19,236,134,51,216,206,205,154,153,22,39,37,167,200,201,208,36,142,100,57,212,202,20,60,99,28,158,157,35,226,113,160,159,27,204,202,210,113,225,46,43,202,204,62,76,77,137,123,116,41,38,72,203,129,142,64,98,240,49,102,64,41,73,74,212,216,207,42,74,184,169,170,211,170,149,176,105,66,69,122,6,168,123,147,187,96,77,90,65,55,107,89,90,180,101,100,120,63,105,104,93,137,227,15,86,85,129,102,49,14,87,86,55,8,9,100,47,121,145,23,22,88,89,179,6,122,196,88,95,96,138,172,136,215,58,172,115,48,219,42,80,81,195,3,51,43,146,61,171,175,199,81,82,38,53,46,225,144,163,110,246,33,7,52,65,66,229,228,117,34,127,234,107,108,69,109,108,151,48,64,235,62,78,191,129,209,126,111,35,143,163,161,246,117,123,50,222,65,52,19,125,141,221,55,65,3,195,197,25,7,33,220,237,44,70,71,139,122,193,245,247,130,33,71,21,162,153,158,159,170,169,150,188,174,196,216,186,92,144,160,161,2,97,167,141,125,241,164,167,37,72,38,12,145,159,160,38,82,13,63,68,71,226,35,111,158,153,154,101,50,205,206,92,165,209,198,217,165,167,97,220,115,218,133,112,243,239,238,241,214,135,169,190,173,133,171,208,32,125,44,237,86,87,178,85,86,179,84,85,180,83,84,181,201,83,182,137,93,132,76,62,183,61,76,184,57,61,185,212,57,186,214,207,187,34,143,156,79,239,237,123,137,177,44,1,4,201,194,32,64,102,129,213,215,138,59,166,219,242,99,97,2,94,141,75,59,235,24,110,228,25,130,226,23,24,229,22,23,230,26,22,231,112,26,232,189,190,243,221,56,190,28,56,221,27,28,222,29,27,223,30,29,224,247,30,225,238,79,20,166,59,75,60,75,240,147,177,215,20,79,166,187,147,213,112,233,244,233,128,245,128,114,188,114,217,174,131,115,220,217,198,236,198,131,134,177,132,58,143,35,124,110,163,7,228,110,25,356,389,368,11,302,267,452,350,349,302,303,269,357,343,277,452,453,357,333,332,297,175,152,377,384,398,382,347,348,330,303,304,270,9,336,337,278,279,360,418,262,431,304,408,409,310,415,407,270,409,410,450,348,347,422,430,434,313,314,17,306,307,375,387,388,260,286,414,398,335,406,418,364,367,416,423,358,327,251,284,298,281,5,4,373,374,253,307,320,321,425,427,411,421,313,18,321,405,406,320,404,405,315,16,17,426,425,266,377,400,369,322,391,269,417,465,464,386,257,258,466,260,388,456,399,419,284,332,333,417,285,8,346,340,261,413,441,285,327,460,328,355,371,329,392,439,438,382,341,256,429,420,360,364,394,379,277,343,437,443,444,283,275,440,363,431,262,369,297,338,337,273,375,321,450,451,349,446,342,467,293,334,282,458,461,462,276,353,383,308,324,325,276,300,293,372,345,447,382,398,362,352,345,340,274,1,19,456,248,281,436,427,425,381,256,252,269,391,393,200,199,428,266,330,329,287,273,422,250,462,328,258,286,384,265,353,342,387,259,257,424,431,430,342,353,276,273,335,424,292,325,307,366,447,345,271,303,302,423,266,371,294,455,460,279,278,294,271,272,304,432,434,427,272,407,408,394,430,431,395,369,400,334,333,299,351,417,168,352,280,411,325,319,320,295,296,336,319,403,404,330,348,349,293,298,333,323,454,447,15,16,315,358,429,279,14,15,316,285,336,9,329,349,350,374,380,252,318,402,403,6,197,419,318,319,325,367,364,365,435,367,397,344,438,439,272,271,311,195,5,281,273,287,291,396,428,199,311,271,268,283,444,445,373,254,339,263,466,249,282,334,296,449,347,346,264,447,454,336,296,299,338,10,151,278,439,455,292,407,415,358,371,355,340,345,372,390,249,466,346,347,280,442,443,282,19,94,370,441,442,295,248,419,197,263,255,359,440,275,274,300,383,368,351,412,465,263,467,466,301,368,389,380,374,386,395,378,379,412,351,419,436,426,322,373,390,388,2,164,393,370,462,461,164,0,267,302,11,12,374,373,387,268,12,13,293,300,301,446,261,340,385,384,381,330,266,425,426,423,391,429,355,437,391,327,326,440,457,438,341,382,362,459,457,461,434,430,394,414,463,362,396,369,262,354,461,457,316,403,402,315,404,403,314,405,404,313,406,405,421,418,406,366,401,361,306,408,407,291,409,408,287,410,409,432,436,410,434,416,411,264,368,383,309,438,457,352,376,401,274,275,4,421,428,262,294,327,358,433,416,367,289,455,439,462,370,326,2,326,370,305,460,455,254,449,448,255,261,446,253,450,449,252,451,450,256,452,451,341,453,452,413,464,463,441,413,414,258,442,441,257,443,442,259,444,443,260,445,444,467,342,445,459,458,250,289,392,290,290,328,460,376,433,435,250,290,392,411,416,433,341,463,464,453,464,465,357,465,412,343,412,399,360,363,440,437,399,456,420,456,363,401,435,288,372,383,353,339,255,249,448,261,255,133,243,190,133,155,112,33,246,247,33,130,25,398,384,286,362,398,414,362,463,341,263,359,467,263,249,255,466,467,260,75,60,166,238,239,79,162,127,139,72,11,37,121,232,120,73,72,39,114,128,47,233,232,128,103,104,67,152,175,148,173,157,155,119,118,101,74,73,40,107,9,108,49,48,131,32,194,211,184,74,185,191,80,183,185,40,186,119,230,118,210,202,214,84,83,17,77,76,146,161,160,30,190,56,173,182,106,194,138,135,192,129,203,98,54,21,68,5,51,4,145,144,23,90,77,91,207,205,187,83,201,18,181,91,182,180,90,181,16,85,17,205,206,36,176,148,140,165,92,39,245,193,244,27,159,28,30,247,161,174,236,196,103,54,104,55,193,8,111,117,31,221,189,55,240,98,99,142,126,100,219,166,218,112,155,26,198,209,131,169,135,150,114,47,217,224,223,53,220,45,134,32,211,140,109,67,108,146,43,91,231,230,120,113,226,247,105,63,52,241,238,242,124,46,156,95,78,96,70,46,63,116,143,227,116,123,111,1,44,19,3,236,51,207,216,205,26,154,22,165,39,167,199,200,208,101,36,100,43,57,202,242,20,99,56,28,157,124,35,113,29,160,27,211,204,210,124,113,46,106,43,204,96,62,77,227,137,116,73,41,72,36,203,142,235,64,240,48,49,64,42,41,74,214,212,207,183,42,184,210,169,211,140,170,176,104,105,69,193,122,168,50,123,187,89,96,90,66,65,107,179,89,180,119,101,120,68,63,104,234,93,227,16,15,85,209,129,49,15,14,86,107,55,9,120,100,121,153,145,22,178,88,179,197,6,196,89,88,96,135,138,136,138,215,172,218,115,219,41,42,81,5,195,51,57,43,61,208,171,199,41,81,38,224,53,225,24,144,110,105,52,66,118,229,117,227,34,234,66,107,69,10,109,151,219,48,235,183,62,191,142,129,126,116,111,143,7,163,246,118,117,50,223,222,52,94,19,141,222,221,65,196,3,197,45,220,44,156,70,139,188,122,245,139,71,162,145,153,159,149,170,150,122,188,196,206,216,92,163,144,161,164,2,167,242,141,241,0,164,37,11,72,12,144,145,160,12,38,13,70,63,71,31,226,111,157,158,154,36,101,205,203,206,165,126,209,217,98,165,97,237,220,218,237,239,241,210,214,169,140,171,32,241,125,237,179,86,178,180,85,179,181,84,180,182,83,181,194,201,182,177,137,132,184,76,183,185,61,184,186,57,185,216,212,186,192,214,187,139,34,156,218,79,237,147,123,177,45,44,4,208,201,32,98,64,129,192,213,138,235,59,219,141,242,97,97,2,141,240,75,235,229,24,228,31,25,226,230,23,229,231,22,230,232,26,231,233,112,232,244,189,243,189,221,190,222,28,221,223,27,222,224,29,223,225,30,224,113,247,225,99,60,240,213,147,215,60,20,166,192,187,213,243,112,244,244,233,245,245,128,188,188,114,174,134,131,220,174,217,236,236,198,134,215,177,58,156,143,124,25,110,7,31,228,25,264,356,368,0,11,267,451,452,349,267,302,269,350,357,277,350,452,357,299,333,297,396,175,377,381,384,382,280,347,330,269,303,270,151,9,337,344,278,360,424,418,431,270,304,409,272,310,407,322,270,410,449,450,347,432,422,434,18,313,17,291,306,375,259,387,260,424,335,418,434,364,416,391,423,327,301,251,298,275,281,4,254,373,253,375,307,321,280,425,411,200,421,18,335,321,406,321,320,405,314,315,17,423,426,266,396,377,369,270,322,269,413,417,464,385,386,258,248,456,419,298,284,333,168,417,8,448,346,261,417,413,285,326,327,328,277,355,329,309,392,438,381,382,256,279,429,360,365,364,379,355,277,437,282,443,283,281,275,363,395,431,369,299,297,337,335,273,321,348,450,349,359,446,467,283,293,282,250,458,462,300,276,383,292,308,325,283,276,293,264,372,447,346,352,340,354,274,19,363,456,281,426,436,425,380,381,252,267,269,393,421,200,428,371,266,329,432,287,422,290,250,328,385,258,384,446,265,342,386,387,257,422,424,430,445,342,276,422,273,424,306,292,307,352,366,345,268,271,302,358,423,371,327,294,460,331,279,294,303,271,304,436,432,427,304,272,408,395,394,431,378,395,400,296,334,299,6,351,168,376,352,411,307,325,320,285,295,336,320,319,404,329,330,349,334,293,333,366,323,447,316,15,315,331,358,279,317,14,316,8,285,9,277,329,350,253,374,252,319,318,403,351,6,419,324,318,325,397,367,365,288,435,397,278,344,439,310,272,311,248,195,281,375,273,291,175,396,199,312,311,268,276,283,445,390,373,339,295,282,296,448,449,346,356,264,454,337,336,299,337,338,151,294,278,455,308,292,415,429,358,355,265,340,372,388,390,466,352,346,280,295,442,282,354,19,370,285,441,295,195,248,197,457,440,274,301,300,368,417,351,465,251,301,389,385,380,386,394,395,379,399,412,419,410,436,322,387,373,388,326,2,393,354,370,461,393,164,267,268,302,12,386,374,387,312,268,13,298,293,301,265,446,340,380,385,381,280,330,425,322,426,391,420,429,437,393,391,326,344,440,438,458,459,461,364,434,394,428,396,262,274,354,457,317,316,402,316,315,403,315,314,404,314,313,405,313,421,406,323,366,361,292,306,407,306,291,408,291,287,409,287,432,410,427,434,411,372,264,383,459,309,457,366,352,401,1,274,4,418,421,262,331,294,358,435,433,367,392,289,439,328,462,326,94,2,370,289,305,455,339,254,448,359,255,446,254,253,449,253,252,450,252,256,451,256,341,452,414,413,463,286,441,414,286,258,441,258,257,442,257,259,443,259,260,444,260,467,445,309,459,250,305,289,290,305,290,460,401,376,435,309,250,392,376,411,433,453,341,464,357,453,465,343,357,412,437,343,399,344,360,440,420,437,456,360,420,363,361,401,288,265,372,353,390,339,249,339,448,255],SAMPLE_FACE:{keypoints:[{x:356.2804412841797,y:295.1960563659668,z:-23.786449432373047,name:"lips"},{x:354.8859405517578,y:264.69520568847656,z:-36.718435287475586},{x:355.2180862426758,y:275.3360366821289,z:-21.183712482452393},{x:347.349853515625,y:242.4400234222412,z:-25.093655586242676},{x:354.40135955810547,y:256.67933464050293,z:-38.23572635650635},{x:353.7689971923828,y:247.54886627197266,z:-34.5475435256958},{x:352.1288299560547,y:227.34312057495117,z:-13.095386028289795},{x:303.5013198852539,y:234.67002868652344,z:12.500141859054565,name:"rightEye"},{x:351.09378814697266,y:211.87547206878662,z:-6.413471698760986},{x:350.7115936279297,y:202.1251630783081,z:-6.413471698760986},{x:348.33667755126953,y:168.7741756439209,z:6.483500003814697,name:"faceOval"},{x:356.4806365966797,y:299.2995357513428,z:-23.144519329071045},{x:356.5511703491211,y:302.66146659851074,z:-21.020312309265137},{x:356.6239547729492,y:304.1536331176758,z:-18.137459754943848,name:"lips"},{x:356.5807342529297,y:305.1840591430664,z:-18.767719268798828,name:"lips"},{x:356.8241500854492,y:308.25711250305176,z:-20.16829490661621},{x:357.113037109375,y:312.26277351379395,z:-22.10575819015503},{x:357.34962463378906,y:317.1123218536377,z:-21.837315559387207,name:"lips"},{x:357.6658630371094,y:325.51036834716797,z:-16.27002477645874},{x:355.0201416015625,y:269.36279296875,z:-33.73054027557373},{x:348.5237503051758,y:270.33411026000977,z:-24.93025302886963},{x:279.97331619262695,y:213.24176788330078,z:47.759642601013184,name:"faceOval"},{x:322.66529083251953,y:238.5027265548706,z:5.535193085670471},{x:316.0983657836914,y:239.94489669799805,z:5.777376294136047},{x:309.9431610107422,y:240.24518966674805,z:7.510589361190796},{x:301.31994247436523,y:237.86138534545898,z:13.118728399276733},{x:328.14266204833984,y:235.80496788024902,z:6.646900177001953},{x:313.7326431274414,y:222.11161136627197,z:3.9887237548828125},{x:320.45196533203125,y:221.87729358673096,z:4.601476192474365},{x:307.35679626464844,y:223.63793849945068,z:5.932023525238037},{x:303.0031204223633,y:226.3743782043457,z:8.479321002960205},{x:296.80023193359375,y:242.94299125671387,z:15.931552648544312},{x:332.2352981567383,y:340.77341079711914,z:-10.165848731994629},{x:301.38587951660156,y:233.46447944641113,z:14.764405488967896,name:"rightEye"},{x:279.0147018432617,y:244.37155723571777,z:45.77549457550049},{x:289.60548400878906,y:239.1807460784912,z:23.191204071044922},{x:320.32257080078125,y:267.1292781829834,z:-4.954537749290466},{x:347.64583587646484,y:294.4955062866211,z:-23.062820434570313,name:"lips"},{x:349.28138732910156,y:303.1095886230469,z:-20.238323211669922},{x:338.9453125,y:298.19186210632324,z:-19.456336498260498,name:"lips"},{x:333.36788177490234,y:302.6706790924072,z:-14.776077270507813,name:"lips"},{x:342.89188385009766,y:304.3561363220215,z:-17.752301692962646},{x:337.7375030517578,y:306.0098361968994,z:-13.410515785217285},{x:325.6159210205078,y:316.22995376586914,z:-6.681914925575256},{x:349.0104675292969,y:264.9818515777588,z:-36.274919509887695},{x:347.7138900756836,y:257.5664806365967,z:-37.67549514770508},{x:291.79357528686523,y:218.88171672821045,z:11.578094959259033,name:"rightEyebrow"},{x:332.2689437866211,y:247.56946563720703,z:-3.3730539679527283},{x:332.0074462890625,y:267.1201229095459,z:-19.969879388809204},{x:331.27952575683594,y:263.6967658996582,z:-17.47218608856201},{x:301.04373931884766,y:269.56552505493164,z:3.61815482378006},{x:347.4863815307617,y:249.0706443786621,z:-32.633421421051025},{x:307.26118087768555,y:208.2646894454956,z:1.1591226607561111,name:"rightEyebrow"},{x:297.91919708251953,y:212.22604751586914,z:5.914516448974609,name:"rightEyebrow"},{x:285.1651382446289,y:197.98450469970703,z:36.391637325286865,name:"faceOval"},{x:337.04097747802734,y:211.25229835510254,z:-4.548954665660858},{x:326.5912628173828,y:223.16698551177979,z:6.670243740081787},{x:320.05664825439453,y:309.5834255218506,z:-4.055835008621216},{x:289.6866226196289,y:314.617395401001,z:53.875489234924316,name:"faceOval"},{x:337.4256896972656,y:270.8755302429199,z:-17.67060160636902},{x:343.69922637939453,y:273.0000400543213,z:-18.756048679351807},{x:327.4242401123047,y:309.22399520874023,z:-4.703601002693176,name:"lips"},{x:330.37220001220703,y:308.3323001861572,z:-6.442649960517883},{x:293.87027740478516,y:207.7961826324463,z:9.821539521217346,name:"rightEyebrow"},{x:332.11437225341797,y:271.22812271118164,z:-16.64351224899292},{x:320.1197814941406,y:207.40366458892822,z:-2.48164564371109,name:"rightEyebrow"},{x:318.59575271606445,y:201.07443809509277,z:-3.110446035861969,name:"rightEyebrow"},{x:310.72303771972656,y:175.75075149536133,z:13.328815698623657,name:"faceOval"},{x:289.67578887939453,y:202.29835510253906,z:21.370456218719482},{x:315.30879974365234,y:187.35260009765625,z:5.0304025411605835},{x:287.8936767578125,y:216.54793739318848,z:17.81065821647644,name:"rightEyebrow"},{x:283.9391899108887,y:215.01142501831055,z:32.04984903335571},{x:348.35330963134766,y:299.4155788421631,z:-22.47924566268921},{x:341.1790466308594,y:301.8221855163574,z:-18.977805376052856},{x:335.69713592529297,y:304.4266891479492,z:-14.682706594467163},{x:339.4615173339844,y:272.3654365539551,z:-16.38674020767212},{x:328.99600982666016,y:308.86685371398926,z:-5.616893768310547},{x:332.00313568115234,y:309.1875743865967,z:-10.335084199905396},{x:331.0068130493164,y:307.9274368286133,z:-6.681914925575256,name:"lips"},{x:341.13792419433594,y:266.4876937866211,z:-26.56425952911377},{x:339.02950286865234,y:305.6663703918457,z:-12.33674168586731,name:"lips"},{x:344.22935485839844,y:304.9452781677246,z:-15.161235332489014,name:"lips"},{x:350.1844024658203,y:304.374303817749,z:-17.5305438041687,name:"lips"},{x:348.52630615234375,y:325.9562301635742,z:-16.164982318878174},{x:348.6581802368164,y:317.1624183654785,z:-21.510512828826904,name:"lips"},{x:348.9766311645508,y:312.1923065185547,z:-21.708929538726807},{x:349.2427444458008,y:308.0660820007324,z:-19.643079042434692},{x:349.67491149902344,y:305.42747497558594,z:-18.16080331802368,name:"lips"},{x:337.95589447021484,y:306.6535949707031,z:-12.803598642349243,name:"lips"},{x:337.06878662109375,y:307.63169288635254,z:-14.274203777313232},{x:335.77449798583984,y:309.8449516296387,z:-15.698124170303345},{x:334.6099090576172,y:312.7997016906738,z:-14.764405488967896,name:"lips"},{x:327.2330856323242,y:293.80866050720215,z:-11.864047050476074},{x:280.97679138183594,y:279.79928970336914,z:68.90834331512451,name:"faceOval"},{x:355.13843536376953,y:271.7875671386719,z:-25.350427627563477},{x:334.7235870361328,y:307.4656391143799,z:-9.302158951759338,name:"lips"},{x:333.5293960571289,y:307.89782524108887,z:-10.200862884521484},{x:346.29688262939453,y:276.4256286621094,z:-19.748122692108154},{x:335.16246795654297,y:276.22097969055176,z:-12.313398122787476},{x:345.09132385253906,y:274.7082996368408,z:-19.304605722427368},{x:325.4267883300781,y:252.95130729675293,z:-1.6661019623279572},{x:315.347843170166,y:259.05200958251953,z:-.25604281574487686},{x:330.44933319091797,y:267.7570152282715,z:-14.017432928085327},{x:294.96768951416016,y:185.26001930236816,z:23.903164863586426,name:"faceOval"},{x:299.63531494140625,y:192.7913761138916,z:12.640198469161987},{x:304.5452117919922,y:202.4142837524414,z:3.244667649269104,name:"rightEyebrow"},{x:331.6915512084961,y:320.0467872619629,z:-10.632705688476563},{x:334.5911407470703,y:201.27566814422607,z:-6.133356094360352,name:"rightEyebrow"},{x:331.4815902709961,y:185.44180870056152,z:.6627205014228821},{x:328.05816650390625,y:170.8385467529297,z:7.358860373497009,name:"faceOval"},{x:304.49764251708984,y:239.76297855377197,z:10.387605428695679},{x:290.6382179260254,y:248.85257720947266,z:19.03616428375244},{x:331.5682601928711,y:233.20727348327637,z:7.837390303611755},{x:295.5115509033203,y:228.9834451675415,z:14.41426157951355},{x:336.94332122802734,y:241.8259334564209,z:-5.27842104434967},{x:336.2792205810547,y:262.7049922943115,z:-26.12074375152588},{x:284.4102478027344,y:255.3262710571289,z:25.467140674591064},{x:295.1420593261719,y:253.02655220031738,z:12.430112361907959},{x:303.5196113586426,y:254.20703887939453,z:6.139191389083862},{x:315.73450088500977,y:251.64799690246582,z:3.3788898587226868},{x:324.69661712646484,y:247.56494522094727,z:2.3328344523906708},{x:331.57970428466797,y:243.02241325378418,z:1.1423448473215103},{x:345.6210708618164,y:229.9976634979248,z:-10.825285911560059},{x:286.26644134521484,y:270.37991523742676,z:21.708929538726807},{x:290.2525520324707,y:228.4921360015869,z:17.71728754043579},{x:351.65367126464844,y:269.3400764465332,z:-33.450424671173096},{x:333.1378936767578,y:253.88388633728027,z:-7.230473756790161},{x:277.8318977355957,y:246.95331573486328,z:68.20805549621582,name:"faceOval"},{x:336.6680908203125,y:238.10003757476807,z:.7688578963279724},{x:329.95800018310547,y:269.18323516845703,z:-7.207130789756775},{x:299.17491912841797,y:234.13324356079102,z:15.95489501953125},{x:335.61729431152344,y:258.71752738952637,z:-23.016133308410645},{x:284.1079330444336,y:297.0343494415283,z:63.25934886932373,name:"faceOval"},{x:331.44542694091797,y:230.6892442703247,z:9.92658257484436,name:"rightEye"},{x:341.41536712646484,y:253.01264762878418,z:-29.038610458374023},{x:303.5472869873047,y:327.5896739959717,z:16.725212335586548},{x:304.7756576538086,y:337.4389457702637,z:27.38126277923584,name:"faceOval"},{x:280.80501556396484,y:275.32050132751465,z:45.0752067565918},{x:295.43582916259766,y:318.4501647949219,z:26.2608003616333},{x:281.4303207397461,y:228.7355661392212,z:40.94350814819336},{x:331.2549591064453,y:349.4216537475586,z:-7.376367449760437},{x:352.4247741699219,y:271.7330074310303,z:-24.953596591949463},{x:327.5672912597656,y:260.41900634765625,z:-5.456410646438599},{x:284.5432472229004,y:241.7647933959961,z:29.668869972229004},{x:310,y:235.66174507141113,z:8.502663969993591,name:"rightEye"},{x:315.7071113586426,y:235.7572603225708,z:6.938687562942505,name:"rightEye"},{x:330.41088104248047,y:311.04143142700195,z:-9.325502514839172,name:"lips"},{x:288.5377502441406,y:285.31983375549316,z:21.837315559387207},{x:344.55039978027344,y:359.4300842285156,z:-6.705257892608643,name:"faceOval"},{x:323.41880798339844,y:351.67362213134766,z:7.802375555038452,name:"faceOval"},{x:314.64088439941406,y:346.11894607543945,z:16.36339783668518,name:"faceOval"},{x:349.4945526123047,y:184.8434829711914,z:-.21847527474164963},{x:359.24694061279297,y:359.8348903656006,z:-8.403456211090088,name:"faceOval"},{x:321.26182556152344,y:234.64492321014404,z:6.90950870513916,name:"rightEye"},{x:326.318359375,y:232.90250301361084,z:8.029969334602356,name:"rightEye"},{x:329.6211624145508,y:231.6195774078369,z:9.722331762313843,name:"rightEye"},{x:285.9398078918457,y:228.2351303100586,z:24.650139808654785},{x:325.79288482666016,y:227.88007736206055,z:7.469738721847534,name:"rightEye"},{x:320.1699447631836,y:227.5934886932373,z:6.168370842933655,name:"rightEye"},{x:314.85408782958984,y:227.85282611846924,z:6.2675780057907104,name:"rightEye"},{x:309.3084907531738,y:229.1516876220703,z:7.7031683921813965,name:"rightEye"},{x:305.5621337890625,y:230.92366218566895,z:9.722331762313843,name:"rightEye"},{x:277.8681945800781,y:228.5354232788086,z:59.71122741699219,name:"faceOval"},{x:306.1444664001465,y:235.1954698562622,z:10.603528022766113,name:"rightEye"},{x:355.4478454589844,y:281.96210861206055,z:-20.565123558044434},{x:333.02661895751953,y:288.0105400085449,z:-14.72939133644104},{x:337.15728759765625,y:269.2059516906738,z:-19.8414945602417},{x:345.9898376464844,y:283.5453128814697,z:-20.4834246635437},{x:351.48963928222656,y:219.98916149139404,z:-7.0378947257995605},{x:312.39574432373047,y:336.50628089904785,z:8.671900033950806},{x:321.32152557373047,y:343.1755256652832,z:.9067271649837494},{x:343.78379821777344,y:353.2975959777832,z:-14.355905055999756},{x:296.8791389465332,y:327.91497230529785,z:41.01353645324707,name:"faceOval"},{x:329.6939468383789,y:229.27897453308105,z:8.934508562088013,name:"rightEye"},{x:341.6905212402344,y:241.4073657989502,z:-14.589333534240723},{x:359.03079986572266,y:353.48859786987305,z:-15.803166627883911},{x:333.1861877441406,y:356.43213272094727,z:-1.0234417766332626,name:"faceOval"},{x:283.97483825683594,y:291.4318656921387,z:41.94725513458252},{x:343.33770751953125,y:305.830135345459,z:-15.756480693817139,name:"lips"},{x:342.40283966064453,y:307.7453899383545,z:-17.4021577835083},{x:341.53621673583984,y:311.0595703125,z:-19.047834873199463},{x:340.9107208251953,y:315.4837703704834,z:-18.5576331615448,name:"lips"},{x:339.1478729248047,y:323.42233657836914,z:-14.367576837539673},{x:333.3201599121094,y:307.4406337738037,z:-9.617288708686829},{x:331.2411117553711,y:306.9811820983887,z:-9.669809937477112},{x:329.23255920410156,y:306.0508346557617,z:-9.582273960113525,name:"lips"},{x:322.4586486816406,y:301.33323669433594,z:-7.720675468444824},{x:297.1712112426758,y:286.9552803039551,z:8.240055441856384},{x:341.3060760498047,y:235.4432201385498,z:-7.504753470420837},{x:336.9318389892578,y:224.3451976776123,z:5.829898118972778},{x:332.65323638916016,y:226.70403957366943,z:8.105834126472473},{x:334.67357635498047,y:306.4397621154785,z:-8.981193900108337,name:"lips"},{x:297.4601936340332,y:306.29210472106934,z:15.476365089416504},{x:342.9119110107422,y:222.37077713012695,z:-2.754466235637665},{x:335.4629898071289,y:332.20250129699707,z:-11.823196411132813},{x:353.2412338256836,y:240.56339263916016,z:-27.147831916809082},{x:346.3080596923828,y:236.41446590423584,z:-18.452589511871338},{x:352.6475143432617,y:234.1420555114746,z:-19.748122692108154},{x:337.3209762573242,y:253.39937210083008,z:-16.024924516677856},{x:358.6122131347656,y:344.90861892700195,z:-18.592647314071655},{x:358.1117248535156,y:334.64990615844727,z:-17.49552845954895},{x:346.4450454711914,y:335.0321102142334,z:-16.32838249206543},{x:319.17640686035156,y:320.2833938598633,z:-3.276764452457428},{x:325.2540588378906,y:276.2369728088379,z:-6.460157036781311},{x:326.7214584350586,y:327.3939514160156,z:-7.417217493057251},{x:310.7190132141113,y:277.2265148162842,z:-3.5452082753181458},{x:319.78355407714844,y:284.8238182067871,z:-6.4543211460113525},{x:305.773983001709,y:290.83580017089844,z:.06907138042151928},{x:344.4001770019531,y:344.85408782958984,z:-16.946970224380493},{x:333.1879425048828,y:258.74256134033203,z:-11.90489649772644},{x:313.80598068237305,y:327.08919525146484,z:2.2277912497520447},{x:322.9637908935547,y:334.6819496154785,z:-3.3643004298210144},{x:313.4055519104004,y:311.2166690826416,z:-1.1175429821014404},{x:291.0865783691406,y:298.2831001281738,z:22.467575073242188},{x:305.6580924987793,y:313.3707904815674,z:5.561453700065613},{x:288.23760986328125,y:305.9941864013672,z:36.765122413635254},{x:315.10692596435547,y:296.26991271972656,z:-4.604393839836121},{x:337.50518798828125,y:247.5944423675537,z:-10.597691535949707},{x:338.8450622558594,y:265.47778129577637,z:-27.778091430664063},{x:334.25254821777344,y:269.0671920776367,z:-20.938611030578613},{x:341.64512634277344,y:259.6387195587158,z:-32.189905643463135},{x:331.44081115722656,y:219.0976095199585,z:4.207563698291779},{x:320.56339263916016,y:216.49658203125,z:2.930997312068939},{x:311.21912002563477,y:216.57853603363037,z:2.9674705862998962},{x:303.46256256103516,y:218.54614734649658,z:5.357203483581543},{x:297.99999237060547,y:222.505202293396,z:9.325502514839172},{x:294.93839263916016,y:236.39654159545898,z:18.534289598464966},{x:278.87489318847656,y:259.7095584869385,z:45.68212032318115},{x:300.3782653808594,y:245.38593292236328,z:12.278382778167725},{x:307.06348419189453,y:246.36857986450195,z:8.164191246032715},{x:315.5229187011719,y:245.3949737548828,z:5.503097176551819},{x:323.71395111083984,y:242.75178909301758,z:4.6335723996162415},{x:330.2785873413086,y:239.34658527374268,z:4.937030673027039},{x:334.6982192993164,y:236.0460376739502,z:4.823233783245087},{x:279.3412208557129,y:263.5196113586426,z:70.91583728790283,name:"faceOval"},{x:334.65972900390625,y:271.6648578643799,z:-17.775644063949585},{x:342.05677032470703,y:246.99846267700195,z:-20.84523916244507},{x:344.0357971191406,y:264.5701503753662,z:-32.936880588531494},{x:348.25531005859375,y:268.6645030975342,z:-30.695960521697998},{x:344.12227630615234,y:266.34212493896484,z:-29.808926582336426},{x:337.12318420410156,y:274.2556858062744,z:-15.768152475357056},{x:349.49047088623047,y:269.071683883667,z:-32.51670837402344},{x:350.1683044433594,y:271.4691352844238,z:-24.93025302886963},{x:333.9634704589844,y:230.56639194488525,z:8.89949381351471},{x:338.2147979736328,y:231.4807891845703,z:4.6715047955513},{x:340.4712677001953,y:231.74463272094727,z:-.34996166825294495},{x:303.28975677490234,y:232.24980354309082,z:11.916568279266357,name:"rightEye"},{x:299.4649124145508,y:229.53842639923096,z:12.325069904327393},{x:359.09618377685547,y:241.77349090576172,z:-24.650139808654785},{x:399.46216583251953,y:229.89503860473633,z:15.919880867004395,name:"leftEye"},{x:361.38919830322266,y:269.6129894256592,z:-24.510080814361572},{x:416.9973373413086,y:206.0895538330078,z:53.26857566833496,name:"faceOval"},{x:381.32179260253906,y:235.5476474761963,z:7.6214683055877686},{x:387.8068542480469,y:236.25958442687988,z:8.345099091529846},{x:393.95751953125,y:235.8660364151001,z:10.475142002105713},{x:401.84600830078125,y:232.77019500732422,z:16.760226488113403},{x:375.70568084716797,y:233.48456382751465,z:8.234220147132874},{x:388.17752838134766,y:218.94717693328857,z:6.810300946235657},{x:381.64928436279297,y:219.2656660079956,z:6.711093783378601},{x:394.4760513305664,y:219.66821193695068,z:9.173773527145386},{x:398.8843536376953,y:221.8837022781372,z:12.03328251838684},{x:406.5454864501953,y:237.12156772613525,z:19.7131085395813},{x:383.87447357177734,y:337.6932907104492,z:-8.631049990653992},{x:401.2682342529297,y:228.5916566848755,z:18.359217643737793,name:"leftEye"},{x:422.0449447631836,y:236.73934936523438,z:51.16771221160889},{x:412.69153594970703,y:232.80198097229004,z:27.52131938934326},{x:387.3497772216797,y:263.298397064209,z:-2.8609684109687805},{x:364.5124053955078,y:293.39221000671387,z:-22.397546768188477,name:"lips"},{x:363.62987518310547,y:302.1291446685791,z:-19.643079042434692},{x:373.2334518432617,y:295.8647060394287,z:-18.125789165496826,name:"lips"},{x:378.83365631103516,y:299.5177745819092,z:-13.153743743896484,name:"lips"},{x:369.91477966308594,y:302.5704002380371,z:-16.65518283843994},{x:374.9167251586914,y:303.5416603088379,z:-11.963253021240234},{x:387.58888244628906,y:312.2716999053955,z:-4.680258631706238},{x:360.6635284423828,y:264.31986808776855,z:-35.94811677932739},{x:361.04564666748047,y:256.8225860595703,z:-37.278664112091064},{x:408.3855438232422,y:213.52088928222656,z:15.756480693817139,name:"leftEyebrow"},{x:373.2946014404297,y:245.38101196289063,z:-1.9316278398036957},{x:376.83860778808594,y:264.3721103668213,z:-18.510947227478027},{x:376.9546127319336,y:261.0010528564453,z:-15.989909172058105},{x:406.1498260498047,y:263.5030174255371,z:7.072908878326416},{x:360.07205963134766,y:248.3631706237793,z:-32.16656446456909},{x:393.11119079589844,y:205.10473251342773,z:3.7786373496055603,name:"leftEyebrow"},{x:402.12791442871094,y:207.89000988006592,z:9.383859634399414,name:"leftEyebrow"},{x:410.8693313598633,y:191.6182279586792,z:41.27030849456787,name:"faceOval"},{x:364.9509811401367,y:210.40483474731445,z:-3.758212625980377},{x:375.94444274902344,y:221.1331844329834,z:8.368442058563232},{x:392.1904754638672,y:305.0360298156738,z:-1.752179116010666},{x:419.50225830078125,y:307.25592613220215,z:58.96425247192383,name:"faceOval"},{x:372.0027160644531,y:268.7212657928467,z:-16.631840467453003},{x:366.1614227294922,y:271.6237449645996,z:-18.219159841537476},{x:385.00938415527344,y:305.3863334655762,z:-2.567722797393799},{x:381.99771881103516,y:304.9723720550537,z:-4.575215280056},{x:405.078125,y:203.21216583251953,z:13.713973760604858,name:"leftEyebrow"},{x:377.13207244873047,y:268.4710121154785,z:-15.266278982162476},{x:380.9713363647461,y:205.36980628967285,z:-.7250899076461792,name:"leftEyebrow"},{x:381.7788314819336,y:198.9268398284912,z:-1.184653863310814,name:"leftEyebrow"},{x:385.5204772949219,y:172.1484375,z:16.04826807975769,name:"faceOval"},{x:407.94189453125,y:196.76236152648926,z:25.723915100097656},{x:383.03890228271484,y:184.5157527923584,z:7.393874526023865},{x:411.61781311035156,y:210.79241752624512,z:22.315845489501953,name:"leftEyebrow"},{x:414.30870056152344,y:208.4643030166626,z:37.021894454956055},{x:364.28722381591797,y:298.35777282714844,z:-21.86065673828125},{x:371.3682556152344,y:299.78848457336426,z:-17.834001779556274},{x:376.88201904296875,y:301.6696071624756,z:-13.153743743896484},{x:370.2193832397461,y:270.49095153808594,z:-15.569736957550049},{x:383.5081100463867,y:305.2726364135742,z:-3.673594295978546},{x:380.73760986328125,y:305.96869468688965,z:-8.660228252410889},{x:381.2334442138672,y:304.63574409484863,z:-4.820316135883331,name:"lips"},{x:368.1698989868164,y:264.8884963989258,z:-25.653886795043945},{x:373.5087203979492,y:303.4233856201172,z:-10.95950722694397,name:"lips"},{x:368.4544372558594,y:303.29601287841797,z:-14.169161319732666,name:"lips"},{x:362.76554107666016,y:303.5735607147217,z:-16.911956071853638,name:"lips"},{x:366.60980224609375,y:324.8870658874512,z:-15.616422891616821},{x:365.7067108154297,y:315.95678329467773,z:-20.903596878051758,name:"lips"},{x:365.0083923339844,y:311.2232208251953,z:-21.066999435424805},{x:364.1508102416992,y:307.0583438873291,z:-18.907777070999146},{x:363.37512969970703,y:304.5721435546875,z:-17.42550015449524,name:"lips"},{x:374.580078125,y:304.3059539794922,z:-11.40302300453186,name:"lips"},{x:375.55362701416016,y:305.0998020172119,z:-12.861957550048828},{x:377.2437286376953,y:307.1674346923828,z:-14.215847253799438},{x:378.68587493896484,y:309.9015712738037,z:-13.223772048950195,name:"lips"},{x:383.8992691040039,y:290.29629707336426,z:-9.97326910495758},{x:423.3871841430664,y:271.91688537597656,z:74.37058925628662,name:"faceOval"},{x:377.68043518066406,y:304.62209701538086,z:-7.603961229324341,name:"lips"},{x:379.00428771972656,y:304.9314594268799,z:-8.57852816581726},{x:364.00279998779297,y:275.2813911437988,z:-19.25792098045349},{x:374.68231201171875,y:273.82555961608887,z:-11.28047227859497},{x:365.0354766845703,y:273.4548568725586,z:-18.791062831878662},{x:380.61901092529297,y:249.8848056793213,z:.15501167625188828},{x:391.14158630371094,y:254.7934627532959,z:2.0906515419483185},{x:378.1761169433594,y:264.9612236022949,z:-12.605184316635132},{x:400.9540557861328,y:179.99592304229736,z:27.82477855682373,name:"faceOval"},{x:398.0038833618164,y:188.50656509399414,z:16.094952821731567},{x:394.8717498779297,y:199.0359592437744,z:6.226727366447449,name:"leftEyebrow"},{x:382.10926055908203,y:316.83926582336426,z:-8.946179747581482},{x:366.51588439941406,y:200.32583713531494,z:-5.24632453918457,name:"leftEyebrow"},{x:367.4893569946289,y:183.87210845947266,z:1.9039081037044525},{x:368.6243438720703,y:168.8127565383911,z:8.736093044281006,name:"faceOval"},{x:398.96175384521484,y:234.9675178527832,z:13.713973760604858},{x:412.9645538330078,y:242.23042488098145,z:23.272905349731445},{x:372.05257415771484,y:231.41919136047363,z:9.226294755935669},{x:406.0722351074219,y:223.58965873718262,z:18.370890617370605},{x:368.27442169189453,y:240.2039337158203,z:-4.166713654994965},{x:372.3575210571289,y:260.66442489624023,z:-24.976940155029297},{x:419.2244338989258,y:247.9079246520996,z:30.299127101898193},{x:409.43885803222656,y:246.60913467407227,z:16.398411989212036},{x:401.69139862060547,y:248.76328468322754,z:9.395531415939331},{x:389.7608184814453,y:247.56915092468262,z:5.841569304466248},{x:380.5461883544922,y:244.55984115600586,z:4.263003468513489},{x:373.25817108154297,y:240.80214500427246,z:2.5356262922286987},{x:358.77086639404297,y:229.35615062713623,z:-10.387605428695679},{x:419.5793914794922,y:262.8478717803955,z:26.5175724029541},{x:410.8808898925781,y:222.51372814178467,z:22.199130058288574},{x:358.45714569091797,y:268.91467094421387,z:-33.17030906677246},{x:373.4129333496094,y:251.6385841369629,z:-5.771540403366089},{x:422.5408172607422,y:239.23919677734375,z:74.04378890991211,name:"faceOval"},{x:367.8171920776367,y:236.58040523529053,z:1.820748895406723},{x:378.51959228515625,y:266.2532329559326,z:-5.74819803237915},{x:403.3472442626953,y:229.05112266540527,z:19.689764976501465},{x:372.34840393066406,y:256.6451168060303,z:-21.872329711914063},{x:422.54566192626953,y:289.1587829589844,z:68.67491245269775,name:"faceOval"},{x:371.9297409057617,y:228.90116214752197,z:11.432201862335205,name:"leftEye"},{x:366.21360778808594,y:251.6158962249756,z:-28.19826364517212},{x:409.1571807861328,y:321.3156223297119,z:20.2266526222229},{x:408.52943420410156,y:331.44238471984863,z:31.09278917312622,name:"faceOval"},{x:424.2788314819336,y:267.1992301940918,z:50.467424392700195},{x:415.60352325439453,y:311.6528606414795,z:30.579242706298828},{x:418.12793731689453,y:221.59927368164063,z:46.26569747924805},{x:385.68286895751953,y:346.0184955596924,z:-5.70151150226593},{x:357.82936096191406,y:271.3758373260498,z:-24.836881160736084},{x:379.588623046875,y:257.5071716308594,z:-3.755294680595398},{x:417.4592590332031,y:234.71948146820068,z:34.5475435256958},{x:393.4684371948242,y:231.58967971801758,z:11.408859491348267,name:"leftEye"},{x:387.8864288330078,y:232.14245796203613,z:9.51808214187622,name:"leftEye"},{x:382.4981689453125,y:307.5654888153076,z:-7.522260546684265,name:"lips"},{x:419.00169372558594,y:277.8332805633545,z:26.424202919006348},{x:373.62953186035156,y:357.6375102996826,z:-5.75986921787262,name:"faceOval"},{x:392.8708267211914,y:347.72446632385254,z:10.154176950454712,name:"faceOval"},{x:400.3953552246094,y:341.0005187988281,z:19.39797878265381,name:"faceOval"},{x:382.25440979003906,y:231.66935920715332,z:8.998700976371765,name:"leftEye"},{x:377.14550018310547,y:230.4228687286377,z:9.804032444953918,name:"leftEye"},{x:373.8358688354492,y:229.64950561523438,z:11.292144060134888,name:"leftEye"},{x:414.5794677734375,y:221.67891025543213,z:29.412097930908203},{x:377.00672149658203,y:225.66201210021973,z:9.360517263412476,name:"leftEye"},{x:382.29530334472656,y:224.8431158065796,z:8.32175612449646,name:"leftEye"},{x:387.5133514404297,y:224.49507236480713,z:8.917000889778137,name:"leftEye"},{x:393.15906524658203,y:225.24795055389404,z:10.737749338150024,name:"leftEye"},{x:397.05554962158203,y:226.55359268188477,z:13.002015352249146,name:"leftEye"},{x:420.5299377441406,y:221.014666557312,z:65.40690422058105,name:"faceOval"},{x:397.06920623779297,y:230.6661558151245,z:13.807345628738403,name:"leftEye"},{x:377.94647216796875,y:285.1647090911865,z:-13.305472135543823},{x:372.1118927001953,y:267.1267318725586,z:-18.83774757385254},{x:364.9968719482422,y:282.24411964416504,z:-19.818150997161865},{x:401.973876953125,y:331.20131492614746,z:11.566424369812012},{x:394.3083190917969,y:338.86693954467773,z:3.142542541027069},{x:373.9820861816406,y:351.4504623413086,z:-13.50388765335083},{x:414.3888854980469,y:321.24735832214355,z:45.51872253417969,name:"faceOval"},{x:373.44234466552734,y:227.33163356781006,z:10.626870393753052,name:"leftEye"},{x:364.0731430053711,y:240.31539916992188,z:-13.807345628738403},{x:384.2658233642578,y:353.3793067932129,z:.7385850697755814,name:"faceOval"},{x:423.20526123046875,y:283.5176181793213,z:47.152724266052246},{x:369.42798614501953,y:304.0898895263672,z:-14.647691249847412,name:"lips"},{x:370.63812255859375,y:305.90051651000977,z:-16.211668252944946},{x:371.91192626953125,y:309.0167713165283,z:-17.84567356109619},{x:373.0583953857422,y:313.3545398712158,z:-17.378815412521362,name:"lips"},{x:375.39905548095703,y:321.09289169311523,z:-13.118728399276733},{x:379.2567825317383,y:304.3582534790039,z:-7.924926280975342},{x:381.18797302246094,y:303.7031364440918,z:-7.843226194381714},{x:383.0918502807617,y:302.4884605407715,z:-7.6506465673446655,name:"lips"},{x:389.09461975097656,y:297.1475315093994,z:-5.5497825145721436},{x:411.6408920288086,y:280.24898529052734,z:12.02161192893982},{x:363.3110809326172,y:234.27620887756348,z:-6.775286793708801},{x:366.0474395751953,y:223.29872131347656,z:6.827808618545532},{x:370.34427642822266,y:225.1457118988037,z:9.558931589126587},{x:377.5371551513672,y:303.60079765319824,z:-7.358860373497009,name:"lips"},{x:412.9557800292969,y:299.53579902648926,z:19.39797878265381},{x:360.0810241699219,y:221.72012329101563,z:-2.153385728597641},{x:379.82784271240234,y:329.47723388671875,z:-10.48097848892212},{x:359.08477783203125,y:235.7911491394043,z:-18.079102039337158},{x:369.6688461303711,y:251.5407943725586,z:-14.962821006774902},{x:369.5555114746094,y:333.5307312011719,z:-15.67478060722351},{x:394.0193176269531,y:315.6973171234131,z:-.9920747578144073},{x:383.78997802734375,y:272.7268695831299,z:-4.689012169837952},{x:387.67765045166016,y:323.6722755432129,z:-5.640236139297485},{x:397.8769302368164,y:272.1331214904785,z:-.9395531564950943},{x:389.87476348876953,y:280.5630111694336,z:-4.29218202829361},{x:403.83888244628906,y:285.1167869567871,z:3.0229100584983826},{x:372.5467300415039,y:343.1070327758789,z:-16.153310537338257},{x:374.1112518310547,y:256.3721466064453,z:-10.574349164962769},{x:399.73785400390625,y:321.77515983581543,z:4.849494695663452},{x:392.03365325927734,y:330.56447982788086,z:-1.3407598435878754},{x:398.59134674072266,y:305.93902587890625,z:1.517290621995926},{x:417.95997619628906,y:290.9716987609863,z:26.89105987548828},{x:406.04541778564453,y:307.35154151916504,z:8.666064143180847},{x:420.75328826904297,y:298.40752601623535,z:41.78385257720947},{x:395.4522705078125,y:291.4153575897217,z:-2.1752697229385376},{x:368.6452102661133,y:245.8882999420166,z:-9.453888535499573},{x:370.34900665283203,y:263.56690406799316,z:-26.75100326538086},{x:374.98477935791016,y:266.6126346588135,z:-19.77146625518799},{x:366.99840545654297,y:258.12140464782715,z:-31.372904777526855},{x:371.00616455078125,y:217.63479709625244,z:5.60522198677063},{x:381.30577087402344,y:214.14087295532227,z:4.983716309070587},{x:390.1496124267578,y:213.38221549987793,z:5.593550801277161},{x:397.7696990966797,y:214.3659782409668,z:8.57852816581726},{x:403.1652069091797,y:217.65509605407715,z:13.013685941696167},{x:407.3551940917969,y:230.72525024414063,z:22.444231510162354},{x:424.0876770019531,y:251.7839241027832,z:51.16771221160889},{x:403.50196838378906,y:239.88757610321045,z:15.803166627883911},{x:397.31719970703125,y:241.49806022644043,z:11.233787536621094},{x:388.99425506591797,y:241.4366912841797,z:7.948269248008728},{x:380.7804489135742,y:239.78078842163086,z:6.600214838981628},{x:374.01336669921875,y:237.11946487426758,z:6.349278092384338},{x:369.39125061035156,y:234.35351371765137,z:5.987462401390076},{x:422.9730987548828,y:255.76455116271973,z:76.61150932312012,name:"faceOval"},{x:374.73915100097656,y:269.24214363098145,z:-16.608498096466064},{x:364.61681365966797,y:245.71088790893555,z:-20.02823829650879},{x:365.3834533691406,y:263.34174156188965,z:-32.32996463775635},{x:361.58252716064453,y:267.8273677825928,z:-30.345816612243652},{x:365.37208557128906,y:265.0249671936035,z:-29.178667068481445},{x:372.72605895996094,y:272.05135345458984,z:-14.834434986114502},{x:360.48614501953125,y:268.34827423095703,z:-32.189905643463135},{x:359.9516296386719,y:270.8049201965332,z:-24.650139808654785},{x:369.5049285888672,y:229.01945114135742,z:10.107489824295044},{x:365.5447769165039,y:230.24096488952637,z:5.593550801277161},{x:363.50669860839844,y:230.6208372116089,z:.43622106313705444},{x:399.3529510498047,y:227.65677452087402,z:15.35965085029602,name:"leftEye"},{x:402.5693130493164,y:224.60190296173096,z:15.931552648544312}],box:{xMin:277.8318977355957,yMin:168.7741756439209,xMax:424.2788314819336,yMax:359.8348903656006,width:146.4469337463379,height:191.0607147216797}},SAMPLE_FACELANDMARKER_RESULT:{faceLandmarks:[[{x:.5760777592658997,y:.8639070391654968,z:-.030997956171631813},{x:.572094738483429,y:.7886289358139038,z:-.07189624011516571},{x:.5723551511764526,y:.8075382709503174,z:-.03578168898820877},{x:.5548420548439026,y:.7188365459442139,z:-.057787876576185226},{x:.5706077814102173,y:.7674974799156189,z:-.07740399986505508},{x:.5681378245353699,y:.7387768030166626,z:-.07356284558773041},{x:.5621535181999207,y:.6681165099143982,z:-.04189874976873398},{x:.46613582968711853,y:.6679812073707581,z:.011289681307971478},{x:.5579932928085327,y:.6174106597900391,z:-.03502821549773216},{x:.5563451647758484,y:.5905600190162659,z:-.03928658738732338},{x:.5487832427024841,y:.4900572597980499,z:-.029898937791585922},{x:.5765544176101685,y:.8692144751548767,z:-.02831427752971649},{x:.5771114230155945,y:.873644232749939,z:-.02345779910683632},{x:.5771905779838562,y:.877016007900238,z:-.016658689826726913},{x:.5778058767318726,y:.8770116567611694,z:-.014505492523312569},{x:.5783766508102417,y:.8835000991821289,z:-.015996402129530907},{x:.5792440176010132,y:.8913810849189758,z:-.01924579218029976},{x:.5796768069267273,y:.8996334671974182,z:-.018261712044477463},{x:.5817288160324097,y:.9255813956260681,z:-.007126849144697189},{x:.5726592540740967,y:.7992473244667053,z:-.0643521398305893},{x:.5579419136047363,y:.7996989488601685,z:-.04566684365272522},{x:.4216199815273285,y:.5958762764930725,z:.06776496022939682},{x:.5052269697189331,y:.6796539425849915,z:-.0010737782577052712},{x:.49243026971817017,y:.6838865876197815,z:-.0005227324436418712},{x:.4796970784664154,y:.6856290102005005,z:.002684245817363262},{x:.4618356227874756,y:.6764569878578186,z:.013439622707664967},{x:.5160380601882935,y:.6737282276153564,z:-.000017607348127057776},{x:.48070961236953735,y:.6255870461463928,z:-.008339674212038517},{x:.49719780683517456,y:.6256808042526245,z:-.008027955889701843},{x:.46674346923828125,y:.6317623853683472,z:-.004460199736058712},{x:.4582492709159851,y:.641118049621582,z:.0011905613355338573},{x:.45408669114112854,y:.6911458969116211,z:.020514748990535736},{x:.535312294960022,y:.9619986414909363,z:.012499462813138962},{x:.4608460068702698,y:.6628725528717041,z:.01517564244568348},{x:.4206731915473938,y:.6828458309173584,z:.07848648726940155},{x:.4390624463558197,y:.6796106696128845,z:.03283142298460007},{x:.5029968619346619,y:.7701570391654968,z:-.009734481573104858},{x:.5595027208328247,y:.8607323169708252,z:-.030043255537748337},{x:.5621269941329956,y:.8738374710083008,z:-.021709579974412918},{x:.5451499819755554,y:.865527331829071,z:-.022014077752828598},{x:.5351184010505676,y:.8705098032951355,z:-.011602800339460373},{x:.5495014190673828,y:.8744956254959106,z:-.016490943729877472},{x:.5395170450210571,y:.8759440779685974,z:-.007333362940698862},{x:.5183624029159546,y:.8959754705429077,z:.010520773939788342},{x:.5604349374771118,y:.7895449995994568,z:-.07082037627696991},{x:.557381272315979,y:.7687489986419678,z:-.07590588927268982},{x:.4432901442050934,y:.6308897733688354,z:.0027153254486620426},{x:.5258325338363647,y:.7151225805282593,z:-.014676518738269806},{x:.5271827578544617,y:.7833116054534912,z:-.037643320858478546},{x:.5257382988929749,y:.7717816233634949,z:-.03401920944452286},{x:.46516409516334534,y:.7705106735229492,z:.0065747760236263275},{x:.5558893084526062,y:.7420997619628906,z:-.0694495290517807},{x:.4720408320426941,y:.6066038608551025,z:-.021204356104135513},{x:.45432573556900024,y:.6158540844917297,z:-.011054684408009052},{x:.4305151402950287,y:.5608053803443909,z:.0396830290555954},{x:.5310865640640259,y:.6157484650611877,z:-.03081176057457924},{x:.5114666223526001,y:.6329749226570129,z:-.00335998204536736},{x:.506435751914978,y:.8786543607711792,z:.012980876490473747},{x:.4480472207069397,y:.8640613555908203,z:.12569651007652283},{x:.5372058153152466,y:.7942581176757813,z:-.03168361634016037},{x:.5488379597663879,y:.8001630306243896,z:-.03280917927622795},{x:.5213388204574585,y:.8794381618499756,z:.011892606504261494},{x:.5242055654525757,y:.8789222240447998,z:.008370225317776203},{x:.4477175176143646,y:.6039950251579285,z:-.0050799972377717495},{x:.526964008808136,y:.7916748523712158,z:-.02968614175915718},{x:.4971255660057068,y:.6050706505775452,z:-.028175678104162216},{x:.4938119053840637,y:.5882453918457031,z:-.03210941329598427},{x:.4757143557071686,y:.5094879865646362,z:-.01300730835646391},{x:.43947282433509827,y:.5816648006439209,z:.01415177434682846},{x:.485664039850235,y:.5477864146232605,z:-.023685332387685776},{x:.43635931611061096,y:.6226438283920288,z:.013606148771941662},{x:.42910251021385193,y:.6102726459503174,z:.03926564007997513},{x:.5605402588844299,y:.8680099248886108,z:-.027318159118294716},{x:.5474816560745239,y:.8702861070632935,z:-.019686367362737656},{x:.5373021364212036,y:.8728838562965393,z:-.010484928265213966},{x:.540735125541687,y:.7979167103767395,z:-.029073253273963928},{x:.5228585004806519,y:.87913578748703,z:.009915109723806381},{x:.530497670173645,y:.8815253973007202,z:.0020524784922599792},{x:.5259912610054016,y:.8790552616119385,z:.007895970717072487},{x:.5433906316757202,y:.7882310748100281,z:-.05121905356645584},{x:.541388213634491,y:.8777219653129578,z:-.00466804439201951},{x:.5515822172164917,y:.8767023086547852,z:-.010475946590304375},{x:.5637003779411316,y:.877059817314148,z:-.015273625031113625},{x:.5640299320220947,y:.9263423085212708,z:-.00658724969252944},{x:.5642300248146057,y:.8993074893951416,z:-.017653480172157288},{x:.5637336373329163,y:.8910360932350159,z:-.01852807030081749},{x:.5637134313583374,y:.8837276697158813,z:-.01482592523097992},{x:.564205527305603,y:.8768964409828186,z:-.01331155002117157},{x:.5419867634773254,y:.8778373599052429,z:-.0037720394320786},{x:.5404468774795532,y:.880696177482605,z:-.005610354244709015},{x:.5392338633537292,y:.8845721483230591,z:-.007352025713771582},{x:.538469672203064,y:.8891173601150513,z:-.005154991988092661},{x:.5189250111579895,y:.8452741503715515,z:-.009755070321261883},{x:.4258975088596344,y:.7662280797958374,z:.1387351155281067},{x:.5725725293159485,y:.8041572570800781,z:-.04583907872438431},{x:.5342061519622803,y:.8785833120346069,z:.002659974154084921},{x:.5324031114578247,y:.8804071545600891,z:.0017832003068178892},{x:.5538818836212158,y:.8078407645225525,z:-.03254539892077446},{x:.5325431823730469,y:.8026832938194275,z:-.019140373915433884},{x:.5514076948165894,y:.8043903112411499,z:-.03313535451889038},{x:.5131856203079224,y:.7284771800041199,z:-.009399853646755219},{x:.49331504106521606,y:.7443980574607849,z:-.005225230939686298},{x:.5239617824554443,y:.7807451486587524,z:-.025881027802824974},{x:.4473606050014496,y:.5315827131271362,z:.011164786294102669},{x:.45718759298324585,y:.5604941248893738,z:-.005943301599472761},{x:.4670005738735199,y:.5909327268600464,z:-.019681761041283607},{x:.5311570167541504,y:.9076261520385742,z:.00389476353302598},{x:.5249923467636108,y:.5893563628196716,z:-.037981919944286346},{x:.5166932344436646,y:.5429551005363464,z:-.03319704160094261},{x:.5085030198097229,y:.49676206707954407,z:-.02691275253891945},{x:.4687720239162445,y:.6834565997123718,z:.008113506250083447},{x:.4426414966583252,y:.7069531679153442,z:.028577271848917007},{x:.5230373740196228,y:.6675713658332825,z:.001773772411979735},{x:.4481240212917328,y:.6527872085571289,z:.012414850294589996},{x:.5339856743812561,y:.7012367844581604,z:-.020220188423991203},{x:.5347223281860352,y:.7761190533638,z:-.05141595005989075},{x:.4315067231655121,y:.7211957573890686,z:.04381405934691429},{x:.45203351974487305,y:.7206180095672607,z:.017288070172071457},{x:.46892452239990234,y:.7265436053276062,z:.005602988880127668},{x:.49314674735069275,y:.7202282547950745,z:-.0006408205372281373},{x:.5104925632476807,y:.7091827392578125,z:-.00362918758764863},{x:.5232142210006714,y:.698553740978241,z:-.00787867046892643},{x:.5497883558273315,y:.6743605136871338,z:-.036349106580019},{x:.43658503890037537,y:.7627100348472595,z:.042555369436740875},{x:.4397648870944977,y:.6528646349906921,z:.017956094816327095},{x:.5653332471847534,y:.7992802858352661,z:-.06365057826042175},{x:.5285563468933105,y:.736810564994812,z:-.018836988136172295},{x:.4180678725242615,y:.6792560815811157,z:.12284679710865021},{x:.5328429937362671,y:.6865872144699097,z:-.010484723374247551},{x:.5230283141136169,y:.7809416055679321,z:-.011922398582100868},{x:.4551771283149719,y:.6650775074958801,z:.01774493046104908},{x:.5337203741073608,y:.7618928551673889,z:-.04697106033563614},{x:.43463975191116333,y:.8133478164672852,z:.1354849934577942},{x:.5225707292556763,y:.6605283617973328,z:.004980515688657761},{x:.5441933870315552,y:.7497199773788452,z:-.06091512367129326},{x:.4774007797241211,y:.9159183502197266,z:.059622734785079956},{x:.48068761825561523,y:.9364941716194153,z:.08404944837093353},{x:.4268292486667633,y:.7657528519630432,z:.09051097184419632},{x:.46051913499832153,y:.8880485892295837,z:.0738474428653717},{x:.4243420660495758,y:.6434382200241089,z:.06230505183339119},{x:.5342157483100891,y:.9835634231567383,z:.021662971004843712},{x:.5668109655380249,y:.8042187094688416,z:-.044937074184417725},{x:.5176341533660889,y:.7530587315559387,z:-.012967454269528389},{x:.430206298828125,y:.6835605502128601,z:.04612284153699875},{x:.4794231951236725,y:.6732114553451538,z:.003970044665038586},{x:.49073347449302673,y:.6722435355186462,z:8692514384165406e-19},{x:.5294116139411926,y:.884677529335022,z:.004413890186697245},{x:.4430122375488281,y:.80235356092453,z:.04987282305955887},{x:.5603825449943542,y:1.0092442035675049,z:.026417359709739685},{x:.5186598300933838,y:.9828659892082214,z:.0513598807156086},{x:.5010536909103394,y:.9640932679176331,z:.06591596454381943},{x:.5524769425392151,y:.539441704750061,z:-.035816047340631485},{x:.5879997611045837,y:1.0091472864151,z:.02285068854689598},{x:.5016193985939026,y:.6684437990188599,z:28415941051207483e-20},{x:.511952817440033,y:.6642197370529175,z:.0021144719794392586},{x:.5194343328475952,y:.6623469591140747,z:.004674181342124939},{x:.4321230351924896,y:.6496355533599854,z:.03124697133898735},{x:.508686363697052,y:.6479565501213074,z:-.00044765998609364033},{x:.4963986277580261,y:.6431032419204712,z:-.0032507688738405704},{x:.4845542013645172,y:.6430778503417969,z:-.002903624437749386},{x:.4733612537384033,y:.647506833076477,z:23347247042693198e-20},{x:.4668654501438141,y:.653346598148346,z:.004762572236359119},{x:.41815051436424255,y:.633708119392395,z:.09809435904026031},{x:.47159942984580994,y:.6711485385894775,z:.007849935442209244},{x:.5734396576881409,y:.8256140351295471,z:-.03155219927430153},{x:.5306524038314819,y:.8337990641593933,z:-.018351426348090172},{x:.5371729135513306,y:.7910830974578857,z:-.037286680191755295},{x:.5549534559249878,y:.8275275826454163,z:-.030664825811982155},{x:.5597432255744934,y:.6418541669845581,z:-.03318847343325615},{x:.4958484172821045,y:.9429569244384766,z:.048340678215026855},{x:.5140507817268372,y:.9634028077125549,z:.03589847311377525},{x:.5587693452835083,y:.9951097369194031,z:.00908728688955307},{x:.46411189436912537,y:.9051855206489563,z:.10601935535669327},{x:.5181609392166138,y:.6554316878318787,z:.002546071307733655},{x:.5436590909957886,y:.7085841298103333,z:-.03844436630606651},{x:.5872187614440918,y:.9960382580757141,z:.0063423276878893375},{x:.5379653573036194,y:.9989125728607178,z:.03636329993605614},{x:.4350326955318451,y:.8088565468788147,z:.09147704392671585},{x:.5523084998130798,y:.8773422837257385,z:-.009068487212061882},{x:.5510149598121643,y:.8816931843757629,z:-.011043853126466274},{x:.5503793954849243,y:.88776695728302,z:-.01348799467086792},{x:.5501549243927002,y:.8954370617866516,z:-.012142189778387547},{x:.546072781085968,y:.9192524552345276,z:-.003157563041895628},{x:.5314661860466003,y:.8771666884422302,z:5075141089037061e-19},{x:.5293324589729309,y:.8762547969818115,z:39177737198770046e-20},{x:.5275698900222778,y:.8750609755516052,z:47732755774632096e-21},{x:.5104271173477173,y:.8607332110404968,z:.0012934643309563398},{x:.45938700437545776,y:.8134918212890625,z:.023569690063595772},{x:.5418947339057922,y:.6864100694656372,z:-.027333909645676613},{x:.531914234161377,y:.6456130743026733,z:-.005434140563011169},{x:.523697018623352,y:.647885262966156,z:-.0002466466394253075},{x:.5338191390037537,y:.8783687353134155,z:.002268768846988678},{x:.46226605772972107,y:.8610277771949768,z:.04718952998518944},{x:.5434442758560181,y:.6456181406974792,z:-.02327350154519081},{x:.5399754643440247,y:.940219521522522,z:.005075343884527683},{x:.5661457777023315,y:.71457839012146,z:-.06242101639509201},{x:.5523148775100708,y:.6974870562553406,z:-.04863070324063301},{x:.5639959573745728,y:.6923378109931946,z:-.05180761218070984},{x:.5367592573165894,y:.7423217296600342,z:-.03623027727007866},{x:.5853689908981323,y:.9752064943313599,z:-.002361974213272333},{x:.5835235118865967,y:.9493685960769653,z:-.003941743168979883},{x:.5615018606185913,y:.949194610118866,z:-.0015953965485095978},{x:.5068561434745789,y:.9048219323158264,z:.01862684078514576},{x:.5134067535400391,y:.7971825003623962,z:-.008485661819577217},{x:.5223897099494934,y:.925589919090271,z:.01249657291918993},{x:.48500555753707886,y:.7959478497505188,z:-.0032065745908766985},{x:.5037734508514404,y:.8184596300125122,z:-.004932103678584099},{x:.4766361117362976,y:.828806459903717,z:.01027688942849636},{x:.5589827299118042,y:.974656343460083,z:9666886180639267e-19},{x:.5294582843780518,y:.7541216611862183,z:-.025603046640753746},{x:.4973002076148987,y:.9208990931510925,z:.031931452453136444},{x:.5163551568984985,y:.9432790875434875,z:.024321340024471283},{x:.49399662017822266,y:.8814862370491028,z:.018687399104237556},{x:.44948166608810425,y:.836137592792511,z:.05702034756541252},{x:.47898444533348083,y:.8836610913276672,z:.03150695189833641},{x:.4454479217529297,y:.8499438166618347,z:.08868525922298431},{x:.49572959542274475,y:.8452823758125305,z:.0036111653316766024},{x:.5362502336502075,y:.7222585678100586,z:-.027912352234125137},{x:.5393770337104797,y:.7850722074508667,z:-.05415399745106697},{x:.531399667263031,y:.7898418307304382,z:-.03883346915245056},{x:.5451627373695374,y:.7717036604881287,z:-.06480253487825394},{x:.5206395983695984,y:.6287745833396912,z:-.010521138086915016},{x:.4974782466888428,y:.6191938519477844,z:-.014098240062594414},{x:.4774145185947418,y:.6193130612373352,z:-.013643337413668633},{x:.4616098403930664,y:.6259890198707581,z:-.008448202162981033},{x:.4516478478908539,y:.6368461847305298,z:9050309745362028e-20},{x:.4485096037387848,y:.6719120740890503,z:.022984720766544342},{x:.42177659273147583,y:.7240667343139648,z:.08511673659086227},{x:.4616215229034424,y:.6988231539726257,z:.014238474890589714},{x:.4755798876285553,y:.7034608721733093,z:.00625590980052948},{x:.4924992024898529,y:.7005885243415833,z:9391739731654525e-19},{x:.5082254409790039,y:.693384051322937,z:-.0009464038303121924},{x:.5203112959861755,y:.6849707961082458,z:-.0022114769089967012},{x:.52867591381073,y:.6779075860977173,z:-.002962538506835699},{x:.4213953912258148,y:.7219811677932739,z:.1350894570350647},{x:.5320829749107361,y:.794858992099762,z:-.03181503340601921},{x:.5452795028686523,y:.7286570072174072,z:-.04771539941430092},{x:.5496407747268677,y:.7866933345794678,z:-.06452003121376038},{x:.557040274143219,y:.7962084412574768,z:-.05837344378232956},{x:.549176812171936,y:.7895247936248779,z:-.057761140167713165},{x:.5362890362739563,y:.8005836606025696,z:-.026903774589300156},{x:.560200035572052,y:.7983731031417847,z:-.06172555685043335},{x:.5616944432258606,y:.8022753596305847,z:-.045200999826192856},{x:.5273328423500061,y:.6611284017562866,z:.0029021520167589188},{x:.534850537776947,y:.6660012006759644,z:-.005215510260313749},{x:.5394860506057739,y:.6701375246047974,z:-.014931917190551758},{x:.4634307324886322,y:.658291757106781,z:.009295716881752014},{x:.4538393020629883,y:.6519932150840759,z:.00930330716073513},{x:.5776031613349915,y:.7159298658370972,z:-.057365912944078445},{x:.6504855155944824,y:.6461779475212097,z:.014184834435582161},{x:.5860154032707214,y:.7962266206741333,z:-.04522843658924103},{x:.6842049360275269,y:.5631637573242188,z:.07207967340946198},{x:.6152560710906982,y:.6674962639808655,z:7529259892180562e-19},{x:.6280948519706726,y:.6684326529502869,z:.0016892586136236787},{x:.6408625245094299,y:.6663892269134521,z:.005331226624548435},{x:.6557814478874207,y:.6534678936004639,z:.01646413467824459},{x:.6035663485527039,y:.6639701724052429,z:.0013799630105495453},{x:.6329053044319153,y:.608010470867157,z:-.006195899099111557},{x:.6167260408401489,y:.6117533445358276,z:-.006319951266050339},{x:.6471013426780701,y:.6112449765205383,z:-.0017843559617176652},{x:.6560901999473572,y:.6185776591300964,z:.004047257360070944},{x:.6666946411132813,y:.6651176810264587,z:.023647578433156013},{x:.6311345100402832,y:.9495396018028259,z:.014004078693687916},{x:.6544655561447144,y:.6397901773452759,z:.01809609681367874},{x:.6965808868408203,y:.6482675075531006,z:.08304904401302338},{x:.679817259311676,y:.650188148021698,z:.03632688894867897},{x:.6336516737937927,y:.7541458010673523,z:-.007742783520370722},{x:.5921701192855835,y:.8567668199539185,z:-.029399123042821884},{x:.591663658618927,y:.870215654373169,z:-.02103729173541069},{x:.6068367958068848,y:.8584195375442505,z:-.020668085664510727},{x:.6176617741584778,y:.860965371131897,z:-.009790095500648022},{x:.6040634512901306,y:.8686612844467163,z:-.015289564616978168},{x:.6143736839294434,y:.8671170473098755,z:-.005712216719985008},{x:.6373105049133301,y:.8815656900405884,z:.012672550976276398},{x:.5832505822181702,y:.7866312861442566,z:-.07051534950733185},{x:.5836675763130188,y:.7658692598342896,z:-.07566110789775848},{x:.6709531545639038,y:.604898989200592,z:.005951565690338612},{x:.6029891967773438,y:.705652117729187,z:-.013388276100158691},{x:.6131622195243835,y:.7728396058082581,z:-.036248479038476944},{x:.6123163104057312,y:.7612020373344421,z:-.03264721855521202},{x:.6696187853813171,y:.744706928730011,z:.009673702530562878},{x:.5803102254867554,y:.7385968565940857,z:-.0689152330160141},{x:.6404349207878113,y:.5877999663352966,z:-.01929756999015808},{x:.6588467955589294,y:.5929454565048218,z:-.008487257175147533},{x:.6720337867736816,y:.530631422996521,z:.043437421321868896},{x:.584305465221405,y:.6099005341529846,z:-.030301367864012718},{x:.6034283638000488,y:.6217452883720398,z:-.001970183802768588},{x:.6460927724838257,y:.8608663082122803,z:.015541625209152699},{x:.6957815289497375,y:.8326103091239929,z:.13015234470367432},{x:.6043362617492676,y:.7861682772636414,z:-.030476901680231094},{x:.594293475151062,y:.7942103147506714,z:-.032218821346759796},{x:.6324057579040527,y:.8665139675140381,z:.014255806803703308},{x:.6296147704124451,y:.8667733669281006,z:.010388285852968693},{x:.663644552230835,y:.5798642635345459,z:-.0022301070857793093},{x:.6140630841255188,y:.7809288501739502,z:-.02835679054260254},{x:.615908145904541,y:.5921698212623596,z:-.026804860681295395},{x:.617181122303009,y:.5748661756515503,z:-.03060605563223362},{x:.6222207546234131,y:.49137672781944275,z:-.011151673272252083},{x:.6669357419013977,y:.5541607141494751,z:.017466170713305473},{x:.6182981729507446,y:.5320425629615784,z:-.021793590858578682},{x:.6760554313659668,y:.595052182674408,z:.017115700989961624},{x:.6801463961601257,y:.5800720453262329,z:.043127160519361496},{x:.5922210812568665,y:.8644017577171326,z:-.02662893570959568},{x:.6054555177688599,y:.8637874722480774,z:-.018363753333687782},{x:.6161889433860779,y:.8641164898872375,z:-.008808949030935764},{x:.6017249822616577,y:.7901403307914734,z:-.028126630932092667},{x:.631446123123169,y:.8664817810058594,z:.012112865224480629},{x:.6249198913574219,y:.8716511130332947,z:.003882825840264559},{x:.6281915903091431,y:.867301881313324,z:.009891441091895103},{x:.5986843109130859,y:.7813931703567505,z:-.050227612257003784},{x:.6126407384872437,y:.869275689125061,z:-.0031255714129656553},{x:.6027271151542664,y:.8711842894554138,z:-.009324162267148495},{x:.59088134765625,y:.8742044568061829,z:-.014608660712838173},{x:.5984604358673096,y:.9216185212135315,z:-.005981989670544863},{x:.5950398445129395,y:.8964707255363464,z:-.01703473925590515},{x:.5941568613052368,y:.8882410526275635,z:-.017784785479307175},{x:.5928806662559509,y:.8803883194923401,z:-.014153128489851952},{x:.5909661054611206,y:.8748103976249695,z:-.012609979137778282},{x:.6128016710281372,y:.8702545762062073,z:-.0022550546564161777},{x:.6150846481323242,y:.8726804256439209,z:-.00414019962772727},{x:.6173093914985657,y:.8770190477371216,z:-.005970994010567665},{x:.619335412979126,y:.8814800977706909,z:-.0036864024586975574},{x:.6292637586593628,y:.8314558267593384,z:-.007714875973761082},{x:.702275276184082,y:.7320667505264282,z:.1433621346950531},{x:.6204835176467896,y:.8689177632331848,z:.0044869170524179935},{x:.6223508715629578,y:.8704851269721985,z:.00352082890458405},{x:.590448260307312,y:.8029727935791016,z:-.03200828656554222},{x:.6097423434257507,y:.7933741211891174,z:-.018042555078864098},{x:.59229576587677,y:.7993767261505127,z:-.032564569264650345},{x:.6171364188194275,y:.7153720259666443,z:-.007672437466681004},{x:.6389747858047485,y:.726390540599823,z:-.002999067772179842},{x:.6151940226554871,y:.769412100315094,z:-.024427521973848343},{x:.6526776552200317,y:.505868136882782,z:.01412637997418642},{x:.6475822329521179,y:.5375454425811768,z:-.0033899128902703524},{x:.6433356404304504,y:.5714520215988159,z:-.017428796738386154},{x:.626949667930603,y:.8962116837501526,z:.005602736957371235},{x:.5868416428565979,y:.5829002261161804,z:-.03727729618549347},{x:.5877229571342468,y:.5345035791397095,z:-.032396964728832245},{x:.5887066125869751,y:.48655083775520325,z:-.025856535881757736},{x:.6507197618484497,y:.6612282991409302,z:.011114613153040409},{x:.6803066730499268,y:.677992045879364,z:.032125361263751984},{x:.5963194370269775,y:.6598632335662842,z:.002976928371936083},{x:.667536199092865,y:.6274255514144897,z:.015618261881172657},{x:.5930740833282471,y:.6940041780471802,z:-.019217798486351967},{x:.6053346395492554,y:.7676517963409424,z:-.050308309495449066},{x:.6934473514556885,y:.6884298920631409,z:.04794462397694588},{x:.6738007664680481,y:.6934011578559875,z:.020697161555290222},{x:.6588084697723389,y:.7033141851425171,z:.008462334051728249},{x:.6346072554588318,y:.7029502391815186,z:.001542167621664703},{x:.6157816648483276,y:.6966525912284851,z:-.002009218093007803},{x:.6015574336051941,y:.688928484916687,z:-.006588225718587637},{x:.5746836066246033,y:.6711069345474243,z:-.03597589209675789},{x:.6947521567344666,y:.7309479117393494,z:.046707939356565475},{x:.6759101152420044,y:.6249120831489563,z:.021654341369867325},{x:.5794773101806641,y:.7971615195274353,z:-.06339326500892639},{x:.6041849851608276,y:.727514922618866,z:-.017512541264295578},{x:.6968844532966614,y:.6440950036048889,z:.12727996706962585},{x:.5910853147506714,y:.679325520992279,z:-.009497715160250664},{x:.6157375574111938,y:.7695677280426025,z:-.010624290443956852},{x:.6606494784355164,y:.6410489678382874,z:.0208158977329731},{x:.6040687561035156,y:.7531470656394958,z:-.045887019485235214},{x:.7012156248092651,y:.780247151851654,z:.14028730988502502},{x:.595149576663971,y:.6527782678604126,z:.006308757700026035},{x:.5925500392913818,y:.7436665892601013,z:-.060151755809783936},{x:.6780198812484741,y:.8905693888664246,z:.0626060739159584},{x:.676746666431427,y:.9113880395889282,z:.08726003766059875},{x:.7030686140060425,y:.7312687635421753,z:.09529774636030197},{x:.688987135887146,y:.8588417172431946,z:.07752864807844162},{x:.6883691549301147,y:.6109960675239563,z:.06669612973928452},{x:.6358906030654907,y:.9702065587043762,z:.023120900616049767},{x:.5781539678573608,y:.8023634552955627,z:-.044763918966054916},{x:.6170316934585571,y:.7408350706100464,z:-.011375460773706436},{x:.688542366027832,y:.6516284346580505,z:.050206027925014496},{x:.6385149359703064,y:.6540714502334595,z:.006462941411882639},{x:.6279382109642029,y:.6563615798950195,z:.003062846139073372},{x:.6268895268440247,y:.8736732006072998,z:.00627936702221632},{x:.6944946050643921,y:.7709181308746338,z:.053824134171009064},{x:.614617109298706,y:1.0022112131118774,z:.02719894051551819},{x:.6493719220161438,y:.9665167927742004,z:.053563784807920456},{x:.6624587178230286,y:.943530797958374,z:.068605437874794},{x:.6162528991699219,y:.6558693051338196,z:.002187855076044798},{x:.6058168411254883,y:.654328465461731,z:.0036193584091961384},{x:.5987918972969055,y:.6536934971809387,z:.006134530063718557},{x:.6831037402153015,y:.6195642948150635,z:.03511790186166763},{x:.6062582731246948,y:.6356398463249207,z:.001280312892049551},{x:.6174948811531067,y:.62776118516922,z:-.0013642468256875873},{x:.6297246217727661,y:.6253792643547058,z:-.0007034156005829573},{x:.6407091617584229,y:.627578616142273,z:.0028144705574959517},{x:.6479622721672058,y:.6322650909423828,z:.00750273372977972},{x:.6915091276168823,y:.5990704298019409,z:.10270945727825165},{x:.6457163095474243,y:.6504453420639038,z:.010696077719330788},{x:.6164222955703735,y:.8231936097145081,z:-.016772059723734856},{x:.6042401194572449,y:.7830976843833923,z:-.03630910441279411},{x:.5922216773033142,y:.8228387236595154,z:-.029992375522851944},{x:.6646111011505127,y:.92097008228302,z:.050967294722795486},{x:.651232898235321,y:.9460107088088989,z:.038000158965587616},{x:.6140977144241333,y:.9882472157478333,z:.009882091544568539},{x:.6870781183242798,y:.8768675327301025,z:.10980932414531708},{x:.5986856818199158,y:.6456438899040222,z:.003999010659754276},{x:.585981547832489,y:.7034481763839722,z:-.0377722829580307},{x:.6342031359672546,y:.9867448806762695,z:.03786521404981613},{x:.7013950943946838,y:.776049017906189,z:.09598205983638763},{x:.6030206680297852,y:.8719133138656616,z:-.007931148633360863},{x:.6050592064857483,y:.8767156004905701,z:-.009791925549507141},{x:.6073468923568726,y:.8831382393836975,z:-.012361008673906326},{x:.6087977290153503,y:.890143632888794,z:-.01098148338496685},{x:.6147705316543579,y:.9110084772109985,z:-.0018823575228452682},{x:.622577965259552,y:.8670604825019836,z:.002609190298244357},{x:.6241236329078674,y:.8651344180107117,z:.0025534380692988634},{x:.6257084608078003,y:.8638408184051514,z:.0023300074972212315},{x:.639931321144104,y:.8449671268463135,z:.0038123116828501225},{x:.6810906529426575,y:.7856625318527222,z:.02717764675617218},{x:.583532452583313,y:.6811994910240173,z:-.026588857173919678},{x:.5855660438537598,y:.6393819451332092,z:-.004512844607234001},{x:.5932201743125916,y:.6398029327392578,z:8020466193556786e-19},{x:.6200879812240601,y:.8683351874351501,z:.00417016725987196},{x:.6842559576034546,y:.8330534100532532,z:.050836317241191864},{x:.5754412412643433,y:.6418221592903137,z:-.022838059812784195},{x:.6232790350914001,y:.9295297265052795,z:.006339520215988159},{x:.5764067769050598,y:.694546639919281,z:-.04825803264975548},{x:.59778892993927,y:.7343927621841431,z:-.035004377365112305},{x:.6042810678482056,y:.9441440105438232,z:-.0010970570147037506},{x:.6496372222900391,y:.8869078159332275,z:.021036235615611076},{x:.6274012327194214,y:.7830310463905334,z:-.006658440921455622},{x:.637792706489563,y:.9104999899864197,z:.014290250837802887},{x:.6549934148788452,y:.7748609185218811,z:-.0006672973395325243},{x:.6404005289077759,y:.801220715045929,z:-.0026642554439604282},{x:.6671456694602966,y:.8045546412467957,z:.013180811889469624},{x:.6107483506202698,y:.9680658578872681,z:.001778992242179811},{x:.6060343980789185,y:.744587242603302,z:-.024382334202528},{x:.6602751612663269,y:.8998945355415344,z:.0344940721988678},{x:.6463775038719177,y:.9262562394142151,z:.02617623284459114},{x:.6579852104187012,y:.8602304458618164,z:.021586716175079346},{x:.6926165223121643,y:.8053340315818787,z:.061075080186128616},{x:.6724731922149658,y:.8594399690628052,z:.03457934781908989},{x:.6975721716880798,y:.8183245062828064,z:.09300774335861206},{x:.6512877941131592,y:.8258221745491028,z:.006324059329926968},{x:.594887375831604,y:.7148372530937195,z:-.026898479089140892},{x:.6017440557479858,y:.7773507833480835,z:-.05312420800328255},{x:.6096571683883667,y:.7806998491287231,z:-.037646256387233734},{x:.5952993035316467,y:.7654367685317993,z:-.06398405134677887},{x:.5950021147727966,y:.6201304793357849,z:-.009297547861933708},{x:.6165438890457153,y:.6052900552749634,z:-.012455573305487633},{x:.6362661719322205,y:.6015968918800354,z:-.011649220250546932},{x:.6522727608680725,y:.6046400666236877,z:-.005903332494199276},{x:.6625409722328186,y:.6128141283988953,z:.0030042496509850025},{x:.6688099503517151,y:.6457712054252625,z:.026322703808546066},{x:.7013440728187561,y:.6893666386604309,z:.08984331786632538},{x:.6608623266220093,y:.6749406456947327,z:.0172116681933403},{x:.6482325196266174,y:.6823726296424866,z:.008881398476660252},{x:.6313265562057495,y:.6842025518417358,z:.0031308617908507586},{x:.6147016286849976,y:.6809731721878052,z:7630771724507213e-19},{x:.6018834114074707,y:.6755372285842896,z:-.0008834321051836014},{x:.5925027132034302,y:.670681357383728,z:-.001968748401850462},{x:.700127363204956,y:.6871103644371033,z:.13980500400066376},{x:.6095665693283081,y:.7853189706802368,z:-.03074747882783413},{x:.5880423784255981,y:.7229287028312683,z:-.04691500961780548},{x:.5930182337760925,y:.7811514139175415,z:-.06398335844278336},{x:.5867722034454346,y:.7922660112380981,z:-.05794971063733101},{x:.5933279991149902,y:.7842848896980286,z:-.05714067071676254},{x:.6063535809516907,y:.7920218706130981,z:-.02590685710310936},{x:.5839452743530273,y:.794978141784668,z:-.0615212507545948},{x:.5828126072883606,y:.8000800013542175,z:-.0449722595512867},{x:.5909603834152222,y:.6541213393211365,z:.003991890233010054},{x:.5852181911468506,y:.6602938771247864,z:-.004428438376635313},{x:.5825737714767456,y:.6651063561439514,z:-.014345290139317513},{x:.6517343521118164,y:.6362385153770447,z:.012151890434324741},{x:.6615052819252014,y:.6281577944755554,z:.0123682152479887},{x:.4856873154640198,y:.6568945646286011,z:720038078725338e-18},{x:.49988406896591187,y:.6547410488128662,z:6949726957827806e-19},{x:.48438939452171326,y:.6392973065376282,z:705525919329375e-18},{x:.47143134474754333,y:.6589511632919312,z:6980331381782889e-19},{x:.48704618215560913,y:.6752797961235046,z:6921177846379578e-19},{x:.6243702173233032,y:.640461802482605,z:-.00006592126737814397},{x:.6390967965126038,y:.6385173797607422,z:-.00016105435497593135},{x:.6230536699295044,y:.6224825382232666,z:-.00016136496560648084},{x:.6095397472381592,y:.641917884349823,z:-.0001803556369850412},{x:.6250996589660645,y:.6586247682571411,z:-.0001785515050869435}]],faceBlendshapes:[{categories:[{index:0,score:5187174338061595e-21,categoryName:"_neutral",displayName:""},{index:1,score:.24521504342556,categoryName:"browDownLeft",displayName:""},{index:2,score:.1987743377685547,categoryName:"browDownRight",displayName:""},{index:3,score:.013400448486208916,categoryName:"browInnerUp",displayName:""},{index:4,score:.012361560948193073,categoryName:"browOuterUpLeft",displayName:""},{index:5,score:.019305096939206123,categoryName:"browOuterUpRight",displayName:""},{index:6,score:28426356948330067e-21,categoryName:"cheekPuff",displayName:""},{index:7,score:34500112633395474e-23,categoryName:"cheekSquintLeft",displayName:""},{index:8,score:483789051486383e-21,categoryName:"cheekSquintRight",displayName:""},{index:9,score:.07650448381900787,categoryName:"eyeBlinkLeft",displayName:""},{index:10,score:.05070012807846069,categoryName:"eyeBlinkRight",displayName:""},{index:11,score:.13978900015354156,categoryName:"eyeLookDownLeft",displayName:""},{index:12,score:.14198613166809082,categoryName:"eyeLookDownRight",displayName:""},{index:13,score:.2177766114473343,categoryName:"eyeLookInLeft",displayName:""},{index:14,score:.014739357866346836,categoryName:"eyeLookInRight",displayName:""},{index:15,score:.02361512929201126,categoryName:"eyeLookOutLeft",displayName:""},{index:16,score:.19679604470729828,categoryName:"eyeLookOutRight",displayName:""},{index:17,score:.04874616861343384,categoryName:"eyeLookUpLeft",displayName:""},{index:18,score:.049392376095056534,categoryName:"eyeLookUpRight",displayName:""},{index:19,score:.34944331645965576,categoryName:"eyeSquintLeft",displayName:""},{index:20,score:.2939716875553131,categoryName:"eyeSquintRight",displayName:""},{index:21,score:.005955042317509651,categoryName:"eyeWideLeft",displayName:""},{index:22,score:.006776117719709873,categoryName:"eyeWideRight",displayName:""},{index:23,score:16942436559475027e-21,categoryName:"jawForward",displayName:""},{index:24,score:.0045165494084358215,categoryName:"jawLeft",displayName:""},{index:25,score:.07803940027952194,categoryName:"jawOpen",displayName:""},{index:26,score:2090057751047425e-20,categoryName:"jawRight",displayName:""},{index:27,score:.06032035872340202,categoryName:"mouthClose",displayName:""},{index:28,score:.00228882092051208,categoryName:"mouthDimpleLeft",displayName:""},{index:29,score:.00781762320548296,categoryName:"mouthDimpleRight",displayName:""},{index:30,score:.0017093931091949344,categoryName:"mouthFrownLeft",displayName:""},{index:31,score:.0019319106359034777,categoryName:"mouthFrownRight",displayName:""},{index:32,score:8485237776767462e-20,categoryName:"mouthFunnel",displayName:""},{index:33,score:9051355300471187e-19,categoryName:"mouthLeft",displayName:""},{index:34,score:3630454302765429e-19,categoryName:"mouthLowerDownLeft",displayName:""},{index:35,score:17601238505449146e-20,categoryName:"mouthLowerDownRight",displayName:""},{index:36,score:.12865161895751953,categoryName:"mouthPressLeft",displayName:""},{index:37,score:.20137207210063934,categoryName:"mouthPressRight",displayName:""},{index:38,score:.0022203284315764904,categoryName:"mouthPucker",displayName:""},{index:39,score:9096377179957926e-19,categoryName:"mouthRight",displayName:""},{index:40,score:.34189721941947937,categoryName:"mouthRollLower",displayName:""},{index:41,score:.11409689486026764,categoryName:"mouthRollUpper",displayName:""},{index:42,score:.17172536253929138,categoryName:"mouthShrugLower",displayName:""},{index:43,score:.004038424696773291,categoryName:"mouthShrugUpper",displayName:""},{index:44,score:23205230536404997e-20,categoryName:"mouthSmileLeft",displayName:""},{index:45,score:19313619122840464e-20,categoryName:"mouthSmileRight",displayName:""},{index:46,score:.0018571305554360151,categoryName:"mouthStretchLeft",displayName:""},{index:47,score:.0023813238367438316,categoryName:"mouthStretchRight",displayName:""},{index:48,score:24323100660694763e-21,categoryName:"mouthUpperUpLeft",displayName:""},{index:49,score:3161552012898028e-20,categoryName:"mouthUpperUpRight",displayName:""},{index:50,score:108198406678639e-21,categoryName:"noseSneerLeft",displayName:""},{index:51,score:12652527630052646e-22,categoryName:"noseSneerRight",displayName:""}],headIndex:-1,headName:""}],facialTransformationMatrixes:[{rows:4,columns:4,data:[.9947517514228821,.10230544209480286,.0013679931871592999,0,-.10230997204780579,.9947447776794434,.003816320328041911,0,-.000970348424743861,-.0039362297393381596,.9999914169311523,0,2.8888821601867676,-7.808934211730957,-30.52109146118164,1]}]}},Ez=(0,eS.createContext)({}),EL={basePath:"https://cdn.jsdelivr.net/npm/@mediapipe/tasks-vision@0.10.17/wasm",options:{baseOptions:{modelAssetPath:"https://storage.googleapis.com/mediapipe-models/face_landmarker/face_landmarker/float16/1/face_landmarker.task",delegate:"GPU"},runningMode:"VIDEO",outputFaceBlendshapes:!0,outputFacialTransformationMatrixes:!0}},EO=(0,eS.forwardRef)(({basePath:e=EL.basePath,options:t=EL.options,children:i},n)=>{let a=JSON.stringify(t),o=(0,ok.Rq)(async()=>{let{FilesetResolver:i,FaceLandmarker:n}=await r.e(180).then(r.bind(r,2180)),a=await i.forVisionTasks(e);return n.createFromOptions(a,t)},[e,a]);return(0,eS.useEffect)(()=>()=>{null==o||o.close(),(0,ok.ZH)([e,a])},[o,e,a]),(0,eS.useImperativeHandle)(n,()=>o,[o]),eS.createElement(Ez.Provider,{value:o},i)});function EU(){return(0,eS.useContext)(Ez)}function Ek(e,t){return e.clone().add(t).multiplyScalar(.5)}function EG(e,t,r){let i=e.localToWorld(t);return r.worldToLocal(i)}let EN=(0,eS.createContext)({}),EH=(0,eS.forwardRef)(({camera:e,videoTexture:t={start:!0},manualDetect:r=!1,faceLandmarkerResult:i,manualUpdate:n=!1,makeDefault:a,smoothTime:o=.25,offset:s=!0,offsetScalar:l=80,eyes:c=!1,eyesAsOrigin:u=!0,depth:h=.15,debug:A=!1,facemesh:d},f)=>{var m,p;let g=(0,eR.D)(e=>e.scene),y=(0,eR.D)(e=>e.camera),v=(0,eR.D)(e=>e.set),E=(0,eR.D)(e=>e.get),x=e||y,C=(0,eS.useRef)(null),[B]=(0,eS.useState)(()=>new eT.Object3D),[w]=(0,eS.useState)(()=>new eT.Vector3),[I]=(0,eS.useState)(()=>new eT.Vector3),[b]=(0,eS.useState)(()=>new eT.Vector3),[_]=(0,eS.useState)(()=>new eT.Vector3),M=(0,eS.useCallback)(()=>{B.parent=x.parent;let e=C.current;if(e){let{outerRef:t,eyeRightRef:r,eyeLeftRef:i}=e;if(r.current&&i.current){let{irisDirRef:e}=r.current,{irisDirRef:n}=i.current;e.current&&n.current&&t.current&&(w.copy(EG(e.current,new eT.Vector3(0,0,0),t.current)),I.copy(EG(n.current,new eT.Vector3(0,0,0),t.current)),B.position.copy(EG(t.current,Ek(w,I),x.parent||g)),b.copy(EG(e.current,new eT.Vector3(0,0,1),t.current)),_.copy(EG(n.current,new eT.Vector3(0,0,1),t.current)),B.lookAt(t.current.localToWorld(Ek(b,_))))}else t.current&&(B.position.copy(EG(t.current,new eT.Vector3(0,0,0),x.parent||g)),B.lookAt(t.current.localToWorld(new eT.Vector3(0,0,1))))}return B},[x,I,_,w,b,g,B]),[S]=(0,eS.useState)(()=>new eT.Object3D),D=(0,eS.useCallback)(function(e,t){if(x){var r;null!==(r=t)&&void 0!==r||(t=M()),o>0?(rW.damp3(S.position,t.position,o,e,void 0,void 0,1e-9),rW.dampE(S.rotation,t.rotation,o,e,void 0,void 0,1e-9)):(S.position.copy(t.position),S.rotation.copy(t.rotation)),x.position.copy(S.position),x.rotation.copy(S.rotation)}},[x,M,o,S.position,S.rotation]);(0,eR.F)((e,t)=>{n||D(t)});let T=(0,eS.useRef)(null),[R,F]=(0,eS.useState)(),P=EU(),Q=(0,eS.useCallback)((e,t)=>{let r=T.current;if(!r)return;let i=r.source.data;F(null==P?void 0:P.detectForVideo(i,e))},[P]),z=(0,eS.useMemo)(()=>Object.assign(Object.create(eT.EventDispatcher.prototype),{computeTarget:M,update:D,facemeshApiRef:C}),[M,D]);(0,eS.useImperativeHandle)(f,()=>z,[z]),(0,eS.useEffect)(()=>{if(a){let e=E().controls;return v({controls:z}),()=>v({controls:e})}},[a,z,E,v]);let L=null!=i?i:R,O=null==L?void 0:L.faceLandmarks[0],U=null==L||null==(m=L.facialTransformationMatrixes)?void 0:m[0],k=null==L||null==(p=L.faceBlendshapes)?void 0:p[0],G={onVideoFrame:Q,...t};return eS.createElement(EN.Provider,{value:z},!r&&eS.createElement(eS.Suspense,{fallback:null},"src"in G?eS.createElement(Aq,j({ref:T},G)):eS.createElement(ES,j({ref:T},G))),eS.createElement(ER,j({ref:C,children:eS.createElement("meshNormalMaterial",{side:eT.DoubleSide})},d,{points:O,depth:h,facialTransformationMatrix:U,faceBlendshapes:k,eyes:c,eyesAsOrigin:u,offset:s,offsetScalar:l,debug:A,"rotation-z":Math.PI,visible:A})))}),EV=()=>(0,eS.useContext)(EN)},4699:function(e,t){"use strict";t.byteLength=function(e){var t=l(e),r=t[0],i=t[1];return(r+i)*3/4-i},t.toByteArray=function(e){var t,r,a=l(e),o=a[0],s=a[1],c=new n((o+s)*3/4-s),u=0,h=s>0?o-4:o;for(r=0;r<h;r+=4)t=i[e.charCodeAt(r)]<<18|i[e.charCodeAt(r+1)]<<12|i[e.charCodeAt(r+2)]<<6|i[e.charCodeAt(r+3)],c[u++]=t>>16&255,c[u++]=t>>8&255,c[u++]=255&t;return 2===s&&(t=i[e.charCodeAt(r)]<<2|i[e.charCodeAt(r+1)]>>4,c[u++]=255&t),1===s&&(t=i[e.charCodeAt(r)]<<10|i[e.charCodeAt(r+1)]<<4|i[e.charCodeAt(r+2)]>>2,c[u++]=t>>8&255,c[u++]=255&t),c},t.fromByteArray=function(e){for(var t,i=e.length,n=i%3,a=[],o=0,s=i-n;o<s;o+=16383)a.push(function(e,t,i){for(var n,a=[],o=t;o<i;o+=3)a.push(r[(n=(e[o]<<16&16711680)+(e[o+1]<<8&65280)+(255&e[o+2]))>>18&63]+r[n>>12&63]+r[n>>6&63]+r[63&n]);return a.join("")}(e,o,o+16383>s?s:o+16383));return 1===n?a.push(r[(t=e[i-1])>>2]+r[t<<4&63]+"=="):2===n&&a.push(r[(t=(e[i-2]<<8)+e[i-1])>>10]+r[t>>4&63]+r[t<<2&63]+"="),a.join("")};for(var r=[],i=[],n="undefined"!=typeof Uint8Array?Uint8Array:Array,a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",o=0,s=a.length;o<s;++o)r[o]=a[o],i[a.charCodeAt(o)]=o;function l(e){var t=e.length;if(t%4>0)throw Error("Invalid string. Length must be a multiple of 4");var r=e.indexOf("=");-1===r&&(r=t);var i=r===t?0:4-r%4;return[r,i]}i["-".charCodeAt(0)]=62,i["_".charCodeAt(0)]=63},7133:function(e,t,r){"use strict";/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */let i=r(4699),n=r(9087),a="function"==typeof Symbol&&"function"==typeof Symbol.for?Symbol.for("nodejs.util.inspect.custom"):null;function o(e){if(e>2147483647)throw RangeError('The value "'+e+'" is invalid for option "size"');let t=new Uint8Array(e);return Object.setPrototypeOf(t,s.prototype),t}function s(e,t,r){if("number"==typeof e){if("string"==typeof t)throw TypeError('The "string" argument must be of type string. Received type number');return u(e)}return l(e,t,r)}function l(e,t,r){if("string"==typeof e)return function(e,t){if(("string"!=typeof t||""===t)&&(t="utf8"),!s.isEncoding(t))throw TypeError("Unknown encoding: "+t);let r=0|f(e,t),i=o(r),n=i.write(e,t);return n!==r&&(i=i.slice(0,n)),i}(e,t);if(ArrayBuffer.isView(e))return function(e){if(L(e,Uint8Array)){let t=new Uint8Array(e);return A(t.buffer,t.byteOffset,t.byteLength)}return h(e)}(e);if(null==e)throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e);if(L(e,ArrayBuffer)||e&&L(e.buffer,ArrayBuffer)||"undefined"!=typeof SharedArrayBuffer&&(L(e,SharedArrayBuffer)||e&&L(e.buffer,SharedArrayBuffer)))return A(e,t,r);if("number"==typeof e)throw TypeError('The "value" argument must not be of type number. Received type number');let i=e.valueOf&&e.valueOf();if(null!=i&&i!==e)return s.from(i,t,r);let n=function(e){var t;if(s.isBuffer(e)){let t=0|d(e.length),r=o(t);return 0===r.length||e.copy(r,0,0,t),r}return void 0!==e.length?"number"!=typeof e.length||(t=e.length)!=t?o(0):h(e):"Buffer"===e.type&&Array.isArray(e.data)?h(e.data):void 0}(e);if(n)return n;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof e[Symbol.toPrimitive])return s.from(e[Symbol.toPrimitive]("string"),t,r);throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e)}function c(e){if("number"!=typeof e)throw TypeError('"size" argument must be of type number');if(e<0)throw RangeError('The value "'+e+'" is invalid for option "size"')}function u(e){return c(e),o(e<0?0:0|d(e))}function h(e){let t=e.length<0?0:0|d(e.length),r=o(t);for(let i=0;i<t;i+=1)r[i]=255&e[i];return r}function A(e,t,r){let i;if(t<0||e.byteLength<t)throw RangeError('"offset" is outside of buffer bounds');if(e.byteLength<t+(r||0))throw RangeError('"length" is outside of buffer bounds');return Object.setPrototypeOf(i=void 0===t&&void 0===r?new Uint8Array(e):void 0===r?new Uint8Array(e,t):new Uint8Array(e,t,r),s.prototype),i}function d(e){if(e>=2147483647)throw RangeError("Attempt to allocate Buffer larger than maximum size: 0x7fffffff bytes");return 0|e}function f(e,t){if(s.isBuffer(e))return e.length;if(ArrayBuffer.isView(e)||L(e,ArrayBuffer))return e.byteLength;if("string"!=typeof e)throw TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof e);let r=e.length,i=arguments.length>2&&!0===arguments[2];if(!i&&0===r)return 0;let n=!1;for(;;)switch(t){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":return P(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*r;case"hex":return r>>>1;case"base64":return Q(e).length;default:if(n)return i?-1:P(e).length;t=(""+t).toLowerCase(),n=!0}}function m(e,t,r){let n=!1;if((void 0===t||t<0)&&(t=0),t>this.length||((void 0===r||r>this.length)&&(r=this.length),r<=0||(r>>>=0)<=(t>>>=0)))return"";for(e||(e="utf8");;)switch(e){case"hex":return function(e,t,r){let i=e.length;(!t||t<0)&&(t=0),(!r||r<0||r>i)&&(r=i);let n="";for(let i=t;i<r;++i)n+=O[e[i]];return n}(this,t,r);case"utf8":case"utf-8":return v(this,t,r);case"ascii":return function(e,t,r){let i="";r=Math.min(e.length,r);for(let n=t;n<r;++n)i+=String.fromCharCode(127&e[n]);return i}(this,t,r);case"latin1":case"binary":return function(e,t,r){let i="";r=Math.min(e.length,r);for(let n=t;n<r;++n)i+=String.fromCharCode(e[n]);return i}(this,t,r);case"base64":var a,o;return a=t,o=r,0===a&&o===this.length?i.fromByteArray(this):i.fromByteArray(this.slice(a,o));case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return function(e,t,r){let i=e.slice(t,r),n="";for(let e=0;e<i.length-1;e+=2)n+=String.fromCharCode(i[e]+256*i[e+1]);return n}(this,t,r);default:if(n)throw TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),n=!0}}function p(e,t,r){let i=e[t];e[t]=e[r],e[r]=i}function g(e,t,r,i,n){var a;if(0===e.length)return -1;if("string"==typeof r?(i=r,r=0):r>2147483647?r=2147483647:r<-2147483648&&(r=-2147483648),(a=r=+r)!=a&&(r=n?0:e.length-1),r<0&&(r=e.length+r),r>=e.length){if(n)return -1;r=e.length-1}else if(r<0){if(!n)return -1;r=0}if("string"==typeof t&&(t=s.from(t,i)),s.isBuffer(t))return 0===t.length?-1:y(e,t,r,i,n);if("number"==typeof t)return(t&=255,"function"==typeof Uint8Array.prototype.indexOf)?n?Uint8Array.prototype.indexOf.call(e,t,r):Uint8Array.prototype.lastIndexOf.call(e,t,r):y(e,[t],r,i,n);throw TypeError("val must be string, number or Buffer")}function y(e,t,r,i,n){let a,o=1,s=e.length,l=t.length;if(void 0!==i&&("ucs2"===(i=String(i).toLowerCase())||"ucs-2"===i||"utf16le"===i||"utf-16le"===i)){if(e.length<2||t.length<2)return -1;o=2,s/=2,l/=2,r/=2}function c(e,t){return 1===o?e[t]:e.readUInt16BE(t*o)}if(n){let i=-1;for(a=r;a<s;a++)if(c(e,a)===c(t,-1===i?0:a-i)){if(-1===i&&(i=a),a-i+1===l)return i*o}else -1!==i&&(a-=a-i),i=-1}else for(r+l>s&&(r=s-l),a=r;a>=0;a--){let r=!0;for(let i=0;i<l;i++)if(c(e,a+i)!==c(t,i)){r=!1;break}if(r)return a}return -1}function v(e,t,r){r=Math.min(e.length,r);let i=[],n=t;for(;n<r;){let t=e[n],a=null,o=t>239?4:t>223?3:t>191?2:1;if(n+o<=r){let r,i,s,l;switch(o){case 1:t<128&&(a=t);break;case 2:(192&(r=e[n+1]))==128&&(l=(31&t)<<6|63&r)>127&&(a=l);break;case 3:r=e[n+1],i=e[n+2],(192&r)==128&&(192&i)==128&&(l=(15&t)<<12|(63&r)<<6|63&i)>2047&&(l<55296||l>57343)&&(a=l);break;case 4:r=e[n+1],i=e[n+2],s=e[n+3],(192&r)==128&&(192&i)==128&&(192&s)==128&&(l=(15&t)<<18|(63&r)<<12|(63&i)<<6|63&s)>65535&&l<1114112&&(a=l)}}null===a?(a=65533,o=1):a>65535&&(a-=65536,i.push(a>>>10&1023|55296),a=56320|1023&a),i.push(a),n+=o}return function(e){let t=e.length;if(t<=4096)return String.fromCharCode.apply(String,e);let r="",i=0;for(;i<t;)r+=String.fromCharCode.apply(String,e.slice(i,i+=4096));return r}(i)}function E(e,t,r){if(e%1!=0||e<0)throw RangeError("offset is not uint");if(e+t>r)throw RangeError("Trying to access beyond buffer length")}function x(e,t,r,i,n,a){if(!s.isBuffer(e))throw TypeError('"buffer" argument must be a Buffer instance');if(t>n||t<a)throw RangeError('"value" argument is out of bounds');if(r+i>e.length)throw RangeError("Index out of range")}function C(e,t,r,i,n){D(t,i,n,e,r,7);let a=Number(t&BigInt(4294967295));e[r++]=a,a>>=8,e[r++]=a,a>>=8,e[r++]=a,a>>=8,e[r++]=a;let o=Number(t>>BigInt(32)&BigInt(4294967295));return e[r++]=o,o>>=8,e[r++]=o,o>>=8,e[r++]=o,o>>=8,e[r++]=o,r}function B(e,t,r,i,n){D(t,i,n,e,r,7);let a=Number(t&BigInt(4294967295));e[r+7]=a,a>>=8,e[r+6]=a,a>>=8,e[r+5]=a,a>>=8,e[r+4]=a;let o=Number(t>>BigInt(32)&BigInt(4294967295));return e[r+3]=o,o>>=8,e[r+2]=o,o>>=8,e[r+1]=o,o>>=8,e[r]=o,r+8}function w(e,t,r,i,n,a){if(r+i>e.length||r<0)throw RangeError("Index out of range")}function I(e,t,r,i,a){return t=+t,r>>>=0,a||w(e,t,r,4,34028234663852886e22,-34028234663852886e22),n.write(e,t,r,i,23,4),r+4}function b(e,t,r,i,a){return t=+t,r>>>=0,a||w(e,t,r,8,17976931348623157e292,-17976931348623157e292),n.write(e,t,r,i,52,8),r+8}t.lW=s,t.h2=50,s.TYPED_ARRAY_SUPPORT=function(){try{let e=new Uint8Array(1),t={foo:function(){return 42}};return Object.setPrototypeOf(t,Uint8Array.prototype),Object.setPrototypeOf(e,t),42===e.foo()}catch(e){return!1}}(),s.TYPED_ARRAY_SUPPORT||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(s.prototype,"parent",{enumerable:!0,get:function(){if(s.isBuffer(this))return this.buffer}}),Object.defineProperty(s.prototype,"offset",{enumerable:!0,get:function(){if(s.isBuffer(this))return this.byteOffset}}),s.poolSize=8192,s.from=function(e,t,r){return l(e,t,r)},Object.setPrototypeOf(s.prototype,Uint8Array.prototype),Object.setPrototypeOf(s,Uint8Array),s.alloc=function(e,t,r){return(c(e),e<=0)?o(e):void 0!==t?"string"==typeof r?o(e).fill(t,r):o(e).fill(t):o(e)},s.allocUnsafe=function(e){return u(e)},s.allocUnsafeSlow=function(e){return u(e)},s.isBuffer=function(e){return null!=e&&!0===e._isBuffer&&e!==s.prototype},s.compare=function(e,t){if(L(e,Uint8Array)&&(e=s.from(e,e.offset,e.byteLength)),L(t,Uint8Array)&&(t=s.from(t,t.offset,t.byteLength)),!s.isBuffer(e)||!s.isBuffer(t))throw TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(e===t)return 0;let r=e.length,i=t.length;for(let n=0,a=Math.min(r,i);n<a;++n)if(e[n]!==t[n]){r=e[n],i=t[n];break}return r<i?-1:i<r?1:0},s.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},s.concat=function(e,t){let r;if(!Array.isArray(e))throw TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return s.alloc(0);if(void 0===t)for(r=0,t=0;r<e.length;++r)t+=e[r].length;let i=s.allocUnsafe(t),n=0;for(r=0;r<e.length;++r){let t=e[r];if(L(t,Uint8Array))n+t.length>i.length?(s.isBuffer(t)||(t=s.from(t)),t.copy(i,n)):Uint8Array.prototype.set.call(i,t,n);else if(s.isBuffer(t))t.copy(i,n);else throw TypeError('"list" argument must be an Array of Buffers');n+=t.length}return i},s.byteLength=f,s.prototype._isBuffer=!0,s.prototype.swap16=function(){let e=this.length;if(e%2!=0)throw RangeError("Buffer size must be a multiple of 16-bits");for(let t=0;t<e;t+=2)p(this,t,t+1);return this},s.prototype.swap32=function(){let e=this.length;if(e%4!=0)throw RangeError("Buffer size must be a multiple of 32-bits");for(let t=0;t<e;t+=4)p(this,t,t+3),p(this,t+1,t+2);return this},s.prototype.swap64=function(){let e=this.length;if(e%8!=0)throw RangeError("Buffer size must be a multiple of 64-bits");for(let t=0;t<e;t+=8)p(this,t,t+7),p(this,t+1,t+6),p(this,t+2,t+5),p(this,t+3,t+4);return this},s.prototype.toString=function(){let e=this.length;return 0===e?"":0==arguments.length?v(this,0,e):m.apply(this,arguments)},s.prototype.toLocaleString=s.prototype.toString,s.prototype.equals=function(e){if(!s.isBuffer(e))throw TypeError("Argument must be a Buffer");return this===e||0===s.compare(this,e)},s.prototype.inspect=function(){let e="",r=t.h2;return e=this.toString("hex",0,r).replace(/(.{2})/g,"$1 ").trim(),this.length>r&&(e+=" ... "),"<Buffer "+e+">"},a&&(s.prototype[a]=s.prototype.inspect),s.prototype.compare=function(e,t,r,i,n){if(L(e,Uint8Array)&&(e=s.from(e,e.offset,e.byteLength)),!s.isBuffer(e))throw TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof e);if(void 0===t&&(t=0),void 0===r&&(r=e?e.length:0),void 0===i&&(i=0),void 0===n&&(n=this.length),t<0||r>e.length||i<0||n>this.length)throw RangeError("out of range index");if(i>=n&&t>=r)return 0;if(i>=n)return -1;if(t>=r)return 1;if(t>>>=0,r>>>=0,i>>>=0,n>>>=0,this===e)return 0;let a=n-i,o=r-t,l=Math.min(a,o),c=this.slice(i,n),u=e.slice(t,r);for(let e=0;e<l;++e)if(c[e]!==u[e]){a=c[e],o=u[e];break}return a<o?-1:o<a?1:0},s.prototype.includes=function(e,t,r){return -1!==this.indexOf(e,t,r)},s.prototype.indexOf=function(e,t,r){return g(this,e,t,r,!0)},s.prototype.lastIndexOf=function(e,t,r){return g(this,e,t,r,!1)},s.prototype.write=function(e,t,r,i){var n,a,o,s,l,c,u,h;if(void 0===t)i="utf8",r=this.length,t=0;else if(void 0===r&&"string"==typeof t)i=t,r=this.length,t=0;else if(isFinite(t))t>>>=0,isFinite(r)?(r>>>=0,void 0===i&&(i="utf8")):(i=r,r=void 0);else throw Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");let A=this.length-t;if((void 0===r||r>A)&&(r=A),e.length>0&&(r<0||t<0)||t>this.length)throw RangeError("Attempt to write outside buffer bounds");i||(i="utf8");let d=!1;for(;;)switch(i){case"hex":return function(e,t,r,i){let n;r=Number(r)||0;let a=e.length-r;i?(i=Number(i))>a&&(i=a):i=a;let o=t.length;for(i>o/2&&(i=o/2),n=0;n<i;++n){let i=parseInt(t.substr(2*n,2),16);if(i!=i)break;e[r+n]=i}return n}(this,e,t,r);case"utf8":case"utf-8":return n=t,a=r,z(P(e,this.length-n),this,n,a);case"ascii":case"latin1":case"binary":return o=t,s=r,z(function(e){let t=[];for(let r=0;r<e.length;++r)t.push(255&e.charCodeAt(r));return t}(e),this,o,s);case"base64":return l=t,c=r,z(Q(e),this,l,c);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return u=t,h=r,z(function(e,t){let r,i;let n=[];for(let a=0;a<e.length&&!((t-=2)<0);++a)i=(r=e.charCodeAt(a))>>8,n.push(r%256),n.push(i);return n}(e,this.length-u),this,u,h);default:if(d)throw TypeError("Unknown encoding: "+i);i=(""+i).toLowerCase(),d=!0}},s.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}},s.prototype.slice=function(e,t){let r=this.length;e=~~e,t=void 0===t?r:~~t,e<0?(e+=r)<0&&(e=0):e>r&&(e=r),t<0?(t+=r)<0&&(t=0):t>r&&(t=r),t<e&&(t=e);let i=this.subarray(e,t);return Object.setPrototypeOf(i,s.prototype),i},s.prototype.readUintLE=s.prototype.readUIntLE=function(e,t,r){e>>>=0,t>>>=0,r||E(e,t,this.length);let i=this[e],n=1,a=0;for(;++a<t&&(n*=256);)i+=this[e+a]*n;return i},s.prototype.readUintBE=s.prototype.readUIntBE=function(e,t,r){e>>>=0,t>>>=0,r||E(e,t,this.length);let i=this[e+--t],n=1;for(;t>0&&(n*=256);)i+=this[e+--t]*n;return i},s.prototype.readUint8=s.prototype.readUInt8=function(e,t){return e>>>=0,t||E(e,1,this.length),this[e]},s.prototype.readUint16LE=s.prototype.readUInt16LE=function(e,t){return e>>>=0,t||E(e,2,this.length),this[e]|this[e+1]<<8},s.prototype.readUint16BE=s.prototype.readUInt16BE=function(e,t){return e>>>=0,t||E(e,2,this.length),this[e]<<8|this[e+1]},s.prototype.readUint32LE=s.prototype.readUInt32LE=function(e,t){return e>>>=0,t||E(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},s.prototype.readUint32BE=s.prototype.readUInt32BE=function(e,t){return e>>>=0,t||E(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},s.prototype.readBigUInt64LE=U(function(e){T(e>>>=0,"offset");let t=this[e],r=this[e+7];(void 0===t||void 0===r)&&R(e,this.length-8);let i=t+256*this[++e]+65536*this[++e]+16777216*this[++e],n=this[++e]+256*this[++e]+65536*this[++e]+16777216*r;return BigInt(i)+(BigInt(n)<<BigInt(32))}),s.prototype.readBigUInt64BE=U(function(e){T(e>>>=0,"offset");let t=this[e],r=this[e+7];(void 0===t||void 0===r)&&R(e,this.length-8);let i=16777216*t+65536*this[++e]+256*this[++e]+this[++e],n=16777216*this[++e]+65536*this[++e]+256*this[++e]+r;return(BigInt(i)<<BigInt(32))+BigInt(n)}),s.prototype.readIntLE=function(e,t,r){e>>>=0,t>>>=0,r||E(e,t,this.length);let i=this[e],n=1,a=0;for(;++a<t&&(n*=256);)i+=this[e+a]*n;return i>=(n*=128)&&(i-=Math.pow(2,8*t)),i},s.prototype.readIntBE=function(e,t,r){e>>>=0,t>>>=0,r||E(e,t,this.length);let i=t,n=1,a=this[e+--i];for(;i>0&&(n*=256);)a+=this[e+--i]*n;return a>=(n*=128)&&(a-=Math.pow(2,8*t)),a},s.prototype.readInt8=function(e,t){return(e>>>=0,t||E(e,1,this.length),128&this[e])?-((255-this[e]+1)*1):this[e]},s.prototype.readInt16LE=function(e,t){e>>>=0,t||E(e,2,this.length);let r=this[e]|this[e+1]<<8;return 32768&r?4294901760|r:r},s.prototype.readInt16BE=function(e,t){e>>>=0,t||E(e,2,this.length);let r=this[e+1]|this[e]<<8;return 32768&r?4294901760|r:r},s.prototype.readInt32LE=function(e,t){return e>>>=0,t||E(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},s.prototype.readInt32BE=function(e,t){return e>>>=0,t||E(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},s.prototype.readBigInt64LE=U(function(e){T(e>>>=0,"offset");let t=this[e],r=this[e+7];return(void 0===t||void 0===r)&&R(e,this.length-8),(BigInt(this[e+4]+256*this[e+5]+65536*this[e+6]+(r<<24))<<BigInt(32))+BigInt(t+256*this[++e]+65536*this[++e]+16777216*this[++e])}),s.prototype.readBigInt64BE=U(function(e){T(e>>>=0,"offset");let t=this[e],r=this[e+7];return(void 0===t||void 0===r)&&R(e,this.length-8),(BigInt((t<<24)+65536*this[++e]+256*this[++e]+this[++e])<<BigInt(32))+BigInt(16777216*this[++e]+65536*this[++e]+256*this[++e]+r)}),s.prototype.readFloatLE=function(e,t){return e>>>=0,t||E(e,4,this.length),n.read(this,e,!0,23,4)},s.prototype.readFloatBE=function(e,t){return e>>>=0,t||E(e,4,this.length),n.read(this,e,!1,23,4)},s.prototype.readDoubleLE=function(e,t){return e>>>=0,t||E(e,8,this.length),n.read(this,e,!0,52,8)},s.prototype.readDoubleBE=function(e,t){return e>>>=0,t||E(e,8,this.length),n.read(this,e,!1,52,8)},s.prototype.writeUintLE=s.prototype.writeUIntLE=function(e,t,r,i){if(e=+e,t>>>=0,r>>>=0,!i){let i=Math.pow(2,8*r)-1;x(this,e,t,r,i,0)}let n=1,a=0;for(this[t]=255&e;++a<r&&(n*=256);)this[t+a]=e/n&255;return t+r},s.prototype.writeUintBE=s.prototype.writeUIntBE=function(e,t,r,i){if(e=+e,t>>>=0,r>>>=0,!i){let i=Math.pow(2,8*r)-1;x(this,e,t,r,i,0)}let n=r-1,a=1;for(this[t+n]=255&e;--n>=0&&(a*=256);)this[t+n]=e/a&255;return t+r},s.prototype.writeUint8=s.prototype.writeUInt8=function(e,t,r){return e=+e,t>>>=0,r||x(this,e,t,1,255,0),this[t]=255&e,t+1},s.prototype.writeUint16LE=s.prototype.writeUInt16LE=function(e,t,r){return e=+e,t>>>=0,r||x(this,e,t,2,65535,0),this[t]=255&e,this[t+1]=e>>>8,t+2},s.prototype.writeUint16BE=s.prototype.writeUInt16BE=function(e,t,r){return e=+e,t>>>=0,r||x(this,e,t,2,65535,0),this[t]=e>>>8,this[t+1]=255&e,t+2},s.prototype.writeUint32LE=s.prototype.writeUInt32LE=function(e,t,r){return e=+e,t>>>=0,r||x(this,e,t,4,4294967295,0),this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e,t+4},s.prototype.writeUint32BE=s.prototype.writeUInt32BE=function(e,t,r){return e=+e,t>>>=0,r||x(this,e,t,4,4294967295,0),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},s.prototype.writeBigUInt64LE=U(function(e,t=0){return C(this,e,t,BigInt(0),BigInt("0xffffffffffffffff"))}),s.prototype.writeBigUInt64BE=U(function(e,t=0){return B(this,e,t,BigInt(0),BigInt("0xffffffffffffffff"))}),s.prototype.writeIntLE=function(e,t,r,i){if(e=+e,t>>>=0,!i){let i=Math.pow(2,8*r-1);x(this,e,t,r,i-1,-i)}let n=0,a=1,o=0;for(this[t]=255&e;++n<r&&(a*=256);)e<0&&0===o&&0!==this[t+n-1]&&(o=1),this[t+n]=(e/a>>0)-o&255;return t+r},s.prototype.writeIntBE=function(e,t,r,i){if(e=+e,t>>>=0,!i){let i=Math.pow(2,8*r-1);x(this,e,t,r,i-1,-i)}let n=r-1,a=1,o=0;for(this[t+n]=255&e;--n>=0&&(a*=256);)e<0&&0===o&&0!==this[t+n+1]&&(o=1),this[t+n]=(e/a>>0)-o&255;return t+r},s.prototype.writeInt8=function(e,t,r){return e=+e,t>>>=0,r||x(this,e,t,1,127,-128),e<0&&(e=255+e+1),this[t]=255&e,t+1},s.prototype.writeInt16LE=function(e,t,r){return e=+e,t>>>=0,r||x(this,e,t,2,32767,-32768),this[t]=255&e,this[t+1]=e>>>8,t+2},s.prototype.writeInt16BE=function(e,t,r){return e=+e,t>>>=0,r||x(this,e,t,2,32767,-32768),this[t]=e>>>8,this[t+1]=255&e,t+2},s.prototype.writeInt32LE=function(e,t,r){return e=+e,t>>>=0,r||x(this,e,t,4,2147483647,-2147483648),this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24,t+4},s.prototype.writeInt32BE=function(e,t,r){return e=+e,t>>>=0,r||x(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},s.prototype.writeBigInt64LE=U(function(e,t=0){return C(this,e,t,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),s.prototype.writeBigInt64BE=U(function(e,t=0){return B(this,e,t,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),s.prototype.writeFloatLE=function(e,t,r){return I(this,e,t,!0,r)},s.prototype.writeFloatBE=function(e,t,r){return I(this,e,t,!1,r)},s.prototype.writeDoubleLE=function(e,t,r){return b(this,e,t,!0,r)},s.prototype.writeDoubleBE=function(e,t,r){return b(this,e,t,!1,r)},s.prototype.copy=function(e,t,r,i){if(!s.isBuffer(e))throw TypeError("argument should be a Buffer");if(r||(r=0),i||0===i||(i=this.length),t>=e.length&&(t=e.length),t||(t=0),i>0&&i<r&&(i=r),i===r||0===e.length||0===this.length)return 0;if(t<0)throw RangeError("targetStart out of bounds");if(r<0||r>=this.length)throw RangeError("Index out of range");if(i<0)throw RangeError("sourceEnd out of bounds");i>this.length&&(i=this.length),e.length-t<i-r&&(i=e.length-t+r);let n=i-r;return this===e&&"function"==typeof Uint8Array.prototype.copyWithin?this.copyWithin(t,r,i):Uint8Array.prototype.set.call(e,this.subarray(r,i),t),n},s.prototype.fill=function(e,t,r,i){let n;if("string"==typeof e){if("string"==typeof t?(i=t,t=0,r=this.length):"string"==typeof r&&(i=r,r=this.length),void 0!==i&&"string"!=typeof i)throw TypeError("encoding must be a string");if("string"==typeof i&&!s.isEncoding(i))throw TypeError("Unknown encoding: "+i);if(1===e.length){let t=e.charCodeAt(0);("utf8"===i&&t<128||"latin1"===i)&&(e=t)}}else"number"==typeof e?e&=255:"boolean"==typeof e&&(e=Number(e));if(t<0||this.length<t||this.length<r)throw RangeError("Out of range index");if(r<=t)return this;if(t>>>=0,r=void 0===r?this.length:r>>>0,e||(e=0),"number"==typeof e)for(n=t;n<r;++n)this[n]=e;else{let a=s.isBuffer(e)?e:s.from(e,i),o=a.length;if(0===o)throw TypeError('The value "'+e+'" is invalid for argument "value"');for(n=0;n<r-t;++n)this[n+t]=a[n%o]}return this};let _={};function M(e,t,r){_[e]=class extends r{constructor(){super(),Object.defineProperty(this,"message",{value:t.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${e}]`,this.stack,delete this.name}get code(){return e}set code(e){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:e,writable:!0})}toString(){return`${this.name} [${e}]: ${this.message}`}}}function S(e){let t="",r=e.length,i="-"===e[0]?1:0;for(;r>=i+4;r-=3)t=`_${e.slice(r-3,r)}${t}`;return`${e.slice(0,r)}${t}`}function D(e,t,r,i,n,a){if(e>r||e<t){let i;let n="bigint"==typeof t?"n":"";throw i=a>3?0===t||t===BigInt(0)?`>= 0${n} and < 2${n} ** ${(a+1)*8}${n}`:`>= -(2${n} ** ${(a+1)*8-1}${n}) and < 2 ** ${(a+1)*8-1}${n}`:`>= ${t}${n} and <= ${r}${n}`,new _.ERR_OUT_OF_RANGE("value",i,e)}T(n,"offset"),(void 0===i[n]||void 0===i[n+a])&&R(n,i.length-(a+1))}function T(e,t){if("number"!=typeof e)throw new _.ERR_INVALID_ARG_TYPE(t,"number",e)}function R(e,t,r){if(Math.floor(e)!==e)throw T(e,r),new _.ERR_OUT_OF_RANGE(r||"offset","an integer",e);if(t<0)throw new _.ERR_BUFFER_OUT_OF_BOUNDS;throw new _.ERR_OUT_OF_RANGE(r||"offset",`>= ${r?1:0} and <= ${t}`,e)}M("ERR_BUFFER_OUT_OF_BOUNDS",function(e){return e?`${e} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError),M("ERR_INVALID_ARG_TYPE",function(e,t){return`The "${e}" argument must be of type number. Received type ${typeof t}`},TypeError),M("ERR_OUT_OF_RANGE",function(e,t,r){let i=`The value of "${e}" is out of range.`,n=r;return Number.isInteger(r)&&Math.abs(r)>4294967296?n=S(String(r)):"bigint"==typeof r&&(n=String(r),(r>BigInt(2)**BigInt(32)||r<-(BigInt(2)**BigInt(32)))&&(n=S(n)),n+="n"),i+=` It must be ${t}. Received ${n}`},RangeError);let F=/[^+/0-9A-Za-z-_]/g;function P(e,t){let r;t=t||1/0;let i=e.length,n=null,a=[];for(let o=0;o<i;++o){if((r=e.charCodeAt(o))>55295&&r<57344){if(!n){if(r>56319||o+1===i){(t-=3)>-1&&a.push(239,191,189);continue}n=r;continue}if(r<56320){(t-=3)>-1&&a.push(239,191,189),n=r;continue}r=(n-55296<<10|r-56320)+65536}else n&&(t-=3)>-1&&a.push(239,191,189);if(n=null,r<128){if((t-=1)<0)break;a.push(r)}else if(r<2048){if((t-=2)<0)break;a.push(r>>6|192,63&r|128)}else if(r<65536){if((t-=3)<0)break;a.push(r>>12|224,r>>6&63|128,63&r|128)}else if(r<1114112){if((t-=4)<0)break;a.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}else throw Error("Invalid code point")}return a}function Q(e){return i.toByteArray(function(e){if((e=(e=e.split("=")[0]).trim().replace(F,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function z(e,t,r,i){let n;for(n=0;n<i&&!(n+r>=t.length)&&!(n>=e.length);++n)t[n+r]=e[n];return n}function L(e,t){return e instanceof t||null!=e&&null!=e.constructor&&null!=e.constructor.name&&e.constructor.name===t.name}let O=function(){let e="0123456789abcdef",t=Array(256);for(let r=0;r<16;++r){let i=16*r;for(let n=0;n<16;++n)t[i+n]=e[r]+e[n]}return t}();function U(e){return"undefined"==typeof BigInt?k:e}function k(){throw Error("BigInt not supported")}},9087:function(e,t){/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */t.read=function(e,t,r,i,n){var a,o,s=8*n-i-1,l=(1<<s)-1,c=l>>1,u=-7,h=r?n-1:0,A=r?-1:1,d=e[t+h];for(h+=A,a=d&(1<<-u)-1,d>>=-u,u+=s;u>0;a=256*a+e[t+h],h+=A,u-=8);for(o=a&(1<<-u)-1,a>>=-u,u+=i;u>0;o=256*o+e[t+h],h+=A,u-=8);if(0===a)a=1-c;else{if(a===l)return o?NaN:1/0*(d?-1:1);o+=Math.pow(2,i),a-=c}return(d?-1:1)*o*Math.pow(2,a-i)},t.write=function(e,t,r,i,n,a){var o,s,l,c=8*a-n-1,u=(1<<c)-1,h=u>>1,A=23===n?5960464477539062e-23:0,d=i?0:a-1,f=i?1:-1,m=t<0||0===t&&1/t<0?1:0;for(isNaN(t=Math.abs(t))||t===1/0?(s=isNaN(t)?1:0,o=u):(o=Math.floor(Math.log(t)/Math.LN2),t*(l=Math.pow(2,-o))<1&&(o--,l*=2),o+h>=1?t+=A/l:t+=A*Math.pow(2,1-h),t*l>=2&&(o++,l/=2),o+h>=u?(s=0,o=u):o+h>=1?(s=(t*l-1)*Math.pow(2,n),o+=h):(s=t*Math.pow(2,h-1)*Math.pow(2,n),o=0));n>=8;e[r+d]=255&s,d+=f,s/=256,n-=8);for(o=o<<n|s,c+=n;c>0;e[r+d]=255&o,d+=f,o/=256,c-=8);e[r+d-f]|=128*m}},3018:function(e,t,r){"use strict";var i=r(1289);function n(){}function a(){}a.resetWarningCache=n,e.exports=function(){function e(e,t,r,n,a,o){if(o!==i){var s=Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw s.name="Invariant Violation",s}}function t(){return e}e.isRequired=e;var r={array:e,bigint:e,bool:e,func:e,number:e,object:e,string:e,symbol:e,any:e,arrayOf:t,element:e,elementType:e,instanceOf:t,node:e,objectOf:t,oneOf:t,oneOfType:t,shape:t,exact:t,checkPropTypes:a,resetWarningCache:n};return r.PropTypes=r,r}},4275:function(e,t,r){e.exports=r(3018)()},1289:function(e){"use strict";e.exports="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED"},6563:function(e){var t;e.exports=((t=function(){function e(e){return n.appendChild(e.dom),e}function r(e){for(var t=0;t<n.children.length;t++)n.children[t].style.display=t===e?"block":"none";i=e}var i=0,n=document.createElement("div");n.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",n.addEventListener("click",function(e){e.preventDefault(),r(++i%n.children.length)},!1);var a=(performance||Date).now(),o=a,s=0,l=e(new t.Panel("FPS","#0ff","#002")),c=e(new t.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var u=e(new t.Panel("MB","#f08","#201"));return r(0),{REVISION:16,dom:n,addPanel:e,showPanel:r,begin:function(){a=(performance||Date).now()},end:function(){s++;var e=(performance||Date).now();if(c.update(e-a,200),e>o+1e3&&(l.update(1e3*s/(e-o),100),o=e,s=0,u)){var t=performance.memory;u.update(t.usedJSHeapSize/1048576,t.jsHeapSizeLimit/1048576)}return e},update:function(){a=this.end()},domElement:n,setMode:r}}).Panel=function(e,t,r){var i=1/0,n=0,a=Math.round,o=a(window.devicePixelRatio||1),s=80*o,l=48*o,c=3*o,u=2*o,h=3*o,A=15*o,d=74*o,f=30*o,m=document.createElement("canvas");m.width=s,m.height=l,m.style.cssText="width:80px;height:48px";var p=m.getContext("2d");return p.font="bold "+9*o+"px Helvetica,Arial,sans-serif",p.textBaseline="top",p.fillStyle=r,p.fillRect(0,0,s,l),p.fillStyle=t,p.fillText(e,c,u),p.fillRect(h,A,d,f),p.fillStyle=r,p.globalAlpha=.9,p.fillRect(h,A,d,f),{dom:m,update:function(l,g){i=Math.min(i,l),n=Math.max(n,l),p.fillStyle=r,p.globalAlpha=1,p.fillRect(0,0,s,A),p.fillStyle=t,p.fillText(a(l)+" "+e+" ("+a(i)+"-"+a(n)+")",c,u),p.drawImage(m,h+o,A,d-o,f,h,A,d-o,f),p.fillRect(h+d-o,A,o,f),p.fillStyle=r,p.globalAlpha=.9,p.fillRect(h+d-o,A,o,a((1-l/g)*f))}}},t)},6956:function(e,t,r){"use strict";r.d(t,{B$:function(){return function e(t,r){let n=function(e){let t=JSON.stringify(e,d),r=m.get(t);return null==r&&m.set(t,r=++f),r}(r),p=c.get(t);if(p||c.set(t,p=Object.create(null)),p[n])return new p[n];let g=`_onBeforeCompile${n}`,y=function(e,i){t.onBeforeCompile.call(this,e,i);let o=this.customProgramCacheKey()+"|"+e.vertexShader+"|"+e.fragmentShader,c=u[o];if(!c){let t=function(e,{vertexShader:t,fragmentShader:r},i,n){let{vertexDefs:o,vertexMainIntro:s,vertexMainOutro:l,vertexTransform:c,fragmentDefs:u,fragmentMainIntro:h,fragmentMainOutro:d,fragmentColorTransform:f,customRewriter:m,timeUniform:p}=i;if(o=o||"",s=s||"",l=l||"",u=u||"",h=h||"",d=d||"",(c||m)&&(t=a(t)),(f||m)&&(r=a(r=r.replace(/^[ \t]*#include <((?:tonemapping|encodings|colorspace|fog|premultiplied_alpha|dithering)_fragment)>/gm,"\n//!BEGIN_POST_CHUNK $1\n$&\n//!END_POST_CHUNK\n"))),m){let e=m({vertexShader:t,fragmentShader:r});t=e.vertexShader,r=e.fragmentShader}if(f){let e=[];r=r.replace(/^\/\/!BEGIN_POST_CHUNK[^]+?^\/\/!END_POST_CHUNK/gm,t=>(e.push(t),"")),d=`${f}
${e.join("\n")}
${d}`}if(p){let e=`
uniform float ${p};
`;o=e+o,u=e+u}return c&&(t=`vec3 troika_position_${n};
vec3 troika_normal_${n};
vec2 troika_uv_${n};
${t}
`,o=`${o}
void troikaVertexTransform${n}(inout vec3 position, inout vec3 normal, inout vec2 uv) {
  ${c}
}
`,s=`
troika_position_${n} = vec3(position);
troika_normal_${n} = vec3(normal);
troika_uv_${n} = vec2(uv);
troikaVertexTransform${n}(troika_position_${n}, troika_normal_${n}, troika_uv_${n});
${s}
`,t=t.replace(/\b(position|normal|uv)\b/g,(e,t,r,i)=>/\battribute\s+vec[23]\s+$/.test(i.substr(0,r))?t:`troika_${t}_${n}`),e.map&&e.map.channel>0||(t=t.replace(/\bMAP_UV\b/g,`troika_uv_${n}`))),{vertexShader:t=A(t,n,o,s,l),fragmentShader:r=A(r,n,u,h,d)}}(this,e,r,n);c=u[o]=t}e.vertexShader=c.vertexShader,e.fragmentShader=c.fragmentShader,s(e.uniforms,this.uniforms),r.timeUniform&&(e.uniforms[r.timeUniform]={get value(){return Date.now()-l}}),this[g]&&this[g](e)},v=function(){return E(r.chained?t:t.clone())},E=function(e){let i=Object.create(e,x);return Object.defineProperty(i,"baseMaterial",{value:t}),Object.defineProperty(i,"id",{value:h++}),i.uuid=function(){let e=4294967295*Math.random()|0,t=4294967295*Math.random()|0,r=4294967295*Math.random()|0,i=4294967295*Math.random()|0;return(o[255&e]+o[e>>8&255]+o[e>>16&255]+o[e>>24&255]+"-"+o[255&t]+o[t>>8&255]+"-"+o[t>>16&15|64]+o[t>>24&255]+"-"+o[63&r|128]+o[r>>8&255]+"-"+o[r>>16&255]+o[r>>24&255]+o[255&i]+o[i>>8&255]+o[i>>16&255]+o[i>>24&255]).toUpperCase()}(),i.uniforms=s({},e.uniforms,r.uniforms),i.defines=s({},e.defines,r.defines),i.defines[`TROIKA_DERIVED_MATERIAL_${n}`]="",i.extensions=s({},e.extensions,r.extensions),i._listeners=void 0,i},x={constructor:{value:v},isDerivedMaterial:{value:!0},type:{get:()=>t.type,set:e=>{t.type=e}},isDerivedFrom:{writable:!0,configurable:!0,value:function(e){let t=this.baseMaterial;return e===t||t.isDerivedMaterial&&t.isDerivedFrom(e)||!1}},customProgramCacheKey:{writable:!0,configurable:!0,value:function(){return t.customProgramCacheKey()+"|"+n}},onBeforeCompile:{get:()=>y,set(e){this[g]=e}},copy:{writable:!0,configurable:!0,value:function(e){return t.copy.call(this,e),t.isShaderMaterial||t.isDerivedMaterial||(s(this.extensions,e.extensions),s(this.defines,e.defines),s(this.uniforms,i.UniformsUtils.clone(e.uniforms))),this}},clone:{writable:!0,configurable:!0,value:function(){return E(new t.constructor).copy(this)}},getDepthMaterial:{writable:!0,configurable:!0,value:function(){let n=this._depthMaterial;return n||((n=this._depthMaterial=e(t.isDerivedMaterial?t.getDepthMaterial():new i.MeshDepthMaterial({depthPacking:i.RGBADepthPacking}),r)).defines.IS_DEPTH_MATERIAL="",n.uniforms=this.uniforms),n}},getDistanceMaterial:{writable:!0,configurable:!0,value:function(){let n=this._distanceMaterial;return n||((n=this._distanceMaterial=e(t.isDerivedMaterial?t.getDistanceMaterial():new i.MeshDistanceMaterial,r)).defines.IS_DISTANCE_MATERIAL="",n.uniforms=this.uniforms),n}},dispose:{writable:!0,configurable:!0,value(){let{_depthMaterial:e,_distanceMaterial:r}=this;e&&e.dispose(),r&&r.dispose(),t.dispose.call(this)}}};return p[n]=v,new v}},MW:function(){return n}});var i=r(6375);let n=/\bvoid\s+main\s*\(\s*\)\s*{/g;function a(e){return e.replace(/^[ \t]*#include +<([\w\d./]+)>/gm,function(e,t){let r=i.ShaderChunk[t];return r?a(r):e})}let o=[];for(let e=0;e<256;e++)o[e]=(e<16?"0":"")+e.toString(16);let s=Object.assign||function(){let e=arguments[0];for(let t=1,r=arguments.length;t<r;t++){let r=arguments[t];if(r)for(let t in r)Object.prototype.hasOwnProperty.call(r,t)&&(e[t]=r[t])}return e},l=Date.now(),c=new WeakMap,u=new Map,h=1e10;function A(e,t,r,i,a){return(i||a||r)&&(e=e.replace(n,`
${r}
void troikaOrigMain${t}() {`)+`
void main() {
  ${i}
  troikaOrigMain${t}();
  ${a}
}`),e}function d(e,t){return"uniforms"===e?void 0:"function"==typeof t?t.toString():t}let f=0,m=new Map;i.DoubleSide},7948:function(e,t,r){"use strict";function i(){var e=Object.create(null);function t(e,t){var r=void 0;self.troikaDefine=function(e){return r=e};var i=URL.createObjectURL(new Blob(["/** "+e.replace(/\*/g,"")+" **/\n\ntroikaDefine(\n"+t+"\n)"],{type:"application/javascript"}));try{importScripts(i)}catch(e){console.error(e)}return URL.revokeObjectURL(i),delete self.troikaDefine,r}self.addEventListener("message",function(r){var i=r.data,n=i.messageId,a=i.action,o=i.data;try{"registerModule"===a&&function r(i,n){var a=i.id,o=i.name,s=i.dependencies;void 0===s&&(s=[]);var l=i.init;void 0===l&&(l=function(){});var c=i.getTransferables;if(void 0===c&&(c=null),!e[a])try{s=s.map(function(t){return t&&t.isWorkerModule&&(r(t,function(e){if(e instanceof Error)throw e}),t=e[t.id].value),t}),l=t("<"+o+">.init",l),c&&(c=t("<"+o+">.getTransferables",c));var u=null;"function"==typeof l?u=l.apply(void 0,s):console.error("worker module init function failed to rehydrate"),e[a]={id:a,value:u,getTransferables:c},n(u)}catch(e){e&&e.noLog||console.error(e),n(e)}}(o,function(e){e instanceof Error?postMessage({messageId:n,success:!1,error:e.message}):postMessage({messageId:n,success:!0,result:{isCallable:"function"==typeof e}})}),"callModule"===a&&function(t,r){var i,n=t.id,a=t.args;e[n]&&"function"==typeof e[n].value||r(Error("Worker module "+n+": not found or its 'init' did not return a function"));try{var o=(i=e[n]).value.apply(i,a);o&&"function"==typeof o.then?o.then(s,function(e){return r(e instanceof Error?e:Error(""+e))}):s(o)}catch(e){r(e)}function s(t){try{var i=e[n].getTransferables&&e[n].getTransferables(t);i&&Array.isArray(i)&&i.length||(i=void 0),r(t,i)}catch(e){console.error(e),r(e)}}}(o,function(e,t){e instanceof Error?postMessage({messageId:n,success:!1,error:e.message}):postMessage({messageId:n,success:!0,result:e},t||void 0)})}catch(e){postMessage({messageId:n,success:!1,error:e.stack})}})}r.d(t,{Ae:function(){return h},Ch:function(){return function e(t){if((!t||"function"!=typeof t.init)&&!s)throw Error("requires `options.init` function");var r,i=t.dependencies,o=t.init,l=t.getTransferables,u=t.workerId,h=((r=function(){for(var e=[],t=arguments.length;t--;)e[t]=arguments[t];return r._getInitResult().then(function(t){if("function"==typeof t)return t.apply(void 0,e);throw Error("Worker module function was called but `init` did not return a callable function")})})._getInitResult=function(){var e=t.dependencies,i=t.init,n=Promise.all(e=Array.isArray(e)?e.map(function(e){return e&&(e=e.onMainThread||e)._getInitResult&&(e=e._getInitResult()),e}):[]).then(function(e){return i.apply(null,e)});return r._getInitResult=function(){return n},n},r);null==u&&(u="#default");var f="workerModule"+ ++a,m=t.name||f,p=null;function g(){for(var e=[],t=arguments.length;t--;)e[t]=arguments[t];if(!n())return h.apply(void 0,e);if(!p){p=d(u,"registerModule",g.workerModuleData);var r=function(){p=null,c[u].delete(r)};(c[u]||(c[u]=new Set)).add(r)}return p.then(function(t){if(t.isCallable)return d(u,"callModule",{id:f,args:e});throw Error("Worker module function was called but `init` did not return a callable function")})}return i=i&&i.map(function(t){return"function"!=typeof t||t.workerModuleData||(s=!0,t=e({workerId:u,name:"<"+m+"> function dependency: "+t.name,init:"function(){return (\n"+A(t)+"\n)}"}),s=!1),t&&t.workerModuleData&&(t=t.workerModuleData),t}),g.workerModuleData={isWorkerModule:!0,id:f,name:m,dependencies:i,init:A(o),getTransferables:l&&A(l)},g.onMainThread=h,g}}}),r(2601);var n=function(){var e=!1;if("undefined"!=typeof window&&void 0!==window.document)try{new Worker(URL.createObjectURL(new Blob([""],{type:"application/javascript"}))).terminate(),e=!0}catch(e){console.log("Troika createWorkerModule: web workers not allowed; falling back to main thread execution. Cause: ["+e.message+"]")}return n=function(){return e},e},a=0,o=0,s=!1,l=Object.create(null),c=Object.create(null),u=Object.create(null);function h(e){c[e]&&c[e].forEach(function(e){e()}),l[e]&&(l[e].terminate(),delete l[e])}function A(e){var t=e.toString();return!/^function/.test(t)&&/^\w+\s*\(/.test(t)&&(t="function "+t),t}function d(e,t,r){return new Promise(function(n,a){var s=++o;u[s]=function(e){e.success?n(e.result):a(Error("Error in worker "+t+" call: "+e.error))},(function(e){var t=l[e];if(!t){var r=A(i);(t=l[e]=new Worker(URL.createObjectURL(new Blob(["/** Worker Module Bootstrap: "+e.replace(/\*/g,"")+" **/\n\n;("+r+")()"],{type:"application/javascript"})))).onmessage=function(e){var t=e.data,r=t.messageId,i=u[r];if(!i)throw Error("WorkerModule response with empty or unknown messageId");delete u[r],i(t)}}return t})(e).postMessage({messageId:s,action:t,data:r})})}},9808:function(e,t,r){"use strict";/**
 * @license React
 * use-sync-external-store-shim.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var i=r(2265),n="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t},a=i.useState,o=i.useEffect,s=i.useLayoutEffect,l=i.useDebugValue;function c(e){var t=e.getSnapshot;e=e.value;try{var r=t();return!n(e,r)}catch(e){return!0}}var u="undefined"==typeof window||void 0===window.document||void 0===window.document.createElement?function(e,t){return t()}:function(e,t){var r=t(),i=a({inst:{value:r,getSnapshot:t}}),n=i[0].inst,u=i[1];return s(function(){n.value=r,n.getSnapshot=t,c(n)&&u({inst:n})},[e,r,t]),o(function(){return c(n)&&u({inst:n}),e(function(){c(n)&&u({inst:n})})},[e]),l(r),r};t.useSyncExternalStore=void 0!==i.useSyncExternalStore?i.useSyncExternalStore:u},3176:function(e,t,r){"use strict";/**
 * @license React
 * use-sync-external-store-shim/with-selector.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var i=r(2265),n=r(6272),a="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t},o=n.useSyncExternalStore,s=i.useRef,l=i.useEffect,c=i.useMemo,u=i.useDebugValue;t.useSyncExternalStoreWithSelector=function(e,t,r,i,n){var h=s(null);if(null===h.current){var A={hasValue:!1,value:null};h.current=A}else A=h.current;var d=o(e,(h=c(function(){function e(e){if(!l){if(l=!0,o=e,e=i(e),void 0!==n&&A.hasValue){var t=A.value;if(n(t,e))return s=t}return s=e}if(t=s,a(o,e))return t;var r=i(e);return void 0!==n&&n(t,r)?(o=e,t):(o=e,s=r)}var o,s,l=!1,c=void 0===r?null:r;return[function(){return e(t())},null===c?void 0:function(){return e(c())}]},[t,r,i,n]))[0],h[1]);return l(function(){A.hasValue=!0,A.value=d},[d]),u(d),d}},6272:function(e,t,r){"use strict";e.exports=r(9808)},5401:function(e,t,r){"use strict";e.exports=r(3176)},2973:function(e,t){"use strict";t.Z=function(){return function(e){var t,r,i,n,a={R:"13k,1a,2,3,3,2+1j,ch+16,a+1,5+2,2+n,5,a,4,6+16,4+3,h+1b,4mo,179q,2+9,2+11,2i9+7y,2+68,4,3+4,5+13,4+3,2+4k,3+29,8+cf,1t+7z,w+17,3+3m,1t+3z,16o1+5r,8+30,8+mc,29+1r,29+4v,75+73",EN:"1c+9,3d+1,6,187+9,513,4+5,7+9,sf+j,175h+9,qw+q,161f+1d,4xt+a,25i+9",ES:"17,2,6dp+1,f+1,av,16vr,mx+1,4o,2",ET:"z+2,3h+3,b+1,ym,3e+1,2o,p4+1,8,6u,7c,g6,1wc,1n9+4,30+1b,2n,6d,qhx+1,h0m,a+1,49+2,63+1,4+1,6bb+3,12jj",AN:"16o+5,2j+9,2+1,35,ed,1ff2+9,87+u",CS:"18,2+1,b,2u,12k,55v,l,17v0,2,3,53,2+1,b",B:"a,3,f+2,2v,690",S:"9,2,k",WS:"c,k,4f4,1vk+a,u,1j,335",ON:"x+1,4+4,h+5,r+5,r+3,z,5+3,2+1,2+1,5,2+2,3+4,o,w,ci+1,8+d,3+d,6+8,2+g,39+1,9,6+1,2,33,b8,3+1,3c+1,7+1,5r,b,7h+3,sa+5,2,3i+6,jg+3,ur+9,2v,ij+1,9g+9,7+a,8m,4+1,49+x,14u,2+2,c+2,e+2,e+2,e+1,i+n,e+e,2+p,u+2,e+2,36+1,2+3,2+1,b,2+2,6+5,2,2,2,h+1,5+4,6+3,3+f,16+2,5+3l,3+81,1y+p,2+40,q+a,m+13,2r+ch,2+9e,75+hf,3+v,2+2w,6e+5,f+6,75+2a,1a+p,2+2g,d+5x,r+b,6+3,4+o,g,6+1,6+2,2k+1,4,2j,5h+z,1m+1,1e+f,t+2,1f+e,d+3,4o+3,2s+1,w,535+1r,h3l+1i,93+2,2s,b+1,3l+x,2v,4g+3,21+3,kz+1,g5v+1,5a,j+9,n+v,2,3,2+8,2+1,3+2,2,3,46+1,4+4,h+5,r+5,r+a,3h+2,4+6,b+4,78,1r+24,4+c,4,1hb,ey+6,103+j,16j+c,1ux+7,5+g,fsh,jdq+1t,4,57+2e,p1,1m,1m,1m,1m,4kt+1,7j+17,5+2r,d+e,3+e,2+e,2+10,m+4,w,1n+5,1q,4z+5,4b+rb,9+c,4+c,4+37,d+2g,8+b,l+b,5+1j,9+9,7+13,9+t,3+1,27+3c,2+29,2+3q,d+d,3+4,4+2,6+6,a+o,8+6,a+2,e+6,16+42,2+1i",BN:"0+8,6+d,2s+5,2+p,e,4m9,1kt+2,2b+5,5+5,17q9+v,7k,6p+8,6+1,119d+3,440+7,96s+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+75,6p+2rz,1ben+1,1ekf+1,1ekf+1",NSM:"lc+33,7o+6,7c+18,2,2+1,2+1,2,21+a,1d+k,h,2u+6,3+5,3+1,2+3,10,v+q,2k+a,1n+8,a,p+3,2+8,2+2,2+4,18+2,3c+e,2+v,1k,2,5+7,5,4+6,b+1,u,1n,5+3,9,l+1,r,3+1,1m,5+1,5+1,3+2,4,v+1,4,c+1,1m,5+4,2+1,5,l+1,n+5,2,1n,3,2+3,9,8+1,c+1,v,1q,d,1f,4,1m+2,6+2,2+3,8+1,c+1,u,1n,g+1,l+1,t+1,1m+1,5+3,9,l+1,u,21,8+2,2,2j,3+6,d+7,2r,3+8,c+5,23+1,s,2,2,1k+d,2+4,2+1,6+a,2+z,a,2v+3,2+5,2+1,3+1,q+1,5+2,h+3,e,3+1,7,g,jk+2,qb+2,u+2,u+1,v+1,1t+1,2+6,9,3+a,a,1a+2,3c+1,z,3b+2,5+1,a,7+2,64+1,3,1n,2+6,2,2,3+7,7+9,3,1d+g,1s+3,1d,2+4,2,6,15+8,d+1,x+3,3+1,2+2,1l,2+1,4,2+2,1n+7,3+1,49+2,2+c,2+6,5,7,4+1,5j+1l,2+4,k1+w,2db+2,3y,2p+v,ff+3,30+1,n9x+3,2+9,x+1,29+1,7l,4,5,q+1,6,48+1,r+h,e,13+7,q+a,1b+2,1d,3+3,3+1,14,1w+5,3+1,3+1,d,9,1c,1g,2+2,3+1,6+1,2,17+1,9,6n,3,5,fn5,ki+f,h+f,r2,6b,46+4,1af+2,2+1,6+3,15+2,5,4m+1,fy+3,as+1,4a+a,4x,1j+e,1l+2,1e+3,3+1,1y+2,11+4,2+7,1r,d+1,1h+8,b+3,3,2o+2,3,2+1,7,4h,4+7,m+1,1m+1,4,12+6,4+4,5g+7,3+2,2,o,2d+5,2,5+1,2+1,6n+3,7+1,2+1,s+1,2e+7,3,2+1,2z,2,3+5,2,2u+2,3+3,2+4,78+8,2+1,75+1,2,5,41+3,3+1,5,x+5,3+1,15+5,3+3,9,a+5,3+2,1b+c,2+1,bb+6,2+5,2d+l,3+6,2+1,2+1,3f+5,4,2+1,2+6,2,21+1,4,2,9o+1,f0c+4,1o+6,t5,1s+3,2a,f5l+1,43t+2,i+7,3+6,v+3,45+2,1j0+1i,5+1d,9,f,n+4,2+e,11t+6,2+g,3+6,2+1,2+4,7a+6,c6+3,15t+6,32+6,gzhy+6n",AL:"16w,3,2,e+1b,z+2,2+2s,g+1,8+1,b+m,2+t,s+2i,c+e,4h+f,1d+1e,1bwe+dp,3+3z,x+c,2+1,35+3y,2rm+z,5+7,b+5,dt+l,c+u,17nl+27,1t+27,4x+6n,3+d",LRO:"6ct",RLO:"6cu",LRE:"6cq",RLE:"6cr",PDF:"6cs",LRI:"6ee",RLI:"6ef",FSI:"6eg",PDI:"6eh"},o={},s={};o.L=1,s[1]="L",Object.keys(a).forEach(function(e,t){o[e]=1<<t+1,s[o[e]]=e}),Object.freeze(o);var l=o.LRI|o.RLI|o.FSI,c=o.L|o.R|o.AL,u=o.B|o.S|o.WS|o.ON|o.FSI|o.LRI|o.RLI|o.PDI,h=o.BN|o.RLE|o.LRE|o.RLO|o.LRO|o.PDF,A=o.S|o.WS|o.B|l|o.PDI|h,d=null;function f(e){return!function(){if(!d){d=new Map;var e=function(e){if(a.hasOwnProperty(e)){var t=0;a[e].split(",").forEach(function(r){var i=r.split("+"),n=i[0],a=i[1];n=parseInt(n,36),a=a?parseInt(a,36):0,d.set(t+=n,o[e]);for(var s=0;s<a;s++)d.set(++t,o[e])})}};for(var t in a)e(t)}}(),d.get(e.codePointAt(0))||o.L}var m={pairs:"14>1,1e>2,u>2,2wt>1,1>1,1ge>1,1wp>1,1j>1,f>1,hm>1,1>1,u>1,u6>1,1>1,+5,28>1,w>1,1>1,+3,b8>1,1>1,+3,1>3,-1>-1,3>1,1>1,+2,1s>1,1>1,x>1,th>1,1>1,+2,db>1,1>1,+3,3>1,1>1,+2,14qm>1,1>1,+1,4q>1,1e>2,u>2,2>1,+1",canonical:"6f1>-6dx,6dy>-6dx,6ec>-6ed,6ee>-6ed,6ww>2jj,-2ji>2jj,14r4>-1e7l,1e7m>-1e7l,1e7m>-1e5c,1e5d>-1e5b,1e5c>-14qx,14qy>-14qx,14vn>-1ecg,1ech>-1ecg,1edu>-1ecg,1eci>-1ecg,1eda>-1ecg,1eci>-1ecg,1eci>-168q,168r>-168q,168s>-14ye,14yf>-14ye"};function p(e,t){var r,i=0,n=new Map,a=t&&new Map;return e.split(",").forEach(function e(o){if(-1!==o.indexOf("+"))for(var s=+o;s--;)e(r);else{r=o;var l=o.split(">"),c=l[0],u=l[1];c=String.fromCodePoint(i+=parseInt(c,36)),u=String.fromCodePoint(i+=parseInt(u,36)),n.set(c,u),t&&a.set(u,c)}}),{map:n,reverseMap:a}}function g(){if(!t){var e=p(m.pairs,!0),n=e.map,a=e.reverseMap;t=n,r=a,i=p(m.canonical,!1).map}}function y(e){return g(),t.get(e)||null}function v(e){return g(),r.get(e)||null}function E(e){return g(),i.get(e)||null}var x=o.L,C=o.R,B=o.EN,w=o.ES,I=o.ET,b=o.AN,_=o.CS,M=o.B,S=o.S,D=o.ON,T=o.BN,R=o.NSM,F=o.AL,P=o.LRO,Q=o.RLO,z=o.LRE,L=o.RLE,O=o.PDF,U=o.LRI,k=o.RLI,G=o.FSI,N=o.PDI;function H(e){return!function(){if(!n){var e=p("14>1,j>2,t>2,u>2,1a>g,2v3>1,1>1,1ge>1,1wd>1,b>1,1j>1,f>1,ai>3,-2>3,+1,8>1k0,-1jq>1y7,-1y6>1hf,-1he>1h6,-1h5>1ha,-1h8>1qi,-1pu>1,6>3u,-3s>7,6>1,1>1,f>1,1>1,+2,3>1,1>1,+13,4>1,1>1,6>1eo,-1ee>1,3>1mg,-1me>1mk,-1mj>1mi,-1mg>1mi,-1md>1,1>1,+2,1>10k,-103>1,1>1,4>1,5>1,1>1,+10,3>1,1>8,-7>8,+1,-6>7,+1,a>1,1>1,u>1,u6>1,1>1,+5,26>1,1>1,2>1,2>2,8>1,7>1,4>1,1>1,+5,b8>1,1>1,+3,1>3,-2>1,2>1,1>1,+2,c>1,3>1,1>1,+2,h>1,3>1,a>1,1>1,2>1,3>1,1>1,d>1,f>1,3>1,1a>1,1>1,6>1,7>1,13>1,k>1,1>1,+19,4>1,1>1,+2,2>1,1>1,+18,m>1,a>1,1>1,lk>1,1>1,4>1,2>1,f>1,3>1,1>1,+3,db>1,1>1,+3,3>1,1>1,+2,14qm>1,1>1,+1,6>1,4j>1,j>2,t>2,u>2,2>1,+1",!0),t=e.map;e.reverseMap.forEach(function(e,r){t.set(r,e)}),n=t}}(),n.get(e)||null}function V(e,t,r,i){var n=e.length;r=Math.max(0,null==r?0:+r),i=Math.min(n-1,null==i?n-1:+i);var a=[];return t.paragraphs.forEach(function(n){var o=Math.max(r,n.start),s=Math.min(i,n.end);if(o<s){for(var l=t.levels.slice(o,s+1),c=s;c>=o&&f(e[c])&A;c--)l[c]=n.level;for(var u=n.level,h=1/0,d=0;d<l.length;d++){var m=l[d];m>u&&(u=m),m<h&&(h=1|m)}for(var p=u;p>=h;p--)for(var g=0;g<l.length;g++)if(l[g]>=p){for(var y=g;g+1<l.length&&l[g+1]>=p;)g++;g>y&&a.push([y+o,g+o])}}}),a}function j(e,t,r,i){for(var n=V(e,t,r,i),a=[],o=0;o<e.length;o++)a[o]=o;return n.forEach(function(e){for(var t=e[0],r=e[1],i=a.slice(t,r+1),n=i.length;n--;)a[r-n]=i[n]}),a}return e.closingToOpeningBracket=v,e.getBidiCharType=f,e.getBidiCharTypeName=function(e){return s[f(e)]},e.getCanonicalBracket=E,e.getEmbeddingLevels=function(e,t){for(var r=new Uint32Array(e.length),i=0;i<e.length;i++)r[i]=f(e[i]);var n=new Map;function a(e,t){var i=r[e];r[e]=t,n.set(i,n.get(i)-1),i&u&&n.set(u,n.get(u)-1),n.set(t,(n.get(t)||0)+1),t&u&&n.set(u,(n.get(u)||0)+1)}for(var o=new Uint8Array(e.length),s=new Map,d=[],m=null,p=0;p<e.length;p++)m||d.push(m={start:p,end:e.length-1,level:"rtl"===t?1:"ltr"===t?0:tD(p,!1)}),r[p]&M&&(m.end=p,m=null);for(var g=L|z|Q|P|l|N|O|M,H=function(e){return e+(1&e?1:2)},V=function(e){return e+(1&e?2:1)},j=0;j<d.length;j++){var J=[{_level:(m=d[j]).level,_override:0,_isolate:0}],Y=void 0,W=0,K=0,q=0;n.clear();for(var X=m.start;X<=m.end;X++){var Z=r[X];if(Y=J[J.length-1],n.set(Z,(n.get(Z)||0)+1),Z&u&&n.set(u,(n.get(u)||0)+1),Z&g){if(Z&(L|z)){o[X]=Y._level;var $=(Z===L?V:H)(Y._level);!($<=125)||W||K?!W&&K++:J.push({_level:$,_override:0,_isolate:0})}else if(Z&(Q|P)){o[X]=Y._level;var ee=(Z===Q?V:H)(Y._level);!(ee<=125)||W||K?!W&&K++:J.push({_level:ee,_override:Z&Q?C:x,_isolate:0})}else if(Z&l){Z&G&&(Z=1===tD(X+1,!0)?k:U),o[X]=Y._level,Y._override&&a(X,Y._override);var et=(Z===k?V:H)(Y._level);et<=125&&0===W&&0===K?(q++,J.push({_level:et,_override:0,_isolate:1,_isolInitIndex:X})):W++}else if(Z&N){if(W>0)W--;else if(q>0){for(K=0;!J[J.length-1]._isolate;)J.pop();var er=J[J.length-1]._isolInitIndex;null!=er&&(s.set(er,X),s.set(X,er)),J.pop(),q--}Y=J[J.length-1],o[X]=Y._level,Y._override&&a(X,Y._override)}else Z&O?(0===W&&(K>0?K--:!Y._isolate&&J.length>1&&(J.pop(),Y=J[J.length-1])),o[X]=Y._level):Z&M&&(o[X]=m.level)}else o[X]=Y._level,Y._override&&Z!==T&&a(X,Y._override)}for(var ei=[],en=null,ea=m.start;ea<=m.end;ea++){var eo=r[ea];if(!(eo&h)){var es=o[ea],el=eo&l,ec=eo===N;en&&es===en._level?(en._end=ea,en._endsWithIsolInit=el):ei.push(en={_start:ea,_end:ea,_level:es,_startsWithPDI:ec,_endsWithIsolInit:el})}}for(var eu=[],eh=0;eh<ei.length;eh++){var eA=ei[eh];if(!eA._startsWithPDI||eA._startsWithPDI&&!s.has(eA._start)){for(var ed=[en=eA],ef=void 0;en&&en._endsWithIsolInit&&null!=(ef=s.get(en._end));)for(var em=eh+1;em<ei.length;em++)if(ei[em]._start===ef){ed.push(en=ei[em]);break}for(var ep=[],eg=0;eg<ed.length;eg++)for(var ey=ed[eg],ev=ey._start;ev<=ey._end;ev++)ep.push(ev);for(var eE=o[ep[0]],ex=m.level,eC=ep[0]-1;eC>=0;eC--)if(!(r[eC]&h)){ex=o[eC];break}var eB=ep[ep.length-1],ew=o[eB],eI=m.level;if(!(r[eB]&l)){for(var eb=eB+1;eb<=m.end;eb++)if(!(r[eb]&h)){eI=o[eb];break}}eu.push({_seqIndices:ep,_sosType:Math.max(ex,eE)%2?C:x,_eosType:Math.max(eI,ew)%2?C:x})}}for(var e_=0;e_<eu.length;e_++){var eM=eu[e_],eS=eM._seqIndices,eD=eM._sosType,eT=eM._eosType,eR=1&o[eS[0]]?C:x;if(n.get(R))for(var eF=0;eF<eS.length;eF++){var eP=eS[eF];if(r[eP]&R){for(var eQ=eD,ez=eF-1;ez>=0;ez--)if(!(r[eS[ez]]&h)){eQ=r[eS[ez]];break}a(eP,eQ&(l|N)?D:eQ)}}if(n.get(B))for(var eL=0;eL<eS.length;eL++){var eO=eS[eL];if(r[eO]&B)for(var eU=eL-1;eU>=-1;eU--){var ek=-1===eU?eD:r[eS[eU]];if(ek&c){ek===F&&a(eO,b);break}}}if(n.get(F))for(var eG=0;eG<eS.length;eG++){var eN=eS[eG];r[eN]&F&&a(eN,C)}if(n.get(w)||n.get(_))for(var eH=1;eH<eS.length-1;eH++){var eV=eS[eH];if(r[eV]&(w|_)){for(var ej=0,eJ=0,eY=eH-1;eY>=0&&(ej=r[eS[eY]])&h;eY--);for(var eW=eH+1;eW<eS.length&&(eJ=r[eS[eW]])&h;eW++);ej===eJ&&(r[eV]===w?ej===B:ej&(B|b))&&a(eV,ej)}}if(n.get(B)){for(var eK=0;eK<eS.length;eK++)if(r[eS[eK]]&B){for(var eq=eK-1;eq>=0&&r[eS[eq]]&(I|h);eq--)a(eS[eq],B);for(eK++;eK<eS.length&&r[eS[eK]]&(I|h|B);eK++)r[eS[eK]]!==B&&a(eS[eK],B)}}if(n.get(I)||n.get(w)||n.get(_))for(var eX=0;eX<eS.length;eX++){var eZ=eS[eX];if(r[eZ]&(I|w|_)){a(eZ,D);for(var e$=eX-1;e$>=0&&r[eS[e$]]&h;e$--)a(eS[e$],D);for(var e1=eX+1;e1<eS.length&&r[eS[e1]]&h;e1++)a(eS[e1],D)}}if(n.get(B))for(var e0=0,e2=eD;e0<eS.length;e0++){var e3=eS[e0],e4=r[e3];e4&B?e2===x&&a(e3,x):e4&c&&(e2=e4)}if(n.get(u)){for(var e5=C|B|b,e6=e5|x,e8=[],e9=[],e7=0;e7<eS.length;e7++)if(r[eS[e7]]&u){var te=e[eS[e7]],tt=void 0;if(null!==y(te)){if(e9.length<63)e9.push({char:te,seqIndex:e7});else break}else if(null!==(tt=v(te)))for(var tr=e9.length-1;tr>=0;tr--){var ti=e9[tr].char;if(ti===tt||ti===v(E(te))||y(E(ti))===te){e8.push([e9[tr].seqIndex,e7]),e9.length=tr;break}}}e8.sort(function(e,t){return e[0]-t[0]});for(var tn=0;tn<e8.length;tn++){for(var ta=e8[tn],to=ta[0],ts=ta[1],tl=!1,tc=0,tu=to+1;tu<ts;tu++){var th=eS[tu];if(r[th]&e6){tl=!0;var tA=r[th]&e5?C:x;if(tA===eR){tc=tA;break}}}if(tl&&!tc){tc=eD;for(var td=to-1;td>=0;td--){var tf=eS[td];if(r[tf]&e6){var tm=r[tf]&e5?C:x;tc=tm!==eR?tm:eR;break}}}if(tc){if(r[eS[to]]=r[eS[ts]]=tc,tc!==eR){for(var tp=to+1;tp<eS.length;tp++)if(!(r[eS[tp]]&h)){f(e[eS[tp]])&R&&(r[eS[tp]]=tc);break}}if(tc!==eR){for(var tg=ts+1;tg<eS.length;tg++)if(!(r[eS[tg]]&h)){f(e[eS[tg]])&R&&(r[eS[tg]]=tc);break}}}}for(var ty=0;ty<eS.length;ty++)if(r[eS[ty]]&u){for(var tv=ty,tE=ty,tx=eD,tC=ty-1;tC>=0;tC--)if(r[eS[tC]]&h)tv=tC;else{tx=r[eS[tC]]&e5?C:x;break}for(var tB=eT,tw=ty+1;tw<eS.length;tw++)if(r[eS[tw]]&(u|h))tE=tw;else{tB=r[eS[tw]]&e5?C:x;break}for(var tI=tv;tI<=tE;tI++)r[eS[tI]]=tx===tB?tx:eR;ty=tE}}}for(var tb=m.start;tb<=m.end;tb++){var t_=o[tb],tM=r[tb];if(1&t_?tM&(x|B|b)&&o[tb]++:tM&C?o[tb]++:tM&(b|B)&&(o[tb]+=2),tM&h&&(o[tb]=0===tb?m.level:o[tb-1]),tb===m.end||f(e[tb])&(S|M))for(var tS=tb;tS>=0&&f(e[tS])&A;tS--)o[tS]=m.level}}return{levels:o,paragraphs:d};function tD(t,i){for(var n=t;n<e.length;n++){var a=r[n];if(a&(C|F))return 1;if(a&(M|x)||i&&a===N)break;if(a&l){var o=function(t){for(var i=1,n=t+1;n<e.length;n++){var a=r[n];if(a&M)break;if(a&N){if(0==--i)return n}else a&l&&i++}return -1}(n);n=-1===o?e.length:o}}return 0}},e.getMirroredCharacter=H,e.getMirroredCharactersMap=function(e,t,r,i){var n=e.length;r=Math.max(0,null==r?0:+r),i=Math.min(n-1,null==i?n-1:+i);for(var a=new Map,o=r;o<=i;o++)if(1&t[o]){var s=H(e[o]);null!==s&&a.set(o,s)}return a},e.getReorderSegments=V,e.getReorderedIndices=j,e.getReorderedString=function(e,t,r,i){var n=j(e,t,r,i),a=[].concat(e);return n.forEach(function(r,i){a[i]=(1&t.levels[r]?H(e[r]):null)||e[r]}),a.join("")},e.openingToClosingBracket=y,Object.defineProperty(e,"__esModule",{value:!0}),e}({})}},4547:function(e,t,r){"use strict";function i(){return function(e){function t(e,t){for(var r,i,n,a,o,s=/([MLQCZ])([^MLQCZ]*)/g;r=s.exec(e);){var l=r[2].replace(/^\s*|\s*$/g,"").split(/[,\s]+/).map(function(e){return parseFloat(e)});switch(r[1]){case"M":a=i=l[0],o=n=l[1];break;case"L":(l[0]!==a||l[1]!==o)&&t("L",a,o,a=l[0],o=l[1]);break;case"Q":t("Q",a,o,a=l[2],o=l[3],l[0],l[1]);break;case"C":t("C",a,o,a=l[4],o=l[5],l[0],l[1],l[2],l[3]);break;case"Z":(a!==i||o!==n)&&t("L",a,o,i,n)}}}function r(e,r,i){void 0===i&&(i=16);var n={x:0,y:0};t(e,function(e,t,a,o,s,l,c,u,h){switch(e){case"L":r(t,a,o,s);break;case"Q":for(var A=t,d=a,f=1;f<i;f++)!function(e,t,r,i,n,a,o,s){var l=1-o;s.x=l*l*e+2*l*o*r+o*o*n,s.y=l*l*t+2*l*o*i+o*o*a}(t,a,l,c,o,s,f/(i-1),n),r(A,d,n.x,n.y),A=n.x,d=n.y;break;case"C":for(var m=t,p=a,g=1;g<i;g++)!function(e,t,r,i,n,a,o,s,l,c){var u=1-l;c.x=u*u*u*e+3*u*u*l*r+3*u*l*l*n+l*l*l*o,c.y=u*u*u*t+3*u*u*l*i+3*u*l*l*a+l*l*l*s}(t,a,l,c,u,h,o,s,g/(i-1),n),r(m,p,n.x,n.y),m=n.x,p=n.y}})}var i="precision highp float;attribute vec2 aUV;varying vec2 vUV;void main(){vUV=aUV;gl_Position=vec4(mix(vec2(-1.0),vec2(1.0),aUV),0.0,1.0);}",n=new WeakMap,a={premultipliedAlpha:!1,preserveDrawingBuffer:!0,antialias:!1,depth:!1};function o(e,t){var r=e.getContext?e.getContext("webgl",a):e,i=n.get(r);if(!i){var o="undefined"!=typeof WebGL2RenderingContext&&r instanceof WebGL2RenderingContext,s={},l={},c={},u=-1,h=[];function A(e){var t=s[e];if(!t&&!(t=s[e]=r.getExtension(e)))throw Error(e+" not supported");return t}function d(e,t){var i=r.createShader(t);return r.shaderSource(i,e),r.compileShader(i),i}function f(){s={},l={},c={},u=-1,h.length=0}r.canvas.addEventListener("webglcontextlost",function(e){f(),e.preventDefault()},!1),n.set(r,i={gl:r,isWebGL2:o,getExtension:A,withProgram:function(e,t,i,n){if(!l[e]){var a={},s={},c=r.createProgram();r.attachShader(c,d(t,r.VERTEX_SHADER)),r.attachShader(c,d(i,r.FRAGMENT_SHADER)),r.linkProgram(c),l[e]={program:c,transaction:function(e){r.useProgram(c),e({setUniform:function(e,t){for(var i=[],n=arguments.length-2;n-- >0;)i[n]=arguments[n+2];var a=s[t]||(s[t]=r.getUniformLocation(c,t));r["uniform"+e].apply(r,[a].concat(i))},setAttribute:function(e,t,i,n,s){var l=a[e];l||(l=a[e]={buf:r.createBuffer(),loc:r.getAttribLocation(c,e),data:null}),r.bindBuffer(r.ARRAY_BUFFER,l.buf),r.vertexAttribPointer(l.loc,t,r.FLOAT,!1,0,0),r.enableVertexAttribArray(l.loc),o?r.vertexAttribDivisor(l.loc,n):A("ANGLE_instanced_arrays").vertexAttribDivisorANGLE(l.loc,n),s!==l.data&&(r.bufferData(r.ARRAY_BUFFER,s,i),l.data=s)}})}}}l[e].transaction(n)},withTexture:function(e,t){u++;try{r.activeTexture(r.TEXTURE0+u);var i=c[e];i||(i=c[e]=r.createTexture(),r.bindTexture(r.TEXTURE_2D,i),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.NEAREST),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.NEAREST)),r.bindTexture(r.TEXTURE_2D,i),t(i,u)}finally{u--}},withTextureFramebuffer:function(e,t,i){var n=r.createFramebuffer();h.push(n),r.bindFramebuffer(r.FRAMEBUFFER,n),r.activeTexture(r.TEXTURE0+t),r.bindTexture(r.TEXTURE_2D,e),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,e,0);try{i(n)}finally{r.deleteFramebuffer(n),r.bindFramebuffer(r.FRAMEBUFFER,h[--h.length-1]||null)}},handleContextLoss:f})}t(i)}function s(e,t,r,n,a,s,l,c){void 0===l&&(l=15),void 0===c&&(c=null),o(e,function(e){var o=e.gl,u=e.withProgram;(0,e.withTexture)("copy",function(e,h){o.texImage2D(o.TEXTURE_2D,0,o.RGBA,a,s,0,o.RGBA,o.UNSIGNED_BYTE,t),u("copy",i,"precision highp float;uniform sampler2D tex;varying vec2 vUV;void main(){gl_FragColor=texture2D(tex,vUV);}",function(e){var t=e.setUniform;(0,e.setAttribute)("aUV",2,o.STATIC_DRAW,0,new Float32Array([0,0,2,0,0,2])),t("1i","image",h),o.bindFramebuffer(o.FRAMEBUFFER,c||null),o.disable(o.BLEND),o.colorMask(8&l,4&l,2&l,1&l),o.viewport(r,n,a,s),o.scissor(r,n,a,s),o.drawArrays(o.TRIANGLES,0,3)})})})}var l=Object.freeze({__proto__:null,withWebGLContext:o,renderImageData:s,resizeWebGLCanvasWithoutClearing:function(e,t,r){var i=e.width,n=e.height;o(e,function(a){var o=a.gl,l=new Uint8Array(i*n*4);o.readPixels(0,0,i,n,o.RGBA,o.UNSIGNED_BYTE,l),e.width=t,e.height=r,s(o,l,0,0,i,n)})}});function c(e,t,i,n,a,o){void 0===o&&(o=1);var s=new Uint8Array(e*t),l=n[2]-n[0],c=n[3]-n[1],u=[];r(i,function(e,t,r,i){u.push({x1:e,y1:t,x2:r,y2:i,minX:Math.min(e,r),minY:Math.min(t,i),maxX:Math.max(e,r),maxY:Math.max(t,i)})}),u.sort(function(e,t){return e.maxX-t.maxX});for(var h=0;h<e;h++)for(var A=0;A<t;A++){var d=function(e,t){for(var r=1/0,i=1/0,n=u.length;n--;){var a=u[n];if(a.maxX+i<=e)break;if(e+i>a.minX&&t-i<a.maxY&&t+i>a.minY){var o=function(e,t,r,i,n,a){var o=n-r,s=a-i,l=o*o+s*s,c=l?Math.max(0,Math.min(1,((e-r)*o+(t-i)*s)/l)):0,u=e-(r+c*o),h=t-(i+c*s);return u*u+h*h}(e,t,a.x1,a.y1,a.x2,a.y2);o<r&&(i=Math.sqrt(r=o))}}return function(e,t){for(var r=0,i=u.length;i--;){var n=u[i];if(n.maxX<=e)break;n.y1>t!=n.y2>t&&e<(n.x2-n.x1)*(t-n.y1)/(n.y2-n.y1)+n.x1&&(r+=n.y1<n.y2?1:-1)}return 0!==r}(e,t)&&(i=-i),i}(n[0]+l*(h+.5)/e,n[1]+c*(A+.5)/t),f=Math.pow(1-Math.abs(d)/a,o)/2;d<0&&(f=1-f),f=Math.max(0,Math.min(255,Math.round(255*f))),s[A*e+h]=f}return s}function u(e,t,r,i,n,a,o,s,l,c){void 0===a&&(a=1),void 0===s&&(s=0),void 0===l&&(l=0),void 0===c&&(c=0),h(e,t,r,i,n,a,o,null,s,l,c)}function h(e,t,r,i,n,a,o,l,u,h,A){void 0===a&&(a=1),void 0===u&&(u=0),void 0===h&&(h=0),void 0===A&&(A=0);for(var d=c(e,t,r,i,n,a),f=new Uint8Array(4*d.length),m=0;m<d.length;m++)f[4*m+A]=d[m];s(o,f,u,h,e,t,1<<3-A,l)}var A=Object.freeze({__proto__:null,generate:c,generateIntoCanvas:u,generateIntoFramebuffer:h}),d=new Float32Array([0,0,2,0,0,2]),f=null,m=!1,p={},g=new WeakMap;function y(e){if(!m&&!C(e))throw Error("WebGL generation not supported")}function v(e,t,r,i,n,a,s){if(void 0===a&&(a=1),void 0===s&&(s=null),!s&&!(s=f)){var l="function"==typeof OffscreenCanvas?new OffscreenCanvas(1,1):"undefined"!=typeof document?document.createElement("canvas"):null;if(!l)throw Error("OffscreenCanvas or DOM canvas not supported");s=f=l.getContext("webgl",{depth:!1})}y(s);var c=new Uint8Array(e*t*4);o(s,function(o){var s=o.gl,l=o.withTexture,u=o.withTextureFramebuffer;l("readable",function(o,l){s.texImage2D(s.TEXTURE_2D,0,s.RGBA,e,t,0,s.RGBA,s.UNSIGNED_BYTE,null),u(o,l,function(o){x(e,t,r,i,n,a,s,o,0,0,0),s.readPixels(0,0,e,t,s.RGBA,s.UNSIGNED_BYTE,c)})})});for(var u=new Uint8Array(e*t),h=0,A=0;h<c.length;h+=4)u[A++]=c[h];return u}function E(e,t,r,i,n,a,o,s,l,c){void 0===a&&(a=1),void 0===s&&(s=0),void 0===l&&(l=0),void 0===c&&(c=0),x(e,t,r,i,n,a,o,null,s,l,c)}function x(e,t,n,a,s,l,c,u,h,A,f){void 0===l&&(l=1),void 0===h&&(h=0),void 0===A&&(A=0),void 0===f&&(f=0),y(c);var m=[];r(n,function(e,t,r,i){m.push(e,t,r,i)}),m=new Float32Array(m),o(c,function(r){var n=r.gl,o=r.isWebGL2,c=r.getExtension,p=r.withProgram,g=r.withTexture,y=r.withTextureFramebuffer,v=r.handleContextLoss;if(g("rawDistances",function(r,g){(e!==r._lastWidth||t!==r._lastHeight)&&n.texImage2D(n.TEXTURE_2D,0,n.RGBA,r._lastWidth=e,r._lastHeight=t,0,n.RGBA,n.UNSIGNED_BYTE,null),p("main","precision highp float;uniform vec4 uGlyphBounds;attribute vec2 aUV;attribute vec4 aLineSegment;varying vec4 vLineSegment;varying vec2 vGlyphXY;void main(){vLineSegment=aLineSegment;vGlyphXY=mix(uGlyphBounds.xy,uGlyphBounds.zw,aUV);gl_Position=vec4(mix(vec2(-1.0),vec2(1.0),aUV),0.0,1.0);}","precision highp float;uniform vec4 uGlyphBounds;uniform float uMaxDistance;uniform float uExponent;varying vec4 vLineSegment;varying vec2 vGlyphXY;float absDistToSegment(vec2 point,vec2 lineA,vec2 lineB){vec2 lineDir=lineB-lineA;float lenSq=dot(lineDir,lineDir);float t=lenSq==0.0 ? 0.0 : clamp(dot(point-lineA,lineDir)/lenSq,0.0,1.0);vec2 linePt=lineA+t*lineDir;return distance(point,linePt);}void main(){vec4 seg=vLineSegment;vec2 p=vGlyphXY;float dist=absDistToSegment(p,seg.xy,seg.zw);float val=pow(1.0-clamp(dist/uMaxDistance,0.0,1.0),uExponent)*0.5;bool crossing=(seg.y>p.y!=seg.w>p.y)&&(p.x<(seg.z-seg.x)*(p.y-seg.y)/(seg.w-seg.y)+seg.x);bool crossingUp=crossing&&vLineSegment.y<vLineSegment.w;gl_FragColor=vec4(crossingUp ? 1.0/255.0 : 0.0,crossing&&!crossingUp ? 1.0/255.0 : 0.0,0.0,val);}",function(i){var u=i.setAttribute,h=i.setUniform,A=!o&&c("ANGLE_instanced_arrays"),f=!o&&c("EXT_blend_minmax");u("aUV",2,n.STATIC_DRAW,0,d),u("aLineSegment",4,n.DYNAMIC_DRAW,1,m),h.apply(void 0,["4f","uGlyphBounds"].concat(a)),h("1f","uMaxDistance",s),h("1f","uExponent",l),y(r,g,function(r){n.enable(n.BLEND),n.colorMask(!0,!0,!0,!0),n.viewport(0,0,e,t),n.scissor(0,0,e,t),n.blendFunc(n.ONE,n.ONE),n.blendEquationSeparate(n.FUNC_ADD,o?n.MAX:f.MAX_EXT),n.clear(n.COLOR_BUFFER_BIT),o?n.drawArraysInstanced(n.TRIANGLES,0,3,m.length/4):A.drawArraysInstancedANGLE(n.TRIANGLES,0,3,m.length/4)})}),p("post",i,"precision highp float;uniform sampler2D tex;varying vec2 vUV;void main(){vec4 color=texture2D(tex,vUV);bool inside=color.r!=color.g;float val=inside ? 1.0-color.a : color.a;gl_FragColor=vec4(val);}",function(r){r.setAttribute("aUV",2,n.STATIC_DRAW,0,d),r.setUniform("1i","tex",g),n.bindFramebuffer(n.FRAMEBUFFER,u),n.disable(n.BLEND),n.colorMask(0===f,1===f,2===f,3===f),n.viewport(h,A,e,t),n.scissor(h,A,e,t),n.drawArrays(n.TRIANGLES,0,3)})}),n.isContextLost())throw v(),Error("webgl context lost")})}function C(e){var t=e&&e!==f?e.canvas||e:p,r=g.get(t);if(void 0===r){m=!0;var i=null;try{var n=[97,106,97,61,99,137,118,80,80,118,137,99,61,97,106,97],a=v(4,4,"M8,8L16,8L24,24L16,24Z",[0,0,32,32],24,1,e);(r=a&&n.length===a.length&&a.every(function(e,t){return e===n[t]}))||(i="bad trial run results",console.info(n,a))}catch(e){r=!1,i=e.message}i&&console.warn("WebGL SDF generation not supported:",i),m=!1,g.set(t,r)}return r}var B=Object.freeze({__proto__:null,generate:v,generateIntoCanvas:E,generateIntoFramebuffer:x,isSupported:C});return e.forEachPathCommand=t,e.generate=function(e,t,r,i,n,a){void 0===n&&(n=Math.max(i[2]-i[0],i[3]-i[1])/2),void 0===a&&(a=1);try{return v.apply(B,arguments)}catch(e){return console.info("WebGL SDF generation failed, falling back to JS",e),c.apply(A,arguments)}},e.generateIntoCanvas=function(e,t,r,i,n,a,o,s,l,c){void 0===n&&(n=Math.max(i[2]-i[0],i[3]-i[1])/2),void 0===a&&(a=1),void 0===s&&(s=0),void 0===l&&(l=0),void 0===c&&(c=0);try{return E.apply(B,arguments)}catch(e){return console.info("WebGL SDF generation failed, falling back to JS",e),u.apply(A,arguments)}},e.javascript=A,e.pathToLineSegments=r,e.webgl=B,e.webglUtils=l,Object.defineProperty(e,"__esModule",{value:!0}),e}({})}r.d(t,{Z:function(){return i}})}}]);